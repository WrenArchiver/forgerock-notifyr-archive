<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[3415]&nbsp;forgerock-rest/trunk:&nbsp;CHF-14/CREST-240&nbsp;CMN-132&nbsp;Replace&nbsp;UriRouter&nbsp;with&nbsp;single&nbsp;&amp;quot;predicate&amp;quot;/RouteMatcher&nbsp;based&nbsp;Router&nbsp;with&nbsp;URI&nbsp;routing&nbsp;support&nbsp;(UriRouteMatcher)&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=3415&quot;&gt;3415&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;phillcunnington&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2015-06-09&nbsp;22:56:23&nbsp;+0100&nbsp;(Tue,&nbsp;09&nbsp;Jun&nbsp;2015)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;CHF-14/CREST-240&nbsp;CMN-132&nbsp;Replace&nbsp;UriRouter&nbsp;with&nbsp;single&nbsp;&amp;quot;predicate&amp;quot;/RouteMatcher&nbsp;based&nbsp;Router&nbsp;with&nbsp;URI&nbsp;routing&nbsp;support&nbsp;(UriRouteMatcher)&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceResourcesjava&quot;&gt;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Resources.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRoutejava&quot;&gt;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Route.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceContextTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ContextTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceFiltersTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/FiltersTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceMemoryBackendTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/MemoryBackendTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceResourcesTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ResourcesTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceVersionedRouterTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDemoUtilsjava&quot;&gt;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDynamicRealmDemojava&quot;&gt;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesVersionedResourcesDemojava&quot;&gt;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourcehttpexamplesCrestHttpApplicationjava&quot;&gt;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/CrestHttpApplication.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourcehttpexamplesMemoryBackendHandlerjava&quot;&gt;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/MemoryBackendHandler.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpHttpAdapterjava&quot;&gt;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/HttpAdapter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpRequestRunnerjava&quot;&gt;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/RequestRunner.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRouteMatchersjava&quot;&gt;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/RouteMatchers.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRouterjava&quot;&gt;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Router.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceRouterTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceUriRouterjava&quot;&gt;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceUriRouterTestjava&quot;&gt;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/UriRouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceResourcesjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Resources.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Resources.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Resources.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-18,13&nbsp;+18,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.EQUALS;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.util.promise.Promises.newResultPromise;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.LinkedHashMap;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.RouterContext;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.ServerContext;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonPointer;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.promise.Promise;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-148,19&nbsp;+149,19&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;RequestHandler&nbsp;newCollection(final&nbsp;Object&nbsp;provider)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;fromInterface&nbsp;=&nbsp;provider&nbsp;instanceof&nbsp;CollectionResourceProvider;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Route&nbsp;requests&nbsp;to&nbsp;the&nbsp;collection/instance&nbsp;using&nbsp;a&nbsp;router.<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;route&nbsp;for&nbsp;the&nbsp;collection.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;collectionHandler&nbsp;=&nbsp;fromInterface&nbsp;?<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InterfaceCollectionHandler((CollectionResourceProvider)&nbsp;provider)&nbsp;:<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;AnnotatedCollectionHandler(provider);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(EQUALS,&nbsp;&amp;quot;&amp;quot;,&nbsp;collectionHandler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(EQUALS,&nbsp;&amp;quot;&amp;quot;),&nbsp;collectionHandler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;route&nbsp;for&nbsp;the&nbsp;instances&nbsp;within&nbsp;the&nbsp;collection.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;instanceHandler&nbsp;=&nbsp;fromInterface&nbsp;?<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InterfaceCollectionInstance((CollectionResourceProvider)&nbsp;provider)&nbsp;:<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;AnnotationCollectionInstance(provider);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(EQUALS,&nbsp;&amp;quot;{id}&amp;quot;,&nbsp;instanceHandler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(EQUALS,&nbsp;&amp;quot;{id}&amp;quot;),&nbsp;instanceHandler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;router;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRoutejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Route.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Route.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Route.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,17&nbsp;+11,17&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;a&nbsp;route&nbsp;which&nbsp;has&nbsp;been&nbsp;registered&nbsp;in&nbsp;a&nbsp;{@link&nbsp;UriRouter&nbsp;uriRouter}&nbsp;or<br>
-&nbsp;*&nbsp;{@link&nbsp;VersionRouter&nbsp;versionRouter}.&nbsp;A&nbsp;reference&nbsp;to&nbsp;a&nbsp;route&nbsp;should&nbsp;be&nbsp;maintained&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;chance&nbsp;that&nbsp;the&nbsp;route<br>
-&nbsp;*&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;removed&nbsp;from&nbsp;the&nbsp;router&nbsp;at&nbsp;a&nbsp;later&nbsp;time.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;a&nbsp;route&nbsp;which&nbsp;has&nbsp;been&nbsp;registered&nbsp;in&nbsp;a<br>
+&nbsp;*&nbsp;{@link&nbsp;VersionRouter&nbsp;versionRouter}.&nbsp;A&nbsp;reference&nbsp;to&nbsp;a&nbsp;route&nbsp;should&nbsp;be<br>
+&nbsp;*&nbsp;maintained&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;chance&nbsp;that&nbsp;the&nbsp;route&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;removed&nbsp;from<br>
+&nbsp;*&nbsp;the&nbsp;router&nbsp;at&nbsp;a&nbsp;later&nbsp;time.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;@see&nbsp;UriRouter<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@see&nbsp;VersionRouter<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;interface&nbsp;Route&nbsp;{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRouteMatchersjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/RouteMatchers.java&nbsp;(0&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/RouteMatchers.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/RouteMatchers.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,84&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.json.resource;<br>
+<br>
+import&nbsp;static&nbsp;org.forgerock.http.routing.RouteMatchers.uriMatcher;<br>
+<br>
+import&nbsp;org.forgerock.http.Context;<br>
+import&nbsp;org.forgerock.http.ResourcePath;<br>
+import&nbsp;org.forgerock.http.RoutingMode;<br>
+import&nbsp;org.forgerock.http.routing.RouteMatch;<br>
+import&nbsp;org.forgerock.http.routing.RouteMatcher;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;utility&nbsp;class&nbsp;that&nbsp;contains&nbsp;methods&nbsp;for&nbsp;creating&nbsp;route&nbsp;matchers.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;3.0.0<br>
+&nbsp;*/<br>
+public&nbsp;final&nbsp;class&nbsp;RouteMatchers&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;{@code&nbsp;RouteMatcher}&nbsp;instance&nbsp;that&nbsp;matches&nbsp;{@code&nbsp;Request}s<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;with&nbsp;the&nbsp;provided&nbsp;{@literal&nbsp;mode}&nbsp;and&nbsp;{@literal&nbsp;template}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mode&nbsp;The&nbsp;routing&nbsp;mode.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;template&nbsp;The&nbsp;uri&nbsp;template.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;{@code&nbsp;RouteMatcher}&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;RouteMatcher&amp;lt;Request&amp;gt;&nbsp;requestUriMatcher(RoutingMode&nbsp;mode,&nbsp;String&nbsp;template)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RequestUriRoutePredicate(uriMatcher(mode,&nbsp;template));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;A&nbsp;CREST&nbsp;specific&nbsp;{@code&nbsp;RouteMatcher}&nbsp;which&nbsp;extracts&nbsp;the&nbsp;requests<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;resource&nbsp;name&nbsp;from&nbsp;a&nbsp;{@code&nbsp;Request}&nbsp;and&nbsp;passes&nbsp;it&nbsp;as&nbsp;a<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;ResourcePath}&nbsp;to&nbsp;the&nbsp;common&nbsp;{@code&nbsp;ResourcePath}&nbsp;route&nbsp;predicate.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@since&nbsp;3.0.0<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;class&nbsp;RequestUriRoutePredicate&nbsp;extends&nbsp;RouteMatcher&amp;lt;Request&amp;gt;&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;RouteMatcher&amp;lt;ResourcePath&amp;gt;&nbsp;delegate;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestUriRoutePredicate(RouteMatcher&amp;lt;ResourcePath&amp;gt;&nbsp;delegate)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.delegate&nbsp;=&nbsp;delegate;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;RouteMatch&nbsp;evaluate(Context&nbsp;context,&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.evaluate(context,&nbsp;request.getResourcePathObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;toString()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.toString();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;equals(Object&nbsp;o)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this&nbsp;==&nbsp;o)&nbsp;return&nbsp;true;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(o&nbsp;instanceof&nbsp;RequestUriRoutePredicate))&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestUriRoutePredicate&nbsp;that&nbsp;=&nbsp;(RequestUriRoutePredicate)&nbsp;o;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.equals(that.delegate);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;hashCode()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.hashCode();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceRouterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp;(0&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,260&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.json.resource;<br>
+<br>
+import&nbsp;org.forgerock.http.Context;<br>
+import&nbsp;org.forgerock.http.ServerContext;<br>
+import&nbsp;org.forgerock.http.routing.AbstractRouter;<br>
+import&nbsp;org.forgerock.http.routing.IncomparableRouteMatchException;<br>
+import&nbsp;org.forgerock.http.routing.RouteMatcher;<br>
+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.util.Pair;<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+<br>
+import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.EQUALS;<br>
+import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.STARTS_WITH;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.*;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newCollection;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newSingleton;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
+import&nbsp;static&nbsp;org.forgerock.util.promise.Promises.newExceptionPromise;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;router&nbsp;which&nbsp;routes&nbsp;requests&nbsp;based&nbsp;on&nbsp;route&nbsp;predicates.&nbsp;Each&nbsp;route&nbsp;is<br>
+&nbsp;*&nbsp;comprised&nbsp;of&nbsp;a&nbsp;{@link&nbsp;RouteMatcher&nbsp;route&nbsp;matcher}&nbsp;and&nbsp;a&nbsp;corresponding<br>
+&nbsp;*&nbsp;handler,&nbsp;when&nbsp;routing&nbsp;a&nbsp;request&nbsp;the&nbsp;router&nbsp;will&nbsp;call<br>
+&nbsp;*&nbsp;{@link&nbsp;RouteMatcher&amp;lt;Request&amp;gt;#evaluate(Context,&nbsp;Request)}&nbsp;for&nbsp;each<br>
+&nbsp;*&nbsp;registered&nbsp;route&nbsp;and&nbsp;use&nbsp;the&nbsp;returned&nbsp;{@link&nbsp;RouteMatcher}&nbsp;to&nbsp;determine<br>
+&nbsp;*&nbsp;which&nbsp;route&nbsp;best&nbsp;matches&nbsp;the&nbsp;request.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;Routes&nbsp;may&nbsp;be&nbsp;added&nbsp;and&nbsp;removed&nbsp;from&nbsp;a&nbsp;router&nbsp;as&nbsp;follows:<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
+&nbsp;*&nbsp;Handler&nbsp;users&nbsp;=&nbsp;...;<br>
+&nbsp;*&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+&nbsp;*&nbsp;RouteMatcher&nbsp;routeOne&nbsp;=&nbsp;RouteMatchers.requestUriMatcher(EQUALS,&nbsp;&amp;amp;quot;users&amp;amp;quot;);<br>
+&nbsp;*&nbsp;RouteMatcher&nbsp;routeTwo&nbsp;=&nbsp;RouteMatchers.requestUriMatcher(EQUALS,&nbsp;&amp;amp;quot;users/{userId}&amp;amp;quot;);<br>
+&nbsp;*&nbsp;router.addRoute(routeOne,&nbsp;users);<br>
+&nbsp;*&nbsp;router.addRoute(routeTwo,&nbsp;users);<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;//&nbsp;Deregister&nbsp;a&nbsp;route.<br>
+&nbsp;*&nbsp;router.removeRoute(routeOne,&nbsp;routeTwo);<br>
+&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;AbstractRouter<br>
+&nbsp;*&nbsp;@see&nbsp;RouteMatchers<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;3.0.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;Router&nbsp;extends&nbsp;AbstractRouter&amp;lt;Router,&nbsp;Request,&nbsp;RequestHandler&amp;gt;&nbsp;implements&nbsp;RequestHandler&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;with&nbsp;no&nbsp;routes&nbsp;defined.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;containing&nbsp;the&nbsp;same&nbsp;routes&nbsp;and&nbsp;default&nbsp;route&nbsp;as&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provided&nbsp;router.&nbsp;Changes&nbsp;to&nbsp;the&nbsp;returned&nbsp;router's&nbsp;routing&nbsp;table&nbsp;will&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;impact&nbsp;the&nbsp;provided&nbsp;router.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router&nbsp;The&nbsp;router&nbsp;to&nbsp;be&nbsp;copied.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router(AbstractRouter&amp;lt;Router,&nbsp;Request,&nbsp;RequestHandler&amp;gt;&nbsp;router)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(router);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;Router&nbsp;getThis()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;collection&nbsp;resource<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;requests.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;provided&nbsp;URI&nbsp;template&nbsp;must&nbsp;match&nbsp;the&nbsp;resource&nbsp;collection&nbsp;itself,&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;resource&nbsp;instances.&nbsp;For&nbsp;example:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;CollectionResourceProvider&nbsp;users&nbsp;=&nbsp;...;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;valid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;the&nbsp;resource&nbsp;collection.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;invalid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;resource&nbsp;instances.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users/{userId}&amp;quot;,&nbsp;users);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;collection&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;be&nbsp;routed.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addRoute(String&nbsp;uriTemplate,&nbsp;CollectionResourceProvider&nbsp;provider)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addRoute(requestUriMatcher(STARTS_WITH,&nbsp;uriTemplate),&nbsp;newCollection(provider));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;singleton&nbsp;resource<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;requests.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;singleton&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;be&nbsp;routed.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addRoute(String&nbsp;uriTemplate,&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addRoute(requestUriMatcher(EQUALS,&nbsp;uriTemplate),&nbsp;newSingleton(provider));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;getBestMatch(ServerContext&nbsp;context,&nbsp;Request&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bestMatch&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;NotFoundException(String.format(&amp;quot;Resource&nbsp;'%s'&nbsp;not&nbsp;found&amp;quot;,&nbsp;request.getResourcePath()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IncomparableRouteMatchException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;InternalServerErrorException(e.getMessage(),&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;JsonValue,&nbsp;ResourceException&amp;gt;&nbsp;handleAction(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfActionRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleAction((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleCreate(ServerContext&nbsp;context,&nbsp;CreateRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfCreateRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleCreate((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleDelete(ServerContext&nbsp;context,&nbsp;DeleteRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfDeleteRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleDelete((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handlePatch(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfPatchRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handlePatch((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;QueryResult,&nbsp;ResourceException&amp;gt;&nbsp;handleQuery(ServerContext&nbsp;context,&nbsp;QueryRequest&nbsp;request,&nbsp;QueryResourceHandler&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfQueryRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleQuery((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest,&nbsp;handler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleRead(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfReadRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleRead((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleUpdate(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&amp;lt;Context,&nbsp;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestMatch(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RouterContext&nbsp;routerContext&nbsp;=&nbsp;getRouterContext(bestMatch.getFirst());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;routedRequest&nbsp;=&nbsp;wasRouted(routerContext,&nbsp;request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfUpdateRequest(request).setResourcePath(getResourcePath(routerContext))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getSecond().handleUpdate((ServerContext)&nbsp;bestMatch.getFirst(),&nbsp;routedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RouterContext&nbsp;getRouterContext(Context&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context.containsContext(RouterContext.class))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;context.asContext(RouterContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;boolean&nbsp;wasRouted(RouterContext&nbsp;routerContext,&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;routerContext&nbsp;!=&nbsp;null&nbsp;&amp;amp;&amp;amp;&nbsp;!routerContext.getRemainingUri().equals(request.getResourcePath());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;getResourcePath(RouterContext&nbsp;routerContext)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;routerContext.getRemainingUri();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrcmainjavaorgforgerockjsonresourceUriRouterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,255&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2012-2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.EQUALS;<br>
-import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.STARTS_WITH;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.*;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newCollection;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newSingleton;<br>
-import&nbsp;static&nbsp;org.forgerock.util.promise.Promises.newExceptionPromise;<br>
-<br>
-import&nbsp;org.forgerock.http.AbstractUriRouter;<br>
-import&nbsp;org.forgerock.http.RouteMatcher;<br>
-import&nbsp;org.forgerock.http.RouteNotFoundException;<br>
-import&nbsp;org.forgerock.http.ServerContext;<br>
-import&nbsp;org.forgerock.http.UriRoute;<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.util.promise.Promise;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;A&nbsp;request&nbsp;handler&nbsp;which&nbsp;routes&nbsp;requests&nbsp;using&nbsp;URI&nbsp;template&nbsp;matching&nbsp;against<br>
-&nbsp;*&nbsp;the&nbsp;request's&nbsp;resource&nbsp;name.&nbsp;Examples&nbsp;of&nbsp;valid&nbsp;URI&nbsp;templates&nbsp;include:<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;users<br>
-&nbsp;*&nbsp;users/{userId}<br>
-&nbsp;*&nbsp;users/{userId}/devices<br>
-&nbsp;*&nbsp;users/{userId}/devices/{deviceId}<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Routes&nbsp;may&nbsp;be&nbsp;added&nbsp;and&nbsp;removed&nbsp;from&nbsp;a&nbsp;router&nbsp;as&nbsp;follows:<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;RequestHandler&nbsp;users&nbsp;=&nbsp;...;<br>
-&nbsp;*&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;*&nbsp;Route&nbsp;r1&nbsp;=&nbsp;router.addRoute(EQUALS,&nbsp;&amp;amp;quot;users&amp;amp;quot;,&nbsp;users);<br>
-&nbsp;*&nbsp;Route&nbsp;r2&nbsp;=&nbsp;router.addRoute(EQUALS,&nbsp;&amp;amp;quot;users/{userId}&amp;amp;quot;,&nbsp;users);<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;//&nbsp;Deregister&nbsp;a&nbsp;route.<br>
-&nbsp;*&nbsp;router.removeRoute(r1,&nbsp;r2);<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;A&nbsp;request&nbsp;handler&nbsp;receiving&nbsp;a&nbsp;routed&nbsp;request&nbsp;may&nbsp;access&nbsp;the&nbsp;associated<br>
-&nbsp;*&nbsp;route's&nbsp;URI&nbsp;template&nbsp;variables&nbsp;via<br>
-&nbsp;*&nbsp;{@link&nbsp;org.forgerock.http.RouterContext#getUriTemplateVariables()}.&nbsp;For&nbsp;example,&nbsp;a&nbsp;request<br>
-&nbsp;*&nbsp;handler&nbsp;processing&nbsp;requests&nbsp;for&nbsp;the&nbsp;route&nbsp;users/{userId}&nbsp;may&nbsp;obtain&nbsp;the&nbsp;value<br>
-&nbsp;*&nbsp;of&nbsp;{@code&nbsp;userId}&nbsp;as&nbsp;follows:<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;String&nbsp;userId&nbsp;=&nbsp;context.asContext(RouterContext.class).getUriTemplateVariables().get(&amp;amp;quot;userId&amp;amp;quot;);<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;During&nbsp;routing&nbsp;resource&nbsp;names&nbsp;are&nbsp;&amp;quot;relativized&amp;quot;&nbsp;by&nbsp;removing&nbsp;the&nbsp;leading&nbsp;path<br>
-&nbsp;*&nbsp;components&nbsp;which&nbsp;matched&nbsp;the&nbsp;template.&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for<br>
-&nbsp;*&nbsp;{@link&nbsp;org.forgerock.http.RouterContext}&nbsp;for&nbsp;more&nbsp;information.<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
-&nbsp;*&nbsp;&amp;lt;b&amp;gt;NOTE:&amp;lt;/b&amp;gt;&nbsp;for&nbsp;simplicity&nbsp;this&nbsp;implementation&nbsp;only&nbsp;supports&nbsp;a&nbsp;small&nbsp;sub-set<br>
-&nbsp;*&nbsp;of&nbsp;the&nbsp;functionality&nbsp;described&nbsp;in&nbsp;RFC&nbsp;6570.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;@see&nbsp;org.forgerock.http.RouterContext<br>
-&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://tools.ietf.org/html/rfc6570&amp;quot;&amp;gt;RFC&nbsp;6570&nbsp;-&nbsp;URI&nbsp;Template<br>
-&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/a&amp;gt;<br>
-&nbsp;*/<br>
-public&nbsp;final&nbsp;class&nbsp;UriRouter&nbsp;extends&nbsp;AbstractUriRouter&amp;lt;UriRouter,&nbsp;RequestHandler&amp;gt;&nbsp;implements&nbsp;RequestHandler&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;with&nbsp;no&nbsp;routes&nbsp;defined.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;containing&nbsp;the&nbsp;same&nbsp;routes&nbsp;and&nbsp;default&nbsp;route&nbsp;as&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provided&nbsp;router.&nbsp;Changes&nbsp;to&nbsp;the&nbsp;returned&nbsp;router's&nbsp;routing&nbsp;table&nbsp;will&nbsp;not<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;impact&nbsp;the&nbsp;provided&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;router&nbsp;to&nbsp;be&nbsp;copied.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter(final&nbsp;UriRouter&nbsp;router)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;UriRouter&nbsp;getThis()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;collection&nbsp;resource<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;provided&nbsp;URI&nbsp;template&nbsp;must&nbsp;match&nbsp;the&nbsp;resource&nbsp;collection&nbsp;itself,&nbsp;not<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;resource&nbsp;instances.&nbsp;For&nbsp;example:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;CollectionResourceProvider&nbsp;users&nbsp;=&nbsp;...;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;valid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;the&nbsp;resource&nbsp;collection.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;invalid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;resource&nbsp;instances.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users/{userId}&amp;quot;,&nbsp;users);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;paths&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;collection&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;be&nbsp;routed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;later.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRoute&amp;lt;RequestHandler&amp;gt;&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CollectionResourceProvider&nbsp;provider)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(STARTS_WITH,&nbsp;uriTemplate,&nbsp;newCollection(provider));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;singleton&nbsp;resource<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;paths&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;singleton&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;be&nbsp;routed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;later.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRoute&amp;lt;RequestHandler&amp;gt;&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,&nbsp;final&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(EQUALS,&nbsp;uriTemplate,&nbsp;newSingleton(provider));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;JsonValue,&nbsp;ResourceException&amp;gt;&nbsp;handleAction(final&nbsp;ServerContext&nbsp;context,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ActionRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ActionRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfActionRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleAction(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleCreate(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;CreateRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CreateRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfCreateRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleCreate(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleDelete(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;DeleteRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;DeleteRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfDeleteRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleDelete(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handlePatch(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;PatchRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PatchRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfPatchRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handlePatch(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;QueryResult,&nbsp;ResourceException&amp;gt;&nbsp;handleQuery(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;QueryRequest&nbsp;request,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;QueryResourceHandler&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;QueryRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfQueryRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleQuery(bestMatch.getContext(),&nbsp;routedRequest,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleRead(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;ReadRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfReadRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleRead(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;handleUpdate(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;UpdateRequest&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;bestMatch&nbsp;=&nbsp;getBestRoute(context,&nbsp;request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UpdateRequest&nbsp;routedRequest&nbsp;=&nbsp;bestMatch.wasRouted()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;copyOfUpdateRequest(request).setResourcePath(bestMatch.getRemaining())<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;request;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bestMatch.getHandler().handleUpdate(bestMatch.getContext(),&nbsp;routedRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newExceptionPromise(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RouteMatcher&amp;lt;RequestHandler&amp;gt;&nbsp;getBestRoute(final&nbsp;ServerContext&nbsp;context,&nbsp;final&nbsp;Request&nbsp;request)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getBestRoute(context,&nbsp;request.getResourcePath());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(RouteNotFoundException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;i18n<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;NotFoundException(String.format(&amp;quot;Resource&nbsp;'%s'&nbsp;not&nbsp;found&amp;quot;,&nbsp;request.getResourcePath()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceContextTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ContextTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,7&nbsp;+11,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2012-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2012-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-20,7&nbsp;+20,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.RootContext;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.RouterContext;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.ServerContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.testng.annotations.Test;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-77,7&nbsp;+77,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Context&nbsp;root&nbsp;=&nbsp;new&nbsp;RootContext(&amp;quot;root-id&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;InternalServerContext&nbsp;internal&nbsp;=&nbsp;new&nbsp;InternalServerContext(root);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;server&nbsp;=&nbsp;new&nbsp;ServerContext(internal);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouterContext&nbsp;router&nbsp;=&nbsp;new&nbsp;RouterContext(server,&nbsp;&amp;quot;test&amp;quot;,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;String&amp;gt;(0));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RouterContext&nbsp;router&nbsp;=&nbsp;new&nbsp;RouterContext(server,&nbsp;&amp;quot;test&amp;quot;,&nbsp;&amp;quot;&amp;quot;,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;String&amp;gt;(0));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;InternalServerContext&nbsp;internal2&nbsp;=&nbsp;new&nbsp;InternalServerContext(router);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(server.asContext(RootContext.class)).isSameAs(root);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceFiltersTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/FiltersTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/FiltersTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/FiltersTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-142,14&nbsp;+142,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMatchResourceNameFalse()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMatchResourcePathFalse()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FilterCondition&nbsp;condition&nbsp;=&nbsp;Filters.matchResourcePath(&amp;quot;nomatch/name&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Request&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(&amp;quot;resource/name&amp;quot;,&nbsp;&amp;quot;test&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(condition.matches(null,&nbsp;request)).isFalse();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMatchResourceNameTrue()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMatchResourcePathTrue()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FilterCondition&nbsp;condition&nbsp;=&nbsp;Filters.matchResourcePath(&amp;quot;resource/.*&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Request&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(&amp;quot;resource/name&amp;quot;,&nbsp;&amp;quot;test&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(condition.matches(null,&nbsp;request)).isTrue();<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceMemoryBackendTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/MemoryBackendTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/MemoryBackendTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/MemoryBackendTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-223,7&nbsp;+223,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Connection&nbsp;getConnection()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;MemoryBackend&nbsp;users&nbsp;=&nbsp;new&nbsp;MemoryBackend();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;newInternalConnection(router);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceResourcesTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ResourcesTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ResourcesTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/ResourcesTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,6&nbsp;+19,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.EQUALS;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.STARTS_WITH;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.*;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.TestUtils.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.test.assertj.AssertJResourceAssert.assertThat;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.test.assertj.AssertJJsonValueAssert.assertThatJsonValue;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-494,8&nbsp;+495,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;createHandler(boolean&nbsp;collection,&nbsp;Object&nbsp;provider)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;handler&nbsp;=&nbsp;collection&nbsp;?&nbsp;Resources.newCollection(provider)&nbsp;:&nbsp;Resources.newSingleton(provider);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(collection&nbsp;?&nbsp;STARTS_WITH&nbsp;:&nbsp;EQUALS,&nbsp;&amp;quot;test&amp;quot;,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(collection&nbsp;?&nbsp;STARTS_WITH&nbsp;:&nbsp;EQUALS,&nbsp;&amp;quot;test&amp;quot;),&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;router;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceRouterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp;(0&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,461&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.json.resource;<br>
+<br>
+import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
+import&nbsp;static&nbsp;org.assertj.core.api.Assertions.failBecauseExceptionWasNotThrown;<br>
+import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.EQUALS;<br>
+import&nbsp;static&nbsp;org.forgerock.http.RoutingMode.STARTS_WITH;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
+import&nbsp;static&nbsp;org.forgerock.util.test.assertj.AssertJPromiseAssert.assertThat;<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.*;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+<br>
+import&nbsp;java.util.Collections;<br>
+<br>
+import&nbsp;org.forgerock.http.Context;<br>
+import&nbsp;org.forgerock.http.ResourcePath;<br>
+import&nbsp;org.forgerock.http.ServerContext;<br>
+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+import&nbsp;org.testng.annotations.BeforeClass;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.DataProvider;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+public&nbsp;class&nbsp;RouterTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Router&nbsp;router;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;routeOneHandler;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;routeTwoHandler;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;defaultRouteHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeClass<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setupClass()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routeOneHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routeTwoHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setup()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;data()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users/demo&amp;quot;,&nbsp;routeOneHandler},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;config&amp;quot;,&nbsp;routeTwoHandler},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups/admin&amp;quot;,&nbsp;defaultRouteHandler},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;creatingRouterFromExistingRouterShouldCopyAllRoutes(String&nbsp;requestUri,&nbsp;RequestHandler&nbsp;expectedHandler)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(STARTS_WITH,&nbsp;&amp;quot;users/{id}&amp;quot;),&nbsp;routeOneHandler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(EQUALS,&nbsp;&amp;quot;config&amp;quot;),&nbsp;routeTwoHandler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;newRouter&nbsp;=&nbsp;new&nbsp;Router(router);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;mockRequest(ReadRequest.class,&nbsp;requestUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newRouter.handleRead(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(expectedHandler).handleRead(any(ServerContext.class),&nbsp;any(ReadRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAddRouteToCollectionResourceProvider()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollectionResourceProvider&nbsp;provider&nbsp;=&nbsp;mock(CollectionResourceProvider.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;mockRequest(ReadRequest.class,&nbsp;&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;provider);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).readInstance(any(ServerContext.class),&nbsp;anyString(),&nbsp;any(ReadRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAddRouteToSingletonResourceProvider()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SingletonResourceProvider&nbsp;provider&nbsp;=&nbsp;mock(SingletonResourceProvider.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;mockRequest(ReadRequest.class,&nbsp;&amp;quot;config&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;config&amp;quot;,&nbsp;provider);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).readInstance(any(ServerContext.class),&nbsp;any(ReadRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;testData()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;&amp;quot;,&nbsp;true},&nbsp;//&nbsp;wasRouted&nbsp;=&nbsp;true<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users/demo&amp;quot;,&nbsp;false},&nbsp;//&nbsp;wasRouted&nbsp;=&nbsp;false<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleActionShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;mock(ActionRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleAction(any(ServerContext.class),&nbsp;any(ActionRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleAction(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCreateShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;mock(CreateRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleCreate(any(ServerContext.class),&nbsp;any(CreateRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleCreate(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleDeleteShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;mock(DeleteRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleDelete(any(ServerContext.class),&nbsp;any(DeleteRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleDelete(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handlePatchShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;mock(PatchRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handlePatch(any(ServerContext.class),&nbsp;any(PatchRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handlePatch(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleQueryShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;mock(QueryRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResourceHandler&nbsp;resourceHandler&nbsp;=&nbsp;mock(QueryResourceHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;resourceHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleQuery(any(ServerContext.class),&nbsp;any(QueryRequest.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any(QueryResourceHandler.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleQuery(any(ServerContext.class),&nbsp;eq(request),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any(QueryResourceHandler.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleReadShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;mock(ReadRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleRead(any(ServerContext.class),&nbsp;any(ReadRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleRead(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;testData&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleUpdateShouldCallBestRoute(String&nbsp;remainingUri,&nbsp;boolean&nbsp;expectedRequestToBeCopied)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;defaultRouteHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;newRouterContext(mock(ServerContext.class),&nbsp;remainingUri);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;mock(UpdateRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(defaultRouteHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectedRequestToBeCopied)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleUpdate(any(ServerContext.class),&nbsp;any(UpdateRequest.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(defaultRouteHandler).handleUpdate(any(ServerContext.class),&nbsp;eq(request));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCreateShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;mock(CreateRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleCreate(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleReadShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;mock(ReadRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleRead(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleUpdateShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;mock(UpdateRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleUpdate(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleDeleteShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;mock(DeleteRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleDelete(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handlePatchShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;mock(PatchRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Resource,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handlePatch(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleActionShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;mock(ActionRequest.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;JsonValue,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleAction(context,&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleQueryShouldReturn404ResponseExceptionIfNoRouteFound()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;mock(ServerContext.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;mock(QueryRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResourceHandler&nbsp;resultHandler&nbsp;=&nbsp;mock(QueryResourceHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(&amp;quot;users/demo&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;QueryResult,&nbsp;ResourceException&amp;gt;&nbsp;promise&nbsp;=&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;resultHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise).failedWithException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.getOrThrowUninterruptibly();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failBecauseExceptionWasNotThrown(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getCode()).isEqualTo(404);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(e.getMessage()).isEqualTo(&amp;quot;Resource&nbsp;'users/demo'&nbsp;not&nbsp;found&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerContext&nbsp;newRouterContext(Context&nbsp;parentContext,&nbsp;String&nbsp;remainingUri)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RouterContext(parentContext,&nbsp;&amp;quot;MATCHED_URI&amp;quot;,&nbsp;remainingUri,&nbsp;Collections.&amp;lt;String,&nbsp;String&amp;gt;emptyMap());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;&amp;lt;T&nbsp;extends&nbsp;Request&amp;gt;&nbsp;T&nbsp;mockRequest(Class&amp;lt;T&amp;gt;&nbsp;clazz,&nbsp;String&nbsp;resourcePath)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;request&nbsp;=&nbsp;mock(clazz);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePath()).willReturn(resourcePath);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getResourcePathObject()).willReturn(ResourcePath.valueOf(resourcePath));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceUriRouterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/UriRouterTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/UriRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/UriRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,283&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2012-2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newReadRequest;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
-<br>
-import&nbsp;org.forgerock.http.Context;<br>
-import&nbsp;org.forgerock.http.RootContext;<br>
-import&nbsp;org.forgerock.http.RouterContext;<br>
-import&nbsp;org.forgerock.http.RoutingMode;<br>
-import&nbsp;org.forgerock.http.ServerContext;<br>
-import&nbsp;org.forgerock.util.promise.Promise;<br>
-import&nbsp;org.mockito.ArgumentCaptor;<br>
-import&nbsp;org.mockito.Matchers;<br>
-import&nbsp;org.testng.annotations.DataProvider;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-import&nbsp;java.util.Collections;<br>
-import&nbsp;java.util.LinkedHashMap;<br>
-import&nbsp;java.util.Map;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Tests&nbsp;{@code&nbsp;Router}.<br>
-&nbsp;*/<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;final&nbsp;class&nbsp;UriRouterTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;starts&nbsp;with&nbsp;match<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;more&nbsp;precedence&nbsp;tests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;test&nbsp;collection/singleton<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;route&nbsp;registration/deregistation<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;absoluteRouteHitTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;resource&nbsp;name&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b/c&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/two/three&amp;quot;&nbsp;},&nbsp;//&nbsp;Check&nbsp;multi-char&nbsp;path&nbsp;elements.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;absoluteRouteHitTestData&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testAbsoluteRouteHit(final&nbsp;String&nbsp;resourcePath)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;resourcePath,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourcePath);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h).handleRead(rc.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;resourcePath);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri,&nbsp;final&nbsp;String&nbsp;key,&nbsp;final&nbsp;String&nbsp;value)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;expectedMatchedUri,&nbsp;Collections.singletonMap(key,&nbsp;value));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;expectedMatchedUri,&nbsp;Collections.&amp;lt;String,&nbsp;String&amp;gt;&nbsp;emptyMap());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri,&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;String&amp;gt;&nbsp;expectedUriTemplateVariables)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getParent()).isSameAs(c);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getMatchedUri()).isEqualTo(expectedMatchedUri);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getBaseUri()).isEqualTo(expectedMatchedUri);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getUriTemplateVariables()).isEqualTo(expectedUriTemplateVariables);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkReadRequest(ArgumentCaptor&amp;lt;ReadRequest&amp;gt;&nbsp;rr,&nbsp;ReadRequest&nbsp;r)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rr.getValue().getFields()).isEqualTo(r.getFields());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rr.getValue().getRequestType()).isEqualTo(r.getRequestType());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rr.getValue().getResourcePath()).isEqualTo(r.getResourcePath());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testDefaultRouteWithOne()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h1&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;users&amp;quot;,&nbsp;h1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h2&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(h2);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;ReadRequest&amp;gt;&nbsp;rr&nbsp;=&nbsp;ArgumentCaptor.forClass(ReadRequest.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h2).handleRead(rc.capture(),&nbsp;rr.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;&amp;quot;&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkReadRequest(rr,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testDefaultRouteWithZero()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setDefaultRoute(h);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;ReadRequest&amp;gt;&nbsp;rr&nbsp;=&nbsp;ArgumentCaptor.forClass(ReadRequest.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h).handleRead(rc.capture(),&nbsp;rr.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;&amp;quot;&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkReadRequest(rr,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;invalidTemplatesTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;invalid&nbsp;template&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{}&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a/{b}&amp;quot;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;invalidTemplatesTestData&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testInvalidTemplates(final&nbsp;String&nbsp;template)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMultipleRoutePrecedence()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h1&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;object&amp;quot;,&nbsp;h1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h2&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;{objectId}&amp;quot;,&nbsp;h2);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r1&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc1&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h1).handleRead(rc1.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc1,&nbsp;c,&nbsp;&amp;quot;object&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r2&nbsp;=&nbsp;newReadRequest(&amp;quot;thing&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r2);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc2&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h2).handleRead(rc2.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc2,&nbsp;c,&nbsp;&amp;quot;thing&amp;quot;,&nbsp;&amp;quot;objectId&amp;quot;,&nbsp;&amp;quot;thing&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMultipleRoutes()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h1&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;users&amp;quot;,&nbsp;h1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h2&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;groups&amp;quot;,&nbsp;h2);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r1&nbsp;=&nbsp;newReadRequest(&amp;quot;users&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc1&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h1).handleRead(rc1.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc1,&nbsp;c,&nbsp;&amp;quot;users&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r2&nbsp;=&nbsp;newReadRequest(&amp;quot;groups&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r2);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc2&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h2).handleRead(rc2.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc2,&nbsp;c,&nbsp;&amp;quot;groups&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;routeMissTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;template&nbsp;-&nbsp;resource&nbsp;name&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;,&nbsp;&amp;quot;b/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/two&amp;quot;,&nbsp;&amp;quot;one/twox&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/twox&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/{b}&amp;quot;,&nbsp;&amp;quot;one/two/three&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/{a}/{b}&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;routeMissTestData&amp;quot;,&nbsp;expectedExceptions&nbsp;=&nbsp;NotFoundException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testRouteMiss(final&nbsp;String&nbsp;template,&nbsp;final&nbsp;String&nbsp;resourcePath)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourcePath);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newInternalConnection(router).read(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;that&nbsp;routing&nbsp;failure&nbsp;does&nbsp;not&nbsp;pollute&nbsp;the&nbsp;context.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;variableRouteHitTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;template&nbsp;-&nbsp;resource&nbsp;name&nbsp;-&nbsp;variables&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}&amp;quot;,&nbsp;&amp;quot;a&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}&amp;quot;,&nbsp;&amp;quot;test&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;x{userId}&amp;quot;,&nbsp;&amp;quot;xtest&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}/devices&amp;quot;,&nbsp;&amp;quot;test/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/{b}&amp;quot;,&nbsp;&amp;quot;aaa/bbb&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;a&amp;quot;,&nbsp;&amp;quot;aaa&amp;quot;,&nbsp;&amp;quot;b&amp;quot;,&nbsp;&amp;quot;bbb&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/b/{c}&amp;quot;,&nbsp;&amp;quot;aaa/b/ccc&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;a&amp;quot;,&nbsp;&amp;quot;aaa&amp;quot;,&nbsp;&amp;quot;c&amp;quot;,&nbsp;&amp;quot;ccc&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;users/{id}/devices&amp;quot;,&nbsp;&amp;quot;users/test%20user/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;id&amp;quot;,&nbsp;&amp;quot;test&nbsp;user&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;users/{id}/devices&amp;quot;,&nbsp;&amp;quot;users/test%2fdevices/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;id&amp;quot;,&nbsp;&amp;quot;test/devices&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;variableRouteHitTestData&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testVariableRouteHit(final&nbsp;String&nbsp;template,&nbsp;final&nbsp;String&nbsp;resourcePath,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String[]&nbsp;expectedVars)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourcePath);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;String&amp;gt;&nbsp;expectedMap&nbsp;=&nbsp;new&nbsp;LinkedHashMap&amp;lt;String,&nbsp;String&amp;gt;();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;expectedVars.length;&nbsp;i&nbsp;+=&nbsp;2)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMap.put(expectedVars[i],&nbsp;expectedVars[i&nbsp;+&nbsp;1]);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h).handleRead(rc.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;resourcePath,&nbsp;expectedMap);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(expectedExceptions&nbsp;=&nbsp;NotFoundException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testZeroRoutes()&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Context&nbsp;c&nbsp;=&nbsp;new&nbsp;RootContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newInternalConnection(router).read(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerContext&nbsp;newServerContext()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ServerContext(new&nbsp;RootContext());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcesrctestjavaorgforgerockjsonresourceVersionedRouterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,6&nbsp;+19,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.util.test.assertj.AssertJPromiseAssert.assertThat;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-41,7&nbsp;+42,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;VersionedRouterTest&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;UriRouter&nbsp;router;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Router&nbsp;router;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionRouter&nbsp;versionRouter1;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionRouter&nbsp;versionRouter2;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-55,7&nbsp;+56,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@BeforeClass<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-67,12&nbsp;+68,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter1&nbsp;=&nbsp;new&nbsp;VersionRouter();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter2&nbsp;=&nbsp;new&nbsp;VersionRouter();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/users&amp;quot;,&nbsp;versionRouter1<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.EQUALS,&nbsp;&amp;quot;/users&amp;quot;),&nbsp;versionRouter1<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;usersHandlerOne)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersHandlerTwo)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;usersHandlerThree));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/groups&amp;quot;,&nbsp;versionRouter2<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.EQUALS,&nbsp;&amp;quot;/groups&amp;quot;),&nbsp;versionRouter2<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;groupsHandlerOne)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;groupsHandlerTwo)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;groupsHandlerThree));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDemoUtilsjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,7&nbsp;+11,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,7&nbsp;+28,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.MemoryBackend;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Utility&nbsp;methods&nbsp;for&nbsp;demo&nbsp;apps.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-57,7&nbsp;+57,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;ConnectionFactory&nbsp;getConnectionFactory()&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;MemoryBackend&nbsp;users&nbsp;=&nbsp;new&nbsp;MemoryBackend();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Connection&nbsp;connection&nbsp;=&nbsp;newInternalConnection(router);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection.create(ctx(),&nbsp;newCreateRequest(&amp;quot;users&amp;quot;,&nbsp;&amp;quot;1&amp;quot;,&nbsp;userAliceWithIdAndRev(1,&nbsp;0)));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDynamicRealmDemojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,6&nbsp;+16,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.ctx;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.log;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.util.promise.Promises.newExceptionPromise;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,9&nbsp;+26,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.LinkedList;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.RouterContext;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.RoutingMode;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.ServerContext;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.AbstractRequestHandler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-47,8&nbsp;+48,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.promise.Promise;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;An&nbsp;example&nbsp;illustrating&nbsp;how&nbsp;you&nbsp;can&nbsp;route&nbsp;realms&nbsp;/&nbsp;sub-realm&nbsp;requests&nbsp;using<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-169,10&nbsp;+170,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including&nbsp;sub-realms,&nbsp;users,&nbsp;and&nbsp;groups.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;RequestHandler&nbsp;realm(final&nbsp;List&amp;lt;String&amp;gt;&nbsp;path)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/users&amp;quot;,&nbsp;collection(path,&nbsp;&amp;quot;user&amp;quot;));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/groups&amp;quot;,&nbsp;collection(path,&nbsp;&amp;quot;group&amp;quot;));<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/{realm}&amp;quot;,&nbsp;subrealms(path));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/{realm}&amp;quot;),&nbsp;subrealms(path));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;router;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesVersionedResourcesDemojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,6&nbsp;+16,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.RouteMatchers.requestUriMatcher;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newCreateRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-42,9&nbsp;+43,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resource;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.SingletonResourceProvider;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.VersionRouter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.promise.Promise;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-112,18&nbsp;+113,18&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MemoryBackend&nbsp;groups&nbsp;=&nbsp;new&nbsp;MemoryBackend();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;),&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1&amp;quot;,&nbsp;usersV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersV1Dot5)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;usersV2Dot0));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/roles&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.EQUALS,&nbsp;&amp;quot;/roles&amp;quot;),&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;rolesV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;rolesV1Dot5)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;rolesV2Dot0));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/config&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/config&amp;quot;),&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;configV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;configV1Dot5)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;configV2Dot0));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourcehttpexamplesCrestHttpApplicationjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/CrestHttpApplication.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/CrestHttpApplication.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/CrestHttpApplication.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,12&nbsp;+16,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.http.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.http.routing.RouteMatchers.requestUriMatcher;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Handler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.HttpApplication;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.HttpApplicationException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.RoutingMode;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.UriRouter;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.io.Buffer;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.Router;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.Factory;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-33,9&nbsp;+35,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Handler&nbsp;start()&nbsp;throws&nbsp;HttpApplicationException&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;,&nbsp;MemoryBackendHandler.getHandler());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/groups&amp;quot;,&nbsp;MemoryBackendHandler.getHandler());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;),&nbsp;MemoryBackendHandler.getHandler());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(requestUriMatcher(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/groups&amp;quot;),&nbsp;MemoryBackendHandler.getHandler());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;router;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourceexamplessrcmainjavaorgforgerockjsonresourcehttpexamplesMemoryBackendHandlerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/MemoryBackendHandler.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/MemoryBackendHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-examples/src/main/java/org/forgerock/json/resource/http/examples/MemoryBackendHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,9&nbsp;+19,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Handler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.MemoryBackend;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.http.CrestHttp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.util.Reject;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Default&nbsp;in-memory&nbsp;{@link&nbsp;Handler}.<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpHttpAdapterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/HttpAdapter.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/HttpAdapter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/HttpAdapter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,7&nbsp;+28,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Handler;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.RouterContext;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.header.ContentTypeHeader;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.protocol.Form;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.protocol.Response;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockresttrunkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpRequestRunnerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/RequestRunner.java&nbsp;(3414&nbsp;=&gt;&nbsp;3415)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/RequestRunner.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:54:28&nbsp;UTC&nbsp;(rev&nbsp;3414)<br>
+++&nbsp;forgerock-rest/trunk/json-resource-http/src/main/java/org/forgerock/json/resource/http/RequestRunner.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-09&nbsp;21:56:23&nbsp;UTC&nbsp;(rev&nbsp;3415)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-32,7&nbsp;+32,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;com.fasterxml.jackson.core.JsonGenerator;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.ResourcePath;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.http.RouterContext;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.http.routing.RouterContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.header.ContentTypeHeader;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.protocol.Response;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.protocol.Status;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
