<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[1632]&nbsp;forgerock-script/trunk:&nbsp;IDME-48&nbsp;(CR-2863)&nbsp;(CR-2912)&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=1632&quot;&gt;1632&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;brmiller&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2014-01-30&nbsp;18:08:42&nbsp;+0000&nbsp;(Thu,&nbsp;30&nbsp;Jan&nbsp;2014)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;IDME-48&nbsp;(CR-2863)&nbsp;(CR-2912)<br>
Enhancements&nbsp;to&nbsp;facilitate&nbsp;mapping&nbsp;CREST&nbsp;objects&nbsp;to&nbsp;[Java]script<br>
ScriptableObject&nbsp;wrappers&nbsp;for&nbsp;CREST&nbsp;Requests&nbsp;objects&nbsp;and&nbsp;Contexts&nbsp;so&nbsp;they&nbsp;are&nbsp;<br>
visible&nbsp;to&nbsp;scripts&nbsp;with&nbsp;the&nbsp;same&nbsp;semantics&nbsp;as&nbsp;the&nbsp;Java&nbsp;API.<br>
<br>
from&nbsp;merge&nbsp;-&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=1491&quot;&gt;r1491&lt;/a&gt;:1611&nbsp;&nbsp;https://svn.forgerock.org/commons/forgerock-script/branches/context-refactor-scriptable-wrappers&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkpomxml&quot;&gt;forgerock-script/trunk/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptScriptContextjava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptScriptNamejava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptName.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptregistryScriptRegistryImpljava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/registry/ScriptRegistryImpl.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeOperationParameterjava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/OperationParameter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeParameterjava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/Parameter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeResourceFunctionsjava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/ResourceFunctions.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceEmbeddedScriptSourcejava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/EmbeddedScriptSource.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceSourceUnitjava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/SourceUnit.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceURLScriptSourcejava&quot;&gt;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/URLScriptSource.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrctestjavaorgforgerockscriptScriptTestjava&quot;&gt;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/ScriptTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptcommonsrctestjavaorgforgerockscriptscopeResourceFunctionsTestjava&quot;&gt;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/scope/ResourceFunctionsTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptpomxml&quot;&gt;forgerock-script/trunk/script-javascript/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptConverterjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/Converter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrctestresourcescontainerresourcejs&quot;&gt;forgerock-script/trunk/script-javascript/src/test/resources/container/resource.js&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptAbstractScriptableRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/AbstractScriptableRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableActionRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableActionRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableContextjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableCreateRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableCreateRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableDeleteRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableDeleteRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptablePatchRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptablePatchRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableQueryRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableQueryRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableReadRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableReadRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableUpdateRequestjava&quot;&gt;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableUpdateRequest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Property&nbsp;Changed&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockscripttrunk&quot;&gt;forgerock-script/trunk/&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunk&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;propset&quot;&gt;&lt;h4&gt;Property&nbsp;changes:&nbsp;forgerock-script/trunk&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;svnmergeinfo&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;svn:mergeinfo&lt;/h4&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/pom.xml&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-111,7&nbsp;+111,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/siteDistributionURL&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Commons&nbsp;forgerock-rest&nbsp;versions&nbsp;--&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;commons.forgerock-rest.version&amp;gt;2.1.0&amp;lt;/commons.forgerock-rest.version&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;commons.forgerock-rest.version&amp;gt;2.2.0&amp;lt;/commons.forgerock-rest.version&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;commons.script.osgi.import.default.version&amp;gt;--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--[$(version;==;$(@)),$(version;+;$(@)))--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-147,6&nbsp;+147,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;ForgeRock&nbsp;Commons&nbsp;--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-fluent&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${commons.forgerock-rest.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${commons.forgerock-rest.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-165,12&nbsp;+170,24&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${slf4j.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;CodeHaus&nbsp;JSON&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.codehaus.jackson&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;jackson-core-asl&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.9.2&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.codehaus.jackson&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;jackson-mapper-asl&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.9.2&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Provided&nbsp;Dependencies&nbsp;--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Core&nbsp;OSGi&nbsp;--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.osgi&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;org.osgi.core&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.3.0&amp;lt;/version&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.3.1&amp;lt;/version&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptScriptContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptContext.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;ALTER&nbsp;OR&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2013&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,6&nbsp;+25,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.script;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.AbstractContext;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.PersistenceConfig;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-34,37&nbsp;+35,33&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@author&nbsp;Laszlo&nbsp;Hordos<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;class&nbsp;ScriptContext&nbsp;extends&nbsp;Context&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+public&nbsp;class&nbsp;ScriptContext&nbsp;extends&nbsp;AbstractContext&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;the&nbsp;friendly&nbsp;name&nbsp;for&nbsp;this&nbsp;context&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;CONTEXT_NAME&nbsp;=&nbsp;&amp;quot;script&amp;quot;;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_TYPE&nbsp;=&nbsp;&amp;quot;type&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_NAME&nbsp;=&nbsp;&amp;quot;name&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_REVISION&nbsp;=&nbsp;&amp;quot;revision&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;name;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;type;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;revision;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptContext(Context&nbsp;parent,&nbsp;String&nbsp;name,&nbsp;String&nbsp;type,&nbsp;String&nbsp;revision)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parent);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.type&nbsp;=&nbsp;type;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.revision&nbsp;=&nbsp;revision;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.put(ATTR_NAME,&nbsp;name);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.put(ATTR_TYPE,&nbsp;type);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.put(ATTR_REVISION,&nbsp;revision);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptContext(JsonValue&nbsp;savedContext,&nbsp;PersistenceConfig&nbsp;config)&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(savedContext,&nbsp;config);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;savedContext.get(ATTR_NAME).required().asString();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;savedContext.get(ATTR_TYPE).required().asString();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;revision&nbsp;=&nbsp;savedContext.get(ATTR_REVISION).asString();<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;saveToJson(JsonValue&nbsp;savedContext,&nbsp;PersistenceConfig&nbsp;config)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.saveToJson(savedContext,&nbsp;config);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;savedContext.put(ATTR_NAME,&nbsp;name);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;savedContext.put(ATTR_TYPE,&nbsp;type);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;savedContext.put(ATTR_REVISION,&nbsp;revision);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;this&nbsp;Context's&nbsp;name.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;this&nbsp;object's&nbsp;name<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getContextName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CONTEXT_NAME;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptScriptNamejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptName.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptName.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/ScriptName.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-35,18&nbsp;+35,24&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;name;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;type;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;revision;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;requestBinding;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptName(String&nbsp;name,&nbsp;String&nbsp;type)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(name,&nbsp;type,&nbsp;null);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptName(String&nbsp;name,&nbsp;String&nbsp;type,&nbsp;String&nbsp;revision)&nbsp;{<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(name,&nbsp;type,&nbsp;revision,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptName(String&nbsp;name,&nbsp;String&nbsp;type,&nbsp;String&nbsp;revision,&nbsp;String&nbsp;requestBinding)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;==&nbsp;name&nbsp;||&nbsp;null&nbsp;==&nbsp;type&nbsp;||&nbsp;name.trim().isEmpty()&nbsp;||&nbsp;type.trim().isEmpty())&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalArgumentException(&amp;quot;Required&nbsp;name&nbsp;and&nbsp;type&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.type&nbsp;=&nbsp;type;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.revision&nbsp;=&nbsp;revision;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.requestBinding&nbsp;=&nbsp;requestBinding;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getName()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-61,6&nbsp;+67,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;revision&nbsp;!=&nbsp;null&nbsp;?&nbsp;revision&nbsp;:&nbsp;&amp;quot;0&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getRequestBinding()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;requestBinding;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;equals(Object&nbsp;o)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this&nbsp;==&nbsp;o)&nbsp;{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptregistryScriptRegistryImpljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/registry/ScriptRegistryImpl.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/registry/ScriptRegistryImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/registry/ScriptRegistryImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-186,6&nbsp;+186,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;name&nbsp;=&nbsp;script.get(SourceUnit.ATTR_NAME);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;type&nbsp;=&nbsp;script.get(SourceUnit.ATTR_TYPE);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;source&nbsp;=&nbsp;script.get(SourceUnit.ATTR_SOURCE);<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;requestBinding&nbsp;=&nbsp;script.get(SourceUnit.ATTR_REQUEST_BINDING);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!source.isNull()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;amp;&amp;amp;&nbsp;(type.isNull()&nbsp;||&nbsp;type.expect(String.class).asString().equals(<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-194,10&nbsp;+195,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptName&nbsp;scriptName&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(name.isNull()&nbsp;||&nbsp;!name.isString()&nbsp;?&nbsp;UUID.randomUUID().toString()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;name.asString(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type.isNull()&nbsp;||&nbsp;!type.isString()&nbsp;?&nbsp;SourceUnit.AUTO_DETECT&nbsp;:&nbsp;type<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.asString());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name.isNull()&nbsp;||&nbsp;!name.isString()&nbsp;?&nbsp;UUID.randomUUID().toString()&nbsp;:&nbsp;name.asString(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type.isNull()&nbsp;||&nbsp;!type.isString()&nbsp;?&nbsp;SourceUnit.AUTO_DETECT&nbsp;:&nbsp;type.asString(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestBinding.isNull()&nbsp;||&nbsp;!requestBinding.isString()&nbsp;?&nbsp;null&nbsp;:&nbsp;requestBinding.asString());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!source.isNull())&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;visibility&nbsp;=&nbsp;script.get(SourceUnit.ATTR_VISIBILITY);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeOperationParameterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/OperationParameter.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/OperationParameter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/OperationParameter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;ALTER&nbsp;OR&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-63,11&nbsp;+63,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerContext&nbsp;getServerContext(JsonValue&nbsp;savedContext)&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;!=&nbsp;savedContext)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ServerContext.loadFromJson(savedContext,&nbsp;getPersistenceConfig());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ServerContext(savedContext,&nbsp;getPersistenceConfig());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(context&nbsp;instanceof&nbsp;ServerContext)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(ServerContext)&nbsp;context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(null&nbsp;!=&nbsp;context)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ServerContext(context,&nbsp;getConnection());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ServerContext(context);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;InternalServerErrorException(&amp;quot;Failed&nbsp;to&nbsp;get&nbsp;ServerContext.&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeParameterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/Parameter.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/Parameter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/Parameter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,6&nbsp;+25,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.script.scope;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.Connection;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.PersistenceConfig;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ServerContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-39,6&nbsp;+40,19&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;internal&nbsp;connection.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;a&nbsp;Connection<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;org.forgerock.json.resource.NotFoundException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;no&nbsp;such&nbsp;connection&nbsp;exists.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;org.forgerock.json.resource.ResourceException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;connection&nbsp;could&nbsp;not&nbsp;be&nbsp;obtained&nbsp;for&nbsp;some&nbsp;other&nbsp;reason<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.&nbsp;due&nbsp;to&nbsp;a&nbsp;configuration&nbsp;or&nbsp;initialization&nbsp;problem).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Connection&nbsp;getConnection()&nbsp;throws&nbsp;ResourceException;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;ServerRequest&nbsp;assigned&nbsp;with&nbsp;the&nbsp;current&nbsp;{@link&nbsp;org.forgerock.json.resource.Request}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;from&nbsp;the&nbsp;saved&nbsp;context&nbsp;data.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;ServerContext&nbsp;assigned&nbsp;with&nbsp;current<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@link&nbsp;org.forgerock.json.resource.Request}.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;org.forgerock.json.resource.NotFoundException<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-49,5&nbsp;+63,15&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerContext&nbsp;getServerContext(JsonValue&nbsp;savedContext)&nbsp;throws&nbsp;ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;persistence&nbsp;config&nbsp;helper.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;PersistenceConfig<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;org.forgerock.json.resource.NotFoundException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;no&nbsp;such&nbsp;connection&nbsp;exists.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;org.forgerock.json.resource.ResourceException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;connection&nbsp;could&nbsp;not&nbsp;be&nbsp;obtained&nbsp;for&nbsp;some&nbsp;other&nbsp;reason<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.&nbsp;due&nbsp;to&nbsp;a&nbsp;configuration&nbsp;or&nbsp;initialization&nbsp;problem).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;PersistenceConfig&nbsp;getPersistenceConfig();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptscopeResourceFunctionsjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/ResourceFunctions.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/ResourceFunctions.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/scope/ResourceFunctions.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;ALTER&nbsp;OR&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2013&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;Rights&nbsp;Reserved<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-161,7&nbsp;+161,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;Resource&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().createAsync(serverContext,&nbsp;cr,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().createAsync(serverContext,&nbsp;cr,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;Resource&amp;gt;&nbsp;getResultHandler(scope,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-257,7&nbsp;+257,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;parameter.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;Resource&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().readAsync(serverContext,&nbsp;rr,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter.getConnection().readAsync(serverContext,&nbsp;rr,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;Resource&amp;gt;&nbsp;getResultHandler(parameter,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-370,7&nbsp;+370,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;Resource&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().updateAsync(serverContext,&nbsp;ur,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().updateAsync(serverContext,&nbsp;ur,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;Resource&amp;gt;&nbsp;getResultHandler(scope,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-484,7&nbsp;+484,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;Resource&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().patchAsync(serverContext,&nbsp;pr,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().patchAsync(serverContext,&nbsp;pr,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;Resource&amp;gt;&nbsp;getResultHandler(scope,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-673,7&nbsp;+673,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;QueryResult&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().queryAsync(serverContext,&nbsp;qr,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().queryAsync(serverContext,&nbsp;qr,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;QueryResultHandler()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleError(final&nbsp;ResourceException&nbsp;error)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-835,7&nbsp;+835,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;Resource&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().deleteAsync(serverContext,&nbsp;dr,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().deleteAsync(serverContext,&nbsp;dr,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;Resource&amp;gt;&nbsp;getResultHandler(scope,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-976,7&nbsp;+976,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;scope.getServerContext(context);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FutureResult&amp;lt;JsonValue&amp;gt;&nbsp;future&nbsp;=<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverContext.getConnection().actionAsync(serverContext,&nbsp;ar,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope.getConnection().actionAsync(serverContext,&nbsp;ar,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.&amp;lt;JsonValue&amp;gt;&nbsp;getResultHandler(scope,&nbsp;callback));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;future.get();<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceEmbeddedScriptSourcejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/EmbeddedScriptSource.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/EmbeddedScriptSource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/EmbeddedScriptSource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-45,16&nbsp;+45,16&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;EmbeddedScriptSource(String&nbsp;source,&nbsp;ScriptName&nbsp;scriptName)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.source&nbsp;=&nbsp;source;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;scriptName.getRevision());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=&nbsp;new&nbsp;ScriptName(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;scriptName.getRevision(),&nbsp;scriptName.getRequestBinding());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;EmbeddedScriptSource(ScriptEntry.Visibility&nbsp;visibility,&nbsp;String&nbsp;source,<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptName&nbsp;scriptName)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.visibility&nbsp;=&nbsp;visibility;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.source&nbsp;=&nbsp;source;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;scriptName.getRevision());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=&nbsp;new&nbsp;ScriptName(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;scriptName.getRevision(),&nbsp;scriptName.getRequestBinding());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;guessType()&nbsp;{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceSourceUnitjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/SourceUnit.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/SourceUnit.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/SourceUnit.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-42,6&nbsp;+42,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_REVISION&nbsp;=&nbsp;&amp;quot;revision&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_SOURCE&nbsp;=&nbsp;&amp;quot;source&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_VISIBILITY&nbsp;=&nbsp;&amp;quot;visibility&amp;quot;;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTR_REQUEST_BINDING&nbsp;=&nbsp;&amp;quot;request-binding&amp;quot;;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptName&nbsp;getName();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrcmainjavaorgforgerockscriptsourceURLScriptSourcejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/URLScriptSource.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/URLScriptSource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/main/java/org/forgerock/script/source/URLScriptSource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-60,9&nbsp;+60,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.visibility&nbsp;=&nbsp;visibility;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.source&nbsp;=&nbsp;source;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;Long<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.toHexString(getURLRevision(source,&nbsp;null)));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=&nbsp;new&nbsp;ScriptName(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getName(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getType(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Long.toHexString(getURLRevision(source,&nbsp;null)),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getRequestBinding());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;long&nbsp;getURLRevision(URL&nbsp;source,&nbsp;String&nbsp;revision)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-108,9&nbsp;+110,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.visibility&nbsp;=&nbsp;visibility;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.source&nbsp;=&nbsp;source;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ScriptName(scriptName.getName(),&nbsp;scriptName.getType(),&nbsp;Long<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.toHexString(getURLRevision(source,&nbsp;null)));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scriptName&nbsp;=&nbsp;new&nbsp;ScriptName(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getName(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getType(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Long.toHexString(getURLRevision(source,&nbsp;null)),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptName.getRequestBinding());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.parent&nbsp;=&nbsp;parent;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrctestjavaorgforgerockscriptScriptTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/ScriptTest.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/ScriptTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/ScriptTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-29,6&nbsp;+29,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ApiInfoContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Connection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ConnectionProvider;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.Context;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.CreateRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.DeleteRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.InternalServerErrorException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-213,8&nbsp;+214,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateContent.put(&amp;quot;_id&amp;quot;,&nbsp;UUID.randomUUID().toString());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateContent.put(&amp;quot;profileUrl&amp;quot;,&nbsp;&amp;quot;https://login.example.com/bjensen&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.put(&amp;quot;context&amp;quot;,&nbsp;new&nbsp;ApiInfoContext(new&nbsp;SecurityContext(new&nbsp;RootContext(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;bjensen@example.com&amp;quot;,&nbsp;null),&nbsp;&amp;quot;&amp;quot;,&nbsp;&amp;quot;&amp;quot;));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Context&nbsp;context&nbsp;=&nbsp;new&nbsp;ApiInfoContext(new&nbsp;SecurityContext(new&nbsp;RootContext(),&nbsp;&amp;quot;bjensen@example.com&amp;quot;,&nbsp;null),&nbsp;&amp;quot;&amp;quot;,&nbsp;&amp;quot;&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.put(&amp;quot;context&amp;quot;,&nbsp;context);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;createRequest&nbsp;=&nbsp;Requests.newCreateRequest(&amp;quot;/Users&amp;quot;,&nbsp;&amp;quot;701984&amp;quot;,&nbsp;createContent);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.put(&amp;quot;createRequest&amp;quot;,&nbsp;createRequest);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptcommonsrctestjavaorgforgerockscriptscopeResourceFunctionsTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/scope/ResourceFunctionsTest.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/scope/ResourceFunctionsTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-common/src/test/java/org/forgerock/script/scope/ResourceFunctionsTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-157,8&nbsp;+157,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).when(resource).handleAction(any(ServerContext.class),&nbsp;any(ActionRequest.class),<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any(ResultHandler.class));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;serverContext&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ServerContext(new&nbsp;RootContext(),&nbsp;Resources.newInternalConnection(resource));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;serverContext&nbsp;=&nbsp;new&nbsp;ServerContext(new&nbsp;RootContext());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PersistenceConfig&nbsp;persistenceConfig&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PersistenceConfig.builder().connectionProvider(new&nbsp;ConnectionProvider()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-197,8&nbsp;+196,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object[]&nbsp;arguments&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;&amp;quot;resourceName&amp;quot;,&nbsp;&amp;quot;actionId&amp;quot;,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;new&nbsp;ArrayList&amp;lt;String&amp;gt;(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext.saveToJson(serverContext,&nbsp;persistenceConfig)&nbsp;};<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;new&nbsp;ArrayList&amp;lt;String&amp;gt;(),&nbsp;serverContext.toJsonValue()&nbsp;};<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.assertTrue(ResourceFunctions.ACTION.call(parameter,&nbsp;null,&nbsp;arguments).asBoolean());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments&nbsp;=<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-javascript/pom.xml&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-50,6&nbsp;+50,16&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;script-common&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource-servlet&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;de.matrixweb.osgi.wrapped&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptAbstractScriptableRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptAbstractScriptableRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/AbstractScriptableRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/AbstractScriptableRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/AbstractScriptableRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/AbstractScriptableRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,146&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.Request;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.NativeObject;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+import&nbsp;java.util.Arrays;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;an&nbsp;abstract&nbsp;{@code&nbsp;Request}&nbsp;object.<br>
+&nbsp;*/<br>
+abstract&nbsp;class&nbsp;AbstractScriptableRequest&nbsp;extends&nbsp;NativeObject&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;FIELD_TYPE&nbsp;=&nbsp;&amp;quot;type&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;request&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;transient&nbsp;Parameter&nbsp;parameter;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;request&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Request&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;request&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AbstractScriptableRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;==&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;NullPointerException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.parameter&nbsp;=&nbsp;parameter;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(FIELD_TYPE.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getRequestType().toString(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(Request.FIELD_FIELDS.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getFields(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(Request.FIELD_RESOURCE_NAME.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getResourceName(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NOT_FOUND;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(int&nbsp;index,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NOT_FOUND;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FIELD_TYPE.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;Request.FIELD_FIELDS.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;Request.FIELD_RESOURCE_NAME.equals(name);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(int&nbsp;index,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;don't&nbsp;allow&nbsp;setting&nbsp;fields&nbsp;or&nbsp;resource&nbsp;name<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;setting&nbsp;by&nbsp;index&nbsp;not&nbsp;supported<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;delete(String&nbsp;name)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;delete(int&nbsp;index)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;common&nbsp;to&nbsp;all&nbsp;request&nbsp;types&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;new&nbsp;Object[]&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIELD_TYPE,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request.FIELD_FIELDS,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request.FIELD_RESOURCE_NAME<br>
+&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;static&nbsp;Object[]&nbsp;concatIds(Object...&nbsp;properties)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object[]&nbsp;result&nbsp;=&nbsp;Arrays.copyOf(PROPERTIES,&nbsp;PROPERTIES.length&nbsp;+&nbsp;properties.length);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(properties,&nbsp;0,&nbsp;result,&nbsp;PROPERTIES.length,&nbsp;properties.length);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;hasInstance(Scriptable&nbsp;instance)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;&nbsp;//&nbsp;no&nbsp;support&nbsp;for&nbsp;javascript&nbsp;instanceof<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;unwrap()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;toString()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;request&nbsp;==&nbsp;null&nbsp;?&nbsp;&amp;quot;null&amp;quot;&nbsp;:&nbsp;request.toString();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptConverterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/Converter.java&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/Converter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/Converter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,7&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2012-2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-29,6&nbsp;+29,16&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.fluent.JsonPointer;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
+import&nbsp;org.forgerock.json.resource.CreateRequest;<br>
+import&nbsp;org.forgerock.json.resource.DeleteRequest;<br>
+import&nbsp;org.forgerock.json.resource.PatchRequest;<br>
+import&nbsp;org.forgerock.json.resource.QueryRequest;<br>
+import&nbsp;org.forgerock.json.resource.ReadRequest;<br>
+import&nbsp;org.forgerock.json.resource.Request;<br>
+import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.script.scope.AbstractFactory;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.script.scope.Function;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.script.scope.Parameter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-40,23&nbsp;+50,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.mozilla.javascript.TopLevel;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.mozilla.javascript.Wrapper;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Converts&nbsp;scriptable&nbsp;types&nbsp;provided&nbsp;by&nbsp;Rhino&nbsp;into&nbsp;standard&nbsp;Java&nbsp;objects.<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*<br>
-&nbsp;*&nbsp;@author&nbsp;Paul&nbsp;C.&nbsp;Bryan<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;class&nbsp;Converter&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;LONG_HIGH_BITS&nbsp;=&nbsp;0xFFFFFFFF80000000L;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;int&nbsp;longToInteger(Long&nbsp;number,&nbsp;Integer&nbsp;defaultTo)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((number&nbsp;&amp;amp;&nbsp;LONG_HIGH_BITS)&nbsp;==&nbsp;0&nbsp;||&nbsp;(number&nbsp;&amp;amp;&nbsp;LONG_HIGH_BITS)&nbsp;==&nbsp;LONG_HIGH_BITS)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;number.intValue();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;defaultTo;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;{@code&nbsp;true}&nbsp;if&nbsp;the&nbsp;specified&nbsp;number&nbsp;can&nbsp;be&nbsp;converted&nbsp;to&nbsp;an<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;integer&nbsp;without&nbsp;rounding.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-103,34&nbsp;+102,112&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value&nbsp;==&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;Map)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doCopy)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableMap&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableMap(getMap(parameter,&nbsp;(Map)&nbsp;value));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableMap&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableMap(parameter,&nbsp;(Map)&nbsp;value);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(Map)&nbsp;value,&nbsp;scope,&nbsp;doCopy);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;List)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doCopy)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableList&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableList(getList(parameter,&nbsp;(List)&nbsp;value));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Array);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableList&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableList(parameter,&nbsp;(List)&nbsp;value);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Array);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(List)&nbsp;value,&nbsp;scope,&nbsp;doCopy);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;Function)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableFunction&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableFunction(parameter,&nbsp;(Function)&nbsp;value);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Function);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(Function)&nbsp;value,&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;JsonValue)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(JsonValue)&nbsp;value,&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;JsonPointer)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;value.toString(),&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;Request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(Request)&nbsp;value,&nbsp;scope);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;org.forgerock.json.resource.Context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;(org.forgerock.json.resource.Context)&nbsp;value,&nbsp;scope);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Context.javaToJS(value,&nbsp;scope);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;Map&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope,&nbsp;boolean&nbsp;doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableMap&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableMap(getMap(parameter,&nbsp;(Map)&nbsp;value));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableMap&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableMap(parameter,&nbsp;(Map)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;List&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope,&nbsp;boolean&nbsp;doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableList&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableList(getList(parameter,&nbsp;(List)&nbsp;value));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Array);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableList&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableList(parameter,&nbsp;(List)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Array);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;Function&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope,&nbsp;boolean&nbsp;doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableFunction&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableFunction(parameter,&nbsp;(Function)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Function);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;JsonValue&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope,&nbsp;boolean&nbsp;doCopy)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;wrap&nbsp;JsonValues&nbsp;as&nbsp;either&nbsp;the&nbsp;wrapped&nbsp;Map,&nbsp;the&nbsp;wrapped&nbsp;List,&nbsp;or&nbsp;the&nbsp;wrapped&nbsp;primitive<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.isMap())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;value.asMap(),&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value.isList())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;value.asList(),&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wrap(parameter,&nbsp;value.getObject(),&nbsp;scope,&nbsp;doCopy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;Request&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;CreateRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableCreateRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableCreateRequest(parameter,&nbsp;(CreateRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;DeleteRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableDeleteRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableDeleteRequest(parameter,&nbsp;(DeleteRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;PatchRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptablePatchRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptablePatchRequest(parameter,&nbsp;(PatchRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;QueryRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableQueryRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableQueryRequest(parameter,&nbsp;(QueryRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;ReadRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableReadRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableReadRequest(parameter,&nbsp;(ReadRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;UpdateRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableUpdateRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableUpdateRequest(parameter,&nbsp;(UpdateRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;ActionRequest)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableActionRequest&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableActionRequest(parameter,&nbsp;(ActionRequest)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;we&nbsp;shouldn't&nbsp;get&nbsp;here...<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Context.javaToJS(value,&nbsp;scope);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Object&nbsp;wrap(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;org.forgerock.json.resource.Context&nbsp;value,&nbsp;final&nbsp;Scriptable&nbsp;scope)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptableContext&nbsp;result&nbsp;=&nbsp;new&nbsp;ScriptableContext(parameter,&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptRuntime.setBuiltinProtoAndParent(result,&nbsp;scope,&nbsp;TopLevel.Builtins.Object);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;value&nbsp;provided&nbsp;from&nbsp;JavaScript&nbsp;into&nbsp;a&nbsp;standard&nbsp;Java&nbsp;object.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Used&nbsp;when&nbsp;the&nbsp;script&nbsp;is&nbsp;attempting&nbsp;to&nbsp;assign&nbsp;a&nbsp;value&nbsp;to&nbsp;a&nbsp;supplied&nbsp;scope<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-186,7&nbsp;+263,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;value&nbsp;instanceof&nbsp;Map&nbsp;||&nbsp;value&nbsp;instanceof&nbsp;List)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;value;&nbsp;//&nbsp;already&nbsp;valid&nbsp;JSON&nbsp;element<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(value&nbsp;instanceof&nbsp;CharSequence)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;((CharSequence)&nbsp;value).toString();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;value.toString();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableActionRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableActionRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableActionRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableActionRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableActionRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableActionRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,109&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;ActionRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableActionRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ActionRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableActionRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;ActionRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableActionRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ActionRequest.FIELD_ACTION.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getAction(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ActionRequest.FIELD_ADDITIONAL_ACTION_PARAMETERS.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getAdditionalActionParameters(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ActionRequest.FIELD_CONTENT.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getContent(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ActionRequest.FIELD_ACTION.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;ActionRequest.FIELD_ADDITIONAL_ACTION_PARAMETERS.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;ActionRequest.FIELD_CONTENT.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;patch&nbsp;operations&nbsp;and&nbsp;revision(?)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;ActionRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest.FIELD_ACTION,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest.FIELD_ADDITIONAL_ACTION_PARAMETERS,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest.FIELD_CONTENT);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;ActionRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableContextjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableContext.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableContext.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,204&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ClientContext;<br>
+import&nbsp;org.forgerock.json.resource.Context;<br>
+import&nbsp;org.forgerock.json.resource.servlet.HttpContext;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.NativeObject;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+import&nbsp;org.mozilla.javascript.annotations.JSFunction;<br>
+<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.HashSet;<br>
+import&nbsp;java.util.LinkedHashMap;<br>
+import&nbsp;java.util.Map;<br>
+import&nbsp;java.util.Set;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;an&nbsp;abstract&nbsp;{@code&nbsp;Context}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableContext&nbsp;extends&nbsp;NativeObject&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;CALLER&nbsp;=&nbsp;&amp;quot;caller&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;CURRENT&nbsp;=&nbsp;&amp;quot;current&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;PARENT&nbsp;=&nbsp;&amp;quot;parent&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;transient&nbsp;Parameter&nbsp;parameter;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;map&nbsp;of&nbsp;contexts&nbsp;exposed&nbsp;by&nbsp;this&nbsp;wrapper&nbsp;by&nbsp;context&nbsp;name&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Map&amp;lt;String,Context&amp;gt;&nbsp;contexts;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;set&nbsp;of&nbsp;keys&nbsp;that&nbsp;this&nbsp;context&nbsp;wrapper&nbsp;&amp;quot;responds&nbsp;to&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Set&amp;lt;String&amp;gt;&nbsp;ids;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;context.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;context&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;context&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableContext(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;Context&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;==&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;NullPointerException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;this.parameter&nbsp;=&nbsp;parameter;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contexts&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Context&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contexts.put(CURRENT,&nbsp;context);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context.getParent()&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contexts.put(PARENT,&nbsp;context.getParent());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Context&nbsp;aContext&nbsp;=&nbsp;context;&nbsp;aContext&nbsp;!=&nbsp;null;&nbsp;aContext&nbsp;=&nbsp;aContext.getParent())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!contexts.containsKey(aContext.getContextName()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contexts.put(aContext.getContextName(),&nbsp;aContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;respond&nbsp;to&nbsp;all&nbsp;context&nbsp;names&nbsp;and&nbsp;&amp;quot;caller&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ids&nbsp;=&nbsp;new&nbsp;HashSet&amp;lt;String&amp;gt;(contexts.keySet());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ids.add(CALLER);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Context&nbsp;getWrappedContext()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;contexts.get(CURRENT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@JSFunction<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;containsContext(Class&nbsp;clazz,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getWrappedContext().containsContext(clazz);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@JSFunction<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;asContext(Class&nbsp;clazz,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;getWrappedContext().asContext(clazz).toJsonValue(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@JSFunction<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;containsContext(String&nbsp;contextName,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getWrappedContext().containsContext(contextName);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@JSFunction<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getContext(String&nbsp;contextName,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;getWrappedContext().getContext(contextName).toJsonValue(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@JSFunction<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getParent(Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;getWrappedContext().getParent(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CALLER.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getWrappedContext().containsContext(ClientContext.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;getWrappedContext().asContext(ClientContext.class).getProtocol()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&amp;quot;none&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(contexts.containsKey(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(HttpContext.CONTEXT_NAME.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;JsonValue&nbsp;value&nbsp;=&nbsp;contexts.get(name).toJsonValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Join&nbsp;all&nbsp;header/parameter&nbsp;values&nbsp;for&nbsp;the&nbsp;same&nbsp;header/parameter&nbsp;into&nbsp;comma-separated-value&nbsp;String<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value.put(HttpContext.ATTR_HEADERS,&nbsp;listValuesAsStrings(value.get(HttpContext.ATTR_HEADERS)));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value.put(HttpContext.ATTR_PARAMETERS,&nbsp;listValuesAsStrings(value.get(HttpContext.ATTR_PARAMETERS)));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;value,&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;contexts.get(name).toJsonValue(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NOT_FOUND;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;listValuesAsStrings(JsonValue&nbsp;values)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;new&nbsp;LinkedHashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;String&nbsp;key&nbsp;:&nbsp;values.keys())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;StringBuilder&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuilder();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;Object&nbsp;value&nbsp;:&nbsp;values.get(key).asList())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(value.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(&amp;quot;,&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(key,&nbsp;sb.substring(0,&nbsp;sb.length()&nbsp;-&nbsp;1));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;map;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(int&nbsp;index,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NOT_FOUND;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ids.contains(name);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(int&nbsp;index,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;delete(String&nbsp;name)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;delete(int&nbsp;index)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ids.toArray();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;hasInstance(Scriptable&nbsp;instance)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;&nbsp;//&nbsp;no&nbsp;support&nbsp;for&nbsp;javascript&nbsp;instanceof<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;unwrap()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getWrappedContext();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;toString()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;JsonValue(contexts).toString();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableCreateRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableCreateRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableCreateRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableCreateRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableCreateRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableCreateRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,128&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.CreateRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+import&nbsp;org.codehaus.jackson.map.ObjectMapper;<br>
+<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.util.LinkedHashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;CreateRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableCreateRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;ObjectMapper&nbsp;JSON_MAPPER&nbsp;=&nbsp;new&nbsp;ObjectMapper();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CreateRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableCreateRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;CreateRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableCreateRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CreateRequest.FIELD_CONTENT.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getContent(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(CreateRequest.FIELD_NEW_RESOURCE_ID.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getNewResourceId(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CreateRequest.FIELD_CONTENT.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;CreateRequest.FIELD_NEW_RESOURCE_ID.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;content&nbsp;and&nbsp;newResourceId<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CreateRequest.FIELD_CONTENT.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;json&nbsp;=&nbsp;JSON_MAPPER.getJsonFactory().createJsonParser((String)&nbsp;value).readValueAs(Object.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(json&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setContent(new&nbsp;JsonValue(new&nbsp;LinkedHashMap&amp;lt;String,&nbsp;Object&amp;gt;(0)));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(json&nbsp;instanceof&nbsp;Map)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setContent(new&nbsp;JsonValue(json));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;log&nbsp;the&nbsp;failure<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(CreateRequest.FIELD_NEW_RESOURCE_ID.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setNewResourceId((String)&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.put(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;CreateRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest.FIELD_CONTENT,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest.FIELD_NEW_RESOURCE_ID);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;CreateRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableDeleteRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableDeleteRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableDeleteRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableDeleteRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableDeleteRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableDeleteRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,100&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.DeleteRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;DeleteRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableDeleteRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;DeleteRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableDeleteRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;DeleteRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableDeleteRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(DeleteRequest.FIELD_REVISION.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getRevision(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;DeleteRequest.FIELD_REVISION.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;revision<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;DeleteRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest.FIELD_REVISION);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;DeleteRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptablePatchRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptablePatchRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptablePatchRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptablePatchRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptablePatchRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptablePatchRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,112&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.PatchOperation;<br>
+import&nbsp;org.forgerock.json.resource.PatchRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+import&nbsp;java.util.ArrayList;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;PatchRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptablePatchRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;PatchRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptablePatchRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;PatchRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptablePatchRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(PatchRequest.FIELD_PATCH_OPERATIONS.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;JsonValue&nbsp;value&nbsp;=&nbsp;new&nbsp;JsonValue(new&nbsp;ArrayList&amp;lt;Object&amp;gt;());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;PatchOperation&nbsp;operation&nbsp;:&nbsp;request.getPatchOperations())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value.add(operation.toJsonValue().getObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;value,&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(PatchRequest.FIELD_REVISION.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getRevision(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PatchRequest.FIELD_PATCH_OPERATIONS.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;PatchRequest.FIELD_REVISION.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;patch&nbsp;operations&nbsp;and&nbsp;revision(?)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;PatchRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest.FIELD_PATCH_OPERATIONS,&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest.FIELD_REVISION);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;PatchRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableQueryRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableQueryRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableQueryRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableQueryRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableQueryRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableQueryRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,129&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.QueryRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;QueryRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableQueryRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;QueryRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableQueryRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;QueryRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableQueryRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(QueryRequest.FIELD_ADDITIONAL_QUERY_PARAMETERS.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getAdditionalQueryParameters(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_PAGED_RESULTS_COOKIE.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getPagedResultsCookie(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_PAGED_RESULTS_OFFSET.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getPagedResultsOffset(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_PAGE_SIZE.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getPageSize(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_QUERY_EXPRESSION.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getQueryExpression(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_QUERY_FILTER.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getQueryFilter(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_QUERY_ID.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getQueryId(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(QueryRequest.FIELD_SORT_KEYS.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getSortKeys(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;QueryRequest.FIELD_ADDITIONAL_QUERY_PARAMETERS.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_PAGED_RESULTS_COOKIE.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_PAGED_RESULTS_OFFSET.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_PAGE_SIZE.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_QUERY_EXPRESSION.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_QUERY_FILTER.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_QUERY_ID.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;QueryRequest.FIELD_SORT_KEYS.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;fields<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;QueryRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_ADDITIONAL_QUERY_PARAMETERS,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_PAGED_RESULTS_COOKIE,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_PAGED_RESULTS_OFFSET,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_PAGE_SIZE,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_QUERY_EXPRESSION,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_QUERY_FILTER,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_QUERY_ID,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest.FIELD_SORT_KEYS);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;QueryRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableReadRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableReadRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableReadRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableReadRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableReadRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableReadRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,65&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.ReadRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;ReadRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableReadRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ReadRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableReadRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;ReadRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;superfluous,&nbsp;as&nbsp;ReadRequest&nbsp;doesn't&nbsp;have&nbsp;any&nbsp;custom&nbsp;content/fields&nbsp;over&nbsp;AbstractRequest...<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableReadRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;ReadRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableUpdateRequestjavafromrev1611forgerockscriptbranchescontextrefactorscriptablewrappersscriptjavascriptsrcmainjavaorgforgerockscriptjavascriptScriptableUpdateRequestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableUpdateRequest.java&nbsp;(from&nbsp;rev&nbsp;1611,&nbsp;forgerock-script/branches/context-refactor-scriptable-wrappers/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableUpdateRequest.java)&nbsp;(0&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableUpdateRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/main/java/org/forgerock/script/javascript/ScriptableUpdateRequest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,106&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;DO&nbsp;NOT&nbsp;REMOVE&nbsp;COPYRIGHT&nbsp;NOTICES&nbsp;OR&nbsp;THIS&nbsp;HEADER.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2014&nbsp;ForgeRock&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and&nbsp;Distribution&nbsp;License<br>
+&nbsp;*&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in<br>
+&nbsp;*&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at<br>
+&nbsp;*&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing<br>
+&nbsp;*&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Code,&nbsp;include&nbsp;this&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include&nbsp;the&nbsp;License&nbsp;file<br>
+&nbsp;*&nbsp;at&nbsp;http://forgerock.org/license/CDDLv1.0.html<br>
+&nbsp;*&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL&nbsp;Header,<br>
+&nbsp;*&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by<br>
+&nbsp;*&nbsp;your&nbsp;own&nbsp;identifying&nbsp;information:<br>
+&nbsp;*&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.script.javascript;<br>
+<br>
+import&nbsp;org.forgerock.json.resource.CreateRequest;<br>
+import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
+import&nbsp;org.forgerock.script.scope.Parameter;<br>
+import&nbsp;org.mozilla.javascript.Scriptable;<br>
+import&nbsp;org.mozilla.javascript.Wrapper;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;{@code&nbsp;Scriptable}&nbsp;wrapper&nbsp;for&nbsp;a&nbsp;{@code&nbsp;UpdateRequest}&nbsp;object.<br>
+&nbsp;*/<br>
+class&nbsp;ScriptableUpdateRequest&nbsp;extends&nbsp;AbstractScriptableRequest&nbsp;implements&nbsp;Wrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;map&nbsp;being&nbsp;wrapped.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;UpdateRequest&nbsp;request;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;scriptable&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;specified&nbsp;list.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;wrapped.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NullPointerException<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;specified&nbsp;map&nbsp;is&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScriptableUpdateRequest(final&nbsp;Parameter&nbsp;parameter,&nbsp;final&nbsp;UpdateRequest&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(parameter,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getClassName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;ScriptableUpdateRequest&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;get(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CreateRequest.FIELD_CONTENT.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;map&nbsp;newContent&nbsp;to&nbsp;content&nbsp;for&nbsp;consistency!<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getNewContent(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(UpdateRequest.FIELD_REVISION.equals(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Converter.wrap(parameter,&nbsp;request.getRevision(),&nbsp;start,&nbsp;false);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super.get(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;has(String&nbsp;name,&nbsp;Scriptable&nbsp;start)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CreateRequest.FIELD_CONTENT.equals(name)&nbsp;//&nbsp;map&nbsp;newContent&nbsp;to&nbsp;content&nbsp;for&nbsp;consistency!<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;UpdateRequest.FIELD_REVISION.equals(name)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;super.has(name,&nbsp;start);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(String&nbsp;name,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;allow&nbsp;updating&nbsp;newContent&nbsp;and&nbsp;revision<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;put(int&nbsp;index,&nbsp;Scriptable&nbsp;start,&nbsp;Object&nbsp;value)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;concatenate&nbsp;the&nbsp;UpdateRequest&nbsp;properties&nbsp;with&nbsp;the&nbsp;generic&nbsp;request&nbsp;properties&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Object[]&nbsp;PROPERTIES&nbsp;=&nbsp;concatIds(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest.FIELD_CONTENT,&nbsp;//&nbsp;map&nbsp;newContent&nbsp;to&nbsp;content&nbsp;for&nbsp;consistency<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest.FIELD_REVISION);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[]&nbsp;getIds()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PROPERTIES;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getDefaultValue(Class&amp;lt;?&amp;gt;&nbsp;hint)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;[object&nbsp;UpdateRequest]&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockscripttrunkscriptjavascriptsrctestresourcescontainerresourcejs&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-script/trunk/script-javascript/src/test/resources/container/resource.js&nbsp;(1631&nbsp;=&gt;&nbsp;1632)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-script/trunk/script-javascript/src/test/resources/container/resource.js&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;16:53:25&nbsp;UTC&nbsp;(rev&nbsp;1631)<br>
+++&nbsp;forgerock-script/trunk/script-javascript/src/test/resources/container/resource.js&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2014-01-30&nbsp;18:08:42&nbsp;UTC&nbsp;(rev&nbsp;1632)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-167,9&nbsp;+167,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;{&nbsp;&amp;quot;message&amp;quot;:&nbsp;&amp;quot;actionRequest&nbsp;type&nbsp;is&nbsp;not&nbsp;match&amp;quot;};<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-var&nbsp;securityContextClass&nbsp;=&nbsp;Packages.org.forgerock.json.resource.SecurityContext;<br>
-if&nbsp;(context.containsContext(securityContextClass))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;securityContext&nbsp;=&nbsp;context.asContext(securityContextClass);<br>
&lt;/del&gt;&lt;ins&gt;+if&nbsp;(context.security)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;securityContext&nbsp;=&nbsp;context.security;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!securityContext.authenticationId&nbsp;==&nbsp;&amp;quot;bjensen@example.com&amp;quot;)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;code&amp;quot;:&nbsp;401,<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
