<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[1377]&nbsp;forgerock-auth-filters/branches/1.3.0-changes:&nbsp;Adding&nbsp;in&nbsp;changes&nbsp;to&nbsp;jaspi&nbsp;runtime&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=1377&quot;&gt;1377&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;phillcunnington&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2013-12-13&nbsp;20:49:50&nbsp;+0000&nbsp;(Fri,&nbsp;13&nbsp;Dec&nbsp;2013)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;Adding&nbsp;in&nbsp;changes&nbsp;to&nbsp;jaspi&nbsp;runtime&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonpomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonAuditLoggerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditLogger.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonAuditRecordjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditRecord.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonDebugLoggerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/DebugLogger.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonLoggingConfiguratorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/LoggingConfigurator.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulepomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulesrcmainjavaorgforgerockjaspimodulesiwaIWAModulejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/IWAModule.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulesrcmainjavaorgforgerockjaspimodulesiwawdssoWDSSOjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/wdsso/WDSSO.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulepomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulesrcmainjavaorgforgerockjaspimodulessessionjwtJwtSessionModulejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/main/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulesrctestjavaorgforgerockjaspimodulessessionjwtJwtSessionModuleTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/test/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModuleTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulespomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterpomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthzfilterpomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthzfiltersrctestjavaorgforgerockauthzAuthZFilterTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/src/test/java/org/forgerock/authz/AuthZFilterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changespomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonNopAuditLoggerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopAuditLogger.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonNopDebugLoggerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopDebugLogger.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsargumentstxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/arguments.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/forgerock-jaspi-test-server/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsdeployapachetomcat6037webappsjaspiMETAINFmavenorgforgerockcommonsforgerockjaspitestserverpomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/forgerock-jaspi-test-server/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/WEB-INF/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsdeployapachetomcat6037webappsjaspiWEBINFwebxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/WEB-INF/web.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibjaspi_keywordstxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/jaspi_keywords.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibrest_utilspy&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.py&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibrest_utilstxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibstartup_shutdownpy&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.py&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibstartup_shutdowntxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/resources/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsresourcesapachetomcat6037zip&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/resources/apache-tomcat-6.0.37.zip&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcases__init__txt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/__init__.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntime__init__txt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/__init__.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimeauthmoduleonlyconfigjson&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only-config.json&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimeauthmoduleonlytxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimesessionmoduleonlyconfigjson&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only-config.json&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimesessionmoduleonlytxt&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only.txt&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsvariablespy&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/variables.py&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimepomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiJaspiRuntimeFilterjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/JaspiRuntimeFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextDefaultServerContextFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/DefaultServerContextFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextFallbackServerAuthContextjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreator.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorImpljava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImpl.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionsJaspiAuthExceptionjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionspackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingJaspiAuditLoggerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiAuditLogger.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingJaspiLoggingConfiguratorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiLoggingConfigurator.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingLogFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/LogFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingMessageInfoAuditRecordjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/MessageInfoAuditRecord.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspipackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeHttpServletCallbackHandlerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandler.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeHttpServletMessageInfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletMessageInfo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeJaspiRuntimejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/JaspiRuntime.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeRuntimeResultHandlerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/RuntimeResultHandler.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigServerContextFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/ServerContextFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigSessionServerContextFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectDefaultRuntimeInjectorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjector.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectRuntimeInjectorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/RuntimeInjector.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextContextHandlerjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextconfigModuleConfigurationFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/ModuleConfigurationFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextconfigpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextpackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimepackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiHttpServletResponseWrapperjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapper.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiPrintWriterjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiServletOutputStreamjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStream.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponsepackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsFilterConfigurationjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfiguration.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsFilterConfigurationImpljava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfigurationImpl.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsMessageInfoUtilsjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/MessageInfoUtils.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilspackageinfojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiJaspiRuntimeFilterTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/JaspiRuntimeFilterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextDefaultServerContextFactoryTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/DefaultServerContextFactoryTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextFallbackServerAuthContextTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/FallbackServerAuthContextTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorImplTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImplTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiexceptionsJaspiAuthExceptionTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiloggingLogFactoryTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/LogFactoryTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiloggingMessageInfoAuditRecordTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/MessageInfoAuditRecordTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeHttpServletCallbackHandlerTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandlerTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeHttpServletMessageInfoTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletMessageInfoTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeJaspiRuntimeTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/JaspiRuntimeTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeRuntimeResultHandlerTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/RuntimeResultHandlerTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeconfigSessionServerContextFactoryTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactoryTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/inject/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeconfiginjectDefaultRuntimeInjectorTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjectorTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextContextHandlerTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiHttpServletResponseWrapperTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapperTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiPrintWriterTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiServletOutputStreamTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStreamTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiutilsFilterConfigurationImplTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/FilterConfigurationImplTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiutilsMessageInfoUtilsTestjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/MessageInfoUtilsTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserverpomxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverConnectionFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/ConnectionFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverStatusResourcejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/StatusResource.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverTestLoggingConfiguratorjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/TestLoggingConfigurator.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointAbstractEndpointjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/AbstractEndpoint.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointEndpointResourcejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointResource.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointEndpointUtilsjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointUtils.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointModuleConfigurationResourcejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/ModuleConfigurationResource.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointoneEndpointModuleConfigurationFactoryjava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointModuleConfigurationFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointoneEndpointOnejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointOne.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesAuthModuleOnejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleOne.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesAuthModuleTwojava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleTwo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesSessionModulejava&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/SessionModule.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/WEB-INF/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainwebappWEBINFwebxml&quot;&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/WEB-INF/web.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/examples/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-container/&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,9&nbsp;+25,20&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-auth-filter-common&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;Auth&nbsp;Filter&nbsp;Common&amp;lt;/name&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.felix&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;maven-bundle-plugin&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;extensions&amp;gt;true&amp;lt;/extensions&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/build&amp;gt;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonAuditLoggerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditLogger.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-22,7&nbsp;+22,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@author&nbsp;Phill&nbsp;Cunnington<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@since&nbsp;1.0.0<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;interface&nbsp;AuditLogger&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+public&nbsp;interface&nbsp;AuditLogger&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Audits&nbsp;the&nbsp;AuthN&nbsp;or&nbsp;AuthZ&nbsp;requests&nbsp;outcome.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-32,5&nbsp;+32,5&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;auditRecord&nbsp;The&nbsp;AuditRecord.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;audit(AuditRecord&nbsp;auditRecord);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;audit(AuditRecord&amp;lt;T&amp;gt;&nbsp;auditRecord);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonAuditRecordjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditRecord.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditRecord.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/AuditRecord.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,28&nbsp;+16,26&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.auth.common;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;javax.servlet.http.HttpServletRequest;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Contains&nbsp;all&nbsp;required&nbsp;information&nbsp;for&nbsp;the&nbsp;AuthN&nbsp;or&nbsp;AuthZ&nbsp;request&nbsp;to&nbsp;be&nbsp;audited.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@author&nbsp;Phill&nbsp;Cunnington<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@since&nbsp;1.0.0<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;class&nbsp;AuditRecord&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+public&nbsp;class&nbsp;AuditRecord&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;AuthResult&nbsp;authResult;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;HttpServletRequest&nbsp;request;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;T&nbsp;auditObject;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;AuditRecord&nbsp;with&nbsp;the&nbsp;given&nbsp;AuthResult&nbsp;and&nbsp;HttpServletRequest.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;AuditRecord&nbsp;with&nbsp;the&nbsp;given&nbsp;AuthResult&nbsp;and&nbsp;audit&nbsp;Object.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authResult&nbsp;The&nbsp;AuthResult&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;HttpServletRequest&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;auditObject&nbsp;The&nbsp;audit&nbsp;Object&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuditRecord(AuthResult&nbsp;authResult,&nbsp;HttpServletRequest&nbsp;request)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuditRecord(AuthResult&nbsp;authResult,&nbsp;T&nbsp;auditObject)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.authResult&nbsp;=&nbsp;authResult;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;request;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.auditObject&nbsp;=&nbsp;auditObject;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-50,11&nbsp;+48,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;HttpServletRequest&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;audit&nbsp;Object&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;HttpServletRequest.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;audit&nbsp;Object.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpServletRequest&nbsp;getHttpServletRequest()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;request;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;T&nbsp;getAuditObject()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;auditObject;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonDebugLoggerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/DebugLogger.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/DebugLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/DebugLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,17&nbsp;+19,31&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Base&nbsp;interface&nbsp;for&nbsp;all&nbsp;debug&nbsp;logging&nbsp;implementations.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;@author&nbsp;Phill&nbsp;Cunnington<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@since&nbsp;1.0.0<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;interface&nbsp;DebugLogger&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;trace&nbsp;level.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;trace(final&nbsp;String&nbsp;message);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;trace&nbsp;level.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;The&nbsp;throwable&nbsp;to&nbsp;log.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;trace(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;t);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;debug&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug(String&nbsp;message);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug(final&nbsp;String&nbsp;message);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;debug&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-37,14&nbsp;+51,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;The&nbsp;throwable&nbsp;to&nbsp;log.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug(String&nbsp;message,&nbsp;Throwable&nbsp;t);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;t);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;error&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;error(String&nbsp;message);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;error(final&nbsp;String&nbsp;message);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;error&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-52,14&nbsp;+66,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;The&nbsp;throwable&nbsp;to&nbsp;log.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;error(String&nbsp;message,&nbsp;Throwable&nbsp;t);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;error(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;t);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;warning&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;warn(String&nbsp;message);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;warn(final&nbsp;String&nbsp;message);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Logs&nbsp;the&nbsp;given&nbsp;message&nbsp;at&nbsp;the&nbsp;warning&nbsp;level.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-67,5&nbsp;+81,5&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;log&nbsp;message.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;The&nbsp;throwable&nbsp;to&nbsp;log.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;warn(String&nbsp;message,&nbsp;Throwable&nbsp;t);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;warn(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;t);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonLoggingConfiguratorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/LoggingConfigurator.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/LoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/LoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-17,14&nbsp;+17,16&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.auth.common;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Base&nbsp;interface&nbsp;for&nbsp;all&nbsp;Configurators&nbsp;responsible&nbsp;for&nbsp;providing&nbsp;configuration&nbsp;to&nbsp;the&nbsp;AuthN&nbsp;and&nbsp;AuthZ&nbsp;Filters.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Base&nbsp;interface&nbsp;for&nbsp;all&nbsp;Configurators&nbsp;responsible&nbsp;for&nbsp;providing&nbsp;config&nbsp;to&nbsp;the&nbsp;AuthN&nbsp;and&nbsp;AuthZ&nbsp;Filters.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Provides&nbsp;methods&nbsp;for&nbsp;getting&nbsp;instances&nbsp;of&nbsp;the&nbsp;two&nbsp;Logging&nbsp;interfaces.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;The&nbsp;type&nbsp;of&nbsp;AuditLogger.<br>
+&nbsp;*<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@author&nbsp;Phill&nbsp;Cunnington<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@since&nbsp;1.0.0<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;interface&nbsp;LoggingConfigurator&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+public&nbsp;interface&nbsp;LoggingConfigurator&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;Debug&nbsp;Logger.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-38,5&nbsp;+40,5&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;Audit&nbsp;Logger&nbsp;instance.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&nbsp;getAuditLogger();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;T&amp;gt;&nbsp;getAuditLogger();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonNopAuditLoggerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopAuditLogger.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopAuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopAuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,30&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.auth.common;<br>
+<br>
+/**<br>
+&nbsp;*<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@author&nbsp;Phill&nbsp;Cunnington<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;NopAuditLogger&amp;lt;T&amp;gt;&nbsp;implements&nbsp;AuditLogger&amp;lt;T&amp;gt;&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;audit(AuditRecord&amp;lt;T&amp;gt;&nbsp;auditRecord)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthfiltercommonsrcmainjavaorgforgerockauthcommonNopDebugLoggerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopDebugLogger.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopDebugLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-auth-filter-common/src/main/java/org/forgerock/auth/common/NopDebugLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,57&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.auth.common;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;NOP&nbsp;implementation&nbsp;of&nbsp;the&nbsp;DebugLogger.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;NopDebugLogger&nbsp;implements&nbsp;DebugLogger&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;trace(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;trace(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;debug(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;debug(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;error(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;error(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;warn(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;warn(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulepomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,5&nbsp;+1,22&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&amp;lt;!--<br>
+*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+*&nbsp;License.<br>
+*<br>
+*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+*<br>
+*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+*<br>
+*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+--&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-12,7&nbsp;+29,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-iwa-module&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;IWA&nbsp;Module&amp;lt;/name&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;IWA&nbsp;Module&amp;lt;/name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;description&amp;gt;ForgeRock&nbsp;JASPI&nbsp;Integrated&nbsp;Windows&nbsp;Authentication&nbsp;Module&amp;lt;/description&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugins&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-26,22&nbsp;+44,17&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.glassfish&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;javax.security.auth.message&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-api&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-jdk14&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.7.2&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;/project&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulesrcmainjavaorgforgerockjaspimodulesiwaIWAModulejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/IWAModule.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/IWAModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/IWAModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,9&nbsp;+16,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.modules.iwa;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.jaspi.modules.iwa.wdsso.WDSSO;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.slf4j.Logger;<br>
-import&nbsp;org.slf4j.LoggerFactory;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-41,7&nbsp;+41,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;IWAModule&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Logger&nbsp;LOGGER&nbsp;=&nbsp;LoggerFactory.getLogger(IWAModule.class);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;IWA_FAILED&nbsp;=&nbsp;&amp;quot;iwa-failed&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-96,7&nbsp;+96,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getWriter().write(&amp;quot;{\&amp;quot;failure\&amp;quot;:true,\&amp;quot;reason\&amp;quot;:\&amp;quot;&amp;quot;&nbsp;+&nbsp;IWA_FAILED&nbsp;+&nbsp;&amp;quot;\&amp;quot;}&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;Error&nbsp;writing&nbsp;Negotiate&nbsp;header&nbsp;to&nbsp;Response.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;Error&nbsp;writing&nbsp;Negotiate&nbsp;header&nbsp;to&nbsp;Response.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Error&nbsp;writing&nbsp;to&nbsp;Response&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-105,7&nbsp;+105,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;Authorization&nbsp;Header&nbsp;set&nbsp;in&nbsp;request.&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;username&nbsp;=&nbsp;new&nbsp;WDSSO().process(options,&nbsp;request);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;IWA&nbsp;successful&nbsp;with&nbsp;username,&nbsp;{}&amp;quot;,&nbsp;username);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;IWA&nbsp;successful&nbsp;with&nbsp;username,&nbsp;&amp;quot;&nbsp;+&nbsp;username);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientSubject.getPrincipals().add(new&nbsp;Principal()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getName()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-113,7&nbsp;+113,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;IWA&nbsp;has&nbsp;failed.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWAModule:&nbsp;IWA&nbsp;has&nbsp;failed.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;IWA&nbsp;has&nbsp;failed&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspiiwamodulesrcmainjavaorgforgerockjaspimodulesiwawdssoWDSSOjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/wdsso/WDSSO.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/wdsso/WDSSO.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-iwa-module/src/main/java/org/forgerock/jaspi/modules/iwa/wdsso/WDSSO.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-45,17&nbsp;+45,18&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.login.Configuration;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.login.LoginContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.servlet.http.HttpServletRequest;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.ietf.jgss.GSSContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.ietf.jgss.GSSCredential;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.ietf.jgss.GSSException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.ietf.jgss.GSSManager;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.ietf.jgss.GSSName;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.slf4j.Logger;<br>
-import&nbsp;org.slf4j.LoggerFactory;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;WDSSO&nbsp;/*extends&nbsp;AMLoginModule*/&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Logger&nbsp;LOGGER&nbsp;=&nbsp;LoggerFactory.getLogger(WDSSO.class);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;amAuthWindowsDesktopSSO&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;amAuthWindowsDesktopSSO&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-177,7&nbsp;+178,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;e&nbsp;instanceof&nbsp;GSSException)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;major&nbsp;=&nbsp;((GSSException)e).getMajor();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(major&nbsp;==&nbsp;GSSException.CREDENTIALS_EXPIRED)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Credential&nbsp;expired.&nbsp;Re-establish&nbsp;credential...&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Credential&nbsp;expired.&nbsp;Re-establish&nbsp;credential...&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceLogin();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticateToken(kerberosToken);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-186,12&nbsp;+187,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;ISAuthConstants.LOGIN_SUCCEED;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ee)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;new&nbsp;cred.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;new&nbsp;cred.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;ee;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;GSSException.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;GSSException.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-199,7&nbsp;+200,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(GSSException&nbsp;e&nbsp;){<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;major&nbsp;=&nbsp;e.getMajor();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(major&nbsp;==&nbsp;GSSException.CREDENTIALS_EXPIRED)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Credential&nbsp;expired.&nbsp;Re-establish&nbsp;credential...&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Credential&nbsp;expired.&nbsp;Re-establish&nbsp;credential...&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceLogin();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticateToken(kerberosToken);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-208,20&nbsp;+209,20&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;ISAuthConstants.LOGIN_SUCCEED;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ee)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;new&nbsp;cred.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;new&nbsp;cred.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;ee;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;GSSException.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;GSSException.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(RuntimeException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;generic&nbsp;exception.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;generic&nbsp;exception.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;generic&nbsp;exception.&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Authentication&nbsp;failed&nbsp;with&nbsp;generic&nbsp;exception.&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-270,7&nbsp;+271,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GSSName&nbsp;user&nbsp;=&nbsp;context.getSrcName();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WDSSO.user&nbsp;=&nbsp;getUserName(user.toString());<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Found&nbsp;user!&nbsp;{}&amp;quot;,&nbsp;WDSSO.user);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Found&nbsp;user!&nbsp;&amp;quot;&nbsp;+&nbsp;WDSSO.user);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;if&nbsp;the&nbsp;user&nbsp;account&nbsp;from&nbsp;the&nbsp;Kerberos&nbsp;ticket&nbsp;exists&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;in&nbsp;the&nbsp;realm.&nbsp;The&nbsp;&amp;quot;Alias&nbsp;Search&nbsp;Attribute&nbsp;Names&amp;quot;&nbsp;will&nbsp;be&nbsp;used&nbsp;to<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-380,7&nbsp;+381,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;req.getHeader(&amp;quot;Authorization&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((header&nbsp;!=&nbsp;null)&nbsp;&amp;amp;&amp;amp;&nbsp;header.startsWith(&amp;quot;Negotiate&amp;quot;))&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header&nbsp;=&nbsp;header.substring(&amp;quot;Negotiate&amp;quot;.length()).trim();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;\&amp;quot;Authorization\&amp;quot;&nbsp;header&nbsp;set,&nbsp;{}&amp;quot;,&nbsp;header);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;IWA&nbsp;WDSSO:&nbsp;\&amp;quot;Authorization\&amp;quot;&nbsp;header&nbsp;set,&nbsp;&amp;quot;&nbsp;+&nbsp;header);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spnegoToken&nbsp;=&nbsp;Base64.decode(header);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-603,7&nbsp;+604,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug.message(&amp;quot;Service&nbsp;login&nbsp;succeeded.&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Service&nbsp;Login&nbsp;Error:&nbsp;{}&amp;quot;,&nbsp;e.getMessage());<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Service&nbsp;Login&nbsp;Error:&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(debug.messageEnabled())&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;IWA&nbsp;WDSSO:&nbsp;Stack&nbsp;trace:&nbsp;&amp;quot;,&nbsp;e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulepomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,5&nbsp;+1,22&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&amp;lt;!--<br>
+*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+*&nbsp;License.<br>
+*<br>
+*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+*<br>
+*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+*<br>
+*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+--&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-12,7&nbsp;+29,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-jwt-session-module&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;JWT&nbsp;Session&nbsp;Module&amp;lt;/name&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;JWT&nbsp;Session&nbsp;Module&amp;lt;/name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;description&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;JWT&nbsp;Session&nbsp;Authentication&nbsp;Module&amp;lt;/description&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugins&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-26,33&nbsp;+44,22&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.glassfish&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;javax.security.auth.message&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-web-token&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-container&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-api&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.glassfish&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;javax.security.auth.message&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;mockito-all&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;/project&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulesrcmainjavaorgforgerockjaspimodulessessionjwtJwtSessionModulejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/main/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/main/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/main/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,8&nbsp;+16,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.modules.session.jwt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.common.util.KeystoreManager;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.filter.AuthNFilter;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.builders.JwtBuilderFactory;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.jwe.EncryptedJwt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.jwe.EncryptionMethod;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,8&nbsp;+27,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.jwe.JweHeader;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.jwt.Jwt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.jwt.JwtClaimsSet;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.slf4j.Logger;<br>
-import&nbsp;org.slf4j.LoggerFactory;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.callback.Callback;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-60,7&nbsp;+60,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;JwtSessionModule&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Logger&nbsp;DEBUG&nbsp;=&nbsp;LoggerFactory.getLogger(JwtSessionModule.class);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;DEBUG&nbsp;=&nbsp;LogFactory.getDebug();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;JWT_SESSION_COOKIE_NAME&nbsp;=&nbsp;&amp;quot;session-jwt&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;SKIP_SESSION_PARAMETER_NAME&nbsp;=&nbsp;&amp;quot;skipSession&amp;quot;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-180,7&nbsp;+180,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//TODO&nbsp;also&nbsp;include&nbsp;ATTRIBUTE_AUTHCID!<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;context&nbsp;=&nbsp;getContextMap(messageInfo);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;claimsSetContext&nbsp;=&nbsp;jwt.getClaimsSet().getClaim(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;claimsSetContext&nbsp;=&nbsp;jwt.getClaimsSet().getClaim(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(claimsSetContext&nbsp;!=&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.putAll(claimsSetContext);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-232,10&nbsp;+232,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jwt&nbsp;jwt&nbsp;=&nbsp;verifySessionJwt(jwtSessionCookie.getValue());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(jwt&nbsp;!=&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;all&nbsp;goes&nbsp;well!<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;claimsSetContext&nbsp;=&nbsp;jwt.getClaimsSet().getClaim(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;claimsSetContext&nbsp;=&nbsp;jwt.getClaimsSet().getClaim(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(claimsSetContext&nbsp;!=&nbsp;null)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(claimsSetContext&nbsp;!=&nbsp;null)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(String&nbsp;key&nbsp;:&nbsp;claimsSetContext.keySet())&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute(key,&nbsp;claimsSetContext.get(key));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-267,11&nbsp;+266,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;context&nbsp;map&nbsp;internal&nbsp;to&nbsp;the&nbsp;messageInfo's&nbsp;map.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;getContextMap(MessageInfo&nbsp;messageInfo)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;internalMap&nbsp;=&nbsp;(Map&amp;lt;String,&nbsp;Object&amp;gt;)&nbsp;messageInfo.getMap().get(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;internalMap&nbsp;=&nbsp;(Map&amp;lt;String,&nbsp;Object&amp;gt;)&nbsp;messageInfo.getMap().get(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(internalMap&nbsp;==&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internalMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfo.getMap().put(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;internalMap);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfo.getMap().put(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;internalMap);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;internalMap;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-390,14&nbsp;+389,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;messageInfo.getMap();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;principal&nbsp;=&nbsp;request.getHeader(AuthNFilter.ATTRIBUTE_AUTH_PRINCIPAL);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;principal&nbsp;=&nbsp;request.getAttribute(JaspiRuntime.ATTRIBUTE_AUTH_PRINCIPAL);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(principal&nbsp;!=&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jwtParameters.put(&amp;quot;prn&amp;quot;,&nbsp;principal);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(map.containsKey(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jwtParameters.put(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;getContextMap(messageInfo));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(map.containsKey(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jwtParameters.put(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;getContextMap(messageInfo));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(map.containsKey(SKIP_SESSION_PARAMETER_NAME)&nbsp;&amp;amp;&amp;amp;&nbsp;((Boolean)&nbsp;map.get(SKIP_SESSION_PARAMETER_NAME)))&nbsp;{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulesforgerockjaspijwtsessionmodulesrctestjavaorgforgerockjaspimodulessessionjwtJwtSessionModuleTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/test/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModuleTest.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/test/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModuleTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/src/test/java/org/forgerock/jaspi/modules/session/jwt/JwtSessionModuleTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,7&nbsp;+16,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.modules.session.jwt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.filter.AuthNFilter;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.builders.EncryptedJwtBuilder;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.builders.JweHeaderBuilder;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.jose.builders.JwtBuilderFactory;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-412,7&nbsp;+412,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getRequestMessage()).willReturn(request);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getResponseMessage()).willReturn(response);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getMap()).willReturn(map);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getCookies()).willReturn(cookies);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cookie1.getName()).willReturn(&amp;quot;COOKIE1&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-428,7&nbsp;+428,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(&amp;quot;prn&amp;quot;,&nbsp;String.class)).willReturn(&amp;quot;PRINCIPAL&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;newContext&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newContext.put(&amp;quot;KEY&amp;quot;,&nbsp;&amp;quot;VALUE&amp;quot;);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class)).willReturn(newContext);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class)).willReturn(newContext);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jwtSessionModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-491,7&nbsp;+491,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getRequestMessage()).willReturn(request);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getResponseMessage()).willReturn(response);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getMap()).willReturn(map);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(request.getCookies()).willReturn(cookies);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cookie1.getName()).willReturn(&amp;quot;COOKIE1&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-507,7&nbsp;+507,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(&amp;quot;prn&amp;quot;,&nbsp;String.class)).willReturn(&amp;quot;PRINCIPAL&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;newContext&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newContext.put(&amp;quot;KEY&amp;quot;,&nbsp;&amp;quot;VALUE&amp;quot;);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(AuthNFilter.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class)).willReturn(newContext);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(claimsSet.getClaim(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;Map.class)).willReturn(newContext);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jwtSessionModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspimodulespomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-modules/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,26&nbsp;+1,45&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&amp;lt;!--<br>
+*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+*&nbsp;License.<br>
+*<br>
+*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+*<br>
+*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+*<br>
+*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+--&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter-parent&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.3.0-SNAPSHOT&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-modules&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;pom&amp;lt;/packaging&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;Modules&amp;lt;/name&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;Authentication&nbsp;Modules&amp;lt;/name&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modules&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-jwt-session-module&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-iwa-module&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/modules&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;properties&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/properties&amp;gt;<br>
-<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-auth-filter-common&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;/project&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsargumentstxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/arguments.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/arguments.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/arguments.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+######################################################################################################<br>
+#&nbsp;This&nbsp;file&nbsp;contains&nbsp;default&nbsp;command&nbsp;line&nbsp;arguments&nbsp;that&nbsp;are&nbsp;used&nbsp;to&nbsp;launch&nbsp;our&nbsp;test&nbsp;portfolio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;If&nbsp;a&nbsp;new&nbsp;option&nbsp;is&nbsp;required&nbsp;we&nbsp;will&nbsp;add&nbsp;it&nbsp;in&nbsp;this&nbsp;file,&nbsp;so&nbsp;you&nbsp;should&nbsp;not&nbsp;work&nbsp;with&nbsp;a&nbsp;local&nbsp;copy&nbsp;&nbsp;#<br>
+#&nbsp;To&nbsp;customize&nbsp;or&nbsp;add&nbsp;some&nbsp;options,&nbsp;use&nbsp;your&nbsp;own&nbsp;copy&nbsp;of&nbsp;customization/customization_template.txt&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;Final&nbsp;configuration&nbsp;for&nbsp;the&nbsp;tests&nbsp;will&nbsp;be&nbsp;build&nbsp;when&nbsp;launching&nbsp;Robot&nbsp;on&nbsp;the&nbsp;command&nbsp;line&nbsp;with:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;-A&nbsp;configuration/arguments.txt&nbsp;-V&nbsp;configuration/variables.py&nbsp;-A&nbsp;customization/my_customization.txt&nbsp;#<br>
+#&nbsp;=&amp;gt;&nbsp;see&nbsp;INSTALL&nbsp;and&nbsp;README&nbsp;files&nbsp;for&nbsp;some&nbsp;more&nbsp;explanations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+######################################################################################################<br>
+<br>
+#&nbsp;our&nbsp;libraries&nbsp;are&nbsp;in&nbsp;the&nbsp;&amp;quot;lib&amp;quot;&nbsp;folder<br>
+--pythonpath&nbsp;lib<br>
+<br>
+#&nbsp;where&nbsp;the&nbsp;Robot&nbsp;output&nbsp;files&nbsp;are&nbsp;going&nbsp;to&nbsp;be&nbsp;written<br>
+--outputdir&nbsp;output<br>
+<br>
+#&nbsp;handling&nbsp;known&nbsp;bugs&nbsp;by&nbsp;setting&nbsp;them&nbsp;as&nbsp;non&nbsp;critical<br>
+#&nbsp;see&nbsp;http://robotframework.googlecode.com/hg/doc/userguide/RobotFrameworkUserGuide.html#setting-criticality<br>
+--noncritical&nbsp;knownbug<br>
+<br>
+#&nbsp;excluding&nbsp;manual&nbsp;test&nbsp;cases<br>
+--exclude&nbsp;manual<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsdeployapachetomcat6037webappsjaspiMETAINFmavenorgforgerockcommonsforgerockjaspitestserverpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/forgerock-jaspi-test-server/pom.xml&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/forgerock-jaspi-test-server/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/META-INF/maven/org.forgerock.commons/forgerock-jaspi-test-server/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,50&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.3.0-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-test-server&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;Test&nbsp;Server&amp;lt;/name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;need&nbsp;to&nbsp;a&nbsp;build&nbsp;config&nbsp;to&nbsp;not&nbsp;deploy&nbsp;this&nbsp;module&nbsp;--&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;finalName&amp;gt;jaspi&amp;lt;/finalName&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/build&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource-servlet&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;2.0.2&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;dependency&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;groupId&amp;gt;org.codehaus.jackson&amp;lt;/groupId&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;artifactId&amp;gt;jackson-core-asl&amp;lt;/artifactId&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;version&amp;gt;1.9.2&amp;lt;/version&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;/dependency&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;dependency&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;groupId&amp;gt;org.codehaus.jackson&amp;lt;/groupId&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;artifactId&amp;gt;jackson-mapper-asl&amp;lt;/artifactId&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;version&amp;gt;1.9.2&amp;lt;/version&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;/dependency&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsdeployapachetomcat6037webappsjaspiWEBINFwebxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/WEB-INF/web.xml&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/WEB-INF/web.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy/apache-tomcat-6.0.37/webapps/jaspi/WEB-INF/web.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,43&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;web-app&nbsp;version=&amp;quot;2.4&amp;quot;&nbsp;xmlns=&amp;quot;http://java.sun.com/xml/ns/j2ee&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://java.sun.com/xml/ns/j2ee&nbsp;http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&amp;quot;&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;display-name&amp;gt;JASPI&nbsp;Test&nbsp;Server&amp;lt;/display-name&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-name&amp;gt;EndpointJaspiRuntimeFilter&amp;lt;/filter-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-class&amp;gt;org.forgerock.jaspi.JaspiRuntimeFilter&amp;lt;/filter-class&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;init-param&amp;gt;--&amp;gt;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;write&nbsp;test&nbsp;which&nbsp;tests&nbsp;that&nbsp;can&nbsp;change&nbsp;the&nbsp;context&nbsp;factory&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;param-name&amp;gt;context-factory-class&amp;lt;/param-name&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;param-value&amp;gt;org.forgerock.jaspi.context.DefaultServerContextFactory&amp;lt;/param-value&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;/init-param&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;logging-configurator-class&amp;lt;/param-name&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;update&nbsp;Loggers&nbsp;so&nbsp;as&nbsp;can&nbsp;test&nbsp;that&nbsp;they&nbsp;are&nbsp;being&nbsp;called&nbsp;when&nbsp;expected&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.TestLoggingConfigurator&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;module-configuration-factory-class&amp;lt;/param-name&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Test&nbsp;all&nbsp;posible&nbsp;incorrect&nbsp;configurations,&nbsp;etc&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.endpoint.ModuleConfigurationResource&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/filter&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-mapping&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-name&amp;gt;EndpointJaspiRuntimeFilter&amp;lt;/filter-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;url-pattern&amp;gt;/endpoint/*&amp;lt;/url-pattern&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/filter-mapping&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-name&amp;gt;Endpoints&amp;lt;/servlet-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-class&amp;gt;org.forgerock.json.resource.servlet.HttpServlet&amp;lt;/servlet-class&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;connection-factory-class&amp;lt;/param-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.ConnectionFactory&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/servlet&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-mapping&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-name&amp;gt;Endpoints&amp;lt;/servlet-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/servlet-mapping&amp;gt;<br>
+<br>
+&amp;lt;/web-app&amp;gt;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibjaspi_keywordstxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/jaspi_keywords.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/jaspi_keywords.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/jaspi_keywords.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,267&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+This&nbsp;file&nbsp;is&nbsp;imported&nbsp;in&nbsp;every&nbsp;test&nbsp;case<br>
+It&nbsp;will&nbsp;trigger&nbsp;all&nbsp;the&nbsp;other&nbsp;needed&nbsp;imports<br>
+<br>
+***&nbsp;Settings&nbsp;***<br>
+#&nbsp;ForgeRock&nbsp;Libraries:&nbsp;will&nbsp;load&nbsp;Robot&nbsp;and&nbsp;Python&nbsp;libraries<br>
+#Resource&nbsp;&nbsp;&nbsp;&nbsp;file_utils.txt<br>
+#Resource&nbsp;&nbsp;&nbsp;&nbsp;json_utils.txt<br>
+Resource&nbsp;&nbsp;&nbsp;&nbsp;rest_utils.txt<br>
+Resource&nbsp;&nbsp;&nbsp;&nbsp;startup_shutdown.txt<br>
+<br>
+#&nbsp;Robot&nbsp;Framework&nbsp;Libraries&nbsp;needed&nbsp;by&nbsp;keywords&nbsp;defined&nbsp;bellow&nbsp;and&nbsp;by&nbsp;some&nbsp;tc<br>
+Library&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collections<br>
+Library&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OperatingSystem<br>
+Library&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String<br>
+<br>
+***&nbsp;Variables&nbsp;***<br>
+#####################################################################################<br>
+#&nbsp;those&nbsp;variables&nbsp;are&nbsp;variables&nbsp;that&nbsp;can&nbsp;be&nbsp;customized&nbsp;by&nbsp;users&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;custom&nbsp;values&nbsp;should&nbsp;be&nbsp;set&nbsp;in&nbsp;variables.py.&nbsp;Leaving&nbsp;following&nbsp;values&nbsp;as&nbsp;default&nbsp;&nbsp;#<br>
+#####################################################################################<br>
+<br>
+#&nbsp;timeouts&nbsp;in&nbsp;seconds<br>
+${STARTUP_TIMEOUT}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60<br>
+${TIMEOUT}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;90<br>
+${LONGTIMEOUT}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;210<br>
+<br>
+#&nbsp;drives&nbsp;the&nbsp;behavior&nbsp;accordingly&nbsp;to&nbsp;the&nbsp;os&nbsp;chosen:&nbsp;unix&nbsp;or&nbsp;windows<br>
+#&nbsp;windows&nbsp;not&nbsp;supported&nbsp;for&nbsp;the&nbsp;moment<br>
+#${OPERATING_SYSTEM}&nbsp;&nbsp;unix<br>
+<br>
+#&nbsp;To&nbsp;run&nbsp;openidm&nbsp;in&nbsp;debug&nbsp;mode&nbsp;(adding&nbsp;jpda&nbsp;on&nbsp;command&nbsp;line),&nbsp;set&nbsp;to&nbsp;'true'<br>
+${DEBUG}&nbsp;&nbsp;false<br>
+<br>
+#####################################################################################<br>
+#&nbsp;those&nbsp;variables&nbsp;are&nbsp;hard-coded&nbsp;variable&nbsp;that&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;by&nbsp;user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;hence&nbsp;they&nbsp;are&nbsp;not&nbsp;in&nbsp;the&nbsp;variable&nbsp;file&nbsp;(example&nbsp;of&nbsp;variable&nbsp;file&nbsp;in&nbsp;/samples)&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#####################################################################################<br>
+<br>
+#&nbsp;openidm&nbsp;is&nbsp;installed&nbsp;on&nbsp;localhost&nbsp;on&nbsp;port&nbsp;8080.&nbsp;<br>
+#&nbsp;This&nbsp;is&nbsp;URL&nbsp;prefix&nbsp;to&nbsp;use&nbsp;for&nbsp;REST&nbsp;access<br>
+${SERVER}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://localhost:8080/<br>
+${URL_PREFIX}&nbsp;&nbsp;${SERVER}jaspi/<br>
+<br>
+#&nbsp;URL<br>
+#${URL_RECON_XML}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recon?_action=recon&amp;amp;mapping=systemXmlfileAccounts_managedUser&amp;amp;waitForCompletion=true<br>
+#${URL_RECON_LDAP}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recon?_action=recon&amp;amp;mapping=systemLdapAccounts_managedUser&amp;amp;waitForCompletion=true<br>
+#${URL_RECON_LDAP_NOWAITING}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recon?_action=recon&amp;amp;mapping=systemLdapAccounts_managedUser<br>
+#${URL_TASKSCANNER}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskscanner?_action=execute&amp;amp;name=schedule/taskscan_sunset<br>
+<br>
+#&nbsp;Default&nbsp;user&nbsp;properties&nbsp;<br>
+#${DEFAULT_USER_ID}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;joesmith<br>
+#${DEFAULT_USER_NAME}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsmith<br>
+#${DEFAULT_GIVEN_NAME}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;joe<br>
+#${DEFAULT_FAMILY_NAME}&nbsp;&nbsp;&nbsp;&nbsp;smith<br>
+#${DEFAULT_EMAIL}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;joe@example.com<br>
+#${DEFAULT_PHONE_NUMBER}&nbsp;&nbsp;&nbsp;5551231234<br>
+#${DEFAULT_PASSWORD}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Th3Password<br>
+#${DEFAULT_DESCRIPTION}&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;First&nbsp;user<br>
+#&nbsp;If&nbsp;we&nbsp;need&nbsp;another&nbsp;user<br>
+#${ANOTHER_DEFAULT_USER_ID}&nbsp;&nbsp;&nbsp;&nbsp;anotherjoesmith<br>
+#${ANOTHER_DEFAULT_USER_NAME}&nbsp;&nbsp;anotherjsmith<br>
+<br>
+#&nbsp;Configuration&nbsp;files<br>
+${ONE_SESSION_TWO_AUTH_JASPI_CONFIG}&nbsp;&nbsp;&nbsp;&nbsp;/Users/Phill/ForgeRockDev/commons/forgerock-auth-filters-robot/forgerock-auth-filters-robot/testcases/jaspi_configuration.json<br>
+<br>
+#${AUDIT_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/audit.json<br>
+#${AUTHENTICATION_CONFIG_FILE}&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/authentication.json<br>
+#${BOOT_PROPERTIES_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/boot/boot.properties<br>
+#${LOGGING_PROPERTIES_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/logging.properties<br>
+#${MANAGED_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/managed.json<br>
+#${REPO_ORIENTDB_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/repo.orientdb.json<br>
+#${ROUTER_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/router.json<br>
+#${SCHEDULE_TASKSCAN_SUNSET}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/schedule-taskscan_sunset.json<br>
+#${SCHEDULER_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/scheduler.json<br>
+#${SYSTEM_PROPERTIES_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/system.properties<br>
+#${WORKFLOW_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/conf/workflow.json<br>
+#${CONTEXT_ENDUSER_CONFIG_FILE}&nbsp;&nbsp;${OPENIDMDIR}/conf/ui.context-enduser.json<br>
+<br>
+#${AUDIT_CONFIG_FILE_SAMPLE1}&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf/audit.json<br>
+#${MANAGED_CONFIG_FILE_SAMPLE1}&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf/managed.json<br>
+#${POLICY_CONFIG_FILE_SAMPLE1}&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf/policy.json<br>
+#${ROUTER_CONFIG_FILE_SAMPLE1}&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf/router.json<br>
+#${SYNC_CONFIG_FILE_SAMPLE1}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf/sync.json<br>
+<br>
+#${LOGGING_PROPERTIES_FILE_SAMPLE2}&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf/logging.properties<br>
+#${SYNC_CONFIG_FILE_SAMPLE2}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf/sync.json<br>
+#${POLICY_CONFIG_FILE_SAMPLE2}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf/policy.json<br>
+#${REPO_ORIENTDB_CONFIG_FILE_SAMPLE2}&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf/repo.orientdb.json<br>
+#${REPO_JDBC_CONFIG_FILE_SAMPLE2}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf/repo.jdbc.json<br>
+<br>
+<br>
+#${BACKUP_CONF_DIR}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/backupconf<br>
+#${BACKUP_CONF_DIR_SAMPLE1}&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/backupconf<br>
+#${BACKUP_DATA_DIR_SAMPLE1}&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/backupdata<br>
+#${BACKUP_CONF_DIR_SAMPLE2}&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/backupconf<br>
+<br>
+#&nbsp;Audit&nbsp;and&nbsp;Log&nbsp;files<br>
+#${ACCESS_AUDIT_FILE}&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/audit/access.csv<br>
+#${ACTIVITY_AUDIT_FILE}&nbsp;&nbsp;${OPENIDMDIR}/audit/activity.csv<br>
+#${RECON_AUDIT_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/audit/recon.csv&nbsp;<br>
+#${FIRST_LOG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/logs/openidm0.log.0<br>
+<br>
+#&nbsp;Scripts<br>
+#${ACCESS_SCRIPT}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${OPENIDMDIR}/script/access.js<br>
+<br>
+#&nbsp;Command&nbsp;Line&nbsp;Interface&nbsp;<br>
+#${CLI_COMMAND_LINUX}&nbsp;&nbsp;cd&nbsp;${OPENIDMDIR};java&nbsp;-classpath&nbsp;&amp;quot;${OPENIDMDIR}/bin/*:${OPENIDMDIR}/bundle/*&amp;quot;&nbsp;org.forgerock.openidm.shell.impl.Main<br>
+#${CLI_COMMAND_WINDOWS}&nbsp;&nbsp;cd&nbsp;${OPENIDMDIR}&nbsp;&amp;amp;&nbsp;java&nbsp;-classpath&nbsp;&amp;quot;${OPENIDMDIR}\\bin\\*;${OPENIDMDIR}\\bundle\\*&amp;quot;&nbsp;org.forgerock.openidm.shell.impl.Main<br>
+<br>
+<br>
+***&nbsp;Keywords&nbsp;***<br>
+#########################################################################<br>
+#&nbsp;to&nbsp;call&nbsp;from&nbsp;initialization&nbsp;file&nbsp;to&nbsp;set&nbsp;TAG&nbsp;to&nbsp;the&nbsp;TC&nbsp;in&nbsp;FOLDERS<br>
+#########################################################################<br>
+Set_Folder_Name_Tags&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;&nbsp;&nbsp;${test_suite_path}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;to&nbsp;call&nbsp;from&nbsp;initialization&nbsp;file&nbsp;to&nbsp;set&nbsp;TAG&nbsp;to&nbsp;the&nbsp;TC&nbsp;in&nbsp;FOLDERS<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${path}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${folder&nbsp;name}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Split&nbsp;Path&nbsp;&nbsp;&nbsp;&nbsp;${test_suite_path}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;Tags&nbsp;&nbsp;&nbsp;&nbsp;${folder&nbsp;name}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#########################################################################<br>
+#&nbsp;CLI.SH<br>
+#########################################################################<br>
+run_cli_command&nbsp;&nbsp;[arguments]&nbsp;&nbsp;${arguments}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${output}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;Keyword&nbsp;If&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;'${OPERATING_SYSTEM}'&nbsp;==&nbsp;'unix'&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;Run&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${CLI_COMMAND_LINUX}&nbsp;${arguments}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;IF&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'${OPERATING_SYSTEM}'&nbsp;==&nbsp;'windows'&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;Run&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${CLI_COMMAND_WINDOWS}&nbsp;${arguments}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${output}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#########################################################################<br>
+#&nbsp;TaskScanner&nbsp;keywords<br>
+#########################################################################<br>
+#CheckTaskscannerTaskState&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${task_id}&nbsp;&nbsp;${expected_state}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check&nbsp;the&nbsp;status&nbsp;of&nbsp;a&nbsp;given&nbsp;task&nbsp;of&nbsp;the&nbsp;taskscanner<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskscanner/${task_id}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${progress}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;progress&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${actual_state}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${progress}&nbsp;&nbsp;&nbsp;state<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${error_message}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catenate&nbsp;&nbsp;Taskscanner&nbsp;task&nbsp;state&nbsp;expected&nbsp;value&nbsp;was&nbsp;&nbsp;&nbsp;${expected_state}&nbsp;&nbsp;but&nbsp;found&nbsp;&nbsp;${actual_state}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${actual_state}&nbsp;&nbsp;${expected_state}&nbsp;&nbsp;${error_message}&nbsp;&nbsp;values=false<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_taskscanner_tasks<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;@{id_of_tasks}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;get_id_of_taskscanner_tasks<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;:FOR&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${id_of_task}&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;IN&nbsp;&nbsp;@{id_of_tasks}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_url&nbsp;&nbsp;taskscanner/${id_of_task}?_action=cancel&nbsp;&nbsp;&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#get_id_of_taskscanner_tasks<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${id_list}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;List<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_url&nbsp;&nbsp;&nbsp;&nbsp;taskscanner<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${tasks}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;&nbsp;tasks<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${nb_of_tasks}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;Length&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;${tasks}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${nb_of_tasks}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;:FOR&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${index}&nbsp;&nbsp;IN&nbsp;RANGE&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${nb_of_tasks}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${task}&nbsp;=&nbsp;&nbsp;Get&nbsp;From&nbsp;List&nbsp;&nbsp;${tasks}&nbsp;&nbsp;${index}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${id}&nbsp;=&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;${task}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_id<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Append&nbsp;to&nbsp;list&nbsp;&nbsp;${id_list}&nbsp;&nbsp;${id}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${id_list}&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_managed_users_and_taskscanner_tasks<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_taskscanner_tasks&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#########################################################################<br>
+#&nbsp;Policy&nbsp;Enforcement&nbsp;keywords<br>
+#########################################################################<br>
+#validate_user_object_against_server&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${user_name}&nbsp;&nbsp;${data}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;Uses&nbsp;POST&nbsp;to&nbsp;validate&nbsp;a&nbsp;user&nbsp;object&nbsp;against&nbsp;the&nbsp;server&nbsp;policy&nbsp;for&nbsp;users&nbsp;via&nbsp;rest<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_as_admin&nbsp;&nbsp;&nbsp;${OPENIDM_URL_PREFIX}policy/managed/user/${user_name}?_action=validateObject&nbsp;&nbsp;${data}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Return]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${result.json()}&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#validate_property_against_server&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${user_name}&nbsp;&nbsp;${data}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;Validate&nbsp;an&nbsp;object&nbsp;property&nbsp;against&nbsp;the&nbsp;server<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;${user_name}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;${data}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;${OPENIDM_URL_PREFIX}policy/managed/user/${user_name}?_action=validateProperty<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_as_admin&nbsp;&nbsp;&nbsp;${OPENIDM_URL_PREFIX}policy/managed/user/${user_name}?_action=validateProperty&nbsp;&nbsp;${data}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Return]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${result.json()}&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#########################################################################<br>
+#&nbsp;CLEAN&nbsp;AUDIT<br>
+#########################################################################<br>
+#clean_audit_files<br>
+#&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRemove&nbsp;Files&nbsp;&nbsp;${ACCESS_AUDIT_FILE}&nbsp;&nbsp;${ACTIVITY_AUDIT_FILE}&nbsp;&nbsp;${RECON_AUDIT_FILE}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_audit_and_openidm_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;clean&nbsp;audit&nbsp;files&nbsp;after&nbsp;user&nbsp;drop&nbsp;because&nbsp;user&nbsp;delete&nbsp;creates&nbsp;some&nbsp;audit<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_audit_files<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_audit_config_for_sample1_and_audit_files_and_openidm_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;refresh&nbsp;sample1&nbsp;audit&nbsp;config&nbsp;file&nbsp;by&nbsp;default&nbsp;audit&nbsp;config&nbsp;file&nbsp;that&nbsp;was&nbsp;untouched&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${AUDIT_CONFIG_FILE}&nbsp;&nbsp;&nbsp;&nbsp;${AUDIT_CONFIG_FILE_SAMPLE1}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;load_configuration&nbsp;&nbsp;audit&nbsp;&nbsp;${AUDIT_CONFIG_FILE_SAMPLE1}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_audit_and_openidm_users&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+#########################################################################<br>
+#&nbsp;BACKUP&nbsp;AND&nbsp;CLEAN<br>
+#########################################################################&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_openidm_output_directories<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${SUITE_NAME_UNDERSCORE}&nbsp;=&nbsp;&nbsp;replace&nbsp;string&nbsp;&nbsp;${SUITE_NAME}&nbsp;&nbsp;${SPACE}&nbsp;&nbsp;_<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${TEST_NAME_UNDERSCORE}&nbsp;=&nbsp;&nbsp;replace&nbsp;string&nbsp;&nbsp;${TEST_NAME}&nbsp;&nbsp;${SPACE}&nbsp;&nbsp;_<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}&nbsp;=&nbsp;&nbsp;Join&nbsp;Path&nbsp;&nbsp;${BACKUP_PATH}&nbsp;&nbsp;${SUITE_NAME_UNDERSCORE}.${TEST_NAME_UNDERSCORE}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Directory&nbsp;&nbsp;${TC_BACKUP_PATH}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/logs&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/conf&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/audit&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}/sample1_conf&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}/sample2_conf<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_output<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;Keyword&nbsp;If&nbsp;Test&nbsp;Failed&nbsp;&nbsp;backup_openidm_output_directories<br>
+<br>
+#backup_and_clean_audit_and_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_audit_config_for_sample1_and_audit_files_and_openidm_users<br>
+<br>
+#backup_and_clean_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_opendj_users_and_groups<br>
+<br>
+#backup_and_clean_managed_users&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_restore_sync_sample2_and_clean_openidm_links_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backup_output&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;restore_sync_sample2_from_backup_sample2_directory<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete_link_between_managed_users_and_ldap<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_opendj_users_and_groups<br>
+<br>
+#backup_restore_sync_sample2_and_clean_openidm_links_audit_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backup_output&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;restore_sync_sample2_from_backup_sample2_directory<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete_link_between_managed_users_and_ldap<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_audit_files<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_opendj_users_and_groups<br>
+&nbsp;<br>
+#restore_policy_sync_sample2_and_clean_openidm_links_audit_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;restore_sync_policy_sample2_from_backup_sample2_directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_managed_users<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete_link_between_managed_users_and_ldap<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_audit_files<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clean_opendj_users_and_groups<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_and_shutdown_openidm<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm<br>
+<br>
+#backup_and_shutdown_openidm_and_clean_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm_and_clean_opendj<br>
+<br>
+#backup_and_shutdown_openidm_and_uninstall_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;backup_output<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm_and_uninstall_opendj&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_output_cluster<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;Keyword&nbsp;If&nbsp;Test&nbsp;Failed&nbsp;&nbsp;backup_openidm_output_directories_for_cluster&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#backup_openidm_output_directories_for_cluster<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${SUITE_NAME_UNDERSCORE}&nbsp;=&nbsp;&nbsp;replace&nbsp;string&nbsp;&nbsp;${SUITE_NAME}&nbsp;&nbsp;${SPACE}&nbsp;&nbsp;_<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${TEST_NAME_UNDERSCORE}&nbsp;=&nbsp;&nbsp;replace&nbsp;string&nbsp;&nbsp;${TEST_NAME}&nbsp;&nbsp;${SPACE}&nbsp;&nbsp;_<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}&nbsp;=&nbsp;&nbsp;Join&nbsp;Path&nbsp;&nbsp;${BACKUP_PATH}&nbsp;&nbsp;${SUITE_NAME_UNDERSCORE}.${TEST_NAME_UNDERSCORE}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Directory&nbsp;&nbsp;${TC_BACKUP_PATH}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/cluster/openidm0/openidm/logs&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}/node0_logs<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;Directory&nbsp;&nbsp;${OPENIDMDIR}/cluster/openidm1/openidm/logs&nbsp;&nbsp;&nbsp;&nbsp;${TC_BACKUP_PATH}/node1_logs&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibrest_utilspy&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.py&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,87&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;quot;&amp;quot;&amp;quot;<br>
+Python&nbsp;Lib&nbsp;for&nbsp;REST&nbsp;access&nbsp;for&nbsp;OpenIDM<br>
+<br>
+By&nbsp;default&nbsp;we&nbsp;use&nbsp;Content-Type:&nbsp;application/json<br>
+It&nbsp;assumes&nbsp;everything,&nbsp;server&nbsp;and&nbsp;testclient,&nbsp;is&nbsp;UTF-8<br>
+if&nbsp;they&nbsp;have&nbsp;different&nbsp;configuration&nbsp;(Server&nbsp;running&nbsp;on&nbsp;ASCII&nbsp;or&nbsp;ISO&nbsp;something)<br>
+and&nbsp;test&nbsp;fails&nbsp;because&nbsp;the&nbsp;conversion&nbsp;<br>
+then&nbsp;we&nbsp;could&nbsp;try&nbsp;to&nbsp;execute&nbsp;the&nbsp;same&nbsp;call&nbsp;with&nbsp;Content-Type:&nbsp;application/json;charset=utf-8&nbsp;<br>
+which&nbsp;would&nbsp;lead&nbsp;to&nbsp;a&nbsp;success&nbsp;request<br>
+<br>
+&amp;quot;&amp;quot;&amp;quot;<br>
+import&nbsp;requests<br>
+from&nbsp;robot.reporting&nbsp;import&nbsp;resultwriter<br>
+<br>
+class&nbsp;rest_utils:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;Python&nbsp;Lib&nbsp;for&nbsp;REST&nbsp;access&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;url_prefix):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;save&nbsp;the&nbsp;URL&nbsp;prefix&nbsp;in&nbsp;the&nbsp;object&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._prefix&nbsp;=&nbsp;url_prefix<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#########################################################################<br>
+#&nbsp;LOW&nbsp;LEVEL&nbsp;KEYWORDS:&nbsp;call&nbsp;Requests&nbsp;Library&nbsp;Methods<br>
+#&nbsp;Created&nbsp;so&nbsp;that&nbsp;we&nbsp;don't&nbsp;have&nbsp;to&nbsp;name&nbsp;the&nbsp;argument&nbsp;within&nbsp;our&nbsp;TC<br>
+#########################################################################&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get(self,&nbsp;url,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.get(url,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;delete(self,&nbsp;url,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.delete(url,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;head(self,&nbsp;url,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.head(url,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;post(self,&nbsp;url,&nbsp;data_string,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.post(url,&nbsp;data=data_string,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;put(self,&nbsp;url,&nbsp;data_string,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.put(url,&nbsp;data=data_string,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;patch(self,&nbsp;url,&nbsp;data_string,&nbsp;headers=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;direct&nbsp;call&nbsp;to&nbsp;Requests&nbsp;lib&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.patch(url,&nbsp;data=data_string,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;put_url(self,&nbsp;url_endpoint,&nbsp;data_string,&nbsp;headers_custom=None):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;Admin,&nbsp;perform&nbsp;a&nbsp;put,&nbsp;check&nbsp;returned&nbsp;status&nbsp;and&nbsp;return&nbsp;JSON<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;headers_custom&nbsp;is&nbsp;None:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers_custom&nbsp;=&nbsp;{}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers_content&nbsp;=&nbsp;{'Content-Type':'application/json'}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;self._prefix&nbsp;+&nbsp;url_endpoint<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;dict(headers_content.items()&nbsp;+&nbsp;headers_custom.items())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.put(url,&nbsp;data=data_string,&nbsp;headers=headers)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;result.status_code&nbsp;!=&nbsp;200&nbsp;and&nbsp;result.status_code&nbsp;!=&nbsp;201:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;&amp;quot;Status&nbsp;code&nbsp;expected:&nbsp;200&nbsp;or&nbsp;201&nbsp;but&nbsp;found:&nbsp;&amp;quot;+str(result.status_code)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(msg)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result.json()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibrest_utilstxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/rest_utils.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,155&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+***&nbsp;Settings&nbsp;***<br>
+#&nbsp;Robot&nbsp;Framework&nbsp;Libraries&nbsp;needed&nbsp;by&nbsp;keywords&nbsp;defined&nbsp;bellow<br>
+Library&nbsp;&nbsp;Collections<br>
+<br>
+#&nbsp;ForgeRock&nbsp;Python&nbsp;Libraries&nbsp;offers&nbsp;some&nbsp;other&nbsp;keywords<br>
+Library&nbsp;&nbsp;rest_utils&nbsp;&nbsp;${URL_PREFIX}<br>
+<br>
+***&nbsp;Keywords&nbsp;***<br>
+<br>
+##########&nbsp;GENERIC&nbsp;RESOURCE&nbsp;MANAGEMENT&nbsp;##########&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+check_resource_exists&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;check&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;object&nbsp;to&nbsp;delete&nbsp;in&nbsp;a&nbsp;resource<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get_as_admin&nbsp;&nbsp;${OPENIDM_URL_PREFIX}${resource}/${object}/?_queryId=query-all-ids<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${resource_does_exist}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;evaluate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${result.status_code}==200<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${resource_does_exist}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+count_objects_in_resource<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${resource}/${object}/?_queryId=query-all-ids<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${results}&nbsp;=&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;${json}&nbsp;&nbsp;result<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${length}&nbsp;=&nbsp;&nbsp;&nbsp;Get&nbsp;Length&nbsp;&nbsp;${results}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${length}&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+get_id_of_resource&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;id&nbsp;of&nbsp;a&nbsp;given&nbsp;object&nbsp;type&nbsp;in&nbsp;a&nbsp;resource&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${id_list}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;List<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_url&nbsp;&nbsp;&nbsp;&nbsp;${resource}/${object}/?_queryId=query-all-ids<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${results}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${json}&nbsp;&nbsp;result<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${nb_of_results}&nbsp;=&nbsp;&nbsp;Get&nbsp;Length&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;${results}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;:FOR&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${index}&nbsp;&nbsp;IN&nbsp;RANGE&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${nb_of_results}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;Get&nbsp;From&nbsp;List&nbsp;&nbsp;${results}&nbsp;&nbsp;${index}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${id}&nbsp;=&nbsp;&nbsp;&nbsp;Get&nbsp;From&nbsp;Dictionary&nbsp;&nbsp;${result}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_id<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Append&nbsp;to&nbsp;list&nbsp;&nbsp;${id_list}&nbsp;&nbsp;${id}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${id_list}<br>
+<br>
+get_first_id_of_resource&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@{ids}&nbsp;=&nbsp;&nbsp;get_id_of_resource&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;@{ids}[0]<br>
+<br>
+clean_resource&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}&nbsp;<br>
+&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;delete&nbsp;object&nbsp;one&nbsp;by&nbsp;one&nbsp;using&nbsp;their&nbsp;id<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@{ids_of_objects}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;get_id_of_resource&nbsp;&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${number_of_users}&nbsp;=&nbsp;&nbsp;get&nbsp;length&nbsp;&nbsp;${ids_of_objects}&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;:FOR&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${id_of_object}&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;IN&nbsp;&nbsp;@{ids_of_objects}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete_as_admin&nbsp;&nbsp;${OPENIDM_URL_PREFIX}${resource}/${object}/${id_of_object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;don't&nbsp;check&nbsp;if&nbsp;the&nbsp;delete&nbsp;is&nbsp;successful&nbsp;of&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;it&nbsp;could&nbsp;return&nbsp;404&nbsp;sometimes&nbsp;if&nbsp;the&nbsp;user&nbsp;was&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;beeing&nbsp;deleted<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${log_msg}&nbsp;=&nbsp;&nbsp;catenate&nbsp;&nbsp;cleaned&nbsp;&nbsp;${number_of_users}&nbsp;&nbsp;users&nbsp;from&nbsp;&nbsp;${resource}&nbsp;&nbsp;${object}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;${log_msg}&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+##########&nbsp;CHECK&nbsp;URL&nbsp;REST&nbsp;RETURN&nbsp;CODE&nbsp;##########<br>
+<br>
+get_url_and_expect_200&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${url}&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get_as_admin&nbsp;&nbsp;${OPENIDM_URL_PREFIX}${url}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${error_message}&nbsp;=&nbsp;&nbsp;Catenate&nbsp;&nbsp;SEPARATOR=&nbsp;&nbsp;URL&nbsp;&amp;quot;&nbsp;&nbsp;${url}&nbsp;&nbsp;&amp;quot;&nbsp;should&nbsp;return&nbsp;status&nbsp;&amp;quot;200&amp;quot;&nbsp;but&nbsp;returned&nbsp;&amp;quot;&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}&nbsp;&nbsp;${error_message}&nbsp;&nbsp;values=false<br>
+<br>
+get_full_url_and_expect_200&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${url}&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get_as_admin&nbsp;&nbsp;${url}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${error_message}&nbsp;=&nbsp;&nbsp;Catenate&nbsp;&nbsp;SEPARATOR=&nbsp;&nbsp;URL&nbsp;&amp;quot;&nbsp;&nbsp;${url}&nbsp;&nbsp;&amp;quot;&nbsp;should&nbsp;return&nbsp;status&nbsp;&amp;quot;200&amp;quot;&nbsp;but&nbsp;returned&nbsp;&amp;quot;&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}&nbsp;&nbsp;${error_message}&nbsp;&nbsp;values=false<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+get_url_and_expect_404&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${url}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get_as_admin&nbsp;&nbsp;${OPENIDM_URL_PREFIX}${url}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${error_message}&nbsp;=&nbsp;&nbsp;Catenate&nbsp;&nbsp;SEPARATOR=&nbsp;&nbsp;URL&nbsp;&amp;quot;&nbsp;&nbsp;${url}&nbsp;&nbsp;&amp;quot;&nbsp;should&nbsp;return&nbsp;status&nbsp;&amp;quot;404&amp;quot;&nbsp;but&nbsp;returned&nbsp;&amp;quot;&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${404}&nbsp;&nbsp;${error_message}&nbsp;&nbsp;values=false&nbsp;&nbsp;&nbsp;<br>
+&nbsp;<br>
+post_url_and_expect_4xx<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${url}&nbsp;&nbsp;${data}={}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;post_as_admin&nbsp;&nbsp;${OPENIDM_URL_PREFIX}${url}&nbsp;&nbsp;${data}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${status_code}&nbsp;=&nbsp;&nbsp;Convert&nbsp;To&nbsp;String&nbsp;&nbsp;${result.status_code}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Match&nbsp;&nbsp;${status_code}&nbsp;&nbsp;4??&nbsp;<br>
+&nbsp;<br>
+##########&nbsp;HEADERS&nbsp;##########&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+create_headers_anonymous&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-OpenIDM-Username&nbsp;&nbsp;anonymous&nbsp;&nbsp;X-OpenIDM-Password&nbsp;&nbsp;anonymous<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${result}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+create_headers_admin<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-OpenIDM-Username&nbsp;&nbsp;openidm-admin&nbsp;&nbsp;X-OpenIDM-Password&nbsp;&nbsp;openidm-admin<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[return]&nbsp;&nbsp;${result}&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+##########&nbsp;CONFIGURATION&nbsp;##########&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+configure_jaspi<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${CONFIG_FILE}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;&nbsp;Get&nbsp;File&nbsp;&nbsp;${CONFIG_FILE}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;put_url&nbsp;&nbsp;configure&nbsp;&nbsp;${CONFIG_DATA}<br>
+<br>
+update_configuration&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_FILE}&nbsp;&nbsp;${OLD_STRING}&nbsp;&nbsp;${NEW_STRING}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;&nbsp;Get&nbsp;File&nbsp;&nbsp;${CONFIG_FILE}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;=&nbsp;&nbsp;Replace_String&nbsp;&nbsp;${CONFIG_DATA}&nbsp;&nbsp;${OLD_STRING}&nbsp;&nbsp;${NEW_STRING}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;put_url&nbsp;&nbsp;config/${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_DATA}<br>
+<br>
+update_configuration_with_json&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_JSON}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;json_to_string&nbsp;&nbsp;${CONFIG_JSON}&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;put_url&nbsp;&nbsp;config/${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_DATA}<br>
+<br>
+refresh_configuration&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${CONFIG_NAME}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_JSON}&nbsp;=&nbsp;&nbsp;get_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config/${CONFIG_NAME}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;=&nbsp;&nbsp;json_to_string&nbsp;&nbsp;${CONFIG_JSON}&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;put_url&nbsp;&nbsp;config/${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_DATA}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+load_configuration&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_FILE}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${CONFIG_DATA}&nbsp;&nbsp;Get&nbsp;File&nbsp;&nbsp;${CONFIG_FILE}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;put_url&nbsp;&nbsp;config/${CONFIG_NAME}&nbsp;&nbsp;${CONFIG_DATA}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+backup_conf_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;directory&nbsp;&nbsp;${OPENIDMDIR}/conf&nbsp;&nbsp;${BACKUP_CONF_DIR}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+backup_sample1_conf_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;directory&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/conf&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE1}<br>
+<br>
+backup_sample1_data_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;directory&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/data&nbsp;&nbsp;${BACKUP_DATA_DIR_SAMPLE1}<br>
+<br>
+backup_sample2_conf_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;directory&nbsp;&nbsp;${OPENIDMDIR}/samples/sample2/conf&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+restore_conf_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${OPENIDMDIR}/conf&nbsp;&nbsp;recursive=True<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;directory&nbsp;&nbsp;${BACKUP_CONF_DIR}&nbsp;&nbsp;${OPENIDMDIR}/conf<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${BACKUP_CONF_DIR}&nbsp;&nbsp;recursive=True<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+restore_sync_sample1_from_backup_sample1_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;file&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE1}/sync.json&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE1}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;load_configuration&nbsp;&nbsp;sync&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE1}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE1}&nbsp;&nbsp;recursive=True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+restore_xml_sample1_from_backup_sample1_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;file&nbsp;&nbsp;${BACKUP_DATA_DIR_SAMPLE1}/xmlConnectorData.xml&nbsp;&nbsp;${OPENIDMDIR}/samples/sample1/data/xmlConnectorData.xml<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${BACKUP_DATA_DIR_SAMPLE1}&nbsp;&nbsp;recursive=True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+restore_sync_sample2_from_backup_sample2_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;file&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}/sync.json&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;load_configuration&nbsp;&nbsp;sync&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}&nbsp;&nbsp;recursive=True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+restore_sync_policy_sample2_from_backup_sample2_directory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;file&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}/sync.json&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;load_configuration&nbsp;&nbsp;sync&nbsp;&nbsp;${SYNC_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;file&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}/policy.json&nbsp;&nbsp;${POLICY_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;load_configuration&nbsp;&nbsp;policy&nbsp;&nbsp;${POLICY_CONFIG_FILE_SAMPLE2}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;remove&nbsp;directory&nbsp;&nbsp;${BACKUP_CONF_DIR_SAMPLE2}&nbsp;&nbsp;recursive=True&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibstartup_shutdownpy&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.py&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,117&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;quot;&amp;quot;&amp;quot;<br>
+Python&nbsp;lib&nbsp;for&nbsp;deploying,&nbsp;starting&nbsp;and&nbsp;stopping&nbsp;the&nbsp;JASPI&nbsp;runtime<br>
+&amp;quot;&amp;quot;&amp;quot;<br>
+import&nbsp;subprocess<br>
+import&nbsp;shutil<br>
+import&nbsp;os<br>
+import&nbsp;time<br>
+import&nbsp;requests<br>
+import&nbsp;signal<br>
+import&nbsp;glob<br>
+from&nbsp;subprocess&nbsp;import&nbsp;STDOUT<br>
+<br>
+class&nbsp;startup_shutdown:<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;lib_directory,&nbsp;tomcat_zip_path,&nbsp;deploy_path,&nbsp;debug):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;save&nbsp;the&nbsp;resources&nbsp;directory&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources&nbsp;=&nbsp;os.path.join(lib_directory,&nbsp;'..',&nbsp;'resources')<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._resources&nbsp;=&nbsp;resources<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;the&nbsp;parent&nbsp;dir&nbsp;as&nbsp;tomcat_deploy_path&nbsp;end&nbsp;with&nbsp;apache-tomcat&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;apache-tomcat&nbsp;folder&nbsp;will&nbsp;be&nbsp;created&nbsp;when&nbsp;we&nbsp;unzip<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(head,&nbsp;tail)&nbsp;=&nbsp;os.path.split(tomcat_zip_path)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;do&nbsp;it&nbsp;again&nbsp;if&nbsp;the&nbsp;tomcat_deploy_path&nbsp;has&nbsp;a&nbsp;trailing&nbsp;backslash<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;tail&nbsp;==&nbsp;&amp;quot;&amp;quot;:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(head,&nbsp;tail)&nbsp;=&nbsp;os.path.split(head)&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._tomcat_dir_name&nbsp;=&nbsp;tomcat_dir_name&nbsp;=&nbsp;tail.rsplit('.',&nbsp;1)[0]&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._tomcat_zip_path&nbsp;=&nbsp;tomcat_zip_path<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._deploy_path&nbsp;=&nbsp;deploy_path<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._debug&nbsp;=&nbsp;debug<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;clean_deploy_dir(self):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;clean&nbsp;deploy&nbsp;directory&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;os.path.isdir(self._deploy_path):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutil.rmtree(self._deploy_path)&nbsp;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;deploy_tomcat_python(self,&nbsp;jaspi_test_server_war_path):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;deploy&nbsp;JASPI&nbsp;runtime&nbsp;test&nbsp;server&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Unzip&nbsp;the&nbsp;file<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;os.path.exists(self._deploy_path):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.makedirs(self._deploy_path)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.chdir(self._deploy_path)<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(os.devnull,&nbsp;&amp;quot;w&amp;quot;)&nbsp;as&nbsp;invisible:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subprocess.call([&amp;quot;unzip&amp;quot;,&nbsp;self._tomcat_zip_path],&nbsp;stdout=invisible)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&amp;quot;Successfully&nbsp;deployed&nbsp;tomcat&amp;quot;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.set_tomcat_sh_executable()<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutil.copy(jaspi_test_server_war_path,&nbsp;os.path.join(self._deploy_path,&nbsp;self._tomcat_dir_name,&nbsp;'webapps'))<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_tomcat_sh_executable(self):<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tomcat_deploy_bin_path&nbsp;=&nbsp;os.path.join(self._deploy_path,&nbsp;self._tomcat_dir_name,&nbsp;'bin',&nbsp;'*.sh')&nbsp;&nbsp;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(sh_path)&nbsp;in&nbsp;glob.glob(tomcat_deploy_bin_path):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(os.devnull,&nbsp;&amp;quot;w&amp;quot;)&nbsp;as&nbsp;invisible:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subprocess.call([&amp;quot;chmod&amp;quot;,&nbsp;&amp;quot;u+x&amp;quot;,&nbsp;sh_path])<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;startup_tomcat_python(self,&nbsp;port):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;start&nbsp;tomcat&nbsp;using&nbsp;bin/catalina.sh&nbsp;script&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;First,&nbsp;we&nbsp;will&nbsp;kill&nbsp;any&nbsp;other&nbsp;Tomcat&nbsp;process&nbsp;running&nbsp;on&nbsp;the&nbsp;machine<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;prevent&nbsp;us&nbsp;from&nbsp;having&nbsp;another&nbsp;Tomcat&nbsp;using&nbsp;another&nbsp;Port<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;but&nbsp;often&nbsp;this&nbsp;is&nbsp;using&nbsp;the&nbsp;same&nbsp;port&nbsp;and&nbsp;break&nbsp;automation<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.kill_tomcat_processes()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startup_path&nbsp;=&nbsp;os.path.join(self._deploy_path,&nbsp;self._tomcat_dir_name,&nbsp;'bin',&nbsp;'catalina.sh')<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args&nbsp;=&nbsp;[startup_path]<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self._debug&nbsp;!=&nbsp;'false':<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args.append('jpda')<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args.append('start')<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Start&nbsp;Tomcat<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;subprocess.Popen(args,&nbsp;stdout=subprocess.PIPE)<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;startup&nbsp;can&nbsp;take&nbsp;some&nbsp;time&nbsp;before&nbsp;all&nbsp;the&nbsp;bundles&nbsp;are&nbsp;deployed<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;'http://localhost:'+str(port)+'/jaspi/status'<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;True:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;requests.get(url)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actual_status&nbsp;=&nbsp;result.status_code<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;actual_status&nbsp;==&nbsp;200:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(0.5)<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;shutdown_tomcat_python(self):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;shutdown&nbsp;tomcat&nbsp;using&nbsp;bin/catalina.sh&nbsp;script&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown_path&nbsp;=&nbsp;os.path.join(self._deploy_path,&nbsp;self._tomcat_dir_name,&nbsp;'bin',&nbsp;'catalina.sh')<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(os.devnull,&nbsp;&amp;quot;w&amp;quot;)&nbsp;as&nbsp;invisible:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_code&nbsp;=&nbsp;subprocess.call([shutdown_path,&nbsp;'stop'],&nbsp;stdout=invisible)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;return_code&nbsp;==&nbsp;0:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#if&nbsp;shutdown&nbsp;was&nbsp;made,&nbsp;need&nbsp;to&nbsp;wait&nbsp;a&nbsp;bit&nbsp;after&nbsp;shutdown&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;before&nbsp;doing&nbsp;anything&nbsp;else&nbsp;otherwise&nbsp;get&nbsp;errors&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(0.5)&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kill_tomcat_processes(self):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;Kill&nbsp;all&nbsp;the&nbsp;other&nbsp;tomcat&nbsp;processes&nbsp;&amp;quot;&amp;quot;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;subprocess.Popen(['ps',&nbsp;'-ef'],&nbsp;stdout=subprocess.PIPE)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out,&nbsp;err&nbsp;=&nbsp;p.communicate()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;line&nbsp;in&nbsp;out.splitlines():<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;'tomcat'&nbsp;in&nbsp;line&nbsp;in&nbsp;line:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pid&nbsp;=&nbsp;int(line.split()[1])<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.kill(pid,&nbsp;signal.SIGKILL)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestslibstartup_shutdowntxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/lib/startup_shutdown.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,85&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+***&nbsp;Settings&nbsp;***<br>
+#&nbsp;ForgeRock&nbsp;Python&nbsp;Libraries&nbsp;offers&nbsp;some&nbsp;other&nbsp;keywords<br>
+Library&nbsp;&nbsp;startup_shutdown&nbsp;&nbsp;${CURDIR}&nbsp;&nbsp;${TOMCAT_ZIP_PATH}&nbsp;&nbsp;${DEPLOY_PATH}&nbsp;&nbsp;${DEBUG}<br>
+<br>
+***&nbsp;Keywords&nbsp;***<br>
+deploy_startup_jaspi<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${port}=8080<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Timeout]&nbsp;&nbsp;${STARTUP_TIMEOUT}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;clean_deploy_dir&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;deploy_tomcat_python&nbsp;&nbsp;${JASPI_TEST_SERVER_WAR_PATH}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;startup_tomcat_python&nbsp;&nbsp;${port}<br>
+<br>
+shutdown_tomcat<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;shutdown&nbsp;tomcat&nbsp;if&nbsp;it&nbsp;is&nbsp;running<br>
+&nbsp;&nbsp;&nbsp;&nbsp;shutdown_tomcat_python<br>
+<br>
+#deploy_startup_openidm&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}&nbsp;&nbsp;${project_location}=&nbsp;&nbsp;${working_location}=&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${configuration_file}=&nbsp;&nbsp;${port}=8080&nbsp;&nbsp;${expected_openidm_status}=ACTIVE_READY<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Timeout]&nbsp;&nbsp;${OPENIDM_STARTUP_TIMEOUT}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_openidm_install_dir&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;deploy_openidm_python&nbsp;&nbsp;&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${OPENIDM_ZIP_PATH}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${UNZIP_PATH}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_logging_properties_config_file&nbsp;&nbsp;${install_directory}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;Keyword&nbsp;If&nbsp;&nbsp;'${REPO}'&nbsp;==&nbsp;'mysql'&nbsp;&nbsp;mysql.configure_mysql_as_repo&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${MYSQL_ROOT_PASSWORD}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;startup_openidm_python&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${working_location}&nbsp;&nbsp;${configuration_file}&nbsp;&nbsp;${port}&nbsp;&nbsp;${expected_openidm_status}&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#deploy_openidm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_openidm_install_dir&nbsp;&nbsp;${install_directory}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;deploy_openidm_python&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${OPENIDM_ZIP_PATH}&nbsp;&nbsp;${UNZIP_PATH}&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_logging_properties_config_file&nbsp;&nbsp;${install_directory}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#startup_openidm&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}&nbsp;&nbsp;${project_location}=&nbsp;&nbsp;${working_location}=&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${configuration_file}=&nbsp;&nbsp;${port}=8080&nbsp;&nbsp;${expected_openidm_status}=ACTIVE_READY<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Timeout]&nbsp;&nbsp;${OPENIDM_STARTUP_TIMEOUT}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;Keyword&nbsp;If&nbsp;&nbsp;'${REPO}'&nbsp;==&nbsp;'mysql'&nbsp;&nbsp;mysql.configure_mysql_as_repo&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${MYSQL_ROOT_PASSWORD}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;startup_openidm_python&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${working_location}&nbsp;&nbsp;${configuration_file}&nbsp;&nbsp;${port}&nbsp;&nbsp;${expected_openidm_status}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#startup_openidm_and_leave_mysql_repo_untouched&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}&nbsp;&nbsp;${project_location}=&nbsp;&nbsp;${working_location}=&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${configuration_file}=&nbsp;&nbsp;${port}=8080&nbsp;&nbsp;${expected_openidm_status}=ACTIVE_READY<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Timeout]&nbsp;&nbsp;${OPENIDM_STARTUP_TIMEOUT}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;startup_openidm_python&nbsp;&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${working_location}&nbsp;&nbsp;${configuration_file}&nbsp;&nbsp;&nbsp;${port}&nbsp;&nbsp;&nbsp;${expected_openidm_status}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#deploy_startup_openidm_and_leave_mysql_repo_untouched&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}&nbsp;&nbsp;${project_location}=&nbsp;&nbsp;${working_location}=&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${configuration_file}=&nbsp;&nbsp;${port}=8080&nbsp;&nbsp;${expected_openidm_status}=ACTIVE_READY<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Timeout]&nbsp;&nbsp;${OPENIDM_STARTUP_TIMEOUT}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_openidm_install_dir&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;deploy_openidm_python&nbsp;&nbsp;&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${OPENIDM_ZIP_PATH}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${UNZIP_PATH}&nbsp;&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_logging_properties_config_file&nbsp;&nbsp;${install_directory}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;startup_openidm_python&nbsp;&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;&nbsp;${project_location}&nbsp;&nbsp;${working_location}&nbsp;&nbsp;${configuration_file}&nbsp;&nbsp;${port}&nbsp;&nbsp;&nbsp;${expected_openidm_status}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+#shutdown_openidm&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;shutdown&nbsp;openidm&nbsp;if&nbsp;it&nbsp;is&nbsp;running<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm_python&nbsp;&nbsp;&nbsp;${install_directory}<br>
+<br>
+##########&nbsp;GLOBAL&nbsp;SYSTEM&nbsp;STARTUP&nbsp;AND&nbsp;SHUTDOWN&nbsp;##########&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#shutdown_openidm_and_uninstall_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;shutdown&nbsp;openidm&nbsp;and&nbsp;uninstall&nbsp;completely&nbsp;openDJ<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;uninstall_opendj<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#shutdown_openidm_and_clean_opendj<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;shutdown&nbsp;openidm&nbsp;and&nbsp;clean&nbsp;the&nbsp;users&nbsp;an&nbsp;groups&nbsp;in&nbsp;openDJ<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;clean_opendj_users_and_groups<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;shutdown_openidm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
+<br>
+##########&nbsp;DEPLOY&nbsp;UTILS&nbsp;##########&nbsp;&nbsp;&nbsp;&nbsp;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_openidm_install_dir&nbsp;&nbsp;<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp;&nbsp;remove&nbsp;the&nbsp;directory&nbsp;where&nbsp;openidm&nbsp;will&nbsp;be&nbsp;installed<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;try&nbsp;multiple&nbsp;times&nbsp;as&nbsp;it&nbsp;may&nbsp;fail&nbsp;if&nbsp;some&nbsp;write&nbsp;action&nbsp;are&nbsp;still&nbsp;ongoing&nbsp;in&nbsp;the&nbsp;directory<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;Wait&nbsp;until&nbsp;keyword&nbsp;succeeds&nbsp;&nbsp;5&nbsp;&nbsp;1&nbsp;&nbsp;Remove&nbsp;Directory&nbsp;&nbsp;${install_directory}&nbsp;&nbsp;recursive=True<br>
+&nbsp;&nbsp;&nbsp;&nbsp;<br>
+#clean_logging_properties_config_file&nbsp;&nbsp;[Arguments]&nbsp;&nbsp;${install_directory}=${OPENIDMDIR}<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;${file_to_clean}&nbsp;=&nbsp;&nbsp;Set&nbsp;Variable&nbsp;&nbsp;${install_directory}/conf/logging.properties<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;replace_text_in_file&nbsp;&nbsp;&nbsp;&nbsp;${file_to_clean}&nbsp;&nbsp;&nbsp;java.util.logging.ConsoleHandler.level&nbsp;=&nbsp;WARNING&nbsp;&nbsp;&nbsp;java.util.logging.ConsoleHandler.level&nbsp;=&nbsp;OFF<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;replace_text_in_file&nbsp;&nbsp;&nbsp;&nbsp;${file_to_clean}&nbsp;&nbsp;&nbsp;java.util.logging.ConsoleHandler.formatter&nbsp;&nbsp;&nbsp;\#java.util.logging.ConsoleHandler.formatter<br>
+#&nbsp;&nbsp;&nbsp;&nbsp;replace_text_in_file&nbsp;&nbsp;&nbsp;&nbsp;${file_to_clean}&nbsp;&nbsp;&nbsp;java.util.logging.ConsoleHandler.filter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\#java.util.logging.ConsoleHandler.filter<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsresourcesapachetomcat6037zip&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;binary&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/resources/apache-tomcat-6.0.37.zip&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;cx&quot;&gt;(Binary&nbsp;files&nbsp;differ)<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;cx&quot;&gt;Property&nbsp;changes&nbsp;on:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/resources/apache-tomcat-6.0.37.zip<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;___________________________________________________________________<br>
&lt;/span&gt;&lt;a&nbsp;id=&quot;svnmimetype&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;svn:mime-type&lt;/h4&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcases__init__txt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/__init__.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/__init__.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/__init__.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,3&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+***&nbsp;Settings&nbsp;***<br>
+Resource&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;jaspi_keywords.txt<br>
+Test&nbsp;Timeout&nbsp;&nbsp;&nbsp;&nbsp;${TIMEOUT}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntime__init__txt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/__init__.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/__init__.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/__init__.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,3&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+***&nbsp;Settings&nbsp;***<br>
+Resource&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;jaspi_keywords.txt<br>
+Force&nbsp;Tags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimeauthmoduleonlyconfigjson&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only-config.json&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only-config.json&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only-config.json&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,10&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+{<br>
+&nbsp;&nbsp;&amp;quot;serverAuthContext&amp;quot;:&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;authModules&amp;quot;:&nbsp;[{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;className&amp;quot;:&nbsp;&amp;quot;org.forgerock.jaspi.test.server.modules.AuthModuleOne&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;properties&amp;quot;:&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;keyAlias&amp;quot;:&nbsp;&amp;quot;openidm-localhost&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}]<br>
+&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimeauthmoduleonlytxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,86&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+Description:<br>
+JASPI&nbsp;Runtime<br>
+<br>
+***&nbsp;Settings&nbsp;***<br>
+Resource&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;jaspi_keywords.txt<br>
+Test&nbsp;Timeout&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${TIMEOUT}<br>
+Suite&nbsp;Setup&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deploy_startup_jaspi<br>
+Suite&nbsp;Teardown&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown_tomcat<br>
+<br>
+***&nbsp;Variables&nbsp;***<br>
+${JASPI_RUNTIME_CONFIGURATION_FILE}&nbsp;&nbsp;/Users/Phill/ForgeRockDev/tmp-old-repos/forgerock-commons-auth-filters-1.3.0/forgerock-commons-auth-filters-1.3.0/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/auth-module-only-config.json<br>
+<br>
+***&nbsp;Test&nbsp;Cases&nbsp;***<br>
+BasicTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Auth1-Secure-Response=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}<br>
+<br>
+BasicTest2<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test2<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}<br>
+<br>
+BasicTest4<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test4<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SEND_FAILURE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${401}<br>
+<br>
+BasicTest5<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test5<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Secure-Response=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+BasicTest6<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test6<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Auth1-Secure-Response=SEND_FAILURE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+BasicTest8<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test8<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+***<br>
+<br>
+BasicTest3<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test3<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SEND_CONTINUE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${100}<br>
+<br>
+BasicTest7<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test7<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Auth1-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Auth1-Secure-Response=SEND_CONTINUE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${100}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimesessionmoduleonlyconfigjson&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only-config.json&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only-config.json&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only-config.json&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,11&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+{<br>
+&nbsp;&nbsp;&amp;quot;serverAuthContext&amp;quot;:&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;sessionModule&amp;quot;:&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;className&amp;quot;:&nbsp;&amp;quot;org.forgerock.jaspi.test.server.modules.SessionModule&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;properties&amp;quot;:&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;keyAlias&amp;quot;:&nbsp;&amp;quot;openidm-localhost&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;authModules&amp;quot;:&nbsp;[]<br>
+&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobotteststestcasesruntimesessionmoduleonlytxt&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only.txt&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only.txt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,86&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+Description:<br>
+JASPI&nbsp;Runtime<br>
+<br>
+***&nbsp;Settings&nbsp;***<br>
+Resource&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;jaspi_keywords.txt<br>
+Test&nbsp;Timeout&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp${TIMEOUT}<br>
+Suite&nbsp;Setup&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deploy_startup_jaspi<br>
+Suite&nbsp;Teardown&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown_tomcat<br>
+<br>
+***&nbsp;Variables&nbsp;***<br>
+${JASPI_RUNTIME_CONFIGURATION_FILE}&nbsp;&nbsp;/Users/Phill/ForgeRockDev/tmp-old-repos/forgerock-commons-auth-filters-1.3.0/forgerock-commons-auth-filters-1.3.0/forgerock-authn-filter/forgerock-jaspi-robot-tests/testcases/runtime/session-module-only-config.json<br>
+<br>
+***&nbsp;Test&nbsp;Cases&nbsp;***<br>
+BasicTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Session-Secure-Response=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}<br>
+<br>
+BasicTest2<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test2<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${200}<br>
+<br>
+BasicTest4<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test4<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SEND_FAILURE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${401}<br>
+<br>
+BasicTest5<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test5<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Secure-Response=SEND_SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+BasicTest6<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test6<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Session-Secure-Response=SEND_FAILURE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+BasicTest8<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test8<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SUCCESS<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${500}<br>
+<br>
+***<br>
+<br>
+BasicTest3<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test3<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SEND_CONTINUE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${100}<br>
+<br>
+BasicTest7<br>
+&nbsp;&nbsp;&nbsp;&nbsp;[Documentation]&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPerform&nbsp;Basic&nbsp;Test7<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${headers}&nbsp;=&nbsp;&nbsp;&nbsp;Create&nbsp;Dictionary&nbsp;&nbsp;X-Jaspi-Session-Validate-Request=SUCCESS&nbsp;&nbsp;X-Jaspi-Session-Secure-Response=SEND_CONTINUE<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;configure_jaspi&nbsp;&nbsp;${JASPI_RUNTIME_CONFIGURATION_FILE}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;${result}&nbsp;=&nbsp;&nbsp;get&nbsp;&nbsp;http://localhost:8080/jaspi/endpoint&nbsp;&nbsp;${headers}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Should&nbsp;Be&nbsp;Equal&nbsp;&nbsp;${result.status_code}&nbsp;&nbsp;${100}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspirobottestsvariablespy&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/variables.py&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/variables.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-robot-tests/variables.py&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,22&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+###########################<br>
+#&nbsp;MANDATORY&nbsp;CUSTOMISATION&nbsp;#<br>
+###########################<br>
+<br>
+#&nbsp;location&nbsp;of&nbsp;JASPI&nbsp;runtime&nbsp;jar<br>
+JASPI_TEST_SERVER_WAR_PATH&nbsp;=&nbsp;'/Users/Phill/ForgeRockDev/tmp-old-repos/forgerock-commons-auth-filters-1.3.0/forgerock-commons-auth-filters-1.3.0/forgerock-authn-filter/forgerock-jaspi-test-server/target/jaspi.war'<br>
+<br>
+#&nbsp;location&nbsp;of&nbsp;apache&nbsp;tomcat&nbsp;directory<br>
+TOMCAT_ZIP_PATH&nbsp;=&nbsp;'/Users/Phill/ForgeRockDev/tmp-old-repos/forgerock-commons-auth-filters-1.3.0/forgerock-commons-auth-filters-1.3.0/forgerock-authn-filter/forgerock-jaspi-robot-tests/resources/apache-tomcat-6.0.37.zip'<br>
+<br>
+#&nbsp;location&nbsp;of&nbsp;the<br>
+DEPLOY_PATH&nbsp;=&nbsp;'/Users/Phill/ForgeRockDev/tmp-old-repos/forgerock-commons-auth-filters-1.3.0/forgerock-commons-auth-filters-1.3.0/forgerock-authn-filter/forgerock-jaspi-robot-tests/deploy'<br>
+<br>
+##############################<br>
+#&nbsp;OPTIONAL&nbsp;CUSTOMISATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<br>
+#&nbsp;DEFAULT&nbsp;VALUES&nbsp;CAN&nbsp;BE&nbsp;USED&nbsp;#<br>
+##############################<br>
+<br>
+#&nbsp;location&nbsp;of&nbsp;empty&nbsp;exploded&nbsp;war&nbsp;directory<br>
+#EXPLODED_WAR_PATH&nbsp;=&nbsp;'/Users/Phill/ForgeRockDev/commons/forgerock-auth-filters-robot/forgerock-auth-filters-robot/templates/exploded-war'<br>
+<br>
+DEBUG&nbsp;=&nbsp;'true'<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimepomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,53&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.3.0-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;Runtime&amp;lt;/name&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.felix&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;maven-bundle-plugin&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;extensions&amp;gt;true&amp;lt;/extensions&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;instructions&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;DynamicImport-Package&amp;gt;*&amp;lt;/DynamicImport-Package&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/instructions&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/build&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-auth-filter-common&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.glassfish&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;javax.security.auth.message&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiJaspiRuntimeFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/JaspiRuntimeFilter.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/JaspiRuntimeFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/JaspiRuntimeFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,159&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.inject.DefaultRuntimeInjector;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.inject.RuntimeInjector;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfigurationImpl;<br>
+<br>
+import&nbsp;javax.servlet.Filter;<br>
+import&nbsp;javax.servlet.FilterChain;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;javax.servlet.ServletRequest;<br>
+import&nbsp;javax.servlet.ServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;Servlet&nbsp;Filter&nbsp;class&nbsp;provides&nbsp;a&nbsp;method&nbsp;of&nbsp;integrating&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;into&nbsp;a&nbsp;Servlet&nbsp;Container,&nbsp;such&nbsp;that<br>
+&nbsp;*&nbsp;requests&nbsp;made&nbsp;to&nbsp;the&nbsp;url&nbsp;this&nbsp;filter&nbsp;is&nbsp;registered&nbsp;at&nbsp;will&nbsp;cause&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;to&nbsp;validate&nbsp;and&nbsp;secure&nbsp;the<br>
+&nbsp;*&nbsp;request&nbsp;and&nbsp;response&nbsp;using&nbsp;it&nbsp;configured&nbsp;ServerAuthModules.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;To&nbsp;configure&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;the&nbsp;Servlet&nbsp;Filter&nbsp;registration&nbsp;must&nbsp;contain&nbsp;the&nbsp;configuration&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;LoggingConfigurator.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiRuntimeFilter&nbsp;implements&nbsp;Filter&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_INJECTOR_CLASS&nbsp;=&nbsp;&amp;quot;runtime-injector-class&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_INJECTOR_METHOD&nbsp;=&nbsp;&amp;quot;runtime-injector-method&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_INJECTOR_METHOD_DEFAULT&nbsp;=&nbsp;&amp;quot;getRuntimeInjector&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfig&nbsp;filterConfig;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiRuntime&nbsp;jaspiRuntime;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiRuntimeFilter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiRuntimeFilter()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(FilterConfigurationImpl.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiRuntimeFilter&nbsp;for&nbsp;use&nbsp;in&nbsp;tests.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Allows&nbsp;tests&nbsp;to&nbsp;pass&nbsp;in&nbsp;a&nbsp;mock&nbsp;of&nbsp;the&nbsp;FilterConfiguration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterConfiguration&nbsp;A&nbsp;mock&nbsp;of&nbsp;the&nbsp;FilterConfiguration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;JaspiRuntimeFilter(final&nbsp;FilterConfiguration&nbsp;filterConfiguration)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.filterConfiguration&nbsp;=&nbsp;filterConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Initialises&nbsp;the&nbsp;filter&nbsp;with&nbsp;the&nbsp;provided&nbsp;filter&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterConfig&nbsp;The&nbsp;filter&nbsp;config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;init(final&nbsp;FilterConfig&nbsp;filterConfig)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.filterConfig&nbsp;=&nbsp;filterConfig;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lazy&nbsp;initialises&nbsp;the&nbsp;Jaspi&nbsp;runtime,&nbsp;using&nbsp;the&nbsp;config&nbsp;classes&nbsp;provided&nbsp;in&nbsp;the&nbsp;init-param&nbsp;filter&nbsp;config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;Jaspi&nbsp;Runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;configuring&nbsp;the&nbsp;Jaspi&nbsp;Runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiRuntime&nbsp;getJaspiRuntime()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(jaspiRuntime&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Initialising&nbsp;the&nbsp;JaspiRuntime&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeInjector&nbsp;runtimeInjector&nbsp;=&nbsp;getRuntimeInjector(filterConfig);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime&nbsp;=&nbsp;runtimeInjector.getInstance(JaspiRuntime.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;jaspiRuntime;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;On&nbsp;receipt&nbsp;of&nbsp;a&nbsp;request&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;is&nbsp;invoked&nbsp;to&nbsp;validate&nbsp;the&nbsp;request&nbsp;and&nbsp;secure&nbsp;the&nbsp;response,&nbsp;(providing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;validation&nbsp;was&nbsp;successful).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;servletRequest&nbsp;The&nbsp;ServletRequest.&nbsp;MUST&nbsp;be&nbsp;of&nbsp;type&nbsp;HttpServletRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;servletResponse&nbsp;The&nbsp;ServletResponse.&nbsp;MUST&nbsp;be&nbsp;of&nbsp;type&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;chain&nbsp;The&nbsp;filter&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IOException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;exception&nbsp;thrown&nbsp;from&nbsp;the&nbsp;Jaspi&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;exception&nbsp;thrown&nbsp;from&nbsp;the&nbsp;Jaspi&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;doFilter(final&nbsp;ServletRequest&nbsp;servletRequest,&nbsp;final&nbsp;ServletResponse&nbsp;servletResponse,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FilterChain&nbsp;chain)&nbsp;throws&nbsp;IOException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((!HttpServletRequest.class.isAssignableFrom(servletRequest.getClass())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;!HttpServletResponse.class.isAssignableFrom(servletResponse.getClass())))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Unsupported&nbsp;protocol&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException(&amp;quot;Unsupported&nbsp;protocol&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;servletRequest;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;(HttpServletResponse)&nbsp;servletResponse;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getJaspiRuntime().processMessage(request,&nbsp;response,&nbsp;chain);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;configured&nbsp;{@link&nbsp;RuntimeInjector},&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;init&nbsp;params.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;RuntimeInjector&nbsp;is&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config,&nbsp;then&nbsp;the&nbsp;{@link&nbsp;DefaultRuntimeInjector}&nbsp;will&nbsp;be<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;RuntimeInjector.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RuntimeInjector&nbsp;getRuntimeInjector(final&nbsp;FilterConfig&nbsp;config)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeInjector&nbsp;runtimeInjector&nbsp;=&nbsp;filterConfiguration.get(config,&nbsp;INIT_PARAM_INJECTOR_CLASS,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_PARAM_INJECTOR_METHOD,&nbsp;INIT_PARAM_INJECTOR_METHOD_DEFAULT);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(runtimeInjector&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Filter&nbsp;init&nbsp;param,&nbsp;&amp;quot;&nbsp;+&nbsp;INIT_PARAM_INJECTOR_CLASS&nbsp;+&nbsp;&amp;quot;,&nbsp;not&nbsp;set.&nbsp;Falling&nbsp;back&nbsp;to&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;DefaultRuntimeInjector.class.getSimpleName()&nbsp;+&nbsp;&amp;quot;.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtimeInjector&nbsp;=&nbsp;DefaultRuntimeInjector.getRuntimeInjector(config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;runtimeInjector;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Nullifies&nbsp;any&nbsp;state&nbsp;in&nbsp;the&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;destroy()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextDefaultServerContextFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/DefaultServerContextFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/DefaultServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/DefaultServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,111&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.ServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.SessionServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfigurationImpl;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Concrete&nbsp;implementation&nbsp;of&nbsp;a&nbsp;factory&nbsp;class&nbsp;for&nbsp;getting&nbsp;the&nbsp;ServerAuthContext.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;DefaultServerContextFactory&nbsp;extends&nbsp;SessionServerContextFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;DefaultServerContextFactory.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;DefaultServerContextFactory(final&nbsp;FilterConfig&nbsp;config)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(config,&nbsp;FilterConfigurationImpl.INSTANCE,&nbsp;ServerAuthModuleInstanceCreatorImpl.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instances&nbsp;of&nbsp;the&nbsp;DefaultServerContextFactory,&nbsp;for&nbsp;test&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterConfiguration&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfiguration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;moduleInstanceCreator&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthModuleInstanceCreator.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;DefaultServerContextFactory(final&nbsp;FilterConfig&nbsp;config,&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(config,&nbsp;filterConfiguration,&nbsp;moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;DefaultServerContextFactory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;does&nbsp;and&nbsp;should&nbsp;return&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;a&nbsp;ServerContextFactory,&nbsp;as&nbsp;it&nbsp;is&nbsp;only&nbsp;ever&nbsp;called&nbsp;once&nbsp;per<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;configured&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;ServerContextFactory&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;ServerContextFactory&nbsp;getServerContextFactory(final&nbsp;FilterConfig&nbsp;config)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;DefaultServerContextFactory(config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerAuthContext&nbsp;getServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CallbackHandler&nbsp;handler,&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler,&nbsp;final&nbsp;JsonValue&nbsp;configuration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModule&nbsp;sessionAuthModule)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(configuration.isDefined(ModuleConfigurationFactory.AUTH_MODULES_KEY))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!configuration.get(ModuleConfigurationFactory.AUTH_MODULES_KEY).isList())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Auth&nbsp;Modules&nbsp;must&nbsp;be&nbsp;defined&nbsp;as&nbsp;a&nbsp;List.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Auth&nbsp;Modules&nbsp;must&nbsp;be&nbsp;defined&nbsp;as&nbsp;a&nbsp;List.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(JsonValue&nbsp;authModule&nbsp;:&nbsp;configuration.get(ModuleConfigurationFactory.AUTH_MODULES_KEY))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;authModule.get(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY).required()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.asString();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;moduleProperties&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModule.get(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY).asMap();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;serverAuthModule&nbsp;=&nbsp;getModuleInstanceCreator().construct(className,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleProperties,&nbsp;createRequestMessagePolicy(),&nbsp;handler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(serverAuthModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FallbackServerAuthContext(messageInfoUtils,&nbsp;contextHandler,&nbsp;sessionAuthModule,&nbsp;authModules);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextFallbackServerAuthContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,172&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.JaspiServerAuthContext;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Encapsulates&nbsp;ServerAuthModules&nbsp;that&nbsp;are&nbsp;used&nbsp;to&nbsp;validate&nbsp;service&nbsp;requests&nbsp;received&nbsp;from&nbsp;clients,&nbsp;and&nbsp;to&nbsp;secure&nbsp;any<br>
+&nbsp;*&nbsp;response&nbsp;returned&nbsp;for&nbsp;those&nbsp;requests.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;This&nbsp;FallbackServerAuthContext&nbsp;can&nbsp;be&nbsp;configured&nbsp;to&nbsp;use&nbsp;a&nbsp;single&nbsp;Session&nbsp;ServerAuthModule,&nbsp;to&nbsp;provide&nbsp;session<br>
+&nbsp;*&nbsp;capabilities&nbsp;(ie.&nbsp;on&nbsp;secureResponse&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;which&nbsp;is&nbsp;validated&nbsp;on&nbsp;subsequent&nbsp;request&nbsp;to&nbsp;skip&nbsp;re-authenticating<br>
+&nbsp;*&nbsp;for&nbsp;each&nbsp;request),&nbsp;and&nbsp;a&nbsp;list&nbsp;of&nbsp;ServerAuthModule&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;in&nbsp;order&nbsp;until&nbsp;one&nbsp;returns&nbsp;a&nbsp;non-failure<br>
+&nbsp;*&nbsp;AuthStatus,&nbsp;or&nbsp;the&nbsp;list&nbsp;is&nbsp;exhausted.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;FallbackServerAuthContext&nbsp;extends&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;final&nbsp;String&nbsp;AUTHENTICATING_AUTH_MODULE_KEY&nbsp;=&nbsp;&amp;quot;authenticatingAuthModule&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;FallbackServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;contextHandler&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ContextHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;sessionAuthModule&nbsp;The&nbsp;configured&nbsp;Session&nbsp;AuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;The&nbsp;list&nbsp;of&nbsp;configure&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;do&nbsp;not&nbsp;conform&nbsp;to&nbsp;the&nbsp;Jaspi&nbsp;HttpServlet&nbsp;Profile.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;FallbackServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModule&nbsp;sessionAuthModule,&nbsp;final&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(messageInfoUtils,&nbsp;contextHandler,&nbsp;sessionAuthModule,&nbsp;authModules);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;logic&nbsp;used&nbsp;to&nbsp;determine&nbsp;which&nbsp;of&nbsp;the&nbsp;list&nbsp;of&nbsp;ServerAuthModules&nbsp;are&nbsp;called&nbsp;is&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ol&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;Modules&nbsp;are&nbsp;called&nbsp;in&nbsp;insertion&nbsp;order&nbsp;in&nbsp;the&nbsp;list.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;a&nbsp;module&nbsp;returns&nbsp;AuthStatus.SUCCESS&nbsp;the&nbsp;context&nbsp;will&nbsp;return&nbsp;the&nbsp;AuthStatus&nbsp;without&nbsp;calling<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any&nbsp;subsequent&nbsp;modules.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;a&nbsp;module&nbsp;returns&nbsp;AuthStatus.SEND_SUCCESS&nbsp;the&nbsp;module&nbsp;has&nbsp;completely/partially/not&nbsp;authenticated&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;and&nbsp;the&nbsp;context&nbsp;will&nbsp;return&nbsp;the&nbsp;AuthStatus&nbsp;without&nbsp;calling&nbsp;any&nbsp;subsequent&nbsp;modules.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;a&nbsp;module&nbsp;returns&nbsp;AuthStatus.SEND_CONTINUE&nbsp;the&nbsp;context&nbsp;will&nbsp;return&nbsp;the&nbsp;AuthStatus&nbsp;without&nbsp;calling<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any&nbsp;subsequent&nbsp;modules.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;a&nbsp;module&nbsp;returns&nbsp;AuthStatus.SEND_FAILURE&nbsp;the&nbsp;module&nbsp;has&nbsp;failed&nbsp;to&nbsp;authenticate&nbsp;the&nbsp;client&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;context&nbsp;will&nbsp;call&nbsp;the&nbsp;next&nbsp;subsequent&nbsp;module.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;modules&nbsp;in&nbsp;the&nbsp;configured&nbsp;list&nbsp;the&nbsp;last&nbsp;AuthStatus&nbsp;is&nbsp;returned&nbsp;and&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stops..&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ol&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AuthStatus&nbsp;validateRequest(final&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules,&nbsp;final&nbsp;MessageInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;clientSubject,&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authenticatingAuthStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authenticatingAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ServerAuthModule&nbsp;authModule&nbsp;:&nbsp;authModules)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus&nbsp;=&nbsp;authModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Record&nbsp;the&nbsp;AuthModules&nbsp;AuthStatus&nbsp;to&nbsp;decided&nbsp;later&nbsp;whether&nbsp;to&nbsp;call&nbsp;secureResponse&nbsp;on&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;AuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(AuthStatus.SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(authModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticatingAuthStatus&nbsp;=&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticatingAuthModule&nbsp;=&nbsp;authModule;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;may&nbsp;have&nbsp;completely/partially/not&nbsp;authenticated&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(authModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client&nbsp;and&nbsp;has&nbsp;a&nbsp;response&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;failed&nbsp;to&nbsp;authenticate&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;--&nbsp;In&nbsp;our&nbsp;implementation&nbsp;we&nbsp;will&nbsp;let&nbsp;subsequent&nbsp;modules&nbsp;try&nbsp;before&nbsp;sending&nbsp;the&nbsp;failure.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(authModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;failed&nbsp;to&nbsp;authenticated&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client,&nbsp;passing&nbsp;to&nbsp;Auth&nbsp;Modules&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_CONTINUE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;not&nbsp;completed&nbsp;authenticating&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(authModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;not&nbsp;completed&nbsp;authenticating&nbsp;the&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authenticatingAuthStatus&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;put&nbsp;authStatus&nbsp;and&nbsp;authenticatingAuthModule&nbsp;in&nbsp;MessageInfo&nbsp;so&nbsp;can&nbsp;accessed&nbsp;by&nbsp;secureResponse&nbsp;in&nbsp;a<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;stateless&nbsp;way<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Adding&nbsp;authenticating&nbsp;auth&nbsp;module&nbsp;to&nbsp;private&nbsp;context&nbsp;map,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authenticatingAuthModule.getClass().getSimpleName());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;authContextMap&nbsp;=&nbsp;getMessageInfoUtils().getMap(messageInfo,&nbsp;PRIVATE_CONTEXT_MAP_KEY);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authContextMap.put(AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authenticatingAuthModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Only&nbsp;the&nbsp;ServerAuthModule&nbsp;which&nbsp;returned&nbsp;AuthStatus.SUCCESS&nbsp;for&nbsp;its&nbsp;#validateRequest&nbsp;method&nbsp;will&nbsp;have&nbsp;its<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;secureResponse&nbsp;method&nbsp;call&nbsp;and&nbsp;if&nbsp;no&nbsp;ServerAuthModule&nbsp;successfully&nbsp;validated&nbsp;the&nbsp;request&nbsp;then&nbsp;this&nbsp;method<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;will&nbsp;return&nbsp;&amp;lt;code&amp;gt;null&amp;lt;/code&amp;gt;.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AuthStatus&nbsp;secureResponse(final&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules,&nbsp;final&nbsp;MessageInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;authContextMap&nbsp;=&nbsp;getMessageInfoUtils().getMap(messageInfo,&nbsp;PRIVATE_CONTEXT_MAP_KEY);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModule&nbsp;authenticatingAuthModule&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ServerAuthModule)&nbsp;authContextMap.remove(AUTHENTICATING_AUTH_MODULE_KEY);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;authenticationAuthModule&nbsp;has&nbsp;been&nbsp;set,&nbsp;ie&nbsp;a&nbsp;normal&nbsp;ServerAuthModule&nbsp;successfully&nbsp;validated&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authenticatingAuthModule&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Using&nbsp;authenticating&nbsp;auth&nbsp;module&nbsp;from&nbsp;private&nbsp;context&nbsp;map,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authenticatingAuthModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;,&nbsp;to&nbsp;secure&nbsp;the&nbsp;response&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authenticatingAuthModule.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreator.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,47&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Responsible&nbsp;for&nbsp;constructing&nbsp;and&nbsp;initialising&nbsp;ServerAuthModules.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;ServerAuthModuleInstanceCreator&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;ServerAuthModule&nbsp;instance,&nbsp;using&nbsp;the&nbsp;given&nbsp;class&nbsp;name.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;After&nbsp;constructing&nbsp;the&nbsp;ServerAuthModule,&nbsp;its&nbsp;ServerAuthModule#initialize&nbsp;method&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;properties&nbsp;map,&nbsp;message&nbsp;policy&nbsp;and&nbsp;callback&nbsp;handler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;className&nbsp;The&nbsp;class&nbsp;name&nbsp;of&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;moduleProperties&nbsp;A&nbsp;Map&nbsp;of&nbsp;properties&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messagePolicy&nbsp;The&nbsp;message&nbsp;policy&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;The&nbsp;callback&nbsp;handler&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;javax.security.auth.message.AuthException&nbsp;If&nbsp;the&nbsp;AuthConfigProvider&nbsp;class&nbsp;name&nbsp;is&nbsp;null&nbsp;or&nbsp;empty.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerAuthModule&nbsp;construct(final&nbsp;String&nbsp;className,&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;moduleProperties,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;MessagePolicy&nbsp;messagePolicy,&nbsp;final&nbsp;CallbackHandler&nbsp;handler)&nbsp;throws&nbsp;AuthException;<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorImpljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImpl.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,80&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Responsible&nbsp;for&nbsp;constructing&nbsp;and&nbsp;initialising&nbsp;ServerAuthModules.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;enum&nbsp;ServerAuthModuleInstanceCreatorImpl&nbsp;implements&nbsp;ServerAuthModuleInstanceCreator&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;Singleton&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthModuleInstanceCreatorImpl.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;ServerAuthModule&nbsp;instance,&nbsp;using&nbsp;the&nbsp;given&nbsp;class&nbsp;name.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;After&nbsp;constructing&nbsp;the&nbsp;ServerAuthModule,&nbsp;its&nbsp;ServerAuthModule#initialize&nbsp;method&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;properties&nbsp;map,&nbsp;message&nbsp;policy&nbsp;and&nbsp;callback&nbsp;handler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;className&nbsp;The&nbsp;class&nbsp;name&nbsp;of&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;moduleProperties&nbsp;A&nbsp;Map&nbsp;of&nbsp;properties&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messagePolicy&nbsp;The&nbsp;message&nbsp;policy&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;The&nbsp;callback&nbsp;handler&nbsp;used&nbsp;to&nbsp;initialise&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;the&nbsp;AuthConfigProvider&nbsp;class&nbsp;name&nbsp;is&nbsp;null&nbsp;or&nbsp;empty.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerAuthModule&nbsp;construct(final&nbsp;String&nbsp;className,&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;moduleProperties,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;MessagePolicy&nbsp;messagePolicy,&nbsp;final&nbsp;CallbackHandler&nbsp;handler)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(className&nbsp;!=&nbsp;null&nbsp;&amp;amp;&amp;amp;&nbsp;!className.isEmpty())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;module&nbsp;=&nbsp;(ServerAuthModule)&nbsp;Class.forName(className).newInstance();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;module.initialize(messagePolicy,&nbsp;null,&nbsp;handler,&nbsp;moduleProperties);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Created&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;module;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ClassNotFoundException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IllegalAccessException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(InstantiationException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Failed&nbsp;to&nbsp;instantiate&nbsp;module,&nbsp;className:&nbsp;&amp;quot;&nbsp;+&nbsp;className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;FClass&nbsp;name&nbsp;cannot&nbsp;be&nbsp;null.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Class&nbsp;name&nbsp;cannot&nbsp;be&nbsp;null.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;concrete&nbsp;implementations&nbsp;for&nbsp;creating&nbsp;and&nbsp;retrieving&nbsp;an&nbsp;instance&nbsp;of&nbsp;a<br>
+&nbsp;*&nbsp;FallbackServerAuthContext&nbsp;to&nbsp;co-ordinate&nbsp;calls&nbsp;to&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;instances.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionsJaspiAuthExceptionjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,71&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.exceptions;<br>
+<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;sub-type&nbsp;of&nbsp;an&nbsp;AuthException&nbsp;which&nbsp;can&nbsp;accept&nbsp;a&nbsp;cause&nbsp;for&nbsp;this&nbsp;exception.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiAuthException&nbsp;extends&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;-1L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Throwable&nbsp;cause;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.cause&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;cause&nbsp;and&nbsp;a&nbsp;detail&nbsp;message&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(cause==null&nbsp;?&nbsp;null&nbsp;:&nbsp;cause.getMessage()).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(cause.getMessage());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.cause&nbsp;=&nbsp;cause;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message&nbsp;and&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.cause&nbsp;=&nbsp;cause;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Throwable&nbsp;getCause()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cause;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionspackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;extensions&nbsp;to&nbsp;the&nbsp;AuthException&nbsp;from&nbsp;the&nbsp;Jaspi&nbsp;specification.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.exceptions;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingJaspiAuditLoggerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiAuditLogger.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiAuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiAuditLogger.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,29&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Wrapper&nbsp;interface&nbsp;which&nbsp;contains&nbsp;the&nbsp;type&nbsp;for&nbsp;all&nbsp;AuditLoggers&nbsp;for&nbsp;the&nbsp;Jaspi&nbsp;Runtime.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;JaspiAuditLogger&nbsp;extends&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;{<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingJaspiLoggingConfiguratorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiLoggingConfigurator.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiLoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/JaspiLoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,29&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.LoggingConfigurator;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Wrapper&nbsp;interface&nbsp;which&nbsp;contains&nbsp;the&nbsp;type&nbsp;for&nbsp;all&nbsp;LoggingConfigurators&nbsp;for&nbsp;the&nbsp;Jaspi&nbsp;Runtime.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;JaspiLoggingConfigurator&nbsp;extends&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;&nbsp;{<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingLogFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/LogFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/LogFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/LogFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,87&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.auth.common.NopAuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.NopDebugLogger;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Responsible&nbsp;for&nbsp;managing&nbsp;logging&nbsp;implementation,&nbsp;for&nbsp;both&nbsp;Debug&nbsp;and&nbsp;Audit&nbsp;logging.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;final&nbsp;class&nbsp;LogFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;DebugLogger&nbsp;debugLogger;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Private&nbsp;constructor&nbsp;to&nbsp;prevent&nbsp;instantiation.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;LogFactory()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;Debug&nbsp;Logger&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;debug&nbsp;The&nbsp;DebugLogger&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;setDebugLogger(final&nbsp;DebugLogger&nbsp;debug)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger&nbsp;=&nbsp;debug;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;Debug&nbsp;Logger&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;Debug&nbsp;Logger&nbsp;has&nbsp;been&nbsp;set&nbsp;then&nbsp;a&nbsp;Nop&nbsp;Debug&nbsp;Logger&nbsp;will&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;DebugLogger&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;DebugLogger&nbsp;getDebug()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(debugLogger&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;NopDebugLogger();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;debugLogger;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;Audit&nbsp;Logger&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;audit&nbsp;The&nbsp;AuditLogger&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;setAuditLogger(final&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;audit)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auditLogger&nbsp;=&nbsp;audit;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;Audit&nbsp;Logger&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;Audit&nbsp;Logger&nbsp;has&nbsp;been&nbsp;set&nbsp;then&nbsp;a&nbsp;Nop&nbsp;Audit&nbsp;Logger&nbsp;will&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;AuditLogger&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;getAuditLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(auditLogger&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;NopAuditLogger&amp;lt;MessageInfo&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;auditLogger;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingMessageInfoAuditRecordjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/MessageInfoAuditRecord.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/MessageInfoAuditRecord.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/MessageInfoAuditRecord.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,40&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.AuthResult;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Audit&nbsp;Record&nbsp;which&nbsp;contains&nbsp;a&nbsp;MessageInfo&nbsp;instance.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;MessageInfoAuditRecord&nbsp;extends&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;AuditRecord&nbsp;with&nbsp;the&nbsp;given&nbsp;AuthResult&nbsp;and&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authResult&nbsp;The&nbsp;AuthResult&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;of&nbsp;the&nbsp;auth&nbsp;operation.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;MessageInfoAuditRecord(final&nbsp;AuthResult&nbsp;authResult,&nbsp;final&nbsp;MessageInfo&nbsp;messageInfo)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(authResult,&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiloggingpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/logging/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;classes&nbsp;that&nbsp;implements&nbsp;the&nbsp;logging&nbsp;framework&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspipackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;contains&nbsp;the&nbsp;classes&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeHttpServletCallbackHandlerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandler.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,142&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.Callback;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.callback.UnsupportedCallbackException;<br>
+import&nbsp;javax.security.auth.message.callback.CallerPrincipalCallback;<br>
+import&nbsp;javax.security.auth.message.callback.CertStoreCallback;<br>
+import&nbsp;javax.security.auth.message.callback.GroupPrincipalCallback;<br>
+import&nbsp;javax.security.auth.message.callback.PasswordValidationCallback;<br>
+import&nbsp;javax.security.auth.message.callback.PrivateKeyCallback;<br>
+import&nbsp;javax.security.auth.message.callback.SecretKeyCallback;<br>
+import&nbsp;javax.security.auth.message.callback.TrustStoreCallback;<br>
+import&nbsp;java.security.Principal;<br>
+import&nbsp;java.util.Set;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Callback&nbsp;handler&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.0.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;HttpServletCallbackHandler&nbsp;implements&nbsp;CallbackHandler&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Called&nbsp;by&nbsp;Authentication&nbsp;modules&nbsp;to&nbsp;request&nbsp;more&nbsp;information&nbsp;about&nbsp;the&nbsp;request&nbsp;and&nbsp;response&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Callbacks&nbsp;currently&nbsp;supported&nbsp;are&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;CallerPrincipalCallback&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;GroupPrincipalCallback&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;handle&nbsp;a&nbsp;CallerPrincipalCallback&nbsp;by&nbsp;creating&nbsp;a&nbsp;Principal&nbsp;from&nbsp;the&nbsp;name&nbsp;stored&nbsp;in&nbsp;the&nbsp;Callback<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;Subject&nbsp;from&nbsp;the&nbsp;Callback.&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;not&nbsp;populated&nbsp;then&nbsp;the&nbsp;Principal&nbsp;stored&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Callback&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;Subject&nbsp;instead.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;handle&nbsp;a&nbsp;GroupPrincipalCallback&nbsp;by&nbsp;create&nbsp;a&nbsp;Principal&nbsp;for&nbsp;each&nbsp;group&nbsp;stored&nbsp;in&nbsp;the&nbsp;Callback<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;adding&nbsp;them&nbsp;to&nbsp;the&nbsp;Subject&nbsp;from&nbsp;the&nbsp;Callback.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;callbacks&nbsp;An&nbsp;array&nbsp;of&nbsp;Callback&nbsp;objects&nbsp;provided&nbsp;by&nbsp;the&nbsp;Authentication&nbsp;modules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;UnsupportedCallbackException&nbsp;If&nbsp;a&nbsp;callback&nbsp;is&nbsp;passed&nbsp;which&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;this&nbsp;CallbackHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handle(final&nbsp;Callback[]&nbsp;callbacks)&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Callback&nbsp;callback&nbsp;:&nbsp;callbacks)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CallerPrincipalCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallerPrincipalCallback&nbsp;callerPrincipalCallback&nbsp;=&nbsp;(CallerPrincipalCallback)&nbsp;callback;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;callerPrincipalCallback.getSubject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;name&nbsp;=&nbsp;callerPrincipalCallback.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Principal&nbsp;principal&nbsp;=&nbsp;callerPrincipalCallback.getPrincipal();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(name&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Adding&nbsp;principal,&nbsp;&amp;quot;&nbsp;+&nbsp;name&nbsp;+&nbsp;&amp;quot;,&nbsp;to&nbsp;Subject&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject.getPrincipals().add(new&nbsp;Principal()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;name;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(principal&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Adding&nbsp;principal,&nbsp;&amp;quot;&nbsp;+&nbsp;principal.getName()&nbsp;+&nbsp;&amp;quot;,&nbsp;to&nbsp;Subject&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject.getPrincipals().add(principal);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Both&nbsp;name&nbsp;and&nbsp;principal&nbsp;are&nbsp;null&nbsp;so&nbsp;not&nbsp;adding&nbsp;either.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Not&nbsp;adding&nbsp;principal&nbsp;as&nbsp;no&nbsp;name&nbsp;or&nbsp;principal&nbsp;set&nbsp;on&nbsp;callback&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(GroupPrincipalCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GroupPrincipalCallback&nbsp;groupPrincipalCallback&nbsp;=&nbsp;(GroupPrincipalCallback)&nbsp;callback;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;groupPrincipalCallback.getSubject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;groups&nbsp;=&nbsp;groupPrincipalCallback.getGroups();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(groups&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&amp;lt;Principal&amp;gt;&nbsp;principals&nbsp;=&nbsp;subject.getPrincipals();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;String&nbsp;group&nbsp;:&nbsp;groups)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.trace(&amp;quot;Adding&nbsp;principal,&nbsp;&amp;quot;&nbsp;+&nbsp;group&nbsp;+&nbsp;&amp;quot;,&nbsp;to&nbsp;Subject&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;principals.add(new&nbsp;Principal()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;group;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(PasswordValidationCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;JSR-196&nbsp;Spec&nbsp;states&nbsp;this&nbsp;MUST&nbsp;be&nbsp;implemented&nbsp;but&nbsp;as&nbsp;this&nbsp;is&nbsp;not&nbsp;actually&nbsp;a&nbsp;&amp;quot;real&amp;quot;&nbsp;container<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;we&nbsp;don't&nbsp;need&nbsp;to&nbsp;do&nbsp;this&nbsp;here.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;PasswordValidationCallback&nbsp;not&nbsp;supported&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(CertStoreCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//SHOULD&nbsp;implement<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;CertStoreCallback&nbsp;not&nbsp;supported&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(PrivateKeyCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//SHOULD&nbsp;implement<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;PrivateKeyCallback&nbsp;not&nbsp;supported&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SecretKeyCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//SHOULD&nbsp;implement<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;SecretKeyCallback&nbsp;not&nbsp;supported&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(TrustStoreCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//SHOULD&nbsp;implement<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;TrustStoreCallback&nbsp;not&nbsp;supported&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(HttpCallback.class.isAssignableFrom(callback.getClass()))&nbsp;{<br>
+//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//SHOULD&nbsp;implement<br>
+//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedCallbackException(callback);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeHttpServletMessageInfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletMessageInfo.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletMessageInfo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/HttpServletMessageInfo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,114&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.response.JaspiHttpServletResponseWrapper;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletRequestWrapper;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletResponseWrapper;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;an&nbsp;implementation&nbsp;of&nbsp;a&nbsp;MessageInfo&nbsp;for&nbsp;the&nbsp;HttpServlet&nbsp;profile.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;HttpServletMessageInfo&nbsp;implements&nbsp;MessageInfo&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;HttpServletRequestWrapper&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;HttpServletResponseWrapper&nbsp;response;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;properties;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;HttpServletMessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;HttpServletRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;HtwtpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpServletMessageInfo(final&nbsp;HttpServletRequest&nbsp;request,&nbsp;final&nbsp;HttpServletResponse&nbsp;response)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(request,&nbsp;response,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;HttpServletMessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;HttpServletRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;properties&nbsp;A&nbsp;Map&nbsp;of&nbsp;properties.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpServletMessageInfo(final&nbsp;HttpServletRequest&nbsp;request,&nbsp;final&nbsp;HttpServletResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;properties)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setRequestMessage(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setResponseMessage(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.properties&nbsp;=&nbsp;properties;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;the&nbsp;request&nbsp;message&nbsp;object&nbsp;from&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;object&nbsp;representing&nbsp;the&nbsp;request&nbsp;message,&nbsp;or&nbsp;null&nbsp;if&nbsp;no&nbsp;request&nbsp;message&nbsp;is&nbsp;set&nbsp;within&nbsp;the&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpServletRequest&nbsp;getRequestMessage()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;request;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;the&nbsp;response&nbsp;message&nbsp;object&nbsp;from&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;object&nbsp;representing&nbsp;the&nbsp;response&nbsp;message,&nbsp;or&nbsp;null&nbsp;if&nbsp;no&nbsp;response&nbsp;message&nbsp;is&nbsp;set&nbsp;within&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpServletResponse&nbsp;getResponseMessage()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Set&nbsp;the&nbsp;request&nbsp;message&nbsp;object&nbsp;in&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;An&nbsp;object&nbsp;representing&nbsp;the&nbsp;request&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setRequestMessage(final&nbsp;Object&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.request&nbsp;=&nbsp;new&nbsp;HttpServletRequestWrapper((HttpServletRequest)&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Set&nbsp;the&nbsp;response&nbsp;message&nbsp;object&nbsp;in&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;An&nbsp;object&nbsp;representing&nbsp;the&nbsp;response&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setResponseMessage(final&nbsp;Object&nbsp;response)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.response&nbsp;=&nbsp;new&nbsp;JaspiHttpServletResponseWrapper((HttpServletResponse)&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;(a&nbsp;reference&nbsp;to)&nbsp;the&nbsp;Map&nbsp;object&nbsp;of&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;Map&nbsp;object&nbsp;of&nbsp;this&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;getMap()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;properties;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeJaspiRuntimejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/JaspiRuntime.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/JaspiRuntime.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/JaspiRuntime.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,164&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.servlet.FilterChain;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;javax.servlet.ServletRequest;<br>
+import&nbsp;javax.servlet.ServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;class&nbsp;is&nbsp;the&nbsp;entry&nbsp;point&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;single&nbsp;method&nbsp;#processMessage&nbsp;that&nbsp;takes&nbsp;a&nbsp;HttpServletRequest,&nbsp;HttpServletResponse&nbsp;and&nbsp;the&nbsp;FilterChain<br>
+&nbsp;*&nbsp;and&nbsp;will&nbsp;run&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;to&nbsp;determine&nbsp;whether&nbsp;the&nbsp;request&nbsp;is&nbsp;allowed&nbsp;to&nbsp;be&nbsp;passed&nbsp;down<br>
+&nbsp;*&nbsp;the&nbsp;filter&nbsp;chain.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;&amp;lt;strong&amp;gt;Note:&amp;lt;/strong&amp;gt;&nbsp;if&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;is&nbsp;not&nbsp;configured&nbsp;properly&nbsp;with&nbsp;a&nbsp;non-null&nbsp;ServerAuthContext<br>
+&nbsp;*&nbsp;each&nbsp;request&nbsp;will&nbsp;be&nbsp;passed&nbsp;straight&nbsp;to&nbsp;the&nbsp;filter&nbsp;chain&nbsp;with&nbsp;no&nbsp;further&nbsp;processing.&nbsp;So&nbsp;it&nbsp;is&nbsp;VERY&nbsp;important<br>
+&nbsp;*&nbsp;to&nbsp;ensure&nbsp;the&nbsp;runtime&nbsp;is&nbsp;configured&nbsp;correctly.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiRuntime&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;DEBUG&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Indicates&nbsp;that&nbsp;the&nbsp;request&nbsp;could&nbsp;not&nbsp;be&nbsp;authenticated&nbsp;either&nbsp;because&nbsp;no&nbsp;credentials&nbsp;were&nbsp;provided&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;credentials&nbsp;provided&nbsp;did&nbsp;not&nbsp;pass&nbsp;authentication.&nbsp;Equivalent&nbsp;to&nbsp;HTTP&nbsp;status:&nbsp;401&nbsp;Unauthorized.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;int&nbsp;UNAUTHORIZED_HTTP_ERROR_CODE&nbsp;=&nbsp;401;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;exception&nbsp;message&nbsp;for&nbsp;a&nbsp;401&nbsp;ResourceException.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;UNAUTHORIZED_ERROR_MESSAGE&nbsp;=&nbsp;&amp;quot;Access&nbsp;Denied&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;application/json&nbsp;HTTP&nbsp;Media&nbsp;Type.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;JSON_HTTP_MEDIA_TYPE&nbsp;=&nbsp;&amp;quot;application/json&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;Servlet&nbsp;Request&nbsp;attribute&nbsp;where&nbsp;the&nbsp;principal&nbsp;name&nbsp;of&nbsp;the&nbsp;user/client&nbsp;making&nbsp;the&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;will&nbsp;be&nbsp;set.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTRIBUTE_AUTH_PRINCIPAL&nbsp;=&nbsp;&amp;quot;org.forgerock.authentication.principal&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;Servlet&nbsp;Request&nbsp;attribute&nbsp;where&nbsp;any&nbsp;additional&nbsp;authentication&nbsp;context&nbsp;information<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;will&nbsp;be&nbsp;set.&nbsp;It&nbsp;MUST&nbsp;contain&nbsp;a&nbsp;{@code&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;}&nbsp;if&nbsp;present.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;ATTRIBUTE_AUTH_CONTEXT&nbsp;=&nbsp;&amp;quot;org.forgerock.authentication.context&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ServerAuthContext&nbsp;serverAuthContext;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;RuntimeResultHandler&nbsp;resultHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiRuntime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serverAuthContext&nbsp;The&nbsp;instance&nbsp;of&nbsp;a&nbsp;ServerAuthContext&nbsp;that&nbsp;the&nbsp;runtime&nbsp;has&nbsp;been&nbsp;configured&nbsp;to&nbsp;use<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;orchestrate&nbsp;calling&nbsp;the&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;resultHandler&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;RuntimeResultHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiRuntime(final&nbsp;ServerAuthContext&nbsp;serverAuthContext,&nbsp;final&nbsp;RuntimeResultHandler&nbsp;resultHandler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.serverAuthContext&nbsp;=&nbsp;serverAuthContext;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultHandler&nbsp;=&nbsp;resultHandler;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Processes&nbsp;the&nbsp;given&nbsp;request&nbsp;and&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Guaranteed&nbsp;to&nbsp;call&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;validateRequest&nbsp;method&nbsp;to&nbsp;determine&nbsp;whether&nbsp;the&nbsp;request&nbsp;is<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;allowed&nbsp;through&nbsp;and&nbsp;if&nbsp;validation&nbsp;was&nbsp;successful,&nbsp;to&nbsp;call&nbsp;secureResponse&nbsp;after&nbsp;the&nbsp;service&nbsp;call&nbsp;has&nbsp;completed.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Any&nbsp;authentication&nbsp;exceptions&nbsp;that&nbsp;occur&nbsp;during&nbsp;this&nbsp;process&nbsp;will&nbsp;be&nbsp;caught&nbsp;and&nbsp;converted&nbsp;into&nbsp;a&nbsp;Json&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;that&nbsp;matches&nbsp;a&nbsp;HTTP&nbsp;500&nbsp;status&nbsp;code.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;ServerAuthContext&nbsp;is&nbsp;configured&nbsp;for&nbsp;the&nbsp;HttpServlet&nbsp;layer&nbsp;and&nbsp;the&nbsp;requests&nbsp;application&nbsp;context,&nbsp;then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;request&nbsp;will&nbsp;be&nbsp;allowed&nbsp;through.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;HttpServletRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterChain&nbsp;The&nbsp;filter&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;java.io.IOException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;processing&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;javax.servlet.ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;processing&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;processMessage(final&nbsp;HttpServletRequest&nbsp;request,&nbsp;final&nbsp;HttpServletResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FilterChain&nbsp;filterChain)&nbsp;throws&nbsp;IOException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Must&nbsp;create&nbsp;new&nbsp;client&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Can&nbsp;be&nbsp;null&nbsp;if&nbsp;no&nbsp;details&nbsp;required&nbsp;for&nbsp;service&nbsp;subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Could&nbsp;be&nbsp;null&nbsp;if&nbsp;no&nbsp;modules&nbsp;found<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(serverAuthContext&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.error(&amp;quot;No&nbsp;ServerAuthContext&nbsp;configured!&nbsp;Jaspi&nbsp;Runtime&nbsp;not&nbsp;configured&nbsp;properly!&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.warn(&amp;quot;Proceeding&nbsp;with&nbsp;filter&nbsp;chain&nbsp;call.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterChain.doFilter(request,&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;is&nbsp;where&nbsp;the&nbsp;modules&nbsp;are&nbsp;called<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;requestAuthStatus&nbsp;=&nbsp;serverAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!resultHandler.handleValidateRequestResult(requestAuthStatus,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(HttpServletResponse)&nbsp;messageInfo.getResponseMessage()))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterChain.doFilter((ServletRequest)&nbsp;messageInfo.getRequestMessage(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ServletResponse)&nbsp;messageInfo.getResponseMessage());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;responseAuthStatus&nbsp;=&nbsp;serverAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleSecureResponseResult(responseAuthStatus,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(HttpServletResponse)&nbsp;messageInfo.getResponseMessage());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Give&nbsp;the&nbsp;AuthModule&nbsp;a&nbsp;chance&nbsp;to&nbsp;clear&nbsp;out&nbsp;any&nbsp;authentication&nbsp;data&nbsp;from&nbsp;the&nbsp;subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverAuthContext.cleanSubject(messageInfo,&nbsp;clientSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(AuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;httpResponse&nbsp;=&nbsp;(HttpServletResponse)&nbsp;messageInfo.getResponseMessage();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResourceException&nbsp;jre&nbsp;=&nbsp;ResourceException.getException(ResourceException.INTERNAL_ERROR,&nbsp;e.getMessage());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpResponse.setStatus(ResourceException.INTERNAL_ERROR);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpResponse.getWriter().write(jre.toJsonValue().toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpResponse.setContentType(JSON_HTTP_MEDIA_TYPE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;ioe)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException(ioe.getMessage(),&nbsp;ioe);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeRuntimeResultHandlerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/RuntimeResultHandler.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/RuntimeResultHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/RuntimeResultHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,107&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+<br>
+import&nbsp;static&nbsp;javax.security.auth.message.AuthStatus.SEND_CONTINUE;<br>
+import&nbsp;static&nbsp;javax.security.auth.message.AuthStatus.SEND_FAILURE;<br>
+import&nbsp;static&nbsp;javax.security.auth.message.AuthStatus.SEND_SUCCESS;<br>
+import&nbsp;static&nbsp;javax.security.auth.message.AuthStatus.SUCCESS;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Handler&nbsp;which&nbsp;handles&nbsp;the&nbsp;result&nbsp;of&nbsp;calls&nbsp;to&nbsp;a&nbsp;ServerAuthContexts&nbsp;validateRequest&nbsp;and&nbsp;secureResponse&nbsp;methods.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;RuntimeResultHandler&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;DEBUG&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Handles&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;call&nbsp;to&nbsp;the&nbsp;ServerAuthContext&nbsp;validateRequest&nbsp;method.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Only&nbsp;an&nbsp;AuthStatus&nbsp;of&nbsp;SUCCESS&nbsp;will&nbsp;return&nbsp;true&nbsp;and&nbsp;an&nbsp;AuthStatus&nbsp;of&nbsp;SEND_FAILURE&nbsp;will&nbsp;set&nbsp;the&nbsp;response&nbsp;status&nbsp;to<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;401.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Also&nbsp;an&nbsp;AuthStatus&nbsp;of&nbsp;SEND_CONTINUE&nbsp;will&nbsp;set&nbsp;the&nbsp;response&nbsp;status&nbsp;to&nbsp;100.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authStatus&nbsp;The&nbsp;returned&nbsp;AuthStatus&nbsp;from&nbsp;the&nbsp;validateRequest&nbsp;method&nbsp;call.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt;&nbsp;if&nbsp;the&nbsp;processing&nbsp;of&nbsp;the&nbsp;request&nbsp;should&nbsp;proceed,&nbsp;&amp;lt;code&amp;gt;false&amp;lt;/code&amp;gt;&nbsp;otherwise.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;javax.security.auth.message.AuthException&nbsp;If&nbsp;the&nbsp;AuthStatus&nbsp;is&nbsp;not&nbsp;valid&nbsp;for&nbsp;a&nbsp;call&nbsp;to&nbsp;validateRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;handleValidateRequestResult(final&nbsp;AuthStatus&nbsp;authStatus,&nbsp;final&nbsp;HttpServletResponse&nbsp;response)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;here&nbsp;just&nbsp;carry&nbsp;on<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Successfully&nbsp;validated&nbsp;request.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SEND_SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;HttpServletResponse&nbsp;to&nbsp;client&nbsp;and&nbsp;exit.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Successfully&nbsp;validated&nbsp;request,&nbsp;with&nbsp;response&nbsp;message&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SEND_FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;HttpServletResponse&nbsp;to&nbsp;client&nbsp;and&nbsp;exit.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Failed&nbsp;to&nbsp;validate&nbsp;request,&nbsp;included&nbsp;response&nbsp;message.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(401);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SEND_CONTINUE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;HttpServletResponse&nbsp;to&nbsp;client&nbsp;and&nbsp;exit.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Has&nbsp;not&nbsp;finished&nbsp;validating&nbsp;request.&nbsp;Requires&nbsp;more&nbsp;information&nbsp;from&nbsp;client.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(100);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.error(&amp;quot;Invalid&nbsp;AuthStatus,&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;from&nbsp;validateRequest:&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Handles&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;call&nbsp;to&nbsp;the&nbsp;ServerAuthContext&nbsp;secureResponse&nbsp;method.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;An&nbsp;AuthStatus&nbsp;of&nbsp;SEND_CONTINUE&nbsp;will&nbsp;set&nbsp;the&nbsp;response&nbsp;status&nbsp;to&nbsp;100.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authStatus&nbsp;The&nbsp;returned&nbsp;AuthStatus&nbsp;from&nbsp;the&nbsp;secureResponse&nbsp;method&nbsp;call.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;javax.security.auth.message.AuthException&nbsp;If&nbsp;the&nbsp;AuthStatus&nbsp;is&nbsp;not&nbsp;valid&nbsp;for&nbsp;a&nbsp;call&nbsp;to&nbsp;secureResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleSecureResponseResult(final&nbsp;AuthStatus&nbsp;authStatus,&nbsp;final&nbsp;HttpServletResponse&nbsp;response)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SEND_SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;here&nbsp;just&nbsp;carry&nbsp;on<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Successfully&nbsp;secured&nbsp;response.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SEND_FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;HttpServletResponse&nbsp;to&nbsp;client&nbsp;and&nbsp;exit.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Failed&nbsp;to&nbsp;secured&nbsp;response,&nbsp;included&nbsp;response&nbsp;message&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(500);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(SEND_CONTINUE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;HttpServletResponse&nbsp;to&nbsp;client&nbsp;and&nbsp;exit.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.debug(&amp;quot;Has&nbsp;not&nbsp;finished&nbsp;securing&nbsp;response.&nbsp;Requires&nbsp;more&nbsp;information&nbsp;from&nbsp;client.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(100);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG.error(&amp;quot;Invalid&nbsp;AuthStatus,&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;from&nbsp;secureResponse:&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigServerContextFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/ServerContextFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/ServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/ServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,45&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Factory&nbsp;interface&nbsp;for&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance&nbsp;that&nbsp;the&nbsp;JaspiRuntime&nbsp;should&nbsp;be&nbsp;configured&nbsp;to&nbsp;use<br>
+&nbsp;*&nbsp;to&nbsp;authenticate&nbsp;requests.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;ServerContextFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;ServerAuthContext&nbsp;instance&nbsp;that&nbsp;the&nbsp;JaspiRuntime&nbsp;will&nbsp;be&nbsp;configured&nbsp;to&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;An&nbsp;instance&nbsp;of&nbsp;a&nbsp;CallbackHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;contextHandler&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ContextHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;getServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,&nbsp;final&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler)&nbsp;throws&nbsp;AuthException;<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigSessionServerContextFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,178&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.context.ServerAuthModuleInstanceCreator;<br>
+import&nbsp;org.forgerock.jaspi.context.ServerAuthModuleInstanceCreatorImpl;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfigurationImpl;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Factory&nbsp;class&nbsp;for&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance&nbsp;that&nbsp;the&nbsp;JaspiRuntime&nbsp;will&nbsp;be&nbsp;configured&nbsp;to&nbsp;use.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;Configures&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;for&nbsp;the&nbsp;ServerAuthContext&nbsp;and&nbsp;then&nbsp;delegates&nbsp;the&nbsp;configuration&nbsp;of&nbsp;the&nbsp;list<br>
+&nbsp;*&nbsp;of&nbsp;ServerAuthModules&nbsp;and&nbsp;creation&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;instance&nbsp;to&nbsp;its&nbsp;concrete&nbsp;sub-type.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;Uses&nbsp;Json&nbsp;to&nbsp;model&nbsp;the&nbsp;configuration&nbsp;for&nbsp;the&nbsp;ServerAuthContext.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;abstract&nbsp;class&nbsp;SessionServerContextFactory&nbsp;implements&nbsp;ServerContextFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_CLASS&nbsp;=&nbsp;&amp;quot;module-configuration-factory-class&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_METHOD&nbsp;=&nbsp;&amp;quot;module-configuration-factory-method&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_METHOD_DEFAULT&nbsp;=&nbsp;&amp;quot;getModuleConfigurationFactory&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;FilterConfig&nbsp;config;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;SessionServerContextFactory.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;SessionServerContextFactory(final&nbsp;FilterConfig&nbsp;config)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(config,&nbsp;FilterConfigurationImpl.INSTANCE,&nbsp;ServerAuthModuleInstanceCreatorImpl.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instances&nbsp;of&nbsp;the&nbsp;SessionServerContextFactory,&nbsp;for&nbsp;test&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterConfiguration&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfiguration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;moduleInstanceCreator&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthModuleInstanceCreator.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;SessionServerContextFactory(final&nbsp;FilterConfig&nbsp;config,&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.config&nbsp;=&nbsp;config;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.filterConfiguration&nbsp;=&nbsp;filterConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.moduleInstanceCreator&nbsp;=&nbsp;moduleInstanceCreator;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;Json&nbsp;configuration&nbsp;from&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;and&nbsp;configures&nbsp;the&nbsp;Session&nbsp;AuthModule,&nbsp;if&nbsp;defined&nbsp;in<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;configuration.&nbsp;Then&nbsp;passes&nbsp;onto&nbsp;concrete&nbsp;sub-class&nbsp;to&nbsp;configure&nbsp;the&nbsp;list&nbsp;of&nbsp;ServerAuthModules&nbsp;and&nbsp;creating<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;that&nbsp;the&nbsp;Jaspi&nbsp;Runtime&nbsp;will&nbsp;be&nbsp;configured&nbsp;with.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;contextHandler&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServerAuthContext&nbsp;getServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CallbackHandler&nbsp;handler,&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configurationFactory&nbsp;=&nbsp;filterConfiguration.get(config,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_PARAM_CONTEXT_CLASS,&nbsp;INIT_PARAM_CONTEXT_METHOD,&nbsp;INIT_PARAM_CONTEXT_METHOD_DEFAULT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ServletException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;get&nbsp;ModuleConfigurationFactory&nbsp;from&nbsp;Servlet&nbsp;Filter&nbsp;init&nbsp;params&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Failed&nbsp;to&nbsp;get&nbsp;ModuleConfigurationFactory&nbsp;from&nbsp;Servlet&nbsp;Filter&nbsp;init&nbsp;params&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;configurationFactory.getConfiguration()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY).required();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(configuration.isDefined(ModuleConfigurationFactory.SESSION_MODULE_KEY))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;sessionModule&nbsp;=&nbsp;configuration.get(ModuleConfigurationFactory.SESSION_MODULE_KEY);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!sessionModule.isMap())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Only&nbsp;one&nbsp;Session&nbsp;Auth&nbsp;Module&nbsp;can&nbsp;be&nbsp;defined.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Only&nbsp;one&nbsp;Session&nbsp;Auth&nbsp;Module&nbsp;can&nbsp;be&nbsp;defined.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;sessionModule.get(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY).required()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.asString();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;moduleProperties&nbsp;=&nbsp;sessionModule.get(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY).asMap();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule&nbsp;=&nbsp;moduleInstanceCreator.construct(className,&nbsp;moduleProperties,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createRequestMessagePolicy(),&nbsp;handler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler,&nbsp;configuration,&nbsp;sessionAuthModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;ServerAuthContext&nbsp;instance&nbsp;that&nbsp;the&nbsp;JaspiRuntime&nbsp;will&nbsp;be&nbsp;configured&nbsp;to&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Responsible&nbsp;for&nbsp;configuring&nbsp;the&nbsp;list&nbsp;of&nbsp;ServerAuthModules&nbsp;and&nbsp;creating&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerAuthContext<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;that&nbsp;the&nbsp;Jaspi&nbsp;Runtime&nbsp;will&nbsp;be&nbsp;configured&nbsp;with.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;An&nbsp;instance&nbsp;of&nbsp;a&nbsp;CallbackHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;contextHandler&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ContextHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;configuration&nbsp;The&nbsp;Json&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;sessionAuthModule&nbsp;The&nbsp;configured&nbsp;Session&nbsp;AuthModule.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;abstract&nbsp;ServerAuthContext&nbsp;getServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CallbackHandler&nbsp;handler,&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler,&nbsp;final&nbsp;JsonValue&nbsp;configuration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModule&nbsp;sessionAuthModule)&nbsp;throws&nbsp;AuthException;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;ServerAuthModuleInstanceCreator&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;ServerAuthModuleInstanceCreator.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;ServerAuthModuleInstanceCreator&nbsp;getModuleInstanceCreator()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;moduleInstanceCreator;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;MessagePolicy&nbsp;instance&nbsp;for&nbsp;the&nbsp;Request&nbsp;Policy,&nbsp;using&nbsp;the&nbsp;AUTHENTICATE_SENDER&nbsp;ProtectionPolicy&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ensuring&nbsp;the&nbsp;message&nbsp;policy&nbsp;is&nbsp;mandatory.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;MessagePolicy.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;MessagePolicy&nbsp;createRequestMessagePolicy()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.Target[]&nbsp;targets&nbsp;=&nbsp;new&nbsp;MessagePolicy.Target[]{};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.ProtectionPolicy&nbsp;protectionPolicy&nbsp;=&nbsp;new&nbsp;MessagePolicy.ProtectionPolicy()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getID()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MessagePolicy.ProtectionPolicy.AUTHENTICATE_SENDER;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.TargetPolicy&nbsp;targetPolicy&nbsp;=&nbsp;new&nbsp;MessagePolicy.TargetPolicy(targets,&nbsp;protectionPolicy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.TargetPolicy[]&nbsp;targetPolicies&nbsp;=&nbsp;new&nbsp;MessagePolicy.TargetPolicy[]{targetPolicy};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;MessagePolicy(targetPolicies,&nbsp;true);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectDefaultRuntimeInjectorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjector.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjector.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjector.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,204&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config.inject;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.auth.common.LoggingConfigurator;<br>
+import&nbsp;org.forgerock.jaspi.context.DefaultServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.HttpServletCallbackHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.runtime.RuntimeResultHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.ServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfigurationImpl;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Default&nbsp;implementation&nbsp;of&nbsp;the&nbsp;RuntimeInjector&nbsp;interface&nbsp;which&nbsp;will&nbsp;allow&nbsp;for&nbsp;getting&nbsp;the&nbsp;instance&nbsp;of&nbsp;the<br>
+&nbsp;*&nbsp;JaspiRuntime.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;DefaultRuntimeInjector&nbsp;implements&nbsp;RuntimeInjector&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_CLASS&nbsp;=&nbsp;&amp;quot;context-factory-class&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_METHOD&nbsp;=&nbsp;&amp;quot;context-factory-method&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_CONTEXT_METHOD_DEFAULT&nbsp;=&nbsp;&amp;quot;getServerContextFactory&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_CLASS&nbsp;=&nbsp;&amp;quot;logging-configurator-class&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_METHOD&nbsp;=&nbsp;&amp;quot;logging-configurator-method&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_METHOD_DEFAULT&nbsp;=&nbsp;&amp;quot;getLoggingConfigurator&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;JaspiRuntime&nbsp;jaspiRuntime;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;DefaultRuntimeInjector.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;DefaultRuntimeInjector(final&nbsp;FilterConfig&nbsp;config)&nbsp;throws&nbsp;ServletException,&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(config,&nbsp;FilterConfigurationImpl.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;DefaultRuntimeInjector,&nbsp;for&nbsp;test&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filterConfiguration&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfiguration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;getting&nbsp;the&nbsp;ServerAuthContext&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;DefaultRuntimeInjector(final&nbsp;FilterConfig&nbsp;config,&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ServletException,&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.filterConfiguration&nbsp;=&nbsp;filterConfiguration;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Must&nbsp;set&nbsp;the&nbsp;loggers&nbsp;before&nbsp;initialising&nbsp;anything&nbsp;else&nbsp;otherwise&nbsp;classes&nbsp;with&nbsp;static&nbsp;loggers&nbsp;will&nbsp;get&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;NOP&nbsp;implementations<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;&nbsp;loggingConfigurator&nbsp;=&nbsp;getLoggingConfigurator(config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(loggingConfigurator.getAuditLogger());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setDebugLogger(loggingConfigurator.getDebugLogger());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;getServerContextFactory(config);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;new&nbsp;MessageInfoUtils();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletCallbackHandler&nbsp;callbackHandler&nbsp;=&nbsp;new&nbsp;HttpServletCallbackHandler();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;new&nbsp;ContextHandler(messageInfoUtils);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;serverContextFactory.getServerAuthContext(messageInfoUtils,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeResultHandler&nbsp;runtimeResultHandler&nbsp;=&nbsp;new&nbsp;RuntimeResultHandler();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.jaspiRuntime&nbsp;=&nbsp;new&nbsp;JaspiRuntime(serverAuthContext,&nbsp;runtimeResultHandler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Finished&nbsp;initialising&nbsp;the&nbsp;DefaultRuntimeInjector&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;DefaultRuntimeInjector.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;does&nbsp;and&nbsp;should&nbsp;return&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;a&nbsp;RuntimeInjector,&nbsp;as&nbsp;it&nbsp;is&nbsp;only&nbsp;ever&nbsp;called&nbsp;once&nbsp;per&nbsp;configured<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filter.&nbsp;This&nbsp;means&nbsp;that&nbsp;a&nbsp;web&nbsp;application&nbsp;can&nbsp;create&nbsp;multiple&nbsp;instances&nbsp;of&nbsp;the&nbsp;JaspiRuntimeFilter&nbsp;and&nbsp;each<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;instance&nbsp;will&nbsp;have&nbsp;its&nbsp;own&nbsp;self&nbsp;contained&nbsp;injector&nbsp;which&nbsp;uses&nbsp;that&nbsp;instances&nbsp;filter&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfig.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;RuntimeInjector.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;creating&nbsp;the&nbsp;RuntimeInjector.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;RuntimeInjector&nbsp;getRuntimeInjector(final&nbsp;FilterConfig&nbsp;config)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;DefaultRuntimeInjector(config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(AuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;construct&nbsp;RuntimeInjector&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException(&amp;quot;Failed&nbsp;to&nbsp;construct&nbsp;RuntimeInjector&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Will&nbsp;only&nbsp;ever&nbsp;return&nbsp;the&nbsp;singleton&nbsp;instance&nbsp;(for&nbsp;this&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiRuntimeFilter)&nbsp;and&nbsp;if&nbsp;asked<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;for&nbsp;an&nbsp;instance&nbsp;of&nbsp;a&nbsp;different&nbsp;type&nbsp;will&nbsp;throw&nbsp;a&nbsp;{@link&nbsp;RuntimeException}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;type&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&amp;lt;T&amp;gt;&nbsp;T&nbsp;getInstance(final&nbsp;Class&amp;lt;T&amp;gt;&nbsp;type)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!JaspiRuntime.class.equals(type))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Type&nbsp;not&nbsp;registered!&nbsp;&amp;quot;&nbsp;+&nbsp;type.getName());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException(&amp;quot;Type&nbsp;not&nbsp;registered!&nbsp;&amp;quot;&nbsp;+&nbsp;type.getName());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(T)&nbsp;jaspiRuntime;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;configured&nbsp;{@link&nbsp;ServerContextFactory},&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;init&nbsp;params.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;ServerContextFactory&nbsp;is&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config,&nbsp;then&nbsp;the&nbsp;{@link&nbsp;DefaultServerContextFactory}&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ServerContextFactory.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerContextFactory&nbsp;getServerContextFactory(final&nbsp;FilterConfig&nbsp;config)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;filterConfiguration.get(config,&nbsp;INIT_PARAM_CONTEXT_CLASS,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_PARAM_CONTEXT_METHOD,&nbsp;INIT_PARAM_CONTEXT_METHOD_DEFAULT);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(serverContextFactory&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Filter&nbsp;init&nbsp;param,&nbsp;&amp;quot;&nbsp;+&nbsp;INIT_PARAM_CONTEXT_CLASS&nbsp;+&nbsp;&amp;quot;,&nbsp;not&nbsp;set.&nbsp;Falling&nbsp;back&nbsp;to&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;DefaultServerContextFactory.class.getSimpleName()&nbsp;+&nbsp;&amp;quot;.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;DefaultServerContextFactory.getServerContextFactory(config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;serverContextFactory;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;instance&nbsp;of&nbsp;the&nbsp;configured&nbsp;{@link&nbsp;LoggingConfigurator},&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;init&nbsp;params.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;no&nbsp;LoggingConfigurator&nbsp;is&nbsp;configured&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config,&nbsp;then&nbsp;a&nbsp;NOP&nbsp;LoggingConfigurator&nbsp;will&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;LoggingConfigurator.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;&nbsp;getLoggingConfigurator(final&nbsp;FilterConfig&nbsp;config)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;&nbsp;loggingConfigurator&nbsp;=&nbsp;filterConfiguration.get(config,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_CLASS,&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_METHOD,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_METHOD_DEFAULT);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(loggingConfigurator&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Filter&nbsp;init&nbsp;param,&nbsp;&amp;quot;&nbsp;+&nbsp;INIT_PARAM_LOGGING_CONFIGURATOR_CLASS&nbsp;+&nbsp;&amp;quot;,&nbsp;not&nbsp;set.&nbsp;Falling&nbsp;back&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;to&nbsp;the&nbsp;NOPLoggingConfigurator.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loggingConfigurator&nbsp;=&nbsp;new&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DebugLogger&nbsp;getDebugLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;getAuditLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;loggingConfigurator;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectRuntimeInjectorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/RuntimeInjector.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/RuntimeInjector.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/RuntimeInjector.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,34&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;Inc.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config.inject;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Injector&nbsp;interface&nbsp;for&nbsp;getting&nbsp;instances&nbsp;of&nbsp;the&nbsp;Jaspi&nbsp;runtime&nbsp;classes.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;RuntimeInjector&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;request&nbsp;type.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;type&nbsp;The&nbsp;class&nbsp;of&nbsp;the&nbsp;type&nbsp;to&nbsp;return.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;type.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;T&amp;gt;&nbsp;T&nbsp;getInstance(final&nbsp;Class&amp;lt;T&amp;gt;&nbsp;type);<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfiginjectpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/inject/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;classes&nbsp;that&nbsp;provide&nbsp;injection&nbsp;functionality&nbsp;for&nbsp;the&nbsp;creation&nbsp;of&nbsp;the&nbsp;Jaspi&nbsp;Runtime.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime.config.inject;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeconfigpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/config/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;classes&nbsp;that&nbsp;provide&nbsp;factory&nbsp;classes&nbsp;and&nbsp;method&nbsp;for&nbsp;defining&nbsp;the&nbsp;ServerAuthContext&nbsp;instance<br>
+&nbsp;*&nbsp;that&nbsp;the&nbsp;JaspiRuntime&nbsp;will&nbsp;use&nbsp;to&nbsp;use&nbsp;to&nbsp;validate&nbsp;and&nbsp;secure&nbsp;client&nbsp;requests&nbsp;and&nbsp;responses.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime.config;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextContextHandlerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,192&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.AuthResult;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.logging.MessageInfoAuditRecord;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.security.Principal;<br>
+import&nbsp;java.util.Arrays;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.JSON_HTTP_MEDIA_TYPE;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.UNAUTHORIZED_ERROR_MESSAGE;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.UNAUTHORIZED_HTTP_ERROR_CODE;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;handler&nbsp;for&nbsp;ServerAuthContext,&nbsp;which&nbsp;exposes&nbsp;helper&nbsp;methods&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;at&nbsp;the&nbsp;varying&nbsp;end&nbsp;states<br>
+&nbsp;*&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;processing.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;ContextHandler&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;ContextHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ContextHandler(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.messageInfoUtils&nbsp;=&nbsp;messageInfoUtils;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Validates&nbsp;that&nbsp;each&nbsp;given&nbsp;ServerAuthModule&nbsp;conforms&nbsp;to&nbsp;the&nbsp;Jaspi&nbsp;HttpServlet&nbsp;Profile&nbsp;by&nbsp;calling&nbsp;each<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;modules&nbsp;#getSupportedMessageTypes()&nbsp;method&nbsp;and&nbsp;ensuring&nbsp;it&nbsp;contains&nbsp;both&nbsp;the&nbsp;HttpServletRequest&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;HttpServletResponse&nbsp;classes.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;The&nbsp;List&nbsp;of&nbsp;ServerAuthModules&nbsp;to&nbsp;check.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;ServerAuthModules&nbsp;does&nbsp;not&nbsp;conform&nbsp;to&nbsp;the&nbsp;HttpServlet&nbsp;Profile.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModuleConformToHttpServletProfile(final&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authModules&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ServerAuthModule&nbsp;authModule&nbsp;:&nbsp;authModules)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkAuthModuleSupportsHttpServletProfile(authModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Validates&nbsp;that&nbsp;the&nbsp;given&nbsp;ServerAuthModule&nbsp;conforms&nbsp;to&nbsp;the&nbsp;Jaspi&nbsp;HttpServlet&nbsp;Profile&nbsp;by&nbsp;calling&nbsp;the&nbsp;module's<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;#getSupportedMessageTypes()&nbsp;method&nbsp;and&nbsp;ensuring&nbsp;it&nbsp;contains&nbsp;both&nbsp;the&nbsp;HttpServletRequest&nbsp;and&nbsp;HttpServletResponse<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;classes.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModule&nbsp;The&nbsp;ServerAuthModule&nbsp;to&nbsp;check.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;the&nbsp;ServerAuthModule&nbsp;does&nbsp;not&nbsp;conform&nbsp;to&nbsp;the&nbsp;HttpServlet&nbsp;Profile.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkAuthModuleSupportsHttpServletProfile(final&nbsp;ServerAuthModule&nbsp;authModule)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authModule&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;Class&amp;gt;&nbsp;supportedTypes&nbsp;=&nbsp;Arrays.asList(authModule.getSupportedMessageTypes());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(supportedTypes.contains(HttpServletRequest.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;amp;&amp;amp;&nbsp;supportedTypes.contains(HttpServletResponse.class)))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;ServerAuthModule&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;HttpServlet&nbsp;profile,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authModule.getClass().getName());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;ServerAuthModule&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;HttpServlet&nbsp;profile,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authModule.getClass().getName());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Handles&nbsp;the&nbsp;completion&nbsp;of&nbsp;an&nbsp;authentication&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;if&nbsp;the&nbsp;authentication&nbsp;resulted&nbsp;in&nbsp;a&nbsp;valid&nbsp;AuthStatus&nbsp;and&nbsp;if&nbsp;not&nbsp;will&nbsp;write&nbsp;a&nbsp;401&nbsp;Unauthorized&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;the&nbsp;HttpServletResponse&nbsp;stored&nbsp;in&nbsp;the&nbsp;MessageInfo&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Otherwise&nbsp;will&nbsp;set&nbsp;the&nbsp;authentication&nbsp;attributes,&nbsp;principal&nbsp;name&nbsp;and&nbsp;authentication&nbsp;context&nbsp;map,&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;HttpServletRequest.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;The&nbsp;Client&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authStatus&nbsp;The&nbsp;AuthStatus&nbsp;of&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;problem&nbsp;writing&nbsp;to&nbsp;the&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCompletion(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthStatus&nbsp;authStatus)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authStatus&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Authentication&nbsp;has&nbsp;failed.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;(HttpServletResponse)&nbsp;messageInfo.getResponseMessage();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResourceException&nbsp;jre&nbsp;=&nbsp;ResourceException.getException(UNAUTHORIZED_HTTP_ERROR_CODE,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNAUTHORIZED_ERROR_MESSAGE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getWriter().write(jre.toJsonValue().toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setContentType(JSON_HTTP_MEDIA_TYPE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Failed&nbsp;to&nbsp;write&nbsp;to&nbsp;response&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setAuthenticationRequestAttributes(messageInfo,&nbsp;clientSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;authentication&nbsp;id&nbsp;and&nbsp;context&nbsp;map&nbsp;into&nbsp;the&nbsp;HttpServletRequest,&nbsp;as&nbsp;attributes,&nbsp;for&nbsp;use&nbsp;by&nbsp;other<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filters&nbsp;and&nbsp;resources.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Will&nbsp;take&nbsp;the&nbsp;first&nbsp;Principal&nbsp;it&nbsp;finds&nbsp;in&nbsp;the&nbsp;client&nbsp;Subject&nbsp;and&nbsp;add&nbsp;the&nbsp;Principal's&nbsp;name&nbsp;to&nbsp;the&nbsp;authentication<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;context.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;The&nbsp;Client&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;setAuthenticationRequestAttributes(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;clientSubject)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;principalName&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Principal&nbsp;principal&nbsp;:&nbsp;clientSubject.getPrincipals())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;principalName&nbsp;=&nbsp;principal.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;context&nbsp;=&nbsp;messageInfoUtils.getMap(messageInfo,&nbsp;JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Setting&nbsp;principal&nbsp;name,&nbsp;&amp;quot;&nbsp;+&nbsp;principalName&nbsp;+&nbsp;&amp;quot;,&nbsp;and&nbsp;&amp;quot;&nbsp;+&nbsp;context.size()&nbsp;+&nbsp;&amp;quot;&nbsp;context&nbsp;values&nbsp;on&nbsp;to&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;the&nbsp;request.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute(JaspiRuntime.ATTRIBUTE_AUTH_PRINCIPAL,&nbsp;principalName);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;context);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;an&nbsp;audit&nbsp;record&nbsp;containing&nbsp;the&nbsp;given&nbsp;MessageInfo&nbsp;and&nbsp;whether&nbsp;the&nbsp;AuthStatus&nbsp;is&nbsp;a&nbsp;success&nbsp;or&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;calls&nbsp;the&nbsp;configured&nbsp;audit&nbsp;logger.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;to&nbsp;use&nbsp;as&nbsp;the&nbsp;audit&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authStatus&nbsp;The&nbsp;AuthStatus&nbsp;of&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;audit(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;AuthStatus&nbsp;authStatus)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;new&nbsp;MessageInfoAuditRecord(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isAuthStatusSuccessful(authStatus)&nbsp;?&nbsp;AuthResult.SUCCESS&nbsp;:&nbsp;AuthResult.FAILURE,&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.getAuditLogger().audit(auditRecord);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;if&nbsp;the&nbsp;AuthStatus&nbsp;value&nbsp;is&nbsp;a&nbsp;successful&nbsp;status&nbsp;or&nbsp;not.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authStatus&nbsp;The&nbsp;AuthStatus.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt;&nbsp;if&nbsp;the&nbsp;AuthStatus&nbsp;is&nbsp;SUCCESS&nbsp;or&nbsp;SEND_SUCCESS.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;boolean&nbsp;isAuthStatusSuccessful(final&nbsp;AuthStatus&nbsp;authStatus)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SUCCESS.equals(authStatus)&nbsp;||&nbsp;AuthStatus.SEND_SUCCESS.equals(authStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,377&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.List;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Encapsulates&nbsp;ServerAuthModules&nbsp;that&nbsp;are&nbsp;used&nbsp;to&nbsp;validate&nbsp;service&nbsp;requests&nbsp;received&nbsp;from&nbsp;clients,&nbsp;and&nbsp;to&nbsp;secure&nbsp;any<br>
+&nbsp;*&nbsp;response&nbsp;returned&nbsp;for&nbsp;those&nbsp;requests.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;This&nbsp;abstract&nbsp;implementation&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;interface&nbsp;allows&nbsp;a&nbsp;single&nbsp;Session&nbsp;ServerAuthModule,&nbsp;to<br>
+&nbsp;*&nbsp;provide&nbsp;session&nbsp;capabilities&nbsp;(i.e.&nbsp;on&nbsp;secureResponse,&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;which&nbsp;is&nbsp;validate&nbsp;on&nbsp;each&nbsp;subsequent&nbsp;request&nbsp;to<br>
+&nbsp;*&nbsp;skip&nbsp;re-authenticating&nbsp;each&nbsp;request),&nbsp;and&nbsp;then&nbsp;defers&nbsp;to&nbsp;the&nbsp;concrete&nbsp;implementation&nbsp;to&nbsp;co-ordinate&nbsp;calling<br>
+&nbsp;*&nbsp;any&nbsp;other&nbsp;ServerAuthModules.<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;*&nbsp;This&nbsp;class&nbsp;or&nbsp;concrete&nbsp;implementations&nbsp;of&nbsp;it&nbsp;MUST&nbsp;not&nbsp;store&nbsp;any&nbsp;request&nbsp;specific&nbsp;state&nbsp;in&nbsp;it.&nbsp;This&nbsp;is&nbsp;because<br>
+&nbsp;*&nbsp;many&nbsp;different&nbsp;requests&nbsp;will&nbsp;use&nbsp;this&nbsp;class,&nbsp;possibly&nbsp;concurrently.&nbsp;If&nbsp;request&nbsp;specific&nbsp;state&nbsp;does&nbsp;need&nbsp;to&nbsp;be<br>
+&nbsp;*&nbsp;maintained,&nbsp;then&nbsp;use&nbsp;the&nbsp;MessageInfo&nbsp;map&nbsp;that&nbsp;is&nbsp;provided&nbsp;as&nbsp;this&nbsp;is&nbsp;created&nbsp;and&nbsp;used&nbsp;only&nbsp;be&nbsp;the&nbsp;specific&nbsp;request<br>
+&nbsp;*&nbsp;being&nbsp;handled.&nbsp;The&nbsp;MessageInfo&nbsp;will&nbsp;be&nbsp;available&nbsp;for&nbsp;the&nbsp;entire&nbsp;time&nbsp;the&nbsp;request&nbsp;is&nbsp;being&nbsp;processed.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;ServerAuthModule&nbsp;configured&nbsp;in&nbsp;the&nbsp;runtime.<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;abstract&nbsp;class&nbsp;JaspiServerAuthContext&amp;lt;T&nbsp;extends&nbsp;ServerAuthModule&amp;gt;&nbsp;implements&nbsp;ServerAuthContext&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Key&nbsp;to&nbsp;the&nbsp;private&nbsp;context&nbsp;map,&nbsp;shared&nbsp;between&nbsp;ServerAuthContext&nbsp;implementations.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;static&nbsp;final&nbsp;String&nbsp;PRIVATE_CONTEXT_MAP_KEY&nbsp;=&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ServerAuthModule&nbsp;sessionAuthModule;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;List&amp;lt;T&amp;gt;&nbsp;authModules;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiServerAuthContext.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Each&nbsp;configured&nbsp;ServerAuthModule&nbsp;has&nbsp;its&nbsp;#getSupportedMessageTypes()&nbsp;method&nbsp;called&nbsp;to&nbsp;ensure&nbsp;that&nbsp;each&nbsp;module<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;does&nbsp;support&nbsp;and&nbsp;conform&nbsp;to&nbsp;the&nbsp;Jaspi&nbsp;HttpServlet&nbsp;Profile.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfoUtils&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;contextHandler&nbsp;An&nbsp;instance&nbsp;of&nbsp;the&nbsp;ContextHandler.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;sessionAuthModule&nbsp;A&nbsp;Session&nbsp;AuthModule.&nbsp;Can&nbsp;be&nbsp;&amp;lt;code&amp;gt;null&amp;lt;/code&amp;gt;.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;A&nbsp;List&nbsp;of&nbsp;ServerAuthModules.&nbsp;MUST&nbsp;not&nbsp;be&nbsp;&amp;lt;code&amp;gt;null&amp;lt;/code&amp;gt;.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;do&nbsp;not&nbsp;conform&nbsp;to&nbsp;the&nbsp;Jaspi&nbsp;HttpServlet&nbsp;Profile.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiServerAuthContext(final&nbsp;MessageInfoUtils&nbsp;messageInfoUtils,&nbsp;final&nbsp;ContextHandler&nbsp;contextHandler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModule&nbsp;sessionAuthModule,&nbsp;final&nbsp;List&amp;lt;T&amp;gt;&nbsp;authModules)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;allAuthModules;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authModules&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAuthModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAuthModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;(authModules);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAuthModules.add(0,&nbsp;sessionAuthModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(allAuthModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.messageInfoUtils&nbsp;=&nbsp;messageInfoUtils;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.contextHandler&nbsp;=&nbsp;contextHandler;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.sessionAuthModule&nbsp;=&nbsp;sessionAuthModule;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.authModules&nbsp;=&nbsp;authModules;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;MessageInfoUtils.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;MessageInfoUtils&nbsp;getMessageInfoUtils()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;messageInfoUtils;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Authenticate&nbsp;a&nbsp;received&nbsp;service&nbsp;request&nbsp;by&nbsp;delegating&nbsp;calls&nbsp;to&nbsp;the&nbsp;configured&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;logic&nbsp;used&nbsp;to&nbsp;determine&nbsp;whether&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;called&nbsp;is&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ol&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;a&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;configured,&nbsp;it&nbsp;is&nbsp;called&nbsp;first.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;configured&nbsp;and&nbsp;returns&nbsp;AuthStatus.SUCCESS,&nbsp;AuthStatus.SEND_SUCCESS&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus.SEND_CONTINUE&nbsp;processing&nbsp;stops&nbsp;and&nbsp;the&nbsp;AuthStatus&nbsp;is&nbsp;returned.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;If&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;not&nbsp;configured&nbsp;or&nbsp;it&nbsp;returns&nbsp;AuthStatus.SEND_FAILURE&nbsp;then&nbsp;the&nbsp;list<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;ServerAuthModules&nbsp;are&nbsp;called.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ol&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;not&nbsp;configured&nbsp;or&nbsp;returns&nbsp;AuthStatus.SEND_FAILURE,&nbsp;then&nbsp;the&nbsp;concrete&nbsp;sub-types<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;#validateRequest(List,&nbsp;MessageInfo,&nbsp;Subject,&nbsp;Subject)&nbsp;will&nbsp;be&nbsp;called&nbsp;for&nbsp;the&nbsp;ServerAuthModules<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;#validateRequest(MessageInfo,&nbsp;Subject,&nbsp;Subject)&nbsp;to&nbsp;be&nbsp;called.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Possible&nbsp;AuthStatus&nbsp;return&nbsp;values:&nbsp;SUCCESS,&nbsp;SEND_SUCCESS,&nbsp;SEND_FAILURE,&nbsp;SEND_CONTINUE.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;configured&nbsp;AuditLogger&nbsp;will&nbsp;be&nbsp;called&nbsp;to&nbsp;audit&nbsp;the&nbsp;request&nbsp;&amp;lt;strong&amp;gt;if&amp;lt;/strong&amp;gt;&nbsp;the&nbsp;Session&nbsp;AuthModule<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;is&nbsp;not&nbsp;configured&nbsp;or&nbsp;returns&nbsp;AuthStatus.SEND_FAILURE&nbsp;as&nbsp;if&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;passes&nbsp;the&nbsp;Jaspi&nbsp;Runtime<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;takes&nbsp;this&nbsp;as&nbsp;an&nbsp;existing&nbsp;session&nbsp;continuing.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;A&nbsp;contextual&nbsp;object&nbsp;that&nbsp;encapsulates&nbsp;the&nbsp;client&nbsp;request&nbsp;and&nbsp;server&nbsp;response&nbsp;objects.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;service&nbsp;request.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;store&nbsp;Principals<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;credentials&nbsp;validated&nbsp;in&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request,&nbsp;or&nbsp;null.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;as<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;source&nbsp;of&nbsp;Principals&nbsp;or&nbsp;credentials&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;validate&nbsp;the&nbsp;request.&nbsp;If&nbsp;the&nbsp;Subject<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;not&nbsp;null,&nbsp;the&nbsp;method&nbsp;implementation&nbsp;may&nbsp;add&nbsp;additional&nbsp;Principals&nbsp;or&nbsp;credentials<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pertaining&nbsp;to&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request)&nbsp;to&nbsp;the&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;AuthStatus&nbsp;object&nbsp;representing&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing&nbsp;performed&nbsp;by&nbsp;the&nbsp;method.&nbsp;The<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus&nbsp;values&nbsp;that&nbsp;may&nbsp;be&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;are&nbsp;defined&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SUCCESS&nbsp;when&nbsp;the&nbsp;application&nbsp;request&nbsp;message&nbsp;was&nbsp;successfully&nbsp;validated.&nbsp;The&nbsp;validated&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getRequestMessage&nbsp;on&nbsp;messageInfo.&amp;lt;li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_SUCCESS&nbsp;to&nbsp;indicate&nbsp;that&nbsp;validation/processing&nbsp;of&nbsp;the&nbsp;request&nbsp;message&nbsp;successfully&nbsp;produced<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;secured&nbsp;application&nbsp;response&nbsp;message&nbsp;(in&nbsp;messageInfo).&nbsp;The&nbsp;secured&nbsp;response&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_CONTINUE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;message&nbsp;validation&nbsp;is&nbsp;incomplete,&nbsp;and&nbsp;that&nbsp;a&nbsp;preliminary&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;was&nbsp;returned&nbsp;as&nbsp;the&nbsp;response&nbsp;message&nbsp;in&nbsp;messageInfo.&nbsp;When&nbsp;this&nbsp;status&nbsp;value&nbsp;is&nbsp;returned&nbsp;to&nbsp;challenge&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;application&nbsp;request&nbsp;message,&nbsp;the&nbsp;challenged&nbsp;request&nbsp;must&nbsp;be&nbsp;saved&nbsp;by&nbsp;the&nbsp;authentication&nbsp;module&nbsp;such&nbsp;that&nbsp;it&nbsp;can<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;recovered&nbsp;when&nbsp;the&nbsp;module's&nbsp;validateRequest&nbsp;message&nbsp;is&nbsp;called&nbsp;to&nbsp;process&nbsp;the&nbsp;request&nbsp;returned&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;challenge.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_FAILURE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;message&nbsp;validation&nbsp;failed&nbsp;and&nbsp;that&nbsp;an&nbsp;appropriate&nbsp;failure&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;When&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(in&nbsp;messageInfo).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;final&nbsp;AuthStatus&nbsp;validateRequest(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getMessageInfoUtils().addMap(messageInfo,&nbsp;JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;validate&nbsp;session&nbsp;module<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sessionAuthModule&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus&nbsp;=&nbsp;sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(AuthStatus.SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(sessionAuthModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_SUCCESS.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;may&nbsp;have&nbsp;completely/partially/not&nbsp;authenticated&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(sessionAuthModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;successfully&nbsp;authenticated&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client&nbsp;and&nbsp;has&nbsp;a&nbsp;response&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;failed&nbsp;to&nbsp;authenticate&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;--&nbsp;In&nbsp;our&nbsp;implementation&nbsp;we&nbsp;will&nbsp;let&nbsp;subsequent&nbsp;modules&nbsp;try&nbsp;before&nbsp;sending&nbsp;the&nbsp;failure.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(sessionAuthModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;failed&nbsp;to&nbsp;authenticated&nbsp;the&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client,&nbsp;passing&nbsp;to&nbsp;Auth&nbsp;Modules&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(AuthStatus.SEND_CONTINUE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;The&nbsp;module&nbsp;has&nbsp;not&nbsp;completed&nbsp;authenticating&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(sessionAuthModule.getClass().getSimpleName()&nbsp;+&nbsp;&amp;quot;&nbsp;has&nbsp;not&nbsp;completed&nbsp;authenticating&nbsp;the&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;client&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus&nbsp;=&nbsp;validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authStatus&nbsp;==&nbsp;null&nbsp;||&nbsp;AuthStatus.FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthStatus&nbsp;exceptionAuthStatus&nbsp;=&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;&nbsp;+&nbsp;exceptionAuthStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;exceptionAuthStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Should&nbsp;not&nbsp;audit&nbsp;if&nbsp;the&nbsp;authentication&nbsp;process&nbsp;hasn't&nbsp;yet&nbsp;finished<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authStatus&nbsp;!=&nbsp;null&nbsp;&amp;amp;&amp;amp;&nbsp;!AuthStatus.SEND_CONTINUE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Once&nbsp;all&nbsp;Auth&nbsp;modules&nbsp;have&nbsp;had&nbsp;the&nbsp;chance&nbsp;to&nbsp;authenticate,&nbsp;audit&nbsp;the&nbsp;attempt.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.debug(&amp;quot;Auditing&nbsp;authentication&nbsp;result&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Co-ordinates&nbsp;calling&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;#validateRequest&nbsp;method,&nbsp;when&nbsp;either&nbsp;the&nbsp;Session<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthModule&nbsp;is&nbsp;not&nbsp;configured&nbsp;or&nbsp;has&nbsp;returned&nbsp;AuthStatus.SEND_FAILURE.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Possible&nbsp;AuthStatus&nbsp;return&nbsp;values:&nbsp;SUCCESS,&nbsp;SEND_SUCCESS,&nbsp;SEND_FAILURE,&nbsp;SEND_CONTINUE.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;The&nbsp;list&nbsp;of&nbsp;configured&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;A&nbsp;contextual&nbsp;object&nbsp;that&nbsp;encapsulates&nbsp;the&nbsp;client&nbsp;request&nbsp;and&nbsp;server&nbsp;response&nbsp;objects.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;service&nbsp;request.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;store&nbsp;Principals<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;credentials&nbsp;validated&nbsp;in&nbsp;the&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request,&nbsp;or&nbsp;null.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;as<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;source&nbsp;of&nbsp;Principals&nbsp;or&nbsp;credentials&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;validate&nbsp;the&nbsp;request.&nbsp;If&nbsp;the&nbsp;Subject<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;not&nbsp;null,&nbsp;the&nbsp;method&nbsp;implementation&nbsp;may&nbsp;add&nbsp;additional&nbsp;Principals&nbsp;or&nbsp;credentials<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pertaining&nbsp;to&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request)&nbsp;to&nbsp;the&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;AuthStatus&nbsp;object&nbsp;representing&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing&nbsp;performed&nbsp;by&nbsp;the&nbsp;method.&nbsp;The<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus&nbsp;values&nbsp;that&nbsp;may&nbsp;be&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;are&nbsp;defined&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SUCCESS&nbsp;when&nbsp;the&nbsp;application&nbsp;request&nbsp;message&nbsp;was&nbsp;successfully&nbsp;validated.&nbsp;The&nbsp;validated&nbsp;request<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getRequestMessage&nbsp;on&nbsp;messageInfo.&amp;lt;li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_SUCCESS&nbsp;to&nbsp;indicate&nbsp;that&nbsp;validation/processing&nbsp;of&nbsp;the&nbsp;request&nbsp;message&nbsp;successfully&nbsp;produced<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;secured&nbsp;application&nbsp;response&nbsp;message&nbsp;(in&nbsp;messageInfo).&nbsp;The&nbsp;secured&nbsp;response&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_CONTINUE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;message&nbsp;validation&nbsp;is&nbsp;incomplete,&nbsp;and&nbsp;that&nbsp;a&nbsp;preliminary&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;was&nbsp;returned&nbsp;as&nbsp;the&nbsp;response&nbsp;message&nbsp;in&nbsp;messageInfo.&nbsp;When&nbsp;this&nbsp;status&nbsp;value&nbsp;is&nbsp;returned&nbsp;to&nbsp;challenge&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;application&nbsp;request&nbsp;message,&nbsp;the&nbsp;challenged&nbsp;request&nbsp;must&nbsp;be&nbsp;saved&nbsp;by&nbsp;the&nbsp;authentication&nbsp;module&nbsp;such&nbsp;that&nbsp;it&nbsp;can<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;recovered&nbsp;when&nbsp;the&nbsp;module's&nbsp;validateRequest&nbsp;message&nbsp;is&nbsp;called&nbsp;to&nbsp;process&nbsp;the&nbsp;request&nbsp;returned&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;challenge.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_FAILURE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;message&nbsp;validation&nbsp;failed&nbsp;and&nbsp;that&nbsp;an&nbsp;appropriate&nbsp;failure&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;When&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(in&nbsp;messageInfo).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;abstract&nbsp;AuthStatus&nbsp;validateRequest(final&nbsp;List&amp;lt;T&amp;gt;&nbsp;authModules,&nbsp;final&nbsp;MessageInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;clientSubject,&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Secures&nbsp;a&nbsp;service&nbsp;response&nbsp;before&nbsp;sending&nbsp;it&nbsp;to&nbsp;the&nbsp;client&nbsp;by&nbsp;delegating&nbsp;calls&nbsp;to&nbsp;the&nbsp;configured<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Firstly&nbsp;the&nbsp;concrete&nbsp;sub-types&nbsp;#secureResponse(List,&nbsp;MessageInfo,&nbsp;Subject)&nbsp;will&nbsp;be&nbsp;called&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ServerAuthModules&nbsp;#secureResponse(MessageInfo,&nbsp;Subject)&nbsp;to&nbsp;be&nbsp;called.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;Session&nbsp;AuthModule&nbsp;is&nbsp;only&nbsp;called&nbsp;if:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;it&nbsp;is&nbsp;configured&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;li&amp;gt;the&nbsp;call&nbsp;to&nbsp;the&nbsp;concrete&nbsp;sub-types&nbsp;secureResponse&nbsp;returns&nbsp;AuthStatus.SEND_SUCCESS&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Any&nbsp;other&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;the&nbsp;concrete&nbsp;sub-types&nbsp;secureResponse&nbsp;method&nbsp;will&nbsp;result&nbsp;in&nbsp;the&nbsp;end&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;processing&nbsp;and&nbsp;the&nbsp;AuthStatus&nbsp;to&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Note:&nbsp;secureResponse&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;if&nbsp;the&nbsp;call&nbsp;to&nbsp;validateRequest&nbsp;returned&nbsp;AuthStatus.SUCCESS.&nbsp;Any&nbsp;other<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus&nbsp;should&nbsp;cause&nbsp;the&nbsp;runtime&nbsp;to&nbsp;finish&nbsp;processing&nbsp;the&nbsp;request&nbsp;and&nbsp;return&nbsp;a&nbsp;response&nbsp;to&nbsp;the&nbsp;client.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Possible&nbsp;AuthStatus&nbsp;return&nbsp;values:&nbsp;SEND_SUCCESS,&nbsp;SEND_FAILURE,&nbsp;SEND_CONTINUE.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;A&nbsp;contextual&nbsp;object&nbsp;that&nbsp;encapsulates&nbsp;the&nbsp;client&nbsp;request&nbsp;and&nbsp;server&nbsp;response&nbsp;objects.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request,&nbsp;or&nbsp;null.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;as<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;source&nbsp;of&nbsp;Principals&nbsp;or&nbsp;credentials&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;validate&nbsp;the&nbsp;request.&nbsp;If&nbsp;the&nbsp;Subject<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;not&nbsp;null,&nbsp;the&nbsp;method&nbsp;implementation&nbsp;may&nbsp;add&nbsp;additional&nbsp;Principals&nbsp;or&nbsp;credentials<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pertaining&nbsp;to&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request)&nbsp;to&nbsp;the&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;AuthStatus&nbsp;object&nbsp;representing&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing&nbsp;performed&nbsp;by&nbsp;the&nbsp;method.&nbsp;The<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus&nbsp;values&nbsp;that&nbsp;may&nbsp;be&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;are&nbsp;defined&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_SUCCESS&nbsp;when&nbsp;the&nbsp;application&nbsp;response&nbsp;message&nbsp;was&nbsp;successfully&nbsp;secured.&nbsp;The&nbsp;secured<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;response&nbsp;message&nbsp;may&nbsp;be&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_CONTINUE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;the&nbsp;application&nbsp;response&nbsp;message&nbsp;(within&nbsp;messageInfo)&nbsp;was&nbsp;replaced<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;with&nbsp;a&nbsp;security&nbsp;message&nbsp;that&nbsp;should&nbsp;elicit&nbsp;a&nbsp;security-specific&nbsp;response&nbsp;(in&nbsp;the&nbsp;form&nbsp;of&nbsp;a&nbsp;request)&nbsp;from&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;peer.&nbsp;This&nbsp;status&nbsp;value&nbsp;serves&nbsp;to&nbsp;inform&nbsp;the&nbsp;calling&nbsp;runtime&nbsp;that&nbsp;(to&nbsp;successfully&nbsp;complete&nbsp;the&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exchange)&nbsp;it&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;capable&nbsp;of&nbsp;continuing&nbsp;the&nbsp;message&nbsp;dialog&nbsp;by&nbsp;processing&nbsp;at&nbsp;least&nbsp;one&nbsp;additional<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;request/response&nbsp;exchange&nbsp;(after&nbsp;having&nbsp;sent&nbsp;the&nbsp;response&nbsp;message&nbsp;returned&nbsp;in&nbsp;messageInfo).&nbsp;When&nbsp;this&nbsp;status<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;value&nbsp;is&nbsp;returned,&nbsp;the&nbsp;application&nbsp;response&nbsp;must&nbsp;be&nbsp;saved&nbsp;by&nbsp;the&nbsp;authentication&nbsp;module&nbsp;such&nbsp;that&nbsp;it&nbsp;can&nbsp;be<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;recovered&nbsp;when&nbsp;the&nbsp;module's&nbsp;validateRequest&nbsp;message&nbsp;is&nbsp;called&nbsp;to&nbsp;process&nbsp;the&nbsp;elicited&nbsp;response.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_FAILURE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;a&nbsp;failure&nbsp;occurred&nbsp;while&nbsp;securing&nbsp;the&nbsp;response&nbsp;message&nbsp;and&nbsp;that&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;appropriate&nbsp;failure&nbsp;response&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;When&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(in&nbsp;messageInfo).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;final&nbsp;AuthStatus&nbsp;secureResponse(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;serviceSubject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(AuthStatus.SUCCESS.equals(authStatus)&nbsp;||&nbsp;AuthStatus.FAILURE.equals(authStatus))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authStatus.toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;the&nbsp;SessionModule&nbsp;is&nbsp;configured&nbsp;and&nbsp;either&nbsp;the&nbsp;AuthModule&nbsp;secureResponse&nbsp;has&nbsp;been&nbsp;called&nbsp;and&nbsp;returned<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus.SUCCESS&nbsp;or&nbsp;the&nbsp;AuthModule&nbsp;secureResponse&nbsp;has&nbsp;not&nbsp;been&nbsp;called&nbsp;and&nbsp;hence&nbsp;the&nbsp;authStatus&nbsp;is&nbsp;null.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sessionAuthModule&nbsp;!=&nbsp;null&nbsp;&amp;amp;&amp;amp;&nbsp;(authStatus&nbsp;==&nbsp;null&nbsp;||&nbsp;AuthStatus.SEND_SUCCESS.equals(authStatus)))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus&nbsp;=&nbsp;sessionAuthModule.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;As&nbsp;this&nbsp;method&nbsp;can&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;validateRequest&nbsp;returns&nbsp;a&nbsp;AuthStatus.SUCCESS,&nbsp;which&nbsp;means&nbsp;either&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;SessionModule&nbsp;is&nbsp;configured&nbsp;or&nbsp;the&nbsp;authenticatingAuthModule&nbsp;will&nbsp;be&nbsp;set,&nbsp;so&nbsp;authStatus&nbsp;cannot&nbsp;be&nbsp;null&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;MUST&nbsp;be&nbsp;set&nbsp;to&nbsp;a&nbsp;valid&nbsp;AuthStatus&nbsp;value&nbsp;for&nbsp;secureResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;authStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Co-ordinates&nbsp;calling&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;#secureResponse&nbsp;method,&nbsp;before&nbsp;the&nbsp;Session&nbsp;AuthModule&nbsp;is<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;called&nbsp;(if&nbsp;it&nbsp;is&nbsp;configured).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Any&nbsp;other&nbsp;AuthStatus&nbsp;that&nbsp;AuthStatus.SEND_SUCCESS&nbsp;returned&nbsp;from&nbsp;the&nbsp;configured&nbsp;ServerAuthModules&nbsp;secureResponse<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;method&nbsp;will&nbsp;result&nbsp;in&nbsp;the&nbsp;end&nbsp;of&nbsp;processing&nbsp;and&nbsp;the&nbsp;AuthStatus&nbsp;to&nbsp;be&nbsp;returned.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Possible&nbsp;AuthStatus&nbsp;return&nbsp;values:&nbsp;SEND_SUCCESS,&nbsp;SEND_FAILURE,&nbsp;SEND_CONTINUE.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;authModules&nbsp;The&nbsp;list&nbsp;of&nbsp;configured&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;A&nbsp;contextual&nbsp;object&nbsp;that&nbsp;encapsulates&nbsp;the&nbsp;client&nbsp;request&nbsp;and&nbsp;server&nbsp;response&nbsp;objects.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;Subject&nbsp;that&nbsp;represents&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request,&nbsp;or&nbsp;null.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;as<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;source&nbsp;of&nbsp;Principals&nbsp;or&nbsp;credentials&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;validate&nbsp;the&nbsp;request.&nbsp;If&nbsp;the&nbsp;Subject<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;not&nbsp;null,&nbsp;the&nbsp;method&nbsp;implementation&nbsp;may&nbsp;add&nbsp;additional&nbsp;Principals&nbsp;or&nbsp;credentials<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pertaining&nbsp;to&nbsp;the&nbsp;recipient&nbsp;of&nbsp;the&nbsp;service&nbsp;request)&nbsp;to&nbsp;the&nbsp;Subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;AuthStatus&nbsp;object&nbsp;representing&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing&nbsp;performed&nbsp;by&nbsp;the&nbsp;method.&nbsp;The<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthStatus&nbsp;values&nbsp;that&nbsp;may&nbsp;be&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;are&nbsp;defined&nbsp;as&nbsp;follows:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_SUCCESS&nbsp;when&nbsp;the&nbsp;application&nbsp;response&nbsp;message&nbsp;was&nbsp;successfully&nbsp;secured.&nbsp;The&nbsp;secured<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;response&nbsp;message&nbsp;may&nbsp;be&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_CONTINUE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;the&nbsp;application&nbsp;response&nbsp;message&nbsp;(within&nbsp;messageInfo)&nbsp;was&nbsp;replaced<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;with&nbsp;a&nbsp;security&nbsp;message&nbsp;that&nbsp;should&nbsp;elicit&nbsp;a&nbsp;security-specific&nbsp;response&nbsp;(in&nbsp;the&nbsp;form&nbsp;of&nbsp;a&nbsp;request)&nbsp;from&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;peer.&nbsp;This&nbsp;status&nbsp;value&nbsp;serves&nbsp;to&nbsp;inform&nbsp;the&nbsp;calling&nbsp;runtime&nbsp;that&nbsp;(to&nbsp;successfully&nbsp;complete&nbsp;the&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exchange)&nbsp;it&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;capable&nbsp;of&nbsp;continuing&nbsp;the&nbsp;message&nbsp;dialog&nbsp;by&nbsp;processing&nbsp;at&nbsp;least&nbsp;one&nbsp;additional<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;request/response&nbsp;exchange&nbsp;(after&nbsp;having&nbsp;sent&nbsp;the&nbsp;response&nbsp;message&nbsp;returned&nbsp;in&nbsp;messageInfo).&nbsp;When&nbsp;this&nbsp;status<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;value&nbsp;is&nbsp;returned,&nbsp;the&nbsp;application&nbsp;response&nbsp;must&nbsp;be&nbsp;saved&nbsp;by&nbsp;the&nbsp;authentication&nbsp;module&nbsp;such&nbsp;that&nbsp;it&nbsp;can&nbsp;be<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;recovered&nbsp;when&nbsp;the&nbsp;module's&nbsp;validateRequest&nbsp;message&nbsp;is&nbsp;called&nbsp;to&nbsp;process&nbsp;the&nbsp;elicited&nbsp;response.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;li&amp;gt;AuthStatus.SEND_FAILURE&nbsp;to&nbsp;indicate&nbsp;that&nbsp;a&nbsp;failure&nbsp;occurred&nbsp;while&nbsp;securing&nbsp;the&nbsp;response&nbsp;message&nbsp;and&nbsp;that&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;appropriate&nbsp;failure&nbsp;response&nbsp;message&nbsp;is&nbsp;available&nbsp;by&nbsp;calling&nbsp;getResponseMessage&nbsp;on&nbsp;messageInfo.&amp;lt;/li&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/ul&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;When&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(in&nbsp;messageInfo).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;abstract&nbsp;AuthStatus&nbsp;secureResponse(final&nbsp;List&amp;lt;T&amp;gt;&nbsp;authModules,&nbsp;final&nbsp;MessageInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Remove&nbsp;method&nbsp;specific&nbsp;principals&nbsp;and&nbsp;credentials&nbsp;from&nbsp;the&nbsp;subject&nbsp;by&nbsp;delegating&nbsp;calls&nbsp;to&nbsp;the&nbsp;Session<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;AuthModule&nbsp;and&nbsp;the&nbsp;List&nbsp;of&nbsp;ServerAuthModules.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;A&nbsp;contextual&nbsp;object&nbsp;that&nbsp;encapsulates&nbsp;the&nbsp;client&nbsp;request&nbsp;and&nbsp;server&nbsp;response&nbsp;objects.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;subject&nbsp;The&nbsp;Subject&nbsp;instance&nbsp;from&nbsp;which&nbsp;the&nbsp;Principals&nbsp;and&nbsp;credentials&nbsp;are&nbsp;to&nbsp;be&nbsp;removed.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthException&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;Subject&nbsp;processing.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;final&nbsp;void&nbsp;cleanSubject(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sessionAuthModule&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule.cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(authModules&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ServerAuthModule&nbsp;serverAuthModule&nbsp;:&nbsp;authModules)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverAuthModule.cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextconfigModuleConfigurationFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/ModuleConfigurationFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/ModuleConfigurationFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/ModuleConfigurationFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,60&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.context.config;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;factory&nbsp;which&nbsp;is&nbsp;responsible&nbsp;for&nbsp;getting&nbsp;the&nbsp;ServerAuthModule&nbsp;configuration&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;ModuleConfigurationFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Server&nbsp;Auth&nbsp;Context&nbsp;configuration&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;SERVER_AUTH_CONTEXT_KEY&nbsp;=&nbsp;&amp;quot;serverAuthContext&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Session&nbsp;Auth&nbsp;Module&nbsp;configuration&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;SESSION_MODULE_KEY&nbsp;=&nbsp;&amp;quot;sessionModule&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Server&nbsp;Auth&nbsp;Modules&nbsp;configuration&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;AUTH_MODULES_KEY&nbsp;=&nbsp;&amp;quot;authModules&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Auth&nbsp;Module&nbsp;class&nbsp;name&nbsp;configuration&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;AUTH_MODULE_CLASS_NAME_KEY&nbsp;=&nbsp;&amp;quot;className&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Auth&nbsp;Module&nbsp;properties&nbsp;configuration&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;AUTH_MODULE_PROPERTIES_KEY&nbsp;=&nbsp;&amp;quot;properties&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;configuration,&nbsp;as&nbsp;a&nbsp;{@link&nbsp;JsonValue},&nbsp;which&nbsp;contains&nbsp;all&nbsp;the&nbsp;information&nbsp;to&nbsp;configure&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ServerAuthContext&nbsp;for&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;JsonValue&nbsp;of&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;getConfiguration();<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextconfigpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/config/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;an&nbsp;interface&nbsp;that&nbsp;defines&nbsp;a&nbsp;method&nbsp;of&nbsp;retrieving&nbsp;Jaspi&nbsp;Runtime&nbsp;Auth&nbsp;Module&nbsp;configuration,<br>
+&nbsp;*&nbsp;specifying&nbsp;the&nbsp;ServerAuthModules&nbsp;to&nbsp;use&nbsp;to&nbsp;validate&nbsp;and&nbsp;secure&nbsp;client&nbsp;requests&nbsp;and&nbsp;responses.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime.context.config;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;classes&nbsp;that&nbsp;implement&nbsp;the&nbsp;JASPI&nbsp;context&nbsp;object&nbsp;that&nbsp;provide&nbsp;methods&nbsp;to&nbsp;co-ordinate<br>
+&nbsp;*&nbsp;calls&nbsp;to&nbsp;configured&nbsp;ServerAuthModules&nbsp;instances.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime.context;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimepackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;classes&nbsp;that&nbsp;constitute&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiHttpServletResponseWrapperjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapper.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapper.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapper.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,72&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;javax.servlet.ServletOutputStream;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletResponseWrapper;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.io.PrintWriter;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Response&nbsp;Wrapper&nbsp;to&nbsp;prevent&nbsp;subsequent&nbsp;Servlets&nbsp;closing&nbsp;the&nbsp;response&nbsp;before&nbsp;the&nbsp;JASPI&nbsp;filter&nbsp;has&nbsp;run<br>
+&nbsp;*&nbsp;secureResponse.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.0.3<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiHttpServletResponseWrapper&nbsp;extends&nbsp;HttpServletResponseWrapper&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;PrintWriter&nbsp;writer;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServletOutputStream&nbsp;out;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiHttpServletResponseWrapper.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;underlying&nbsp;HttpServletResponse.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiHttpServletResponseWrapper(final&nbsp;HttpServletResponse&nbsp;response)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lazily&nbsp;initialises&nbsp;the&nbsp;wrapped&nbsp;underlying&nbsp;response&nbsp;output&nbsp;stream.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;java.io.IOException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServletOutputStream&nbsp;getOutputStream()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(out&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;new&nbsp;JaspiServletOutputStream(getResponse().getOutputStream());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;out;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lasily&nbsp;initialises&nbsp;the&nbsp;wrapped&nbsp;underlying&nbsp;response&nbsp;writer.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;java.io.IOException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;PrintWriter&nbsp;getWriter()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(writer&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer&nbsp;=&nbsp;new&nbsp;JaspiPrintWriter(getResponse().getWriter());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;writer;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiPrintWriterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriter.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,37&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;java.io.PrintWriter;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Wrapper&nbsp;around&nbsp;a&nbsp;HttpServletResponse's&nbsp;writer&nbsp;to&nbsp;prevent&nbsp;subsequent&nbsp;Servlets&nbsp;closing&nbsp;the&nbsp;writer&nbsp;before&nbsp;the&nbsp;JASPI<br>
+&nbsp;*&nbsp;filter&nbsp;has&nbsp;run&nbsp;secureResponse.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.0.3<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiPrintWriter&nbsp;extends&nbsp;PrintWriter&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiPrintWriter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;printWriter&nbsp;The&nbsp;underlying&nbsp;PrintWriter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiPrintWriter(final&nbsp;PrintWriter&nbsp;printWriter)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(printWriter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponseJaspiServletOutputStreamjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStream.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStream.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStream.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,61&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyrighted&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;javax.servlet.ServletOutputStream;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Wrapper&nbsp;around&nbsp;a&nbsp;HttpServletResponse's&nbsp;output&nbsp;stream&nbsp;to&nbsp;prevent&nbsp;subsequent&nbsp;Servlets&nbsp;closing&nbsp;the&nbsp;stream&nbsp;before&nbsp;the<br>
+&nbsp;*&nbsp;JASPI&nbsp;filter&nbsp;has&nbsp;run&nbsp;secureResponse.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.0.3<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;JaspiServletOutputStream&nbsp;extends&nbsp;ServletOutputStream&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ServletOutputStream&nbsp;servletOutputStream;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;JaspiServletOutputStream.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;servletOutputStream&nbsp;The&nbsp;underlying&nbsp;ServletOutputStream.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiServletOutputStream(final&nbsp;ServletOutputStream&nbsp;servletOutputStream)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servletOutputStream&nbsp;=&nbsp;servletOutputStream;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Calls&nbsp;write(int)&nbsp;on&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;i&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;java.io.IOException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;write(final&nbsp;int&nbsp;i)&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servletOutputStream.write(i);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Calls&nbsp;close()&nbsp;on&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;java.io.IOException&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servletOutputStream.close();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimeresponsepackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/response/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;classes&nbsp;that&nbsp;prevent&nbsp;the&nbsp;HttpServletResponse&nbsp;from&nbsp;being&nbsp;closed&nbsp;before&nbsp;the&nbsp;JASPI&nbsp;runtime<br>
+&nbsp;*&nbsp;has&nbsp;the&nbsp;chance&nbsp;to&nbsp;secure&nbsp;the&nbsp;response.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsFilterConfigurationjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfiguration.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfiguration.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfiguration.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,52&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
+<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;a&nbsp;method&nbsp;to&nbsp;get&nbsp;an&nbsp;instance&nbsp;of&nbsp;a&nbsp;class&nbsp;by&nbsp;calling&nbsp;a&nbsp;static&nbsp;factory&nbsp;method&nbsp;on&nbsp;a&nbsp;class,&nbsp;which&nbsp;will<br>
+&nbsp;*&nbsp;return&nbsp;the&nbsp;required&nbsp;class,&nbsp;using&nbsp;configuration&nbsp;settings&nbsp;defined&nbsp;in&nbsp;the&nbsp;filter&nbsp;configuration&nbsp;init&nbsp;params.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;FilterConfiguration&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;an&nbsp;instance&nbsp;of&nbsp;a&nbsp;class&nbsp;by&nbsp;calling&nbsp;a&nbsp;static&nbsp;factory&nbsp;method&nbsp;on&nbsp;a&nbsp;class,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;given&nbsp;FilterConfig<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;class&nbsp;to&nbsp;call&nbsp;the&nbsp;factory&nbsp;method&nbsp;on&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;using&nbsp;the&nbsp;given&nbsp;classNameParam,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;similarly&nbsp;the&nbsp;method&nbsp;to&nbsp;call&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;using&nbsp;the&nbsp;given&nbsp;methodNameParam.&nbsp;If&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;methodNameParam&nbsp;is&nbsp;not&nbsp;present&nbsp;on&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;then&nbsp;the&nbsp;method&nbsp;specified&nbsp;in&nbsp;the&nbsp;defaultMethodName&nbsp;will&nbsp;be<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;used&nbsp;instead.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;method&nbsp;to&nbsp;be&nbsp;called&nbsp;will&nbsp;be&nbsp;called&nbsp;firstly&nbsp;with&nbsp;the&nbsp;Filter&nbsp;Config&nbsp;instance&nbsp;as&nbsp;a&nbsp;parameter,&nbsp;and&nbsp;if&nbsp;no&nbsp;method<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exists&nbsp;then&nbsp;it&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;no&nbsp;args.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;config&nbsp;The&nbsp;FilterConfig&nbsp;instance.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;classNameParam&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;class&nbsp;to&nbsp;call&nbsp;the&nbsp;factory&nbsp;method&nbsp;on.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;methodNameParam&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;factory&nbsp;method&nbsp;to&nbsp;call.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;defaultMethodName&nbsp;The&nbsp;default&nbsp;name&nbsp;of&nbsp;the&nbsp;factory&nbsp;method.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;The&nbsp;type&nbsp;of&nbsp;instance&nbsp;that&nbsp;the&nbsp;factory&nbsp;method&nbsp;will&nbsp;return.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;instance&nbsp;that&nbsp;the&nbsp;factory&nbsp;method&nbsp;returns.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ServletException&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;accessing&nbsp;the&nbsp;values&nbsp;in&nbsp;the&nbsp;Filter&nbsp;Config.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&amp;lt;T&amp;gt;&nbsp;T&nbsp;get(final&nbsp;FilterConfig&nbsp;config,&nbsp;final&nbsp;String&nbsp;classNameParam,&nbsp;final&nbsp;String&nbsp;methodNameParam,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;defaultMethodName)&nbsp;throws&nbsp;ServletException;<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsFilterConfigurationImpljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfigurationImpl.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfigurationImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/FilterConfigurationImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,72&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;java.lang.reflect.Method;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;The&nbsp;singleton&nbsp;implementation&nbsp;of&nbsp;the&nbsp;FilterConfiguration&nbsp;interface.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;enum&nbsp;FilterConfigurationImpl&nbsp;implements&nbsp;FilterConfiguration&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;Singleton&nbsp;instance&nbsp;of&nbsp;the&nbsp;FilterConfigurationImpl.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;DebugLogger&nbsp;LOGGER&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@inheritDoc}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&amp;lt;T&amp;gt;&nbsp;T&nbsp;get(final&nbsp;FilterConfig&nbsp;config,&nbsp;final&nbsp;String&nbsp;classNameParam,&nbsp;final&nbsp;String&nbsp;methodNameParam,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;defaultMethodName)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(config&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;for&nbsp;configured&nbsp;connection&nbsp;factory&nbsp;class&nbsp;first.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;className&nbsp;=&nbsp;config.getInitParameter(classNameParam);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(className&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Class&amp;lt;?&amp;gt;&nbsp;cls&nbsp;=&nbsp;Class.forName(className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;tmp&nbsp;=&nbsp;config.getInitParameter(methodNameParam);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;methodName&nbsp;=&nbsp;tmp&nbsp;!=&nbsp;null&nbsp;?&nbsp;tmp&nbsp;:&nbsp;defaultMethodName;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Method&nbsp;factoryMethod&nbsp;=&nbsp;cls.getDeclaredMethod(methodName);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(T)&nbsp;factoryMethod.invoke(null,&nbsp;config);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;IllegalArgumentException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Try&nbsp;no-arg&nbsp;method.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Method&nbsp;factoryMethod&nbsp;=&nbsp;cls.getDeclaredMethod(methodName);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(T)&nbsp;factoryMethod.invoke(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(&amp;quot;Could&nbsp;not&nbsp;construct&nbsp;instance&nbsp;of,&nbsp;&amp;quot;&nbsp;+&nbsp;className,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilsMessageInfoUtilsjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/MessageInfoUtils.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/MessageInfoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/MessageInfoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,75&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;methods&nbsp;that&nbsp;allow&nbsp;working&nbsp;with&nbsp;MessageInfo&nbsp;maps&nbsp;to&nbsp;be&nbsp;simplified.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;MessageInfoUtils&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;map&nbsp;with&nbsp;the&nbsp;given&nbsp;key&nbsp;from&nbsp;the&nbsp;root&nbsp;map&nbsp;in&nbsp;the&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;the&nbsp;map&nbsp;does&nbsp;not&nbsp;exist&nbsp;in&nbsp;the&nbsp;root&nbsp;map&nbsp;of&nbsp;the&nbsp;MessageInfo,&nbsp;the&nbsp;a&nbsp;new&nbsp;{@code&nbsp;&amp;lt;String,&nbsp;Object&amp;gt;}&nbsp;map&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;created&nbsp;an&nbsp;inserted&nbsp;into&nbsp;it,&nbsp;with&nbsp;the&nbsp;given&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;to&nbsp;get&nbsp;the&nbsp;map&nbsp;from.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mapKey&nbsp;The&nbsp;key&nbsp;for&nbsp;the&nbsp;map.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;map&nbsp;that&nbsp;is&nbsp;contained&nbsp;in&nbsp;the&nbsp;MessageInfo&nbsp;map&nbsp;with&nbsp;the&nbsp;given&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;getMap(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;String&nbsp;mapKey)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getMap(messageInfo.getMap(),&nbsp;mapKey);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;map&nbsp;with&nbsp;the&nbsp;given&nbsp;key&nbsp;from&nbsp;the&nbsp;given&nbsp;containing&nbsp;map.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;the&nbsp;map&nbsp;does&nbsp;not&nbsp;exist,&nbsp;a&nbsp;new&nbsp;{@code&nbsp;&amp;lt;String,&nbsp;Object&amp;gt;}&nbsp;map&nbsp;will&nbsp;be&nbsp;created&nbsp;and&nbsp;inserted&nbsp;into&nbsp;the&nbsp;given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;containing&nbsp;map&nbsp;with&nbsp;the&nbsp;given&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;containingMap&nbsp;The&nbsp;map&nbsp;that&nbsp;will&nbsp;contain&nbsp;the&nbsp;map&nbsp;at&nbsp;the&nbsp;given&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mapKey&nbsp;The&nbsp;key&nbsp;for&nbsp;the&nbsp;map.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;map&nbsp;that&nbsp;is&nbsp;contained&nbsp;in&nbsp;the&nbsp;given&nbsp;map&nbsp;with&nbsp;the&nbsp;given&nbsp;key.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;getMap(final&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;containingMap,&nbsp;final&nbsp;String&nbsp;mapKey)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;(Map&amp;lt;String,&nbsp;Object&amp;gt;)&nbsp;containingMap.get(mapKey);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(map&nbsp;==&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containingMap.put(mapKey,&nbsp;map);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;map;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;empty&nbsp;{@code&nbsp;&amp;lt;String,&nbsp;Object&amp;gt;}&nbsp;map&nbsp;in&nbsp;the&nbsp;root&nbsp;map&nbsp;in&nbsp;the&nbsp;MessageInfo.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;MessageInfo&nbsp;to&nbsp;add&nbsp;the&nbsp;map&nbsp;to.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;key&nbsp;The&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;new&nbsp;map.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addMap(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;String&nbsp;key)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getMap(messageInfo,&nbsp;key);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiutilspackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/utils/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;classes&nbsp;that&nbsp;offer&nbsp;utilities&nbsp;functions&nbsp;to&nbsp;the&nbsp;JASPI&nbsp;runtime.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiJaspiRuntimeFilterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/JaspiRuntimeFilterTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/JaspiRuntimeFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/JaspiRuntimeFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,134&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.inject.RuntimeInjector;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.servlet.FilterChain;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;javax.servlet.ServletRequest;<br>
+import&nbsp;javax.servlet.ServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;JaspiRuntimeFilterTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiRuntimeFilter&nbsp;jaspiRuntimeFilter;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RuntimeInjector&nbsp;runtimeInjector;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiRuntime&nbsp;jaspiRuntime;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfiguration&nbsp;filterConfiguration&nbsp;=&nbsp;mock(FilterConfiguration.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtimeInjector&nbsp;=&nbsp;mock(RuntimeInjector.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter&nbsp;=&nbsp;new&nbsp;JaspiRuntimeFilter(filterConfiguration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime&nbsp;=&nbsp;mock(JaspiRuntime.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(runtimeInjector.getInstance(JaspiRuntime.class)).willReturn(jaspiRuntime);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;filterConfig&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(filterConfig),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(runtimeInjector);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter.init(filterConfig);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiRuntimeFilterWithDefaultConstructor()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntimeFilter&nbsp;runtimeFilter&nbsp;=&nbsp;new&nbsp;JaspiRuntimeFilter();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(runtimeFilter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;ServletException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowServletExceptionWhenNotHttpServletRequest()&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletRequest&nbsp;request&nbsp;=&nbsp;mock(ServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter.doFilter(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;ServletException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowServletExceptionWhenNotHttpServletResponse()&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletResponse&nbsp;response&nbsp;=&nbsp;mock(ServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter.doFilter(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessMessage()&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter.doFilter(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(jaspiRuntime).processMessage(request,&nbsp;response,&nbsp;filterChain);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldDestroyFilter()&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntimeFilter.destroy();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextDefaultServerContextFactoryTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/DefaultServerContextFactoryTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/DefaultServerContextFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/DefaultServerContextFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,270&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.ServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValueException;<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyMapOf;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyNoMoreInteractions;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;DefaultServerContextFactoryTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;DefaultServerContextFactory&nbsp;defaultServerContextFactory;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfig&nbsp;config;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterConfiguration&nbsp;=&nbsp;mock(FilterConfiguration.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator&nbsp;=&nbsp;mock(ServerAuthModuleInstanceCreator.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultServerContextFactory&nbsp;=&nbsp;new&nbsp;DefaultServerContextFactory(config,&nbsp;filterConfiguration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateServerContextFactoryUsingStaticFactoryMethod()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;DefaultServerContextFactory.getServerContextFactory(config);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(serverContextFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithNoModules()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;authContext&nbsp;=&nbsp;defaultServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authContext.getClass().isAssignableFrom(FallbackServerAuthContext.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JsonValueException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJsonValueExceptionWhenServerAuthModuleClassNameNotSet()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULES_KEY,&nbsp;JsonValue.array(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;AUTH_ONE_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithAuthModules()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULES_KEY,&nbsp;JsonValue.array(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;AUTH_MODULE_ONE&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;AUTH_ONE_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;AUTH_MODULE_TWO&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;AUTH_TWO_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;AUTH_MODULE_ONE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;AUTH_MODULE_TWO&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;Map&amp;gt;&nbsp;authOnePropsCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(Map.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;Map&amp;gt;&nbsp;authTwoPropsCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(Map.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;AUTH_MODULE_ONE&amp;quot;),&nbsp;authOnePropsCaptor.capture(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;AUTH_MODULE_TWO&amp;quot;),&nbsp;authTwoPropsCaptor.capture(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyNoMoreInteractions(moduleInstanceCreator);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;authOneProps&nbsp;=&nbsp;authOnePropsCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authOneProps.size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authOneProps.containsKey(&amp;quot;PROP&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authOneProps.containsValue(&amp;quot;AUTH_ONE_PROP&amp;quot;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;authTwoProps&nbsp;=&nbsp;authTwoPropsCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authTwoProps.size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authTwoProps.containsKey(&amp;quot;PROP&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authTwoProps.containsValue(&amp;quot;AUTH_TWO_PROP&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithAuthModuleWithNoProperties()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULES_KEY,&nbsp;JsonValue.array(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;AUTH_MODULE_ONE&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;AUTH_MODULE_ONE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(authModuleOne);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;AUTH_MODULE_ONE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJaspiAuthExceptionWhenGivenSingleAuthModuleNotInArray()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULES_KEY,&nbsp;JsonValue.object())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextFallbackServerAuthContextTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/FallbackServerAuthContextTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/FallbackServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/FallbackServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,366&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;FallbackServerAuthContextTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FallbackServerAuthContext&nbsp;fallbackServerAuthContext;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fallbackServerAuthContext&nbsp;=&nbsp;new&nbsp;FallbackServerAuthContext(messageInfoUtils,&nbsp;contextHandler,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnSuccessWhenFirstAuthModuleValidateRequestReturnsSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleOne.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleTwo.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(privateContextMap.containsKey(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(privateContextMap.containsValue(authModuleOne));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnSendSuccessWhenFirstAuthModuleValidateRequestReturnsSendSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleOne.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleTwo.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnSendContinueWhenFirstAuthModuleValidateRequestReturnsSendContinue()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleOne.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleTwo.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnSuccessWhenAuthModulesValidateRequestReturnSendFailureSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleOne.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleTwo.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SUCCESS);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(privateContextMap.containsKey(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(privateContextMap.containsValue(authModuleTwo));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnSendFailureWhenSingleAuthModuleValidateRequestReturnsSendFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModuleOne.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionWhenAuthModuleValidateRequestThrowsAuthException()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(AuthException.class).when(authModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWithNoAuthModules()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.validateRequest(authModules,&nbsp;messageInfo,&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldReturnNullWhenNoAuthModuleValidateRequestSuccessfullyAuthenticated()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateContextMap.put(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNull(authStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldReturnSendSuccessWhenAuthModuleReturnsSendSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.secureResponse(messageInfo,&nbsp;serviceSubject)).willReturn(AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateContextMap.put(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldReturnSendContinueWhenAuthModuleReturnsSendContinue()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.secureResponse(messageInfo,&nbsp;serviceSubject)).willReturn(AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateContextMap.put(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldReturnSendFailureWhenAuthModuleReturnsSendFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.secureResponse(messageInfo,&nbsp;serviceSubject)).willReturn(AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateContextMap.put(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;fallbackServerAuthContext.secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(privateContextMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionWhenAuthModuleSecureResponseThrowsAuthException()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;privateContextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(AuthException.class).when(authModule).secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateContextMap.put(FallbackServerAuthContext.AUTHENTICATING_AUTH_MODULE_KEY,&nbsp;authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;&amp;quot;_serverAuthContextMap&amp;quot;)).willReturn(privateContextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fallbackServerAuthContext.secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspicontextServerAuthModuleInstanceCreatorImplTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImplTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/context/ServerAuthModuleInstanceCreatorImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,176&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.context;<br>
+<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;ServerAuthModuleInstanceCreatorImplTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator&nbsp;=&nbsp;ServerAuthModuleInstanceCreatorImpl.INSTANCE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionIfClassNameNull()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator.construct(null,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionIfClassNameEmpty()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator.construct(&amp;quot;&amp;quot;,&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldConstructServerAuthModule()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;serverAuthModule&nbsp;=&nbsp;moduleInstanceCreator.construct(TestServerAuthModuleOne.class.getName(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(serverAuthModule);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionIfClassNotFound()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator.construct(&amp;quot;INVALID_CLASS_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionIfIllegalAccessExceptionThrown()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator.construct(TestServerAuthModuleTwo.class.getName(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowAuthExceptionIfInstantiationExceptionThrown()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;messagePolicy&nbsp;=&nbsp;mock(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator.construct(TestServerAuthModuleThree.class.getName(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;(),&nbsp;messagePolicy,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;TestServerAuthModuleOne&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialize(MessagePolicy&nbsp;messagePolicy,&nbsp;MessagePolicy&nbsp;messagePolicy2,&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;map)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getSupportedMessageTypes()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject,&nbsp;Subject&nbsp;subject2)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;secureResponse(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanSubject(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;TestServerAuthModuleTwo&nbsp;extends&nbsp;TestServerAuthModuleOne&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestServerAuthModuleTwo()&nbsp;throws&nbsp;IllegalAccessException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalAccessException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;TestServerAuthModuleThree&nbsp;extends&nbsp;TestServerAuthModuleOne&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestServerAuthModuleThree()&nbsp;throws&nbsp;InstantiationException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;InstantiationException();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiexceptionsJaspiAuthExceptionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,113&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.exceptions;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+public&nbsp;class&nbsp;JaspiAuthExceptionTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithThrowable()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessageAndCause()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;CAUSE_MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetCauseMessageWhenOnlyCauseSet()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;CAUSE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessageWhenDetailMessageAndCauseSet()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiloggingLogFactoryTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/LogFactoryTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/LogFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/LogFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,102&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+public&nbsp;class&nbsp;LogFactoryTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setDebugLogger(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDebugLogger()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;exception&nbsp;=&nbsp;mock(Exception.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugLogger&nbsp;debugLogger&nbsp;=&nbsp;LogFactory.getDebug();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(debugLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.debug(&amp;quot;&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.debug(&amp;quot;&amp;quot;,&nbsp;exception);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.error(&amp;quot;&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.error(&amp;quot;&amp;quot;,&nbsp;exception);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.warn(&amp;quot;&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugLogger.warn(&amp;quot;&amp;quot;,&nbsp;exception);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(exception);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSetDebugLogger()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugLogger&nbsp;debugLogger&nbsp;=&nbsp;mock(DebugLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setDebugLogger(debugLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugLogger&nbsp;actualDebug&nbsp;=&nbsp;LogFactory.getDebug();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(actualDebug,&nbsp;debugLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetAuditLogger()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;mock(MessageInfoAuditRecord.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;LogFactory.getAuditLogger();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auditLogger.audit(auditRecord);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(auditRecord);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSetAuditLogger()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;actualAuditLogger&nbsp;=&nbsp;LogFactory.getAuditLogger();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(actualAuditLogger,&nbsp;auditLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiloggingMessageInfoAuditRecordTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/MessageInfoAuditRecordTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/MessageInfoAuditRecordTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/logging/MessageInfoAuditRecordTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,44&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.logging;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.AuthResult;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+<br>
+public&nbsp;class&nbsp;MessageInfoAuditRecordTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateMessageInfoAuditRecord()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthResult&nbsp;authResult&nbsp;=&nbsp;AuthResult.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;new&nbsp;MessageInfoAuditRecord(authResult,&nbsp;messageInfo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeHttpServletCallbackHandlerTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandlerTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletCallbackHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,221&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.Callback;<br>
+import&nbsp;javax.security.auth.callback.UnsupportedCallbackException;<br>
+import&nbsp;javax.security.auth.message.callback.CallerPrincipalCallback;<br>
+import&nbsp;javax.security.auth.message.callback.CertStoreCallback;<br>
+import&nbsp;javax.security.auth.message.callback.GroupPrincipalCallback;<br>
+import&nbsp;javax.security.auth.message.callback.PasswordValidationCallback;<br>
+import&nbsp;javax.security.auth.message.callback.PrivateKeyCallback;<br>
+import&nbsp;javax.security.auth.message.callback.SecretKeyCallback;<br>
+import&nbsp;javax.security.auth.message.callback.TrustStoreCallback;<br>
+import&nbsp;java.security.Principal;<br>
+<br>
+import&nbsp;static&nbsp;junit.framework.Assert.fail;<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotEquals;<br>
+<br>
+public&nbsp;class&nbsp;HttpServletCallbackHandlerTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;HttpServletCallbackHandler&nbsp;callbackHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler&nbsp;=&nbsp;new&nbsp;HttpServletCallbackHandler();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCallerPrincipalCallbackWithCallbackName()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallerPrincipalCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(CallerPrincipalCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Principal&nbsp;principal&nbsp;=&nbsp;mock(Principal.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getSubject()).willReturn(subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getName()).willReturn(&amp;quot;PRN_NAME&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getPrincipal()).willReturn(principal);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().toArray(new&nbsp;Principal[0])[0].getName(),&nbsp;&amp;quot;PRN_NAME&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotEquals(subject.getPrincipals().toArray(new&nbsp;Principal[0])[0],&nbsp;principal);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCallerPrincipalCallbackWithCallbackPrincipal()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallerPrincipalCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(CallerPrincipalCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Principal&nbsp;principal&nbsp;=&nbsp;mock(Principal.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getSubject()).willReturn(subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getName()).willReturn(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getPrincipal()).willReturn(principal);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().toArray(new&nbsp;Principal[0])[0],&nbsp;principal);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCallerPrincipalCallbackWithNoCallbackNameOrPrincipal()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallerPrincipalCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(CallerPrincipalCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getSubject()).willReturn(subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getName()).willReturn(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getPrincipal()).willReturn(null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleGroupPrincipalCallbackWithNoGroups()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GroupPrincipalCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(GroupPrincipalCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getSubject()).willReturn(subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getGroups()).willReturn(null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleGroupPrincipalCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GroupPrincipalCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(GroupPrincipalCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;groupOne&nbsp;=&nbsp;&amp;quot;GROUP_ONE&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;groupTwo&nbsp;=&nbsp;&amp;quot;GROUP_TWO&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;groups&nbsp;=&nbsp;new&nbsp;String[]{groupOne,&nbsp;groupTwo};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getSubject()).willReturn(subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(callbackOne.getGroups()).willReturn(groups);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().size(),&nbsp;2);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().toArray(new&nbsp;Principal[0])[0].getName(),&nbsp;&amp;quot;GROUP_ONE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(subject.getPrincipals().toArray(new&nbsp;Principal[0])[1].getName(),&nbsp;&amp;quot;GROUP_TWO&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;UnsupportedCallbackException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandlePasswordValidationCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PasswordValidationCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(PasswordValidationCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;UnsupportedCallbackException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCertStoreCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CertStoreCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(CertStoreCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;UnsupportedCallbackException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandlePrivateKeyCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKeyCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(PrivateKeyCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;UnsupportedCallbackException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecretKeyCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretKeyCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(SecretKeyCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;UnsupportedCallbackException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleTrustStoreCallback()&nbsp;throws&nbsp;UnsupportedCallbackException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TrustStoreCallback&nbsp;callbackOne&nbsp;=&nbsp;mock(TrustStoreCallback.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callback[]&nbsp;callbacks&nbsp;=&nbsp;new&nbsp;Callback[]{callbackOne};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbackHandler.handle(callbacks);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeHttpServletMessageInfoTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletMessageInfoTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletMessageInfoTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/HttpServletMessageInfoTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,132&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+public&nbsp;class&nbsp;HttpServletMessageInfoTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetRequestMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;returnedRequest&nbsp;=&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(returnedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotEquals(returnedRequest,&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetResponseMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;returnedResponse&nbsp;=&nbsp;messageInfo.getResponseMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(returnedResponse);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotEquals(returnedResponse,&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetMapWithNoMapGivenInConstructor()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;returnedMap&nbsp;=&nbsp;messageInfo.getMap();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(returnedMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(returnedMap.size(),&nbsp;0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSetRequestMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request2&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfo.setRequestMessage(request2);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;returnedRequest&nbsp;=&nbsp;messageInfo.getRequestMessage();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(returnedRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotEquals(returnedRequest,&nbsp;request2);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSetResponseMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response2&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfo.setResponseMessage(response2);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;returnedResponse&nbsp;=&nbsp;messageInfo.getResponseMessage();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(returnedResponse);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotEquals(returnedResponse,&nbsp;response2);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetMapWithMapGivenInConstructor()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletMessageInfo&nbsp;messageInfo&nbsp;=&nbsp;new&nbsp;HttpServletMessageInfo(request,&nbsp;response,&nbsp;map);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;returnedMap&nbsp;=&nbsp;messageInfo.getMap();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(returnedMap,&nbsp;map);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeJaspiRuntimeTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/JaspiRuntimeTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/JaspiRuntimeTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/JaspiRuntimeTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,163&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+*&nbsp;License.<br>
+*<br>
+*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+*<br>
+*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+*<br>
+*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.servlet.FilterChain;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletRequestWrapper;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletResponseWrapper;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.io.PrintWriter;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.anyInt;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.never;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+<br>
+public&nbsp;class&nbsp;JaspiRuntimeTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RuntimeResultHandler&nbsp;runtimeResultHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtimeResultHandler&nbsp;=&nbsp;mock(RuntimeResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessMessageAndPassStraightToChainWhenServerAuthContextNotConfigured()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;new&nbsp;JaspiRuntime(serverAuthContext,&nbsp;runtimeResultHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime.processMessage(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(filterChain).doFilter(request,&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(runtimeResultHandler);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessMessageAndNotCallChainIfValidateRequestIsNotSUCCESS()&nbsp;throws&nbsp;AuthException,&nbsp;IOException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(runtimeResultHandler.handleValidateRequestResult(Matchers.&amp;lt;AuthStatus&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;HttpServletResponse&amp;gt;anyObject())).willReturn(false);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;new&nbsp;JaspiRuntime(serverAuthContext,&nbsp;runtimeResultHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime.processMessage(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(filterChain,&nbsp;never()).doFilter(request,&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(runtimeResultHandler,&nbsp;never()).handleSecureResponseResult(Matchers.&amp;lt;AuthStatus&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;HttpServletResponse&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessMessage()&nbsp;throws&nbsp;AuthException,&nbsp;IOException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(runtimeResultHandler.handleValidateRequestResult(Matchers.&amp;lt;AuthStatus&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;HttpServletResponse&amp;gt;anyObject())).willReturn(true);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;new&nbsp;JaspiRuntime(serverAuthContext,&nbsp;runtimeResultHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime.processMessage(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;HttpServletRequest&amp;gt;&nbsp;requestCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;HttpServletResponse&amp;gt;&nbsp;responseCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(filterChain).doFilter(requestCaptor.capture(),&nbsp;responseCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(runtimeResultHandler).handleSecureResponseResult(Matchers.&amp;lt;AuthStatus&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;HttpServletResponse&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(serverAuthContext).cleanSubject(Matchers.&amp;lt;MessageInfo&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;Subject&amp;gt;anyObject());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(((HttpServletRequestWrapper)&nbsp;requestCaptor.getValue()).getRequest(),&nbsp;request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(((HttpServletResponseWrapper)&nbsp;responseCaptor.getValue()).getResponse(),&nbsp;response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldConvertAuthExceptionToCrestResponseWhenDoFilterFails()&nbsp;throws&nbsp;ServletException,&nbsp;IOException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterChain&nbsp;filterChain&nbsp;=&nbsp;mock(FilterChain.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;writer&nbsp;=&nbsp;mock(PrintWriter.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(AuthException.class).when(serverAuthContext).validateRequest(Matchers.&amp;lt;MessageInfo&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;Subject&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;Subject&amp;gt;anyObject());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(response.getWriter()).willReturn(writer);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;new&nbsp;JaspiRuntime(serverAuthContext,&nbsp;runtimeResultHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiRuntime.processMessage(request,&nbsp;response,&nbsp;filterChain);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setStatus(500);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;String&amp;gt;&nbsp;writerArgumentCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(String.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(writer).write(writerArgumentCaptor.capture(),&nbsp;anyInt(),&nbsp;anyInt());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(writerArgumentCaptor.getValue().contains(&amp;quot;500&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setContentType(&amp;quot;application/json&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeRuntimeResultHandlerTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/RuntimeResultHandlerTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/RuntimeResultHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/RuntimeResultHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,185&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime;<br>
+<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertFalse;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;RuntimeResultHandlerTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RuntimeResultHandler&nbsp;resultHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler&nbsp;=&nbsp;new&nbsp;RuntimeResultHandler();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleValidateRequestWithSuccessAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;result&nbsp;=&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(result);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleValidateRequestWithSendSuccessAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;result&nbsp;=&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertFalse(result);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleValidateRequestWithSendFailureAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;result&nbsp;=&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertFalse(result);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setStatus(401);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleValidateRequestWithSendContinueAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;result&nbsp;=&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertFalse(result);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setStatus(100);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleValidateRequestShouldThrowAuthExceptionWithFailureAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecureResponseWithSendSuccessAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleSecureResponseResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecureResponseWithSendFailureAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleSecureResponseResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setStatus(500);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecureResponseWithSendContinueAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleSecureResponseResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setStatus(100);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecureResponseWithSuccessAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleSecureResponseResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleSecureResponseWithFailureAuthStatus()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultHandler.handleValidateRequestResult(authStatus,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeconfigSessionServerContextFactoryTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactoryTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/SessionServerContextFactoryTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,337&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.context.ServerAuthModuleInstanceCreator;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValueException;<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyMapOf;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyNoMoreInteractions;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;SessionServerContextFactoryTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;SessionServerContextFactory&nbsp;sessionServerContextFactory;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfig&nbsp;config;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterConfiguration&nbsp;=&nbsp;mock(FilterConfiguration.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator&nbsp;=&nbsp;mock(ServerAuthModuleInstanceCreator.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory&nbsp;=&nbsp;new&nbsp;TestSessionServerContextFactory(config,&nbsp;filterConfiguration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJaspiAuthExceptionWhenFailsToGetModuleConfigurationFactory()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(ServletException.class).when(filterConfiguration)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithNoModules()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;authContext&nbsp;=&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(authContext.getClass().isAssignableFrom(TestServerAuthContext.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JsonValueException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJsonValueExceptionWhenSessionModuleClassNameNotSet()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SESSION_MODULE_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;SESSION_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithOnlySessionModule()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SESSION_MODULE_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;SESSION_MODULE&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;SESSION_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(sessionAuthModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;Map&amp;gt;&nbsp;sessionPropsCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(Map.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;sessionPropsCaptor.capture(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyNoMoreInteractions(moduleInstanceCreator);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;sessionProps&nbsp;=&nbsp;sessionPropsCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(sessionProps.size(),&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(sessionProps.containsKey(&amp;quot;PROP&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(sessionProps.containsValue(&amp;quot;SESSION_PROP&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextWithOnlySessionModuleWithNoProperties()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SESSION_MODULE_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;SESSION_MODULE&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(sessionAuthModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyNoMoreInteractions(moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetServerAuthContextAndSetMessagePolicy()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SESSION_MODULE_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;SESSION_MODULE&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;PROP&amp;quot;,&nbsp;&amp;quot;SESSION_PROP&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(moduleInstanceCreator.construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;MessagePolicy&amp;gt;anyObject(),&nbsp;eq(handler))).willReturn(sessionAuthModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;MessagePolicy&amp;gt;&nbsp;messagePolicyCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(MessagePolicy.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(moduleInstanceCreator).construct(eq(&amp;quot;SESSION_MODULE&amp;quot;),&nbsp;anyMapOf(String.class,&nbsp;Object.class),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messagePolicyCaptor.capture(),&nbsp;eq(handler));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.TargetPolicy[]&nbsp;targetPolicies&nbsp;=&nbsp;messagePolicyCaptor.getValue().getTargetPolicies();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(targetPolicies.length,&nbsp;1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(targetPolicies[0].getProtectionPolicy().getID(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy.ProtectionPolicy.AUTHENTICATE_SENDER);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJaspiAuthExceptionWhenGivenArrayOfSessionModules()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler&nbsp;=&nbsp;mock(CallbackHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModuleConfigurationFactory&nbsp;configurationFactory&nbsp;=&nbsp;mock(ModuleConfigurationFactory.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;configuration&nbsp;=&nbsp;JsonValue.json(JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SESSION_MODULE_KEY,&nbsp;JsonValue.array(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;anyString(),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(configurationFactory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(configurationFactory.getConfiguration()).willReturn(configuration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionServerContextFactory.getServerAuthContext(messageInfoUtils,&nbsp;handler,&nbsp;contextHandler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;TestSessionServerContextFactory&nbsp;extends&nbsp;SessionServerContextFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;TestSessionServerContextFactory(final&nbsp;FilterConfig&nbsp;config,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;FilterConfiguration&nbsp;filterConfiguration,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerAuthModuleInstanceCreator&nbsp;moduleInstanceCreator)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(config,&nbsp;filterConfiguration,&nbsp;moduleInstanceCreator);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;ServerAuthContext&nbsp;getServerAuthContext(MessageInfoUtils&nbsp;messageInfoUtils,&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContextHandler&nbsp;contextHandler,&nbsp;JsonValue&nbsp;configuration,&nbsp;ServerAuthModule&nbsp;sessionAuthModule)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;TestServerAuthContext();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;TestServerAuthContext&nbsp;implements&nbsp;ServerAuthContext&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject,&nbsp;Subject&nbsp;subject2)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;secureResponse(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanSubject(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeconfiginjectDefaultRuntimeInjectorTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjectorTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjectorTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/config/inject/DefaultRuntimeInjectorTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,140&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.config.inject;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.auth.common.LoggingConfigurator;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.runtime.config.ServerContextFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.utils.FilterConfiguration;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.config.ServerAuthContext;<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;DefaultRuntimeInjectorTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfig&nbsp;config;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterConfiguration&nbsp;filterConfiguration;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterConfiguration&nbsp;=&nbsp;mock(FilterConfiguration.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateAndAddJaspiRuntimeInstanceToInjectorOnInitialisation()&nbsp;throws&nbsp;ServletException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggingConfigurator&amp;lt;MessageInfo&amp;gt;&nbsp;loggingConfigurator&nbsp;=&nbsp;mock(LoggingConfigurator.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DebugLogger&nbsp;debugLogger&nbsp;=&nbsp;mock(DebugLogger.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(loggingConfigurator.getDebugLogger()).willReturn(debugLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(loggingConfigurator.getAuditLogger()).willReturn(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;mock(ServerContextFactory.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;eq(&amp;quot;context-factory-class&amp;quot;),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverContextFactory);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;eq(&amp;quot;logging-configurator-class&amp;quot;),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(loggingConfigurator);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(serverContextFactory.getServerAuthContext(Matchers.&amp;lt;MessageInfoUtils&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;CallbackHandler&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ContextHandler&amp;gt;anyObject()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverAuthContext);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeInjector&nbsp;injector&nbsp;=&nbsp;new&nbsp;DefaultRuntimeInjector(config,&nbsp;filterConfiguration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;injector.getInstance(JaspiRuntime.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiRuntime);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(LogFactory.getAuditLogger(),&nbsp;auditLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(LogFactory.getDebug(),&nbsp;debugLogger);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateAndAddJaspiRuntimeInstanceToInjectorOnInitialisationWithEmptyLoggingConfigurator()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ServletException,&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;mock(ServerContextFactory.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;eq(&amp;quot;context-factory-class&amp;quot;),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverContextFactory);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(serverContextFactory.getServerAuthContext(Matchers.&amp;lt;MessageInfoUtils&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;CallbackHandler&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ContextHandler&amp;gt;anyObject()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverAuthContext);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeInjector&nbsp;injector&nbsp;=&nbsp;new&nbsp;DefaultRuntimeInjector(config,&nbsp;filterConfiguration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiRuntime&nbsp;jaspiRuntime&nbsp;=&nbsp;injector.getInstance(JaspiRuntime.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiRuntime);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;RuntimeException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;getInstanceShouldThrowRuntimeExceptionIfTypeNotRegistered()&nbsp;throws&nbsp;AuthException,&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContextFactory&nbsp;serverContextFactory&nbsp;=&nbsp;mock(ServerContextFactory.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthContext&nbsp;serverAuthContext&nbsp;=&nbsp;mock(ServerAuthContext.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(filterConfiguration.get(eq(config),&nbsp;eq(&amp;quot;context-factory-class&amp;quot;),&nbsp;anyString(),&nbsp;anyString()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverContextFactory);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(serverContextFactory.getServerAuthContext(Matchers.&amp;lt;MessageInfoUtils&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;CallbackHandler&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ContextHandler&amp;gt;anyObject()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(serverAuthContext);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeInjector&nbsp;injector&nbsp;=&nbsp;new&nbsp;DefaultRuntimeInjector(config,&nbsp;filterConfiguration);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;injector.getInstance(Object.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextContextHandlerTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,397&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.context;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditLogger;<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.AuthResult;<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.logging.LogFactory;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.io.PrintWriter;<br>
+import&nbsp;java.security.Principal;<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyObject;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.never;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;ContextHandlerTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ContextHandler&nbsp;contextHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler&nbsp;=&nbsp;new&nbsp;ContextHandler(messageInfoUtils);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateServerAuthModulesWhenAuthModulesNull()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenDoesNotSupportEither()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.getSupportedMessageTypes()).willReturn(new&nbsp;Class[0]);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenOnlySupportsHttpServletRequest()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.getSupportedMessageTypes()).willReturn(new&nbsp;Class[]{HttpServletRequest.class});<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenOnlySupportsHttpServletResponse()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.getSupportedMessageTypes()).willReturn(new&nbsp;Class[]{HttpServletResponse.class});<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateServerAuthModules()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModule);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(authModule.getSupportedMessageTypes())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(new&nbsp;Class[]{HttpServletRequest.class,&nbsp;HttpServletResponse.class});<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateServerAuthModulesWhenAuthModuleListContainsNullAuthModule()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.validateServerAuthModuleConformToHttpServletProfile(authModules);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCompletionWhenAuthStatusIsNull()&nbsp;throws&nbsp;AuthException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;writer&nbsp;=&nbsp;mock(PrintWriter.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getResponseMessage()).willReturn(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(response.getWriter()).willReturn(writer);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;String&amp;gt;&nbsp;contentCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(String.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(writer).write(contentCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response).setContentType(&amp;quot;application/json&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(contentCaptor.getValue().contains(&amp;quot;401&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(contentCaptor.getValue().contains(&amp;quot;Unauthorized&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCompletionShouldThrowJaspiAuthExceptionWhenAuthStatusIsNullAndWriterThrowsIOException()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;writer&nbsp;=&nbsp;mock(PrintWriter.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getResponseMessage()).willReturn(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(response.getWriter()).willReturn(writer);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(IOException.class).when(writer).write(anyString());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(JaspiAuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(response,&nbsp;never()).setContentType(&amp;quot;application/json&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCompletionWhenAuthStatusIsNotNullAndPrincipalNameNotSet()&nbsp;throws&nbsp;AuthException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;contextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getRequestMessage()).willReturn(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT)).willReturn(contextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(request).setAttribute(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(messageInfo,&nbsp;never()).setRequestMessage(anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldHandleCompletionWhenAuthStatusIsNotNull()&nbsp;throws&nbsp;AuthException,&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;mock(HttpServletRequest.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;contextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Principal&nbsp;principalOne&nbsp;=&nbsp;mock(Principal.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getRequestMessage()).willReturn(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT)).willReturn(contextMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientSubject.getPrincipals().add(principalOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(principalOne.getName()).willReturn(&amp;quot;PRN_ONE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(request).setAttribute(JaspiRuntime.ATTRIBUTE_AUTH_PRINCIPAL,&nbsp;&amp;quot;PRN_ONE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(request).setAttribute(JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT,&nbsp;contextMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusSuccess()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusSendSuccess()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusSendContinue()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusSendFailure()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusFailure()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;AuthStatus.FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAuditWhenAuthStatusNull()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditLogger&amp;lt;MessageInfo&amp;gt;&nbsp;auditLogger&nbsp;=&nbsp;mock(AuditLogger.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogFactory.setAuditLogger(auditLogger);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler.audit(messageInfo,&nbsp;authStatus);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord&nbsp;=&nbsp;auditRecordCaptor.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuditObject(),&nbsp;messageInfo);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecord.getAuthResult(),&nbsp;AuthResult.FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,743&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.context;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.eq;<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.never;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.anyListOf;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;JaspiServerAuthContextTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ContextHandler&nbsp;contextHandler;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoUtils&nbsp;=&nbsp;mock(MessageInfoUtils.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextHandler&nbsp;=&nbsp;mock(ContextHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;createJaspiServerAuthContext(ServerAuthModule&nbsp;sessionAuthModule,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules,&nbsp;final&nbsp;AuthStatus&nbsp;validateRequestAuthStatus,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthStatus&nbsp;secureResponseAuthStatus)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;(messageInfoUtils,&nbsp;contextHandler,&nbsp;sessionAuthModule,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AuthStatus&nbsp;validateRequest(List&nbsp;authModules,&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;validateRequestAuthStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AuthStatus&nbsp;secureResponse(List&nbsp;authModules,&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;secureResponseAuthStatus;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiServerAuthContextWithNoSessionAuthModuleAndEmptyListOfAuthModules()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiServerAuthContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiServerAuthContextWithNoSessionAuthModuleAndNullListOfAuthModules()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiServerAuthContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiServerAuthContext()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiServerAuthContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowJaspiAuthExceptionWhenAuthModuleDoesNotConformToHttpServletProfile()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doThrow(AuthException.class).when(contextHandler)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.validateServerAuthModuleConformToHttpServletProfile(anyListOf(ServerAuthModule.class));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createJaspiServerAuthContext(sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetMessageInfoUtils()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfoUtils&nbsp;actualMessageInfoUtils&nbsp;=&nbsp;jaspiServerAuthContext.getMessageInfoUtils();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(actualMessageInfoUtils,&nbsp;messageInfoUtils);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithNoAuthModules()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SUCCESS,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(messageInfoUtils).addMap(messageInfo,&nbsp;JaspiRuntime.ATTRIBUTE_AUTH_CONTEXT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithOnlySessionModuleSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SUCCESS);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithOnlySessionModuleSendSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_SUCCESS);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithOnlySessionModuleSendContinue()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_CONTINUE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenSessionModuleReturnsInvalidAuthStatus()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(JaspiAuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithOnlySessionModuleSendFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SEND_FAILURE,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;contextMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfoUtils.getMap(messageInfo,&nbsp;JaspiServerAuthContext.PRIVATE_CONTEXT_MAP_KEY))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(contextMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).audit(messageInfo,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenAuthModulesReturnNull()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(JaspiAuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenAuthModulesReturnFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.FAILURE,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(JaspiAuthException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;e;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldNotAuditWhenAuthModulesReturnSendContinue()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SEND_CONTINUE,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler,&nbsp;never()).audit(eq(messageInfo),&nbsp;Matchers.&amp;lt;AuthStatus&amp;gt;anyObject());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_CONTINUE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldAuditWhenAuthModulesReturnSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SUCCESS,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).audit(messageInfo,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldAuditWhenAuthModulesReturnSendSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SEND_SUCCESS,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).audit(messageInfo,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldAuditWhenAuthModulesReturnSendFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SEND_FAILURE,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).audit(messageInfo,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldValidateRequestWithNoSessionModuleAndWhenAuthModulesReturnSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;AuthStatus.SUCCESS,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.validateRequest(messageInfo,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).handleCompletion(messageInfo,&nbsp;clientSubject,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(contextHandler).audit(messageInfo,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldThrowJaspiAuthExceptionWhenAuthModulesReturnSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldThrowJaspiAuthExceptionWhenAuthModulesReturnFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;AuthStatus.FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSecureResponseWhenAuthModulesReturnSendSuccessWithNoSessionAuthModule()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSecureResponseWhenAuthModulesReturnNullWithSessionAuthModule()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.secureResponse(messageInfo,&nbsp;serviceSubject)).willReturn(AuthStatus.SEND_SUCCESS);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSecureResponseWhenAuthModulesReturnSendSuccessAndSessionModuleReturnsSendFailure()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(sessionAuthModule.secureResponse(messageInfo,&nbsp;serviceSubject)).willReturn(AuthStatus.SEND_FAILURE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;jaspiServerAuthContext.secureResponse(messageInfo,&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCleanSubjectWithNoSessionAuthModuleAndNullAuthModules()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.cleanSubject(messageInfo,&nbsp;subject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCleanSubjectWithOnlySessionAuthModuleConfigured()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;null;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.cleanSubject(messageInfo,&nbsp;subject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCleanSubjectWithOnlyAuthModulesConfigured()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.cleanSubject(messageInfo,&nbsp;subject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(authModuleOne).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(authModuleTwo).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCleanSubject()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;sessionAuthModule&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleOne&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAuthModule&nbsp;authModuleTwo&nbsp;=&nbsp;mock(ServerAuthModule.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;ServerAuthModule&amp;gt;&nbsp;authModules&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;ServerAuthModule&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleOne);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authModules.add(authModuleTwo);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiServerAuthContext&amp;lt;ServerAuthModule&amp;gt;&nbsp;jaspiServerAuthContext&nbsp;=&nbsp;createJaspiServerAuthContext(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionAuthModule,&nbsp;authModules,&nbsp;null,&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;subject&nbsp;=&nbsp;new&nbsp;Subject();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jaspiServerAuthContext.cleanSubject(messageInfo,&nbsp;subject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(sessionAuthModule).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(authModuleOne).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(authModuleTwo).cleanSubject(messageInfo,&nbsp;subject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiHttpServletResponseWrapperTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapperTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapperTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiHttpServletResponseWrapperTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,62&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.servlet.ServletOutputStream;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.io.PrintWriter;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+<br>
+public&nbsp;class&nbsp;JaspiHttpServletResponseWrapperTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetOutputStream()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiHttpServletResponseWrapper&nbsp;responseWrapper&nbsp;=&nbsp;new&nbsp;JaspiHttpServletResponseWrapper(response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletOutputStream&nbsp;outputStream&nbsp;=&nbsp;responseWrapper.getOutputStream();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(JaspiServletOutputStream.class.isAssignableFrom(outputStream.getClass()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetWriter()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;mock(HttpServletResponse.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiHttpServletResponseWrapper&nbsp;responseWrapper&nbsp;=&nbsp;new&nbsp;JaspiHttpServletResponseWrapper(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;printWriter&nbsp;=&nbsp;mock(PrintWriter.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(response.getWriter()).willReturn(printWriter);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;writer&nbsp;=&nbsp;responseWrapper.getWriter();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(JaspiPrintWriter.class.isAssignableFrom(writer.getClass()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiPrintWriterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriterTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiPrintWriterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,40&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;java.io.PrintWriter;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+public&nbsp;class&nbsp;JaspiPrintWriterTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiPrintWriter()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintWriter&nbsp;printWriter&nbsp;=&nbsp;mock(PrintWriter.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiPrintWriter&nbsp;jaspiPrintWriter&nbsp;=&nbsp;new&nbsp;JaspiPrintWriter(printWriter);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(jaspiPrintWriter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimeresponseJaspiServletOutputStreamTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStreamTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStreamTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/response/JaspiServletOutputStreamTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,65&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.runtime.response;<br>
+<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.servlet.ServletOutputStream;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
+<br>
+public&nbsp;class&nbsp;JaspiServletOutputStreamTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JaspiServletOutputStream&nbsp;servletOutputStream;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServletOutputStream&nbsp;outputStream;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputStream&nbsp;=&nbsp;mock(ServletOutputStream.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servletOutputStream&nbsp;=&nbsp;new&nbsp;JaspiServletOutputStream(outputStream);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldWrite()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servletOutputStream.write(1);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(outputStream).write(1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldClose()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servletOutputStream.close();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(outputStream).close();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiutilsFilterConfigurationImplTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/FilterConfigurationImplTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/FilterConfigurationImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/FilterConfigurationImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,237&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.servlet.FilterConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNull;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
+import&nbsp;static&nbsp;org.testng.Assert.fail;<br>
+<br>
+public&nbsp;class&nbsp;FilterConfigurationImplTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnNullWhenFilterConfigIsNull()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNull(obj);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReturnNullWhenClassNameParamNotSet()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNull(obj);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;ServletException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldThrowServletExceptionWhenClassNotFound()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;&amp;quot;CLASS_NOT_FOUND&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;ServletException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldServletExceptionWhenMethodNameParamNotSetAndDefaultMethodNotOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestOne.class.getName();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;ServletException.class)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldServletExceptionWhenMethodNameParamSetButNotOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestOne.class.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodName&nbsp;=&nbsp;&amp;quot;METHOD_NOT_ON_CLASS&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(methodNameParam)).willReturn(methodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetInstanceWhenMethodNameParamNotSetAndNoArgsDefaultMethodOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestTwo.class.getName();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(obj.getClass().isAssignableFrom(FilterConfigurationTestTwo.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldServletExceptionWhenMethodNameParamSetAndNoArgsMethodOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestThree.class.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodName&nbsp;=&nbsp;&amp;quot;customMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(methodNameParam)).willReturn(methodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(obj.getClass().isAssignableFrom(FilterConfigurationTestThree.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetInstanceWhenMethodNameParamNotSetAndArgsDefaultMethodOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestTwo.class.getName();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(obj.getClass().isAssignableFrom(FilterConfigurationTestTwo.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldServletExceptionWhenMethodNameParamSetAndArgsMethodOnClass()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilterConfig&nbsp;config&nbsp;=&nbsp;mock(FilterConfig.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classNameParam&nbsp;=&nbsp;&amp;quot;CLASS_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodNameParam&nbsp;=&nbsp;&amp;quot;METHOD_NAME_PARAM&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultMethodName&nbsp;=&nbsp;&amp;quot;defaultMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;className&nbsp;=&nbsp;FilterConfigurationTestThree.class.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;methodName&nbsp;=&nbsp;&amp;quot;customMethodName&amp;quot;;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(classNameParam)).willReturn(className);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(config.getInitParameter(methodNameParam)).willReturn(methodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;obj&nbsp;=&nbsp;FilterConfigurationImpl.INSTANCE.get(config,&nbsp;classNameParam,&nbsp;methodNameParam,&nbsp;defaultMethodName);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(obj.getClass().isAssignableFrom(FilterConfigurationTestThree.class));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;FilterConfigurationTestOne&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;FilterConfigurationTestTwo&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Object&nbsp;defaultMethodName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;FilterConfigurationTestThree&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Object&nbsp;customMethodName()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;FilterConfigurationTestFour&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Object&nbsp;defaultMethodName(FilterConfig&nbsp;config)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;FilterConfigurationTestFive&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Object&nbsp;customMethodName(FilterConfig&nbsp;config)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiutilsMessageInfoUtilsTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/MessageInfoUtilsTest.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/MessageInfoUtilsTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/utils/MessageInfoUtilsTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,92&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.utils;<br>
+<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;java.util.HashMap;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+public&nbsp;class&nbsp;MessageInfoUtilsTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoUtils&nbsp;=&nbsp;new&nbsp;MessageInfoUtils();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetNewMap()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;mapKey&nbsp;=&nbsp;&amp;quot;MAP_KEY&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;messageInfoMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getMap()).willReturn(messageInfoMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;messageInfoUtils.getMap(messageInfo,&nbsp;mapKey);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(map);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetExistingMap()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;mapKey&nbsp;=&nbsp;&amp;quot;MAP_KEY&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;messageInfoMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;expectedMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getMap()).willReturn(messageInfoMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoMap.put(mapKey,&nbsp;expectedMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;map&nbsp;=&nbsp;messageInfoUtils.getMap(messageInfo,&nbsp;mapKey);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(map,&nbsp;expectedMap);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;should()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;mock(MessageInfo.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;mapKey&nbsp;=&nbsp;&amp;quot;MAP_KEY&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;messageInfoMap&nbsp;=&nbsp;new&nbsp;HashMap&amp;lt;String,&nbsp;Object&amp;gt;();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(messageInfo.getMap()).willReturn(messageInfoMap);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfoUtils.addMap(messageInfo,&nbsp;mapKey);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserverpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/pom.xml&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,57&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.3.0-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-test-server&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;JASPI&nbsp;(JSR-196)&nbsp;Test&nbsp;Server&amp;lt;/name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;need&nbsp;to&nbsp;a&nbsp;build&nbsp;config&nbsp;to&nbsp;not&nbsp;deploy&nbsp;this&nbsp;module&nbsp;--&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;build&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;finalName&amp;gt;jaspi&amp;lt;/finalName&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;maven-install-plugin&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;skip&amp;gt;true&amp;lt;/skip&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;maven-deploy-plugin&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;skip&amp;gt;true&amp;lt;/skip&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/configuration&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugin&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/plugins&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/build&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource-servlet&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${forgerock-rest.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverConnectionFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/ConnectionFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/ConnectionFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/ConnectionFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,41&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.test.server.endpoint.EndpointResource;<br>
+import&nbsp;org.forgerock.jaspi.test.server.endpoint.ModuleConfigurationResource;<br>
+import&nbsp;org.forgerock.json.resource.Resources;<br>
+import&nbsp;org.forgerock.json.resource.Router;<br>
+<br>
+import&nbsp;javax.servlet.ServletException;<br>
+<br>
+public&nbsp;class&nbsp;ConnectionFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;org.forgerock.json.resource.ConnectionFactory&nbsp;getConnectionFactory()&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/configure&amp;quot;,&nbsp;ModuleConfigurationResource.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/endpoint&amp;quot;,&nbsp;new&nbsp;EndpointResource());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/status&amp;quot;,&nbsp;new&nbsp;StatusResource());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Resources.newInternalConnectionFactory(router);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverStatusResourcejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/StatusResource.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/StatusResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/StatusResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,51&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
+import&nbsp;org.forgerock.json.resource.PatchRequest;<br>
+import&nbsp;org.forgerock.json.resource.ReadRequest;<br>
+import&nbsp;org.forgerock.json.resource.Resource;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.forgerock.json.resource.ResultHandler;<br>
+import&nbsp;org.forgerock.json.resource.ServerContext;<br>
+import&nbsp;org.forgerock.json.resource.SingletonResourceProvider;<br>
+import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
+<br>
+public&nbsp;class&nbsp;StatusResource&nbsp;implements&nbsp;SingletonResourceProvider&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;actionInstance(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;patchInstance(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;readInstance(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleResult(new&nbsp;Resource(&amp;quot;Status&amp;quot;,&nbsp;&amp;quot;0&amp;quot;,&nbsp;JsonValue.json(JsonValue.object(JsonValue.field(&amp;quot;State&amp;quot;,&nbsp;&amp;quot;READY&amp;quot;)))));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;updateInstance(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverTestLoggingConfiguratorjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/TestLoggingConfigurator.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/TestLoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/TestLoggingConfigurator.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,80&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server;<br>
+<br>
+import&nbsp;org.forgerock.auth.common.AuditRecord;<br>
+import&nbsp;org.forgerock.auth.common.AuthResult;<br>
+import&nbsp;org.forgerock.auth.common.DebugLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.JaspiAuditLogger;<br>
+import&nbsp;org.forgerock.jaspi.logging.JaspiLoggingConfigurator;<br>
+<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+<br>
+public&nbsp;class&nbsp;TestLoggingConfigurator&nbsp;implements&nbsp;JaspiLoggingConfigurator&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;JaspiLoggingConfigurator&nbsp;getLoggingConfigurator()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;TestLoggingConfigurator();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DebugLogger&nbsp;getDebugLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;DebugLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;trace(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;trace(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;debug(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;debug(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;error(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;error(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;warn(String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;warn(String&nbsp;message,&nbsp;Throwable&nbsp;t)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuditLogger&nbsp;getAuditLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;JaspiAuditLogger()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;audit(AuditRecord&amp;lt;MessageInfo&amp;gt;&nbsp;auditRecord)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthResult&nbsp;authResult&nbsp;=&nbsp;auditRecord.getAuthResult();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageInfo&nbsp;messageInfo&nbsp;=&nbsp;auditRecord.getAuditObject();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointAbstractEndpointjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/AbstractEndpoint.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/AbstractEndpoint.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/AbstractEndpoint.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,64&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint;<br>
+<br>
+import&nbsp;org.codehaus.jackson.JsonGenerator;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+import&nbsp;javax.servlet.Servlet;<br>
+import&nbsp;javax.servlet.ServletConfig;<br>
+import&nbsp;javax.servlet.ServletException;<br>
+import&nbsp;javax.servlet.ServletRequest;<br>
+import&nbsp;javax.servlet.ServletResponse;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+public&nbsp;abstract&nbsp;class&nbsp;AbstractEndpoint&nbsp;implements&nbsp;Servlet&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;init(ServletConfig&nbsp;servletConfig)&nbsp;throws&nbsp;ServletException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ServletConfig&nbsp;getServletConfig()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;service(ServletRequest&nbsp;servletRequest,&nbsp;ServletResponse&nbsp;servletResponse)&nbsp;throws&nbsp;ServletException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;servletRequest;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;(HttpServletResponse)&nbsp;servletResponse;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonGenerator&nbsp;writer&nbsp;=&nbsp;EndpointUtils.getJsonGenerator(request,&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.writeObject(getJson());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;abstract&nbsp;JsonValue&nbsp;getJson();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getServletInfo()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;destroy()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointEndpointResourcejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointResource.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,52&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
+import&nbsp;org.forgerock.json.resource.PatchRequest;<br>
+import&nbsp;org.forgerock.json.resource.ReadRequest;<br>
+import&nbsp;org.forgerock.json.resource.Resource;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.forgerock.json.resource.ResultHandler;<br>
+import&nbsp;org.forgerock.json.resource.ServerContext;<br>
+import&nbsp;org.forgerock.json.resource.SingletonResourceProvider;<br>
+import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
+<br>
+public&nbsp;class&nbsp;EndpointResource&nbsp;implements&nbsp;SingletonResourceProvider&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;actionInstance(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;patchInstance(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;readInstance(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue&nbsp;json&nbsp;=&nbsp;JsonValue.json(JsonValue.object(JsonValue.field(&amp;quot;State&amp;quot;,&nbsp;&amp;quot;AVAILABLE&amp;quot;)));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleResult(new&nbsp;Resource(&amp;quot;Endpoint&amp;quot;,&nbsp;&amp;quot;0&amp;quot;,&nbsp;json));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;updateInstance(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointEndpointUtilsjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointUtils.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/EndpointUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,86&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint;<br>
+<br>
+import&nbsp;org.codehaus.jackson.JsonGenerator;<br>
+import&nbsp;org.codehaus.jackson.map.ObjectMapper;<br>
+import&nbsp;org.forgerock.json.resource.BadRequestException;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+public&nbsp;class&nbsp;EndpointUtils&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;String&nbsp;PARAM_PRETTY_PRINT&nbsp;=&nbsp;&amp;quot;_prettyPrint&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;ObjectMapper&nbsp;JSON_MAPPER&nbsp;=&nbsp;new&nbsp;ObjectMapper();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;JsonGenerator&nbsp;getJsonGenerator(final&nbsp;HttpServletRequest&nbsp;req,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpServletResponse&nbsp;resp)&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;JsonGenerator&nbsp;writer&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSON_MAPPER.getJsonFactory().createJsonGenerator(resp.getOutputStream());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.configure(JsonGenerator.Feature.AUTO_CLOSE_TARGET,&nbsp;false);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Enable&nbsp;pretty&nbsp;printer&nbsp;if&nbsp;requested.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String[]&nbsp;values&nbsp;=&nbsp;getParameter(req,&nbsp;PARAM_PRETTY_PRINT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(values&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(asBooleanValue(PARAM_PRETTY_PRINT,&nbsp;values))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.useDefaultPrettyPrinter();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;ResourceException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ignore&nbsp;because&nbsp;we&nbsp;may&nbsp;be&nbsp;trying&nbsp;to&nbsp;obtain&nbsp;a&nbsp;generator&nbsp;in<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;order&nbsp;to&nbsp;output&nbsp;an&nbsp;error.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;writer;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;String[]&nbsp;getParameter(final&nbsp;HttpServletRequest&nbsp;req,&nbsp;final&nbsp;String&nbsp;parameter)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Need&nbsp;to&nbsp;do&nbsp;case-insensitive&nbsp;matching.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;String[]&amp;gt;&nbsp;parameterMap&nbsp;=&nbsp;(Map&amp;lt;String,&nbsp;String[]&amp;gt;)&nbsp;req.getParameterMap();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;Map.Entry&amp;lt;String,&nbsp;String[]&amp;gt;&nbsp;p&nbsp;:&nbsp;parameterMap.entrySet())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(p.getKey().equalsIgnoreCase(parameter))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p.getValue();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;boolean&nbsp;asBooleanValue(final&nbsp;String&nbsp;name,&nbsp;final&nbsp;String[]&nbsp;values)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;value&nbsp;=&nbsp;asSingleValue(name,&nbsp;values);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Boolean.parseBoolean(value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;String&nbsp;asSingleValue(final&nbsp;String&nbsp;name,&nbsp;final&nbsp;String[]&nbsp;values)&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(values&nbsp;==&nbsp;null&nbsp;||&nbsp;values.length&nbsp;==&nbsp;0)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;i18n.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;BadRequestException(&amp;quot;No&nbsp;values&nbsp;provided&nbsp;for&nbsp;the&nbsp;request&nbsp;parameter&nbsp;\'&amp;quot;&nbsp;+&nbsp;name<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;\'&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(values.length&nbsp;&amp;gt;&nbsp;1)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;i18n.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;BadRequestException(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Multiple&nbsp;values&nbsp;provided&nbsp;for&nbsp;the&nbsp;single-valued&nbsp;request&nbsp;parameter&nbsp;\'&amp;quot;&nbsp;+&nbsp;name<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;\'&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;values[0];<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointModuleConfigurationResourcejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/ModuleConfigurationResource.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/ModuleConfigurationResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/ModuleConfigurationResource.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,75&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
+import&nbsp;org.forgerock.json.resource.PatchRequest;<br>
+import&nbsp;org.forgerock.json.resource.ReadRequest;<br>
+import&nbsp;org.forgerock.json.resource.Resource;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.forgerock.json.resource.ResultHandler;<br>
+import&nbsp;org.forgerock.json.resource.ServerContext;<br>
+import&nbsp;org.forgerock.json.resource.SingletonResourceProvider;<br>
+import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
+<br>
+import&nbsp;java.util.HashMap;<br>
+<br>
+public&nbsp;enum&nbsp;ModuleConfigurationResource&nbsp;implements&nbsp;SingletonResourceProvider,&nbsp;ModuleConfigurationFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JsonValue&nbsp;moduleConfiguration&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.json(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(ModuleConfigurationFactory.AUTH_MODULES_KEY,&nbsp;JsonValue.array())<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;ModuleConfigurationFactory&nbsp;getModuleConfigurationFactory()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ModuleConfigurationResource.INSTANCE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JsonValue&nbsp;getConfiguration()&nbsp;{//TODO&nbsp;define&nbsp;exception&nbsp;that&nbsp;can&nbsp;be&nbsp;thrown???<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;moduleConfiguration;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;readInstance(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleResult(new&nbsp;Resource(&amp;quot;ModuleConfiguration&amp;quot;,&nbsp;&amp;quot;0&amp;quot;,&nbsp;moduleConfiguration));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;updateInstance(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleConfiguration&nbsp;=&nbsp;request.getNewContent();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleResult(new&nbsp;Resource(&amp;quot;ModuleConfiguration&amp;quot;,&nbsp;&amp;quot;0&amp;quot;,&nbsp;moduleConfiguration));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;actionInstance(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;patchInstance(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(ResourceException.getException(ResourceException.NOT_SUPPORTED));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointoneEndpointModuleConfigurationFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointModuleConfigurationFactory.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointModuleConfigurationFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointModuleConfigurationFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,57&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint.one;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.config.ModuleConfigurationFactory;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+public&nbsp;class&nbsp;EndpointModuleConfigurationFactory&nbsp;implements&nbsp;ModuleConfigurationFactory&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;ModuleConfigurationFactory&nbsp;getModuleConfigurationFactory()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;EndpointModuleConfigurationFactory();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JsonValue&nbsp;getConfiguration()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;JsonValue.json(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(SERVER_AUTH_CONTEXT_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(SESSION_MODULE_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;org.forgerock.jaspi.web.SessionAuthModule&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;keyAlias&amp;quot;,&nbsp;&amp;quot;openidm-localhost&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULES_KEY,&nbsp;JsonValue.array(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;org.forgerock.jaspi.web.AuthModuleOne&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;passThroughAuth&amp;quot;,&nbsp;&amp;quot;system/AD/account&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_CLASS_NAME_KEY,&nbsp;&amp;quot;org.forgerock.jaspi.web.AuthModuleTwo&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(AUTH_MODULE_PROPERTIES_KEY,&nbsp;JsonValue.object(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JsonValue.field(&amp;quot;passThroughAuth&amp;quot;,&nbsp;&amp;quot;system/AD/account&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestserverendpointoneEndpointOnejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointOne.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointOne.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/endpoint/one/EndpointOne.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,28&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.endpoint.one;<br>
+<br>
+import&nbsp;org.forgerock.jaspi.test.server.endpoint.AbstractEndpoint;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+<br>
+public&nbsp;class&nbsp;EndpointOne&nbsp;extends&nbsp;AbstractEndpoint&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;JsonValue&nbsp;getJson()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;JsonValue.json(JsonValue.object(JsonValue.field(&amp;quot;Endpoint&amp;quot;,&nbsp;&amp;quot;One&amp;quot;)));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesAuthModuleOnejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleOne.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleOne.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleOne.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,94&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.modules;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+public&nbsp;class&nbsp;AuthModuleOne&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialize(MessagePolicy&nbsp;requestPolicy,&nbsp;MessagePolicy&nbsp;responsePolicy,&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;options)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getSupportedMessageTypes()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Class[]{HttpServletRequest.class,&nbsp;HttpServletResponse.class};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject,&nbsp;Subject&nbsp;serviceSubject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Auth1-Validate-Request&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Auth1-Validate-Request&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;secureResponse(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Auth1-Secure-Response&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Auth1-Secure-Response&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanSubject(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesAuthModuleTwojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleTwo.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleTwo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/AuthModuleTwo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,94&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*&nbsp;<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.modules;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+public&nbsp;class&nbsp;AuthModuleTwo&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialize(MessagePolicy&nbsp;requestPolicy,&nbsp;MessagePolicy&nbsp;responsePolicy,&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;options)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getSupportedMessageTypes()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Class[]{HttpServletRequest.class,&nbsp;HttpServletResponse.class};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject,&nbsp;Subject&nbsp;serviceSubject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Auth2-Validate-Request&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Auth2-Validate-Request&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;secureResponse(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Auth2-Secure-Response&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Auth2-Secure-Response&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanSubject(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainjavaorgforgerockjaspitestservermodulesSessionModulejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/SessionModule.java&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/SessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/java/org/forgerock/jaspi/test/server/modules/SessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,94&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.jaspi.test.server.modules;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessageInfo;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
+import&nbsp;javax.servlet.http.HttpServletRequest;<br>
+import&nbsp;javax.servlet.http.HttpServletResponse;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+public&nbsp;class&nbsp;SessionModule&nbsp;implements&nbsp;ServerAuthModule&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialize(MessagePolicy&nbsp;requestPolicy,&nbsp;MessagePolicy&nbsp;responsePolicy,&nbsp;CallbackHandler&nbsp;handler,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;options)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getSupportedMessageTypes()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Class[]{HttpServletRequest.class,&nbsp;HttpServletResponse.class};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject,&nbsp;Subject&nbsp;serviceSubject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Session-Validate-Request&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Session-Validate-Request&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;secureResponse(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;messageInfo.getRequestMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;header&nbsp;=&nbsp;request.getHeader(&amp;quot;X-Jaspi-Session-Secure-Response&amp;quot;.toLowerCase());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_SUCCESS&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_SUCCESS;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_FAILURE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&amp;quot;SEND_CONTINUE&amp;quot;.equalsIgnoreCase(header))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_CONTINUE;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthException(&amp;quot;X-Jaspi-Session-Secure-Response&nbsp;header&nbsp;not&nbsp;set,&nbsp;so&nbsp;throwing&nbsp;AuthException.&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanSubject(MessageInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;subject)&nbsp;throws&nbsp;AuthException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterforgerockjaspitestserversrcmainwebappWEBINFwebxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/WEB-INF/web.xml&nbsp;(0&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/WEB-INF/web.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/forgerock-jaspi-test-server/src/main/webapp/WEB-INF/web.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,43&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;web-app&nbsp;version=&amp;quot;2.4&amp;quot;&nbsp;xmlns=&amp;quot;http://java.sun.com/xml/ns/j2ee&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://java.sun.com/xml/ns/j2ee&nbsp;http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&amp;quot;&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;display-name&amp;gt;JASPI&nbsp;Test&nbsp;Server&amp;lt;/display-name&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-name&amp;gt;EndpointJaspiRuntimeFilter&amp;lt;/filter-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-class&amp;gt;org.forgerock.jaspi.JaspiRuntimeFilter&amp;lt;/filter-class&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;init-param&amp;gt;--&amp;gt;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;write&nbsp;test&nbsp;which&nbsp;tests&nbsp;that&nbsp;can&nbsp;change&nbsp;the&nbsp;context&nbsp;factory&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;param-name&amp;gt;context-factory-class&amp;lt;/param-name&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;param-value&amp;gt;org.forgerock.jaspi.context.DefaultServerContextFactory&amp;lt;/param-value&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&amp;lt;/init-param&amp;gt;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;logging-configurator-class&amp;lt;/param-name&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO&nbsp;update&nbsp;Loggers&nbsp;so&nbsp;as&nbsp;can&nbsp;test&nbsp;that&nbsp;they&nbsp;are&nbsp;being&nbsp;called&nbsp;when&nbsp;expected&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.TestLoggingConfigurator&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;module-configuration-factory-class&amp;lt;/param-name&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Test&nbsp;all&nbsp;posible&nbsp;incorrect&nbsp;configurations,&nbsp;etc&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.endpoint.ModuleConfigurationResource&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/filter&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-mapping&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;filter-name&amp;gt;EndpointJaspiRuntimeFilter&amp;lt;/filter-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;url-pattern&amp;gt;/endpoint/*&amp;lt;/url-pattern&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/filter-mapping&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-name&amp;gt;Endpoints&amp;lt;/servlet-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-class&amp;gt;org.forgerock.json.resource.servlet.HttpServlet&amp;lt;/servlet-class&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-name&amp;gt;connection-factory-class&amp;lt;/param-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;param-value&amp;gt;org.forgerock.jaspi.test.server.ConnectionFactory&amp;lt;/param-value&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/init-param&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/servlet&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-mapping&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;servlet-name&amp;gt;Endpoints&amp;lt;/servlet-name&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/servlet-mapping&amp;gt;<br>
+<br>
+&amp;lt;/web-app&amp;gt;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthnfilterpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authn-filter/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,6&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
-<br>
&lt;/del&gt;&lt;ins&gt;+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-9,14&nbsp;+10,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.3.0-SNAPSHOT&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter-parent&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-authn-filter&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;packaging&amp;gt;pom&amp;lt;/packaging&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;Authorization&nbsp;Filter&amp;lt;/name&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;name&amp;gt;ForgeRock&nbsp;Authentication&nbsp;Filter&amp;lt;/name&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modules&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-container&amp;lt;/module&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-runtime&amp;lt;/module&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-modules&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;forgerock-jaspi-test-server&amp;lt;/module&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/modules&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;/project&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthzfilterpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-30,28&nbsp;+30,19&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-auth-filter-common&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-auth-filter-common&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;mockito-all&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;/project&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changesforgerockauthzfiltersrctestjavaorgforgerockauthzAuthZFilterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/src/test/java/org/forgerock/authz/AuthZFilterTest.java&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/src/test/java/org/forgerock/authz/AuthZFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/forgerock-authz-filter/src/test/java/org/forgerock/authz/AuthZFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-48,7&nbsp;+48,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;FilterChain&nbsp;filterChain;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;PrintWriter&nbsp;writer;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AuthorizationFilter&nbsp;authorizationFilter;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AuditLogger&nbsp;auditLogger;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AuditLogger&amp;lt;HttpServletRequest&amp;gt;&nbsp;auditLogger;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;DebugLogger&nbsp;debugLogger;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AuthorizationConfigurator&nbsp;authorizationConfigurator;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-129,7&nbsp;+129,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getAuthResult(),&nbsp;AuthResult.SUCCESS);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getHttpServletRequest(),&nbsp;request);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getAuditObject(),&nbsp;request);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(filterChain).doFilter(request,&nbsp;response);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-146,7&nbsp;+146,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;AuditRecord&amp;gt;&nbsp;auditRecordCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(AuditRecord.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(auditLogger).audit(auditRecordCaptor.capture());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getAuthResult(),&nbsp;AuthResult.FAILURE);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getHttpServletRequest(),&nbsp;request);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(auditRecordCaptor.getValue().getAuditObject(),&nbsp;request);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(filterChain,&nbsp;never()).doFilter(request,&nbsp;response);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfiltersbranches130changespomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/branches/1.3.0-changes/pom.xml&nbsp;(1376&nbsp;=&gt;&nbsp;1377)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/branches/1.3.0-changes/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:38:32&nbsp;UTC&nbsp;(rev&nbsp;1376)<br>
+++&nbsp;forgerock-auth-filters/branches/1.3.0-changes/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2013-12-13&nbsp;20:49:50&nbsp;UTC&nbsp;(rev&nbsp;1377)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,6&nbsp;+1,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
-<br>
&lt;/del&gt;&lt;ins&gt;+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-29,7&nbsp;+30,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;maven.compiler.target&amp;gt;1.6&amp;lt;/maven.compiler.target&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;maven.compiler.source&amp;gt;1.6&amp;lt;/maven.compiler.source&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;forgerock-rest.version&amp;gt;2.0.0&amp;lt;/forgerock-rest.version&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;forgerock-rest.version&amp;gt;2.0.2&amp;lt;/forgerock-rest.version&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/properties&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scm&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-37,6&nbsp;+38,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;connection&amp;gt;scm:svn:https://svn.forgerock.org/commons/forgerock-auth-filters/trunk&amp;lt;/connection&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;developerConnection&amp;gt;scm:svn:https://svn.forgerock.org/commons/forgerock-auth-filters/trunk&amp;lt;/developerConnection&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/scm&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;ciManagement&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;system&amp;gt;jenkins&amp;lt;/system&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;url&amp;gt;https://builds.forgerock.org/job/Commons%20Auth%20Filters&amp;lt;/url&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-47,7&nbsp;+49,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;sendOnFailure&amp;gt;true&amp;lt;/sendOnFailure&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;sendOnSuccess&amp;gt;false&amp;lt;/sendOnSuccess&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;sendOnWarning&amp;gt;false&amp;lt;/sendOnWarning&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;TODO:&nbsp;need&nbsp;mailing&nbsp;list&nbsp;--&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;address&amp;gt;commons@forgerock.org&amp;lt;/address&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/notifier&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/notifiers&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-90,7&nbsp;+91,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;maven-release-plugin&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;inherited&amp;gt;true&amp;lt;/inherited&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;configuration&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Disable&nbsp;inherited&nbsp;configuration&nbsp;--&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;Disable&nbsp;inherited&nbsp;config&nbsp;--&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;autoVersionSubmodules&amp;gt;true&amp;lt;/autoVersionSubmodules&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;mavenExecutorId&amp;gt;forked-path&amp;lt;/mavenExecutorId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;useReleaseProfile&amp;gt;true&amp;lt;/useReleaseProfile&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-112,9&nbsp;+113,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-container&amp;lt;/artifactId&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-jaspi-runtime&amp;lt;/artifactId&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-125,12&nbsp;+127,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-web-token&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${forgerock-rest.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${forgerock-rest.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-142,11&nbsp;+140,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;javax.security.auth.message&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;3.1&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-api&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;1.7.2&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-163,4&nbsp;+156,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencyManagement&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;/project&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;mockito-all&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
