<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[3379]&nbsp;forgerock-http-framework/trunk:&nbsp;Align&nbsp;directory&nbsp;and&nbsp;modules&nbsp;names&nbsp;for&nbsp;consistency&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=3379&quot;&gt;3379&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;guillaume.sauthier&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2015-06-01&nbsp;13:05:55&nbsp;+0100&nbsp;(Mon,&nbsp;01&nbsp;Jun&nbsp;2015)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;Align&nbsp;directory&nbsp;and&nbsp;modules&nbsp;names&nbsp;for&nbsp;consistency&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkpomxml&quot;&gt;forgerock-http-framework/trunk/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncpomxml&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncAsyncClientjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClient.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncAsyncClientProviderjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/services/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/async/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapacheasyncsrctestjavaorgforgerockhttpclientasyncAsyncClientTestjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachecommonpomxml&quot;&gt;forgerock-http-framework/trunk/http-client-apache-common/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcAbstractClientjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcNoAuthenticationStrategyjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncpomxml&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImpljava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImplProviderjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/services/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/&lt;/li&gt;<br>
&lt;li&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/httpclient/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpclientapachesyncsrctestjavaorgforgerockhttpapachehttpclientApacheHttpClientImplTestjava&quot;&gt;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientpomxml&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientjava&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClient.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientProviderjava&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheasynchttpclientsrctestjavaorgforgerockhttpclientasyncAsyncClientTestjava&quot;&gt;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheclientpomxml&quot;&gt;forgerock-http-framework/trunk/http-apache-client/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcAbstractClientjava&quot;&gt;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcNoAuthenticationStrategyjava&quot;&gt;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientpomxml&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImpljava&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImplProviderjava&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientpackageinfojava&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockhttpframeworktrunkhttpapachehttpclientsrctestjavaorgforgerockhttpapachehttpclientApacheHttpClientImplTestjava&quot;&gt;forgerock-http-framework/trunk/http-apache-httpclient/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/pom.xml&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,60&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
-&amp;lt;!--<br>
-&nbsp;&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;&nbsp;License.<br>
-<br>
-&nbsp;&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-<br>
-&nbsp;&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-<br>
-&nbsp;&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
---&amp;gt;<br>
-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-apache-asynchttpclient&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;Async&nbsp;HttpClient&nbsp;integration&amp;lt;/name&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;httpasyncclient&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.1&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-apache-client-common&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.assertj&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;assertj-core&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;com.xebialabs.restito&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;restito&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
-&amp;lt;/project&amp;gt;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,86&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.client.async;<br>
-<br>
-import&nbsp;static&nbsp;java.lang.String.format;<br>
-<br>
-import&nbsp;java.io.IOException;<br>
-<br>
-import&nbsp;org.apache.http.HttpResponse;<br>
-import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
-import&nbsp;org.apache.http.concurrent.FutureCallback;<br>
-import&nbsp;org.apache.http.impl.nio.client.CloseableHttpAsyncClient;<br>
-import&nbsp;org.forgerock.http.client.ahc.AbstractClient;<br>
-import&nbsp;org.forgerock.http.io.Buffer;<br>
-import&nbsp;org.forgerock.http.protocol.Request;<br>
-import&nbsp;org.forgerock.http.protocol.Response;<br>
-import&nbsp;org.forgerock.http.protocol.Status;<br>
-import&nbsp;org.forgerock.util.Factory;<br>
-import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
-import&nbsp;org.forgerock.util.promise.Promise;<br>
-import&nbsp;org.forgerock.util.promise.PromiseImpl;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&nbsp;based&nbsp;implementation.<br>
-&nbsp;*/<br>
-public&nbsp;class&nbsp;AsyncClient&nbsp;extends&nbsp;AbstractClient&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CloseableHttpAsyncClient&nbsp;client;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;AsyncClient(final&nbsp;CloseableHttpAsyncClient&nbsp;client,&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(storage);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Client&nbsp;should&nbsp;already&nbsp;be&nbsp;started<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.client&nbsp;=&nbsp;client;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;sendAsync(final&nbsp;Request&nbsp;request)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpUriRequest&nbsp;clientRequest&nbsp;=&nbsp;createHttpUriRequest(request);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;request&nbsp;and&nbsp;return&nbsp;the&nbsp;configured&nbsp;Promise<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.execute(clientRequest,&nbsp;new&nbsp;FutureCallback&amp;lt;HttpResponse&amp;gt;()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;completed(final&nbsp;HttpResponse&nbsp;result)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;createResponse(result);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(response);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;failed(final&nbsp;Exception&nbsp;ex)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;new&nbsp;Response(Status.BAD_GATEWAY);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setEntity(format(&amp;quot;Failed&nbsp;to&nbsp;obtain&nbsp;response&nbsp;for&nbsp;%s&amp;quot;,&nbsp;request.getUri()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCause(ex);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(response);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cancelled()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failed(new&nbsp;InterruptedException(&amp;quot;Request&nbsp;processing&nbsp;has&nbsp;been&nbsp;cancelled&amp;quot;));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.close();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientProviderjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,181&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.client.async;<br>
-<br>
-import&nbsp;static&nbsp;java.util.concurrent.TimeUnit.MILLISECONDS;<br>
-<br>
-import&nbsp;java.security.GeneralSecurityException;<br>
-<br>
-import&nbsp;javax.net.ssl.SSLContext;<br>
-<br>
-import&nbsp;org.apache.http.HttpRequest;<br>
-import&nbsp;org.apache.http.HttpResponse;<br>
-import&nbsp;org.apache.http.ProtocolException;<br>
-import&nbsp;org.apache.http.client.RedirectStrategy;<br>
-import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
-import&nbsp;org.apache.http.config.Registry;<br>
-import&nbsp;org.apache.http.config.RegistryBuilder;<br>
-import&nbsp;org.apache.http.conn.ssl.SSLConnectionSocketFactory;<br>
-import&nbsp;org.apache.http.conn.ssl.X509HostnameVerifier;<br>
-import&nbsp;org.apache.http.impl.NoConnectionReuseStrategy;<br>
-import&nbsp;org.apache.http.impl.nio.client.CloseableHttpAsyncClient;<br>
-import&nbsp;org.apache.http.impl.nio.client.HttpAsyncClientBuilder;<br>
-import&nbsp;org.apache.http.impl.nio.client.HttpAsyncClients;<br>
-import&nbsp;org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager;<br>
-import&nbsp;org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor;<br>
-import&nbsp;org.apache.http.impl.nio.reactor.IOReactorConfig;<br>
-import&nbsp;org.apache.http.nio.conn.NoopIOSessionStrategy;<br>
-import&nbsp;org.apache.http.nio.conn.SchemeIOSessionStrategy;<br>
-import&nbsp;org.apache.http.nio.conn.ssl.SSLIOSessionStrategy;<br>
-import&nbsp;org.apache.http.nio.reactor.ConnectingIOReactor;<br>
-import&nbsp;org.apache.http.nio.reactor.IOReactorException;<br>
-import&nbsp;org.apache.http.protocol.HttpContext;<br>
-import&nbsp;org.forgerock.http.Client;<br>
-import&nbsp;org.forgerock.http.HttpApplicationException;<br>
-import&nbsp;org.forgerock.http.client.ahc.NoAuthenticationStrategy;<br>
-import&nbsp;org.forgerock.http.io.Buffer;<br>
-import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
-import&nbsp;org.forgerock.http.spi.ClientImplProvider;<br>
-import&nbsp;org.forgerock.util.Factory;<br>
-import&nbsp;org.forgerock.util.Option;<br>
-import&nbsp;org.forgerock.util.Options;<br>
-import&nbsp;org.forgerock.util.time.Duration;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Creates&nbsp;and&nbsp;configures&nbsp;a&nbsp;{@link&nbsp;ClientImpl}&nbsp;instance&nbsp;built&nbsp;around&nbsp;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&nbsp;component.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;https://hc.apache.org/httpcomponents-asyncclient-dev/index.html&amp;quot;&amp;gt;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&amp;lt;/a&amp;gt;<br>
-&nbsp;*/<br>
-public&nbsp;class&nbsp;AsyncClientProvider&nbsp;implements&nbsp;ClientImplProvider&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Specify&nbsp;the&nbsp;number&nbsp;of&nbsp;worker&nbsp;threads.&nbsp;If&nbsp;not&nbsp;set,&nbsp;the&nbsp;async&nbsp;client&nbsp;implementation&nbsp;manages&nbsp;this&nbsp;setting&nbsp;itself<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(by&nbsp;default&nbsp;this&nbsp;is&nbsp;number&nbsp;of&nbsp;CPU&nbsp;+&nbsp;1).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Option&amp;lt;Integer&amp;gt;&nbsp;OPTION_WORKER_THREADS&nbsp;=&nbsp;Option.of(Integer.class,&nbsp;null);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;A&nbsp;redirect&nbsp;strategy&nbsp;that&nbsp;never&nbsp;performs&nbsp;a&nbsp;redirect.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;RedirectStrategy&nbsp;DISABLE_REDIRECT&nbsp;=&nbsp;new&nbsp;RedirectStrategy()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;isRedirected(final&nbsp;HttpRequest&nbsp;request,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;ProtocolException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpUriRequest&nbsp;getRedirect(final&nbsp;HttpRequest&nbsp;request,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;ProtocolException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ClientImpl&nbsp;newClientImpl(final&nbsp;Options&nbsp;options)&nbsp;throws&nbsp;HttpApplicationException&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage&nbsp;=&nbsp;options.get(Client.OPTION_TEMPORARY_STORAGE);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SSL<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;SSLContext&nbsp;sslContext;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sslContext&nbsp;=&nbsp;SSLContext.getInstance(&amp;quot;TLS&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sslContext.init(options.get(Client.OPTION_KEY_MANAGERS),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.get(Client.OPTION_TRUST_MANAGERS),&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;GeneralSecurityException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(&amp;quot;Can't&nbsp;create&nbsp;SSL&nbsp;Context&amp;quot;,&nbsp;e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509HostnameVerifier&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.STRICT_HOSTNAME_VERIFIER;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(options.get(Client.OPTION_HOSTNAME_VERIFIER))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ALLOW_ALL:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;BROWSER_COMPATIBLE:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;registry&nbsp;of&nbsp;custom&nbsp;connection&nbsp;session&nbsp;strategies&nbsp;for&nbsp;supported&nbsp;protocol&nbsp;schemes<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Registry&amp;lt;SchemeIOSessionStrategy&amp;gt;&nbsp;registry&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegistryBuilder.&amp;lt;SchemeIOSessionStrategy&amp;gt;create()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.register(&amp;quot;http&amp;quot;,&nbsp;NoopIOSessionStrategy.INSTANCE)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.register(&amp;quot;https&amp;quot;,&nbsp;new&nbsp;SSLIOSessionStrategy(sslContext,&nbsp;verifier))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Timeouts<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;soTimeout&nbsp;=&nbsp;options.get(Client.OPTION_SO_TIMEOUT);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;connectTimeout&nbsp;=&nbsp;options.get(Client.OPTION_CONNECT_TIMEOUT);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME&nbsp;GSA&nbsp;Can&nbsp;we&nbsp;support&nbsp;requestConnectTimeout&nbsp;?<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;I/O&nbsp;reactor&nbsp;configuration<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOReactorConfig.Builder&nbsp;reactorBuilder&nbsp;=&nbsp;IOReactorConfig.custom();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!connectTimeout.isUnlimited())&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setConnectTimeout((int)&nbsp;connectTimeout.to(MILLISECONDS));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!soTimeout.isUnlimited())&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setSoTimeout((int)&nbsp;soTimeout.to(MILLISECONDS));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer&nbsp;threadCount&nbsp;=&nbsp;options.get(OPTION_WORKER_THREADS);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(threadCount&nbsp;!=&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setIoThreadCount(threadCount);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOReactorConfig&nbsp;ioReactorConfig&nbsp;=&nbsp;reactorBuilder.build();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;custom&nbsp;I/O&nbsp;reactor<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConnectingIOReactor&nbsp;reactor;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor&nbsp;=&nbsp;new&nbsp;DefaultConnectingIOReactor(ioReactorConfig);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOReactorException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(&amp;quot;Cannot&nbsp;create&nbsp;I/O&nbsp;Reactor&amp;quot;,&nbsp;e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;connection&nbsp;manager&nbsp;with&nbsp;custom&nbsp;configuration.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PoolingNHttpClientConnectionManager&nbsp;manager&nbsp;=&nbsp;new&nbsp;PoolingNHttpClientConnectionManager(reactor,&nbsp;registry);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Connection&nbsp;pooling<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;maxConnections&nbsp;=&nbsp;options.get(Client.OPTION_MAX_CONNECTIONS);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager.setMaxTotal(maxConnections);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager.setDefaultMaxPerRoute(maxConnections);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME&nbsp;GSA&nbsp;Couldn't&nbsp;find&nbsp;how&nbsp;to&nbsp;configure&nbsp;retries&nbsp;in&nbsp;async&nbsp;http&nbsp;client<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;(!options.get(Client.OPTION_RETRY_REQUESTS))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;builder.disableAutomaticRetries();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;client&nbsp;with&nbsp;the&nbsp;given&nbsp;custom&nbsp;dependencies&nbsp;and&nbsp;configuration.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpAsyncClientBuilder&nbsp;builder&nbsp;=&nbsp;HttpAsyncClients.custom();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_REUSE_CONNECTIONS))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setConnectionReuseStrategy(NoConnectionReuseStrategy.INSTANCE);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Uncomment&nbsp;when&nbsp;we'll&nbsp;have&nbsp;a&nbsp;user-agent&nbsp;Option<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;builder.setUserAgent(&amp;quot;CHF/1.0&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseableHttpAsyncClient&nbsp;client&nbsp;=&nbsp;builder.setConnectionManager(manager)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.disableCookieManagement()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setRedirectStrategy(DISABLE_REDIRECT)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setTargetAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setProxyAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.start();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AsyncClient(client,&nbsp;storage);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,23&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Provides&nbsp;{@link&nbsp;org.forgerock.http.Client&nbsp;client}&nbsp;integration&nbsp;with<br>
-&nbsp;*&nbsp;Apache&nbsp;HttpComponents&nbsp;Http&nbsp;Async&nbsp;Client.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;https://hc.apache.org/httpcomponents-asyncclient-dev/index.html&amp;quot;&amp;gt;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&amp;lt;/a&amp;gt;<br>
-&nbsp;*/<br>
-package&nbsp;org.forgerock.http.client.async;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,17&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-#<br>
-#&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-#&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-#&nbsp;License.<br>
-#<br>
-#&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-#&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-#<br>
-#&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-#&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-#&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-#&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-#<br>
-#&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-#<br>
-<br>
-org.forgerock.http.client.async.AsyncClientProvider<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheasynchttpclientsrctestjavaorgforgerockhttpclientasyncAsyncClientTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,161&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.client.async;<br>
-<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.builder.stub.StubHttp.whenHttp;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.composite;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.ok;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.stringContent;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.post;<br>
-import&nbsp;static&nbsp;java.lang.String.format;<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-<br>
-import&nbsp;java.util.ArrayList;<br>
-import&nbsp;java.util.List;<br>
-import&nbsp;java.util.concurrent.CountDownLatch;<br>
-<br>
-import&nbsp;org.forgerock.http.Client;<br>
-import&nbsp;org.forgerock.http.protocol.Request;<br>
-import&nbsp;org.forgerock.http.protocol.Response;<br>
-import&nbsp;org.forgerock.http.protocol.Status;<br>
-import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
-import&nbsp;org.forgerock.util.promise.Promise;<br>
-import&nbsp;org.forgerock.util.promise.ResultHandler;<br>
-import&nbsp;org.testng.annotations.AfterTest;<br>
-import&nbsp;org.testng.annotations.BeforeMethod;<br>
-import&nbsp;org.testng.annotations.BeforeTest;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-import&nbsp;com.xebialabs.restito.semantics.Applicable;<br>
-import&nbsp;com.xebialabs.restito.server.StubServer;<br>
-<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;class&nbsp;AsyncClientTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;StubServer&nbsp;server;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeTest<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;mock&nbsp;HTTP&nbsp;server.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;=&nbsp;new&nbsp;StubServer().run();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@AfterTest<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;tearDown()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.stop();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanup()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Clear&nbsp;mocked&nbsp;invocations&nbsp;between&nbsp;tests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;So&nbsp;we&nbsp;can&nbsp;reuse&nbsp;the&nbsp;server&nbsp;instance&nbsp;(less&nbsp;traces)&nbsp;still&nbsp;having&nbsp;isolation<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(server&nbsp;!=&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getCalls().clear();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getStubs().clear();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProducesResponse()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok(),&nbsp;stringContent(&amp;quot;Pong&amp;quot;)));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;client.send(request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getStatus()).isEqualTo(Status.OK);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getEntity().getString()).isEqualTo(&amp;quot;Pong&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessResponsesAsynchronouslyNotWithCallerThread()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok()));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;By&nbsp;default,&nbsp;the&nbsp;client&nbsp;has&nbsp;a&nbsp;pool&nbsp;of&nbsp;less&nbsp;than&nbsp;10&nbsp;threads<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&amp;gt;&nbsp;promises&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ArrayList&amp;lt;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&amp;gt;();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;20;&nbsp;i++)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promises.add(client.sendAsync(request)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenOnResult(new&nbsp;ResultHandler&amp;lt;Response&amp;gt;()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleResult(final&nbsp;Response&nbsp;result)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;=&nbsp;Thread.currentThread().getName();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.getHeaders().putSingle(&amp;quot;thread-name&amp;quot;,&nbsp;name);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;response&nbsp;processing&nbsp;thread&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;calling&nbsp;thread<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;threadName&nbsp;=&nbsp;Thread.currentThread().getName();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;:&nbsp;promises)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Wait&nbsp;for&nbsp;each&nbsp;response<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;promise.get();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getHeaders().getFirst(&amp;quot;thread-name&amp;quot;)).isNotEqualTo(threadName);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;test&nbsp;is&nbsp;performing&nbsp;a&nbsp;single&nbsp;request&nbsp;that&nbsp;is&nbsp;being&nbsp;blocked&nbsp;on&nbsp;the&nbsp;server&nbsp;side&nbsp;until&nbsp;a&nbsp;latch&nbsp;is&nbsp;released.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;ensure&nbsp;that,&nbsp;because&nbsp;the&nbsp;main&nbsp;thread&nbsp;is&nbsp;blocked,&nbsp;the&nbsp;processing&nbsp;is&nbsp;done&nbsp;in&nbsp;another&nbsp;thread.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldDoTheProcessingAsynchronously()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CountDownLatch&nbsp;one&nbsp;=&nbsp;new&nbsp;CountDownLatch(1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok(),&nbsp;new&nbsp;WaitForLatch(one)));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;=&nbsp;client.sendAsync(request);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;We're&nbsp;still&nbsp;waiting&nbsp;for&nbsp;the&nbsp;server's&nbsp;response<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise.isDone()).isFalse();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Unlock&nbsp;server<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one.countDown();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Verify&nbsp;the&nbsp;response&nbsp;(block&nbsp;until&nbsp;reception)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise.get().getStatus()).isEqualTo(Status.OK);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;WaitForLatch&nbsp;implements&nbsp;Applicable&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CountDownLatch&nbsp;one;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;WaitForLatch(final&nbsp;CountDownLatch&nbsp;one)&nbsp;{this.one&nbsp;=&nbsp;one;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;org.glassfish.grizzly.http.server.Response&nbsp;apply(final&nbsp;org.glassfish.grizzly.http.server.Response&nbsp;r)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one.await();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(InterruptedException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-client/pom.xml&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-client/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-client/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,48&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
-&amp;lt;!--<br>
-&nbsp;&nbsp;~&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;&nbsp;~&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;&nbsp;~&nbsp;License.<br>
-&nbsp;&nbsp;~<br>
-&nbsp;&nbsp;~&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;&nbsp;~&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;&nbsp;~<br>
-&nbsp;&nbsp;~&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;&nbsp;~&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;&nbsp;~&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;&nbsp;~&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;&nbsp;~<br>
-&nbsp;&nbsp;~&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;&nbsp;--&amp;gt;<br>
-<br>
-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
-<br>
-&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-apache-client-common&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;HttpClient(s)&nbsp;base&amp;lt;/name&amp;gt;<br>
-<br>
-&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;httpclient&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;This&nbsp;dependency&nbsp;is&nbsp;inherited&nbsp;by&nbsp;both&nbsp;the&nbsp;synchronous&nbsp;and&nbsp;asynchronous&nbsp;AHC&nbsp;CHF&nbsp;Drivers.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;asynchronous&nbsp;driver&nbsp;has&nbsp;a&nbsp;dependency&nbsp;on&nbsp;'httpasyncclient'&nbsp;(that&nbsp;itself&nbsp;depends&nbsp;on&nbsp;'httpclient'),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;make&nbsp;sure&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;incompatibility&nbsp;before&nbsp;updating&nbsp;theses&nbsp;versions&nbsp;--&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.4.1&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
-<br>
-&amp;lt;/project&amp;gt;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcAbstractClientjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,187&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.client.ahc;<br>
-<br>
-import&nbsp;java.io.IOException;<br>
-import&nbsp;java.util.Arrays;<br>
-<br>
-import&nbsp;org.apache.http.Header;<br>
-import&nbsp;org.apache.http.HeaderIterator;<br>
-import&nbsp;org.apache.http.HttpEntity;<br>
-import&nbsp;org.apache.http.HttpResponse;<br>
-import&nbsp;org.apache.http.StatusLine;<br>
-import&nbsp;org.apache.http.client.methods.HttpEntityEnclosingRequestBase;<br>
-import&nbsp;org.apache.http.client.methods.HttpRequestBase;<br>
-import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
-import&nbsp;org.apache.http.entity.InputStreamEntity;<br>
-import&nbsp;org.forgerock.http.header.ConnectionHeader;<br>
-import&nbsp;org.forgerock.http.header.ContentEncodingHeader;<br>
-import&nbsp;org.forgerock.http.header.ContentLengthHeader;<br>
-import&nbsp;org.forgerock.http.header.ContentTypeHeader;<br>
-import&nbsp;org.forgerock.http.io.Buffer;<br>
-import&nbsp;org.forgerock.http.io.IO;<br>
-import&nbsp;org.forgerock.http.protocol.Request;<br>
-import&nbsp;org.forgerock.http.protocol.Response;<br>
-import&nbsp;org.forgerock.http.protocol.Status;<br>
-import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
-import&nbsp;org.forgerock.http.util.CaseInsensitiveSet;<br>
-import&nbsp;org.forgerock.util.Factory;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;This&nbsp;abstract&nbsp;client&nbsp;is&nbsp;used&nbsp;to&nbsp;share&nbsp;commonly&nbsp;used&nbsp;constants&nbsp;and&nbsp;methods<br>
-&nbsp;*&nbsp;in&nbsp;both&nbsp;synchronous&nbsp;and&nbsp;asynchronous&nbsp;Apache&nbsp;HTTP&nbsp;Client&nbsp;libraries.<br>
-&nbsp;*/<br>
-public&nbsp;abstract&nbsp;class&nbsp;AbstractClient&nbsp;implements&nbsp;ClientImpl&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;Headers&nbsp;that&nbsp;are&nbsp;suppressed&nbsp;in&nbsp;request.&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;How&nbsp;should&nbsp;the&nbsp;the&nbsp;&amp;quot;Expect&amp;quot;&nbsp;header&nbsp;be&nbsp;handled?<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;CaseInsensitiveSet&nbsp;SUPPRESS_REQUEST_HEADERS&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet(<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrays.asList(<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;populated&nbsp;in&nbsp;outgoing&nbsp;request&nbsp;by&nbsp;EntityRequest&nbsp;(HttpEntityEnclosingRequestBase):<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Content-Encoding&amp;quot;,&nbsp;&amp;quot;Content-Length&amp;quot;,&nbsp;&amp;quot;Content-Type&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hop-by-hop&nbsp;headers,&nbsp;not&nbsp;forwarded&nbsp;by&nbsp;proxies,&nbsp;per&nbsp;RFC&nbsp;2616&nbsp;13.5.1:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Connection&amp;quot;,&nbsp;&amp;quot;Keep-Alive&amp;quot;,&nbsp;&amp;quot;Proxy-Authenticate&amp;quot;,&nbsp;&amp;quot;Proxy-Authorization&amp;quot;,&nbsp;&amp;quot;TE&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Trailers&amp;quot;,&nbsp;&amp;quot;Transfer-Encoding&amp;quot;,&nbsp;&amp;quot;Upgrade&amp;quot;));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;Headers&nbsp;that&nbsp;are&nbsp;suppressed&nbsp;in&nbsp;response.&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;CaseInsensitiveSet&nbsp;SUPPRESS_RESPONSE_HEADERS&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet(<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrays.asList(<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hop-by-hop&nbsp;headers,&nbsp;not&nbsp;forwarded&nbsp;by&nbsp;proxies,&nbsp;per&nbsp;RFC&nbsp;2616&nbsp;13.5.1:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Connection&amp;quot;,&nbsp;&amp;quot;Keep-Alive&amp;quot;,&nbsp;&amp;quot;Proxy-Authenticate&amp;quot;,&nbsp;&amp;quot;Proxy-Authorization&amp;quot;,&nbsp;&amp;quot;TE&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Trailers&amp;quot;,&nbsp;&amp;quot;Transfer-Encoding&amp;quot;,&nbsp;&amp;quot;Upgrade&amp;quot;));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Base&nbsp;constructor&nbsp;for&nbsp;AHC&nbsp;{@link&nbsp;ClientImpl}&nbsp;drivers.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;storage<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temporary&nbsp;storage&nbsp;area<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AbstractClient(final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.storage&nbsp;=&nbsp;storage;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;A&nbsp;request&nbsp;that&nbsp;encloses&nbsp;an&nbsp;entity.&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;EntityRequest&nbsp;extends&nbsp;HttpEntityEnclosingRequestBase&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;method;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;EntityRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.method&nbsp;=&nbsp;request.getMethod();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;InputStreamEntity&nbsp;entity&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InputStreamEntity(request.getEntity().getRawContentInputStream(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentLengthHeader.valueOf(request).getLength());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.setContentType(ContentTypeHeader.valueOf(request).toString());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.setContentEncoding(ContentEncodingHeader.valueOf(request).toString());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setEntity(entity);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getMethod()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;method;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;A&nbsp;request&nbsp;that&nbsp;does&nbsp;not&nbsp;enclose&nbsp;an&nbsp;entity.&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;NonEntityRequest&nbsp;extends&nbsp;HttpRequestBase&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;method;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;NonEntityRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.method&nbsp;=&nbsp;request.getMethod();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Header[]&nbsp;contentLengthHeader&nbsp;=&nbsp;getHeaders(ContentLengthHeader.NAME);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((contentLengthHeader&nbsp;==&nbsp;null&nbsp;||&nbsp;contentLengthHeader.length&nbsp;==&nbsp;0)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;amp;&amp;amp;&nbsp;(&amp;quot;PUT&amp;quot;.equals(method)&nbsp;||&nbsp;&amp;quot;POST&amp;quot;.equals(method)&nbsp;||&nbsp;&amp;quot;PROPFIND&amp;quot;.equals(method)))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setHeader(ContentLengthHeader.NAME,&nbsp;&amp;quot;0&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getMethod()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;method;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;{@link&nbsp;HttpUriRequest}&nbsp;populated&nbsp;from&nbsp;the&nbsp;given&nbsp;{@code&nbsp;request}.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;returned&nbsp;message&nbsp;has&nbsp;some&nbsp;of&nbsp;its&nbsp;headers&nbsp;filtered/ignored&nbsp;(proxy&nbsp;behaviour).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;OpenIG&nbsp;request&nbsp;structure<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;AHC&nbsp;request&nbsp;structure<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;HttpUriRequest&nbsp;createHttpUriRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;the&nbsp;Http&nbsp;request&nbsp;depending&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;entity&nbsp;or&nbsp;not<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpRequestBase&nbsp;clientRequest&nbsp;=&nbsp;request.getEntity().mayContainData()<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;new&nbsp;EntityRequest(request)&nbsp;:&nbsp;new&nbsp;NonEntityRequest(request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientRequest.setURI(request.getUri().asURI());<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Parse&nbsp;request&nbsp;Connection&nbsp;headers&nbsp;to&nbsp;be&nbsp;suppressed&nbsp;in&nbsp;message<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CaseInsensitiveSet&nbsp;removableHeaderNames&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removableHeaderNames.addAll(ConnectionHeader.valueOf(request).getTokens());<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Populates&nbsp;request&nbsp;headers<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(String&nbsp;name&nbsp;:&nbsp;request.getHeaders().keySet())&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SUPPRESS_REQUEST_HEADERS.contains(name)&nbsp;&amp;amp;&amp;amp;&nbsp;!removableHeaderNames.contains(name))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;String&nbsp;value&nbsp;:&nbsp;request.getHeaders().get(name))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientRequest.addHeader(name,&nbsp;value);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clientRequest;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;{@link&nbsp;Response}&nbsp;populated&nbsp;from&nbsp;the&nbsp;given&nbsp;AHC&nbsp;{@code&nbsp;result}.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;returned&nbsp;message&nbsp;has&nbsp;some&nbsp;of&nbsp;its&nbsp;headers&nbsp;filtered/ignored&nbsp;(proxy&nbsp;behaviour).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;result&nbsp;AHC&nbsp;response&nbsp;structure<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;openIG&nbsp;response&nbsp;structure<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;Response&nbsp;createResponse(final&nbsp;HttpResponse&nbsp;result)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;new&nbsp;Response();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;entity<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpEntity&nbsp;entity&nbsp;=&nbsp;result.getEntity();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(entity&nbsp;!=&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setEntity(IO.newBranchingInputStream(entity.getContent(),&nbsp;storage));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(Status.INTERNAL_SERVER_ERROR);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCause(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;status&nbsp;line<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StatusLine&nbsp;statusLine&nbsp;=&nbsp;result.getStatusLine();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setVersion(statusLine.getProtocolVersion().toString());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(Status.valueOf(statusLine.getStatusCode(),&nbsp;statusLine.getReasonPhrase()));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Parse&nbsp;response&nbsp;Connection&nbsp;headers&nbsp;to&nbsp;be&nbsp;suppressed&nbsp;in&nbsp;message<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CaseInsensitiveSet&nbsp;removableHeaderNames&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removableHeaderNames.addAll(ConnectionHeader.valueOf(response).getTokens());<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;headers<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(HeaderIterator&nbsp;i&nbsp;=&nbsp;result.headerIterator();&nbsp;i.hasNext();)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;header&nbsp;=&nbsp;i.nextHeader();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;=&nbsp;header.getName();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SUPPRESS_RESPONSE_HEADERS.contains(name)&nbsp;&amp;amp;&amp;amp;&nbsp;!removableHeaderNames.contains(name))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getHeaders().add(name,&nbsp;header.getValue());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcNoAuthenticationStrategyjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,83&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.client.ahc;<br>
-<br>
-import&nbsp;java.util.Collections;<br>
-import&nbsp;java.util.LinkedList;<br>
-import&nbsp;java.util.Map;<br>
-import&nbsp;java.util.Queue;<br>
-<br>
-import&nbsp;org.apache.http.Header;<br>
-import&nbsp;org.apache.http.HttpHost;<br>
-import&nbsp;org.apache.http.HttpResponse;<br>
-import&nbsp;org.apache.http.auth.AuthOption;<br>
-import&nbsp;org.apache.http.auth.AuthScheme;<br>
-import&nbsp;org.apache.http.auth.MalformedChallengeException;<br>
-import&nbsp;org.apache.http.client.AuthenticationStrategy;<br>
-import&nbsp;org.apache.http.protocol.HttpContext;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;An&nbsp;authentication&nbsp;strategy&nbsp;that&nbsp;never&nbsp;performs&nbsp;authentication.<br>
-&nbsp;*/<br>
-public&nbsp;final&nbsp;class&nbsp;NoAuthenticationStrategy&nbsp;implements&nbsp;AuthenticationStrategy&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;An&nbsp;{@link&nbsp;AuthenticationStrategy}&nbsp;singleton&nbsp;instance&nbsp;that&nbsp;never&nbsp;performs&nbsp;authentication.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;AuthenticationStrategy&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;NoAuthenticationStrategy();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Singleton&nbsp;only.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;NoAuthenticationStrategy()&nbsp;{&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;authFailed(final&nbsp;HttpHost&nbsp;host,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthScheme&nbsp;authScheme,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;authSucceeded(final&nbsp;HttpHost&nbsp;host,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthScheme&nbsp;authScheme,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Header&amp;gt;&nbsp;getChallenges(final&nbsp;HttpHost&nbsp;host,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;MalformedChallengeException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Collections.emptyMap();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;isAuthenticationRequested(final&nbsp;HttpHost&nbsp;host,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Queue&amp;lt;AuthOption&amp;gt;&nbsp;select(final&nbsp;Map&amp;lt;String,&nbsp;Header&amp;gt;&nbsp;challenges,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpHost&nbsp;host,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;MalformedChallengeException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;LinkedList&amp;lt;AuthOption&amp;gt;();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,20&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;{@literal&nbsp;ahc}&nbsp;stands&nbsp;for&nbsp;Apache&nbsp;Http&nbsp;Client.<br>
-&nbsp;*/<br>
-package&nbsp;org.forgerock.http.client.ahc;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/pom.xml&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,60&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
-&amp;lt;!--<br>
-&nbsp;&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;&nbsp;License.<br>
-<br>
-&nbsp;&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-<br>
-&nbsp;&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-<br>
-&nbsp;&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
---&amp;gt;<br>
-&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
-&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-apache-httpclient&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;HttpClient&nbsp;integration&amp;lt;/name&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-apache-client-common&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.assertj&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;assertj-core&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;mockito-all&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;com.xebialabs.restito&amp;lt;/groupId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;restito&amp;lt;/artifactId&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
-&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
-&amp;lt;/project&amp;gt;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImpljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,68&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2009&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
-&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2010–2011&nbsp;ApexIdentity&nbsp;Inc.<br>
-&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2011-2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.apache.httpclient;<br>
-<br>
-import&nbsp;java.io.IOException;<br>
-<br>
-import&nbsp;org.apache.http.HttpResponse;<br>
-import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
-import&nbsp;org.apache.http.impl.client.CloseableHttpClient;<br>
-import&nbsp;org.forgerock.http.client.ahc.AbstractClient;<br>
-import&nbsp;org.forgerock.http.io.Buffer;<br>
-import&nbsp;org.forgerock.http.protocol.Request;<br>
-import&nbsp;org.forgerock.http.protocol.Response;<br>
-import&nbsp;org.forgerock.http.protocol.Status;<br>
-import&nbsp;org.forgerock.util.Factory;<br>
-import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
-import&nbsp;org.forgerock.util.promise.Promise;<br>
-import&nbsp;org.forgerock.util.promise.Promises;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Apache&nbsp;HTTP&nbsp;Client&nbsp;implementation.<br>
-&nbsp;*/<br>
-final&nbsp;class&nbsp;ApacheHttpClientImpl&nbsp;extends&nbsp;AbstractClient&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;Apache&nbsp;HTTP&nbsp;client&nbsp;to&nbsp;transmit&nbsp;requests&nbsp;through.&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CloseableHttpClient&nbsp;httpClient;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;ApacheHttpClientImpl(final&nbsp;CloseableHttpClient&nbsp;httpClient,&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(storage);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.httpClient&nbsp;=&nbsp;httpClient;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpClient.close();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;sendAsync(final&nbsp;Request&nbsp;request)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Convert&nbsp;the&nbsp;request&nbsp;to&nbsp;AHC&nbsp;then&nbsp;send&nbsp;it<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpUriRequest&nbsp;clientRequest&nbsp;=&nbsp;createHttpUriRequest(request);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpResponse&nbsp;clientResponse&nbsp;=&nbsp;httpClient.execute(clientRequest);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Convert&nbsp;the&nbsp;AHC&nbsp;response&nbsp;back&nbsp;into&nbsp;OpenIG<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;createResponse(clientResponse);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Promises.newResultPromise(response);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;IOException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Promises.newResultPromise(new&nbsp;Response().setStatus(Status.INTERNAL_SERVER_ERROR));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImplProviderjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,108&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2009&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
-&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2010–2011&nbsp;ApexIdentity&nbsp;Inc.<br>
-&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2011-2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.apache.httpclient;<br>
-<br>
-import&nbsp;static&nbsp;java.util.concurrent.TimeUnit.MILLISECONDS;<br>
-<br>
-import&nbsp;java.security.GeneralSecurityException;<br>
-<br>
-import&nbsp;javax.net.ssl.SSLContext;<br>
-<br>
-import&nbsp;org.apache.http.client.config.RequestConfig;<br>
-import&nbsp;org.apache.http.conn.ssl.SSLConnectionSocketFactory;<br>
-import&nbsp;org.apache.http.impl.NoConnectionReuseStrategy;<br>
-import&nbsp;org.apache.http.impl.client.HttpClientBuilder;<br>
-import&nbsp;org.forgerock.http.Client;<br>
-import&nbsp;org.forgerock.http.HttpApplicationException;<br>
-import&nbsp;org.forgerock.http.client.ahc.NoAuthenticationStrategy;<br>
-import&nbsp;org.forgerock.http.io.Buffer;<br>
-import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
-import&nbsp;org.forgerock.http.spi.ClientImplProvider;<br>
-import&nbsp;org.forgerock.util.Factory;<br>
-import&nbsp;org.forgerock.util.Options;<br>
-import&nbsp;org.forgerock.util.time.Duration;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;An&nbsp;HTTP&nbsp;client&nbsp;implementation&nbsp;provider&nbsp;for&nbsp;Apache&nbsp;HttpClient.<br>
-&nbsp;*/<br>
-public&nbsp;final&nbsp;class&nbsp;ApacheHttpClientImplProvider&nbsp;implements&nbsp;ClientImplProvider&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ClientImpl&nbsp;newClientImpl(final&nbsp;Options&nbsp;options)&nbsp;throws&nbsp;HttpApplicationException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage&nbsp;=&nbsp;options.get(Client.OPTION_TEMPORARY_STORAGE);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpClientBuilder&nbsp;builder&nbsp;=&nbsp;HttpClientBuilder.create();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Connection&nbsp;pooling.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;maxConnections&nbsp;=&nbsp;options.get(Client.OPTION_MAX_CONNECTIONS);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setMaxConnTotal(maxConnections);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setMaxConnPerRoute(maxConnections);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_REUSE_CONNECTIONS))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setConnectionReuseStrategy(NoConnectionReuseStrategy.INSTANCE);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_RETRY_REQUESTS))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableAutomaticRetries();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Timeouts.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestConfig.Builder&nbsp;requestConfigBuilder&nbsp;=&nbsp;RequestConfig.custom();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;soTimeout&nbsp;=&nbsp;options.get(Client.OPTION_SO_TIMEOUT);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestConfigBuilder.setSocketTimeout(soTimeout.isUnlimited()&nbsp;?&nbsp;0&nbsp;:&nbsp;(int)&nbsp;soTimeout<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.to(MILLISECONDS));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;connectTimeout&nbsp;=&nbsp;options.get(Client.OPTION_CONNECT_TIMEOUT);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestConfigBuilder.setConnectTimeout(connectTimeout.isUnlimited()&nbsp;?&nbsp;0<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;(int)&nbsp;connectTimeout.to(MILLISECONDS));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setDefaultRequestConfig(requestConfigBuilder.build());<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;where&nbsp;is&nbsp;this&nbsp;setting&nbsp;in&nbsp;HttpClient&nbsp;4.x?<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;HttpProtocolParams.setVersion(parameters,&nbsp;HttpVersion.HTTP_1_1);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableRedirectHandling();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SSL<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;SSLContext&nbsp;context;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context&nbsp;=&nbsp;SSLContext.getInstance(&amp;quot;TLS&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.init(options.get(Client.OPTION_KEY_MANAGERS),&nbsp;options<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(Client.OPTION_TRUST_MANAGERS),&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;GeneralSecurityException&nbsp;e)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setSslcontext(context);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(options.get(Client.OPTION_HOSTNAME_VERIFIER))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ALLOW_ALL:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;BROWSER_COMPATIBLE:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.STRICT_HOSTNAME_VERIFIER);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;is&nbsp;this&nbsp;equivalent&nbsp;to&nbsp;original&nbsp;OpenIG&nbsp;config?<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableCookieManagement();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setProxyAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setTargetAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ApacheHttpClientImpl(builder.build(),&nbsp;storage);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,21&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Provides&nbsp;{@link&nbsp;org.forgerock.http.Client&nbsp;client}&nbsp;client&nbsp;integration&nbsp;with<br>
-&nbsp;*&nbsp;Apache&nbsp;HttpComponents&nbsp;HttpClient.<br>
-&nbsp;*/<br>
-package&nbsp;org.forgerock.http.apache.httpclient;<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,17&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-#<br>
-#&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-#&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-#&nbsp;License.<br>
-#<br>
-#&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-#&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-#<br>
-#&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-#&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-#&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-#&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-#<br>
-#&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-#<br>
-<br>
-org.forgerock.http.apache.httpclient.ApacheHttpClientImplProvider<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpapachehttpclientsrctestjavaorgforgerockhttpapachehttpclientApacheHttpClientImplTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,112&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.http.apache.httpclient;<br>
-<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.builder.stub.StubHttp.whenHttp;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.status;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.post;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.withPostBody;<br>
-import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.withPostBodyContaining;<br>
-import&nbsp;static&nbsp;java.lang.String.format;<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-<br>
-import&nbsp;org.forgerock.http.Client;<br>
-import&nbsp;org.forgerock.http.protocol.Request;<br>
-import&nbsp;org.forgerock.http.protocol.Status;<br>
-import&nbsp;org.glassfish.grizzly.http.util.HttpStatus;<br>
-import&nbsp;org.testng.annotations.AfterTest;<br>
-import&nbsp;org.testng.annotations.BeforeMethod;<br>
-import&nbsp;org.testng.annotations.BeforeTest;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-import&nbsp;com.google.common.base.Predicate;<br>
-import&nbsp;com.google.common.base.Predicates;<br>
-import&nbsp;com.xebialabs.restito.semantics.Call;<br>
-import&nbsp;com.xebialabs.restito.semantics.Condition;<br>
-import&nbsp;com.xebialabs.restito.server.StubServer;<br>
-<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;class&nbsp;ApacheHttpClientImplTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;can&nbsp;we&nbsp;test&nbsp;connection&nbsp;pooling,&nbsp;reuse,&nbsp;SSL,&nbsp;HTTP&nbsp;version,&nbsp;etc?<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;StubServer&nbsp;server;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeTest<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;mock&nbsp;HTTP&nbsp;server.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;=&nbsp;new&nbsp;StubServer().run();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@AfterTest<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;tearDown()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.stop();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanup()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Clear&nbsp;mocked&nbsp;invocations&nbsp;between&nbsp;tests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;So&nbsp;we&nbsp;can&nbsp;reuse&nbsp;the&nbsp;server&nbsp;instance&nbsp;(less&nbsp;traces)&nbsp;still&nbsp;having&nbsp;isolation<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(server&nbsp;!=&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getCalls().clear();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getStubs().clear();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSendPostHttpMessageWithEntityContent()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/test&amp;quot;),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withPostBodyContaining(&amp;quot;Hello&amp;quot;))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(status(HttpStatus.OK_200));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/test&amp;quot;,&nbsp;server.getPort()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.getEntity().setString(&amp;quot;Hello&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(client.send(request).getStatus()).isEqualTo(Status.OK);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSendPostHttpMessageWithEmptyEntity()&nbsp;throws&nbsp;Exception&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/test&amp;quot;),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not(withPostBody()))<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(status(HttpStatus.OK_200));<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/test&amp;quot;,&nbsp;server.getPort()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(client.send(request).getStatus()).isEqualTo(Status.OK);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Restito&nbsp;doesn't&nbsp;provide&nbsp;any&nbsp;way&nbsp;to&nbsp;express&nbsp;a&nbsp;negative&nbsp;condition&nbsp;yet.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Condition&nbsp;not(final&nbsp;Condition&nbsp;condition)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;MyCondition(Predicates.not(condition.getPredicate()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;And&nbsp;Condition&nbsp;has&nbsp;a&nbsp;unique&nbsp;protected&nbsp;constructor.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;MyCondition&nbsp;extends&nbsp;Condition&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;MyCondition(final&nbsp;Predicate&amp;lt;Call&amp;gt;&nbsp;predicate)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(predicate);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncpomxmlfromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/pom.xml&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/pom.xml)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,63&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;!--<br>
+&nbsp;&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;&nbsp;License.<br>
+<br>
+&nbsp;&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+<br>
+&nbsp;&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+<br>
+&nbsp;&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+--&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-client-apache-async&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;Async&nbsp;HttpClient&nbsp;integration&amp;lt;/name&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;httpasyncclient&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.1&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-client-apache-common&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.assertj&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;assertj-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;com.xebialabs.restito&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;restito&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncAsyncClientjavafromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClient.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,86&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.client.async;<br>
+<br>
+import&nbsp;static&nbsp;java.lang.String.format;<br>
+<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+import&nbsp;org.apache.http.HttpResponse;<br>
+import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
+import&nbsp;org.apache.http.concurrent.FutureCallback;<br>
+import&nbsp;org.apache.http.impl.nio.client.CloseableHttpAsyncClient;<br>
+import&nbsp;org.forgerock.http.client.ahc.AbstractClient;<br>
+import&nbsp;org.forgerock.http.io.Buffer;<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Response;<br>
+import&nbsp;org.forgerock.http.protocol.Status;<br>
+import&nbsp;org.forgerock.util.Factory;<br>
+import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+import&nbsp;org.forgerock.util.promise.PromiseImpl;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&nbsp;based&nbsp;implementation.<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;AsyncClient&nbsp;extends&nbsp;AbstractClient&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CloseableHttpAsyncClient&nbsp;client;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;AsyncClient(final&nbsp;CloseableHttpAsyncClient&nbsp;client,&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(storage);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Client&nbsp;should&nbsp;already&nbsp;be&nbsp;started<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.client&nbsp;=&nbsp;client;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;sendAsync(final&nbsp;Request&nbsp;request)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpUriRequest&nbsp;clientRequest&nbsp;=&nbsp;createHttpUriRequest(request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;request&nbsp;and&nbsp;return&nbsp;the&nbsp;configured&nbsp;Promise<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.execute(clientRequest,&nbsp;new&nbsp;FutureCallback&amp;lt;HttpResponse&amp;gt;()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;completed(final&nbsp;HttpResponse&nbsp;result)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;createResponse(result);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;failed(final&nbsp;Exception&nbsp;ex)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;new&nbsp;Response(Status.BAD_GATEWAY);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setEntity(format(&amp;quot;Failed&nbsp;to&nbsp;obtain&nbsp;response&nbsp;for&nbsp;%s&amp;quot;,&nbsp;request.getUri()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCause(ex);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cancelled()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failed(new&nbsp;InterruptedException(&amp;quot;Request&nbsp;processing&nbsp;has&nbsp;been&nbsp;cancelled&amp;quot;));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.close();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncAsyncClientProviderjavafromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncAsyncClientProviderjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/AsyncClientProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,181&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.client.async;<br>
+<br>
+import&nbsp;static&nbsp;java.util.concurrent.TimeUnit.MILLISECONDS;<br>
+<br>
+import&nbsp;java.security.GeneralSecurityException;<br>
+<br>
+import&nbsp;javax.net.ssl.SSLContext;<br>
+<br>
+import&nbsp;org.apache.http.HttpRequest;<br>
+import&nbsp;org.apache.http.HttpResponse;<br>
+import&nbsp;org.apache.http.ProtocolException;<br>
+import&nbsp;org.apache.http.client.RedirectStrategy;<br>
+import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
+import&nbsp;org.apache.http.config.Registry;<br>
+import&nbsp;org.apache.http.config.RegistryBuilder;<br>
+import&nbsp;org.apache.http.conn.ssl.SSLConnectionSocketFactory;<br>
+import&nbsp;org.apache.http.conn.ssl.X509HostnameVerifier;<br>
+import&nbsp;org.apache.http.impl.NoConnectionReuseStrategy;<br>
+import&nbsp;org.apache.http.impl.nio.client.CloseableHttpAsyncClient;<br>
+import&nbsp;org.apache.http.impl.nio.client.HttpAsyncClientBuilder;<br>
+import&nbsp;org.apache.http.impl.nio.client.HttpAsyncClients;<br>
+import&nbsp;org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager;<br>
+import&nbsp;org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor;<br>
+import&nbsp;org.apache.http.impl.nio.reactor.IOReactorConfig;<br>
+import&nbsp;org.apache.http.nio.conn.NoopIOSessionStrategy;<br>
+import&nbsp;org.apache.http.nio.conn.SchemeIOSessionStrategy;<br>
+import&nbsp;org.apache.http.nio.conn.ssl.SSLIOSessionStrategy;<br>
+import&nbsp;org.apache.http.nio.reactor.ConnectingIOReactor;<br>
+import&nbsp;org.apache.http.nio.reactor.IOReactorException;<br>
+import&nbsp;org.apache.http.protocol.HttpContext;<br>
+import&nbsp;org.forgerock.http.Client;<br>
+import&nbsp;org.forgerock.http.HttpApplicationException;<br>
+import&nbsp;org.forgerock.http.client.ahc.NoAuthenticationStrategy;<br>
+import&nbsp;org.forgerock.http.io.Buffer;<br>
+import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
+import&nbsp;org.forgerock.http.spi.ClientImplProvider;<br>
+import&nbsp;org.forgerock.util.Factory;<br>
+import&nbsp;org.forgerock.util.Option;<br>
+import&nbsp;org.forgerock.util.Options;<br>
+import&nbsp;org.forgerock.util.time.Duration;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Creates&nbsp;and&nbsp;configures&nbsp;a&nbsp;{@link&nbsp;ClientImpl}&nbsp;instance&nbsp;built&nbsp;around&nbsp;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&nbsp;component.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;https://hc.apache.org/httpcomponents-asyncclient-dev/index.html&amp;quot;&amp;gt;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&amp;lt;/a&amp;gt;<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;AsyncClientProvider&nbsp;implements&nbsp;ClientImplProvider&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Specify&nbsp;the&nbsp;number&nbsp;of&nbsp;worker&nbsp;threads.&nbsp;If&nbsp;not&nbsp;set,&nbsp;the&nbsp;async&nbsp;client&nbsp;implementation&nbsp;manages&nbsp;this&nbsp;setting&nbsp;itself<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(by&nbsp;default&nbsp;this&nbsp;is&nbsp;number&nbsp;of&nbsp;CPU&nbsp;+&nbsp;1).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Option&amp;lt;Integer&amp;gt;&nbsp;OPTION_WORKER_THREADS&nbsp;=&nbsp;Option.of(Integer.class,&nbsp;null);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;A&nbsp;redirect&nbsp;strategy&nbsp;that&nbsp;never&nbsp;performs&nbsp;a&nbsp;redirect.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;RedirectStrategy&nbsp;DISABLE_REDIRECT&nbsp;=&nbsp;new&nbsp;RedirectStrategy()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;isRedirected(final&nbsp;HttpRequest&nbsp;request,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;ProtocolException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HttpUriRequest&nbsp;getRedirect(final&nbsp;HttpRequest&nbsp;request,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;ProtocolException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ClientImpl&nbsp;newClientImpl(final&nbsp;Options&nbsp;options)&nbsp;throws&nbsp;HttpApplicationException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage&nbsp;=&nbsp;options.get(Client.OPTION_TEMPORARY_STORAGE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SSL<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;SSLContext&nbsp;sslContext;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sslContext&nbsp;=&nbsp;SSLContext.getInstance(&amp;quot;TLS&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sslContext.init(options.get(Client.OPTION_KEY_MANAGERS),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.get(Client.OPTION_TRUST_MANAGERS),&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;GeneralSecurityException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(&amp;quot;Can't&nbsp;create&nbsp;SSL&nbsp;Context&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509HostnameVerifier&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.STRICT_HOSTNAME_VERIFIER;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(options.get(Client.OPTION_HOSTNAME_VERIFIER))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ALLOW_ALL:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;BROWSER_COMPATIBLE:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifier&nbsp;=&nbsp;SSLConnectionSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;registry&nbsp;of&nbsp;custom&nbsp;connection&nbsp;session&nbsp;strategies&nbsp;for&nbsp;supported&nbsp;protocol&nbsp;schemes<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Registry&amp;lt;SchemeIOSessionStrategy&amp;gt;&nbsp;registry&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegistryBuilder.&amp;lt;SchemeIOSessionStrategy&amp;gt;create()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.register(&amp;quot;http&amp;quot;,&nbsp;NoopIOSessionStrategy.INSTANCE)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.register(&amp;quot;https&amp;quot;,&nbsp;new&nbsp;SSLIOSessionStrategy(sslContext,&nbsp;verifier))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Timeouts<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;soTimeout&nbsp;=&nbsp;options.get(Client.OPTION_SO_TIMEOUT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;connectTimeout&nbsp;=&nbsp;options.get(Client.OPTION_CONNECT_TIMEOUT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME&nbsp;GSA&nbsp;Can&nbsp;we&nbsp;support&nbsp;requestConnectTimeout&nbsp;?<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;I/O&nbsp;reactor&nbsp;configuration<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOReactorConfig.Builder&nbsp;reactorBuilder&nbsp;=&nbsp;IOReactorConfig.custom();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!connectTimeout.isUnlimited())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setConnectTimeout((int)&nbsp;connectTimeout.to(MILLISECONDS));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!soTimeout.isUnlimited())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setSoTimeout((int)&nbsp;soTimeout.to(MILLISECONDS));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer&nbsp;threadCount&nbsp;=&nbsp;options.get(OPTION_WORKER_THREADS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(threadCount&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactorBuilder.setIoThreadCount(threadCount);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOReactorConfig&nbsp;ioReactorConfig&nbsp;=&nbsp;reactorBuilder.build();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;custom&nbsp;I/O&nbsp;reactor<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConnectingIOReactor&nbsp;reactor;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor&nbsp;=&nbsp;new&nbsp;DefaultConnectingIOReactor(ioReactorConfig);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOReactorException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(&amp;quot;Cannot&nbsp;create&nbsp;I/O&nbsp;Reactor&amp;quot;,&nbsp;e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;connection&nbsp;manager&nbsp;with&nbsp;custom&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PoolingNHttpClientConnectionManager&nbsp;manager&nbsp;=&nbsp;new&nbsp;PoolingNHttpClientConnectionManager(reactor,&nbsp;registry);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Connection&nbsp;pooling<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;maxConnections&nbsp;=&nbsp;options.get(Client.OPTION_MAX_CONNECTIONS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager.setMaxTotal(maxConnections);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager.setDefaultMaxPerRoute(maxConnections);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME&nbsp;GSA&nbsp;Couldn't&nbsp;find&nbsp;how&nbsp;to&nbsp;configure&nbsp;retries&nbsp;in&nbsp;async&nbsp;http&nbsp;client<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//if&nbsp;(!options.get(Client.OPTION_RETRY_REQUESTS))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;builder.disableAutomaticRetries();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;client&nbsp;with&nbsp;the&nbsp;given&nbsp;custom&nbsp;dependencies&nbsp;and&nbsp;configuration.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpAsyncClientBuilder&nbsp;builder&nbsp;=&nbsp;HttpAsyncClients.custom();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_REUSE_CONNECTIONS))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setConnectionReuseStrategy(NoConnectionReuseStrategy.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;Uncomment&nbsp;when&nbsp;we'll&nbsp;have&nbsp;a&nbsp;user-agent&nbsp;Option<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;builder.setUserAgent(&amp;quot;CHF/1.0&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseableHttpAsyncClient&nbsp;client&nbsp;=&nbsp;builder.setConnectionManager(manager)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.disableCookieManagement()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setRedirectStrategy(DISABLE_REDIRECT)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setTargetAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setProxyAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.start();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AsyncClient(client,&nbsp;storage);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainjavaorgforgerockhttpclientasyncpackageinfojavafromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainjavaorgforgerockhttpclientasyncpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/java/org/forgerock/http/client/async/package-info.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/java/org/forgerock/http/client/async/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,23&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;{@link&nbsp;org.forgerock.http.Client&nbsp;client}&nbsp;integration&nbsp;with<br>
+&nbsp;*&nbsp;Apache&nbsp;HttpComponents&nbsp;Http&nbsp;Async&nbsp;Client.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;https://hc.apache.org/httpcomponents-asyncclient-dev/index.html&amp;quot;&amp;gt;Apache&nbsp;HTTP&nbsp;Async&nbsp;Client&amp;lt;/a&amp;gt;<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.http.client.async;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProviderfromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,17&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+#<br>
+#&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+#&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+#&nbsp;License.<br>
+#<br>
+#&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+#&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+#<br>
+#&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+#&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+#&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+#&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+#<br>
+#&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+#<br>
+<br>
+org.forgerock.http.client.async.AsyncClientProvider<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapacheasyncsrctestjavaorgforgerockhttpclientasyncAsyncClientTestjavafromrev3378forgerockhttpframeworktrunkhttpapacheasynchttpclientsrctestjavaorgforgerockhttpclientasyncAsyncClientTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-asynchttpclient/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-async/src/test/java/org/forgerock/http/client/async/AsyncClientTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,161&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.client.async;<br>
+<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.builder.stub.StubHttp.whenHttp;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.composite;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.ok;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.stringContent;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.post;<br>
+import&nbsp;static&nbsp;java.lang.String.format;<br>
+import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
+<br>
+import&nbsp;java.util.ArrayList;<br>
+import&nbsp;java.util.List;<br>
+import&nbsp;java.util.concurrent.CountDownLatch;<br>
+<br>
+import&nbsp;org.forgerock.http.Client;<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Response;<br>
+import&nbsp;org.forgerock.http.protocol.Status;<br>
+import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+import&nbsp;org.forgerock.util.promise.ResultHandler;<br>
+import&nbsp;org.testng.annotations.AfterTest;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.BeforeTest;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;com.xebialabs.restito.semantics.Applicable;<br>
+import&nbsp;com.xebialabs.restito.server.StubServer;<br>
+<br>
+@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
+public&nbsp;class&nbsp;AsyncClientTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;StubServer&nbsp;server;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;mock&nbsp;HTTP&nbsp;server.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;=&nbsp;new&nbsp;StubServer().run();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@AfterTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;tearDown()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.stop();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanup()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Clear&nbsp;mocked&nbsp;invocations&nbsp;between&nbsp;tests<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;So&nbsp;we&nbsp;can&nbsp;reuse&nbsp;the&nbsp;server&nbsp;instance&nbsp;(less&nbsp;traces)&nbsp;still&nbsp;having&nbsp;isolation<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(server&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getCalls().clear();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getStubs().clear();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProducesResponse()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok(),&nbsp;stringContent(&amp;quot;Pong&amp;quot;)));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;client.send(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getStatus()).isEqualTo(Status.OK);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getEntity().getString()).isEqualTo(&amp;quot;Pong&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldProcessResponsesAsynchronouslyNotWithCallerThread()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok()));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;By&nbsp;default,&nbsp;the&nbsp;client&nbsp;has&nbsp;a&nbsp;pool&nbsp;of&nbsp;less&nbsp;than&nbsp;10&nbsp;threads<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&amp;lt;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&amp;gt;&nbsp;promises&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ArrayList&amp;lt;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;20;&nbsp;i++)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promises.add(client.sendAsync(request)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenOnResult(new&nbsp;ResultHandler&amp;lt;Response&amp;gt;()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleResult(final&nbsp;Response&nbsp;result)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;=&nbsp;Thread.currentThread().getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.getHeaders().putSingle(&amp;quot;thread-name&amp;quot;,&nbsp;name);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;response&nbsp;processing&nbsp;thread&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;calling&nbsp;thread<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;threadName&nbsp;=&nbsp;Thread.currentThread().getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;:&nbsp;promises)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Wait&nbsp;for&nbsp;each&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;promise.get();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(response.getHeaders().getFirst(&amp;quot;thread-name&amp;quot;)).isNotEqualTo(threadName);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;test&nbsp;is&nbsp;performing&nbsp;a&nbsp;single&nbsp;request&nbsp;that&nbsp;is&nbsp;being&nbsp;blocked&nbsp;on&nbsp;the&nbsp;server&nbsp;side&nbsp;until&nbsp;a&nbsp;latch&nbsp;is&nbsp;released.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;ensure&nbsp;that,&nbsp;because&nbsp;the&nbsp;main&nbsp;thread&nbsp;is&nbsp;blocked,&nbsp;the&nbsp;processing&nbsp;is&nbsp;done&nbsp;in&nbsp;another&nbsp;thread.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldDoTheProcessingAsynchronously()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CountDownLatch&nbsp;one&nbsp;=&nbsp;new&nbsp;CountDownLatch(1);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/ping&amp;quot;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(composite(ok(),&nbsp;new&nbsp;WaitForLatch(one)));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/ping&amp;quot;,&nbsp;server.getPort()));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;promise&nbsp;=&nbsp;client.sendAsync(request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;We're&nbsp;still&nbsp;waiting&nbsp;for&nbsp;the&nbsp;server's&nbsp;response<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise.isDone()).isFalse();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Unlock&nbsp;server<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one.countDown();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Verify&nbsp;the&nbsp;response&nbsp;(block&nbsp;until&nbsp;reception)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(promise.get().getStatus()).isEqualTo(Status.OK);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;WaitForLatch&nbsp;implements&nbsp;Applicable&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CountDownLatch&nbsp;one;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;WaitForLatch(final&nbsp;CountDownLatch&nbsp;one)&nbsp;{this.one&nbsp;=&nbsp;one;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;org.glassfish.grizzly.http.server.Response&nbsp;apply(final&nbsp;org.glassfish.grizzly.http.server.Response&nbsp;r)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one.await();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(InterruptedException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachecommonpomxmlfromrev3378forgerockhttpframeworktrunkhttpapacheclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-common/pom.xml&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-client/pom.xml)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-common/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-common/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,48&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;!--<br>
+&nbsp;&nbsp;~&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;&nbsp;~&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;&nbsp;~&nbsp;License.<br>
+&nbsp;&nbsp;~<br>
+&nbsp;&nbsp;~&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;~&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;&nbsp;~<br>
+&nbsp;&nbsp;~&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;&nbsp;~&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;&nbsp;~&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;&nbsp;~&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;&nbsp;~<br>
+&nbsp;&nbsp;~&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;&nbsp;--&amp;gt;<br>
+<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-client-apache-common&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;HttpClient(s)&nbsp;base&amp;lt;/name&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;httpclient&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;!--&nbsp;This&nbsp;dependency&nbsp;is&nbsp;inherited&nbsp;by&nbsp;both&nbsp;the&nbsp;synchronous&nbsp;and&nbsp;asynchronous&nbsp;AHC&nbsp;CHF&nbsp;Drivers.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;asynchronous&nbsp;driver&nbsp;has&nbsp;a&nbsp;dependency&nbsp;on&nbsp;'httpasyncclient'&nbsp;(that&nbsp;itself&nbsp;depends&nbsp;on&nbsp;'httpclient'),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;make&nbsp;sure&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;incompatibility&nbsp;before&nbsp;updating&nbsp;theses&nbsp;versions&nbsp;--&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;4.4.1&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcAbstractClientjavafromrev3378forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcAbstractClientjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/AbstractClient.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,187&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.client.ahc;<br>
+<br>
+import&nbsp;java.io.IOException;<br>
+import&nbsp;java.util.Arrays;<br>
+<br>
+import&nbsp;org.apache.http.Header;<br>
+import&nbsp;org.apache.http.HeaderIterator;<br>
+import&nbsp;org.apache.http.HttpEntity;<br>
+import&nbsp;org.apache.http.HttpResponse;<br>
+import&nbsp;org.apache.http.StatusLine;<br>
+import&nbsp;org.apache.http.client.methods.HttpEntityEnclosingRequestBase;<br>
+import&nbsp;org.apache.http.client.methods.HttpRequestBase;<br>
+import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
+import&nbsp;org.apache.http.entity.InputStreamEntity;<br>
+import&nbsp;org.forgerock.http.header.ConnectionHeader;<br>
+import&nbsp;org.forgerock.http.header.ContentEncodingHeader;<br>
+import&nbsp;org.forgerock.http.header.ContentLengthHeader;<br>
+import&nbsp;org.forgerock.http.header.ContentTypeHeader;<br>
+import&nbsp;org.forgerock.http.io.Buffer;<br>
+import&nbsp;org.forgerock.http.io.IO;<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Response;<br>
+import&nbsp;org.forgerock.http.protocol.Status;<br>
+import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
+import&nbsp;org.forgerock.http.util.CaseInsensitiveSet;<br>
+import&nbsp;org.forgerock.util.Factory;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;abstract&nbsp;client&nbsp;is&nbsp;used&nbsp;to&nbsp;share&nbsp;commonly&nbsp;used&nbsp;constants&nbsp;and&nbsp;methods<br>
+&nbsp;*&nbsp;in&nbsp;both&nbsp;synchronous&nbsp;and&nbsp;asynchronous&nbsp;Apache&nbsp;HTTP&nbsp;Client&nbsp;libraries.<br>
+&nbsp;*/<br>
+public&nbsp;abstract&nbsp;class&nbsp;AbstractClient&nbsp;implements&nbsp;ClientImpl&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;Headers&nbsp;that&nbsp;are&nbsp;suppressed&nbsp;in&nbsp;request.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;How&nbsp;should&nbsp;the&nbsp;the&nbsp;&amp;quot;Expect&amp;quot;&nbsp;header&nbsp;be&nbsp;handled?<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;CaseInsensitiveSet&nbsp;SUPPRESS_REQUEST_HEADERS&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrays.asList(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;populated&nbsp;in&nbsp;outgoing&nbsp;request&nbsp;by&nbsp;EntityRequest&nbsp;(HttpEntityEnclosingRequestBase):<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Content-Encoding&amp;quot;,&nbsp;&amp;quot;Content-Length&amp;quot;,&nbsp;&amp;quot;Content-Type&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hop-by-hop&nbsp;headers,&nbsp;not&nbsp;forwarded&nbsp;by&nbsp;proxies,&nbsp;per&nbsp;RFC&nbsp;2616&nbsp;13.5.1:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Connection&amp;quot;,&nbsp;&amp;quot;Keep-Alive&amp;quot;,&nbsp;&amp;quot;Proxy-Authenticate&amp;quot;,&nbsp;&amp;quot;Proxy-Authorization&amp;quot;,&nbsp;&amp;quot;TE&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Trailers&amp;quot;,&nbsp;&amp;quot;Transfer-Encoding&amp;quot;,&nbsp;&amp;quot;Upgrade&amp;quot;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;Headers&nbsp;that&nbsp;are&nbsp;suppressed&nbsp;in&nbsp;response.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;CaseInsensitiveSet&nbsp;SUPPRESS_RESPONSE_HEADERS&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrays.asList(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hop-by-hop&nbsp;headers,&nbsp;not&nbsp;forwarded&nbsp;by&nbsp;proxies,&nbsp;per&nbsp;RFC&nbsp;2616&nbsp;13.5.1:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Connection&amp;quot;,&nbsp;&amp;quot;Keep-Alive&amp;quot;,&nbsp;&amp;quot;Proxy-Authenticate&amp;quot;,&nbsp;&amp;quot;Proxy-Authorization&amp;quot;,&nbsp;&amp;quot;TE&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Trailers&amp;quot;,&nbsp;&amp;quot;Transfer-Encoding&amp;quot;,&nbsp;&amp;quot;Upgrade&amp;quot;));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Base&nbsp;constructor&nbsp;for&nbsp;AHC&nbsp;{@link&nbsp;ClientImpl}&nbsp;drivers.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;storage<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temporary&nbsp;storage&nbsp;area<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;AbstractClient(final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.storage&nbsp;=&nbsp;storage;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;A&nbsp;request&nbsp;that&nbsp;encloses&nbsp;an&nbsp;entity.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;EntityRequest&nbsp;extends&nbsp;HttpEntityEnclosingRequestBase&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;method;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;EntityRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.method&nbsp;=&nbsp;request.getMethod();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;InputStreamEntity&nbsp;entity&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InputStreamEntity(request.getEntity().getRawContentInputStream(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentLengthHeader.valueOf(request).getLength());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.setContentType(ContentTypeHeader.valueOf(request).toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.setContentEncoding(ContentEncodingHeader.valueOf(request).toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setEntity(entity);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getMethod()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;method;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;A&nbsp;request&nbsp;that&nbsp;does&nbsp;not&nbsp;enclose&nbsp;an&nbsp;entity.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;NonEntityRequest&nbsp;extends&nbsp;HttpRequestBase&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;method;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;NonEntityRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.method&nbsp;=&nbsp;request.getMethod();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Header[]&nbsp;contentLengthHeader&nbsp;=&nbsp;getHeaders(ContentLengthHeader.NAME);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((contentLengthHeader&nbsp;==&nbsp;null&nbsp;||&nbsp;contentLengthHeader.length&nbsp;==&nbsp;0)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;amp;&amp;amp;&nbsp;(&amp;quot;PUT&amp;quot;.equals(method)&nbsp;||&nbsp;&amp;quot;POST&amp;quot;.equals(method)&nbsp;||&nbsp;&amp;quot;PROPFIND&amp;quot;.equals(method)))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setHeader(ContentLengthHeader.NAME,&nbsp;&amp;quot;0&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getMethod()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;method;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;{@link&nbsp;HttpUriRequest}&nbsp;populated&nbsp;from&nbsp;the&nbsp;given&nbsp;{@code&nbsp;request}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;returned&nbsp;message&nbsp;has&nbsp;some&nbsp;of&nbsp;its&nbsp;headers&nbsp;filtered/ignored&nbsp;(proxy&nbsp;behaviour).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;OpenIG&nbsp;request&nbsp;structure<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;AHC&nbsp;request&nbsp;structure<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;HttpUriRequest&nbsp;createHttpUriRequest(final&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;the&nbsp;Http&nbsp;request&nbsp;depending&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;entity&nbsp;or&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpRequestBase&nbsp;clientRequest&nbsp;=&nbsp;request.getEntity().mayContainData()<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;new&nbsp;EntityRequest(request)&nbsp;:&nbsp;new&nbsp;NonEntityRequest(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientRequest.setURI(request.getUri().asURI());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Parse&nbsp;request&nbsp;Connection&nbsp;headers&nbsp;to&nbsp;be&nbsp;suppressed&nbsp;in&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CaseInsensitiveSet&nbsp;removableHeaderNames&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removableHeaderNames.addAll(ConnectionHeader.valueOf(request).getTokens());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Populates&nbsp;request&nbsp;headers<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(String&nbsp;name&nbsp;:&nbsp;request.getHeaders().keySet())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SUPPRESS_REQUEST_HEADERS.contains(name)&nbsp;&amp;amp;&amp;amp;&nbsp;!removableHeaderNames.contains(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;String&nbsp;value&nbsp;:&nbsp;request.getHeaders().get(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientRequest.addHeader(name,&nbsp;value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clientRequest;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;{@link&nbsp;Response}&nbsp;populated&nbsp;from&nbsp;the&nbsp;given&nbsp;AHC&nbsp;{@code&nbsp;result}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;returned&nbsp;message&nbsp;has&nbsp;some&nbsp;of&nbsp;its&nbsp;headers&nbsp;filtered/ignored&nbsp;(proxy&nbsp;behaviour).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;result&nbsp;AHC&nbsp;response&nbsp;structure<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;openIG&nbsp;response&nbsp;structure<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;Response&nbsp;createResponse(final&nbsp;HttpResponse&nbsp;result)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;new&nbsp;Response();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;entity<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpEntity&nbsp;entity&nbsp;=&nbsp;result.getEntity();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(entity&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setEntity(IO.newBranchingInputStream(entity.getContent(),&nbsp;storage));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(Status.INTERNAL_SERVER_ERROR);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCause(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;status&nbsp;line<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StatusLine&nbsp;statusLine&nbsp;=&nbsp;result.getStatusLine();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setVersion(statusLine.getProtocolVersion().toString());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setStatus(Status.valueOf(statusLine.getStatusCode(),&nbsp;statusLine.getReasonPhrase()));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Parse&nbsp;response&nbsp;Connection&nbsp;headers&nbsp;to&nbsp;be&nbsp;suppressed&nbsp;in&nbsp;message<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CaseInsensitiveSet&nbsp;removableHeaderNames&nbsp;=&nbsp;new&nbsp;CaseInsensitiveSet();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removableHeaderNames.addAll(ConnectionHeader.valueOf(response).getTokens());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Response&nbsp;headers<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(HeaderIterator&nbsp;i&nbsp;=&nbsp;result.headerIterator();&nbsp;i.hasNext();)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;header&nbsp;=&nbsp;i.nextHeader();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;=&nbsp;header.getName();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SUPPRESS_RESPONSE_HEADERS.contains(name)&nbsp;&amp;amp;&amp;amp;&nbsp;!removableHeaderNames.contains(name))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getHeaders().add(name,&nbsp;header.getValue());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcNoAuthenticationStrategyjavafromrev3378forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcNoAuthenticationStrategyjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/NoAuthenticationStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,83&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.client.ahc;<br>
+<br>
+import&nbsp;java.util.Collections;<br>
+import&nbsp;java.util.LinkedList;<br>
+import&nbsp;java.util.Map;<br>
+import&nbsp;java.util.Queue;<br>
+<br>
+import&nbsp;org.apache.http.Header;<br>
+import&nbsp;org.apache.http.HttpHost;<br>
+import&nbsp;org.apache.http.HttpResponse;<br>
+import&nbsp;org.apache.http.auth.AuthOption;<br>
+import&nbsp;org.apache.http.auth.AuthScheme;<br>
+import&nbsp;org.apache.http.auth.MalformedChallengeException;<br>
+import&nbsp;org.apache.http.client.AuthenticationStrategy;<br>
+import&nbsp;org.apache.http.protocol.HttpContext;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;An&nbsp;authentication&nbsp;strategy&nbsp;that&nbsp;never&nbsp;performs&nbsp;authentication.<br>
+&nbsp;*/<br>
+public&nbsp;final&nbsp;class&nbsp;NoAuthenticationStrategy&nbsp;implements&nbsp;AuthenticationStrategy&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;An&nbsp;{@link&nbsp;AuthenticationStrategy}&nbsp;singleton&nbsp;instance&nbsp;that&nbsp;never&nbsp;performs&nbsp;authentication.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;AuthenticationStrategy&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;NoAuthenticationStrategy();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Singleton&nbsp;only.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;NoAuthenticationStrategy()&nbsp;{&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;authFailed(final&nbsp;HttpHost&nbsp;host,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthScheme&nbsp;authScheme,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;authSucceeded(final&nbsp;HttpHost&nbsp;host,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthScheme&nbsp;authScheme,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Map&amp;lt;String,&nbsp;Header&amp;gt;&nbsp;getChallenges(final&nbsp;HttpHost&nbsp;host,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;MalformedChallengeException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Collections.emptyMap();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;isAuthenticationRequested(final&nbsp;HttpHost&nbsp;host,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Queue&amp;lt;AuthOption&amp;gt;&nbsp;select(final&nbsp;Map&amp;lt;String,&nbsp;Header&amp;gt;&nbsp;challenges,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpHost&nbsp;host,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpResponse&nbsp;response,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpContext&nbsp;context)&nbsp;throws&nbsp;MalformedChallengeException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;LinkedList&amp;lt;AuthOption&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachecommonsrcmainjavaorgforgerockhttpclientahcpackageinfojavafromrev3378forgerockhttpframeworktrunkhttpapacheclientsrcmainjavaorgforgerockhttpclientahcpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-client/src/main/java/org/forgerock/http/client/ahc/package-info.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-common/src/main/java/org/forgerock/http/client/ahc/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,20&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;{@literal&nbsp;ahc}&nbsp;stands&nbsp;for&nbsp;Apache&nbsp;Http&nbsp;Client.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.http.client.ahc;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncpomxmlfromrev3378forgerockhttpframeworktrunkhttpapachehttpclientpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/pom.xml&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/pom.xml)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,60&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+&amp;lt;?xml&nbsp;version=&amp;quot;1.0&amp;quot;&nbsp;encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;<br>
+&amp;lt;!--<br>
+&nbsp;&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;&nbsp;License.<br>
+<br>
+&nbsp;&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+<br>
+&nbsp;&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+<br>
+&nbsp;&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
+--&amp;gt;<br>
+&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;<br>
+&nbsp;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;parent&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;forgerock-http-framework&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/parent&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-client-apache-sync&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;packaging&amp;gt;bundle&amp;lt;/packaging&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;name&amp;gt;HTTP&nbsp;Apache&nbsp;HttpClient&nbsp;integration&amp;lt;/name&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;dependencies&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-client-apache-common&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.assertj&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;assertj-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;mockito-all&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.testng&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;testng&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;com.xebialabs.restito&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;restito&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
+&amp;lt;/project&amp;gt;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImpljavafromrev3378forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImpljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImpl.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,68&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2009&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
+&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2010–2011&nbsp;ApexIdentity&nbsp;Inc.<br>
+&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2011-2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.apache.httpclient;<br>
+<br>
+import&nbsp;java.io.IOException;<br>
+<br>
+import&nbsp;org.apache.http.HttpResponse;<br>
+import&nbsp;org.apache.http.client.methods.HttpUriRequest;<br>
+import&nbsp;org.apache.http.impl.client.CloseableHttpClient;<br>
+import&nbsp;org.forgerock.http.client.ahc.AbstractClient;<br>
+import&nbsp;org.forgerock.http.io.Buffer;<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Response;<br>
+import&nbsp;org.forgerock.http.protocol.Status;<br>
+import&nbsp;org.forgerock.util.Factory;<br>
+import&nbsp;org.forgerock.util.promise.NeverThrowsException;<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+import&nbsp;org.forgerock.util.promise.Promises;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Apache&nbsp;HTTP&nbsp;Client&nbsp;implementation.<br>
+&nbsp;*/<br>
+final&nbsp;class&nbsp;ApacheHttpClientImpl&nbsp;extends&nbsp;AbstractClient&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;The&nbsp;Apache&nbsp;HTTP&nbsp;client&nbsp;to&nbsp;transmit&nbsp;requests&nbsp;through.&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;CloseableHttpClient&nbsp;httpClient;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;ApacheHttpClientImpl(final&nbsp;CloseableHttpClient&nbsp;httpClient,&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(storage);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.httpClient&nbsp;=&nbsp;httpClient;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpClient.close();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Response,&nbsp;NeverThrowsException&amp;gt;&nbsp;sendAsync(final&nbsp;Request&nbsp;request)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Convert&nbsp;the&nbsp;request&nbsp;to&nbsp;AHC&nbsp;then&nbsp;send&nbsp;it<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpUriRequest&nbsp;clientRequest&nbsp;=&nbsp;createHttpUriRequest(request);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpResponse&nbsp;clientResponse&nbsp;=&nbsp;httpClient.execute(clientRequest);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Convert&nbsp;the&nbsp;AHC&nbsp;response&nbsp;back&nbsp;into&nbsp;OpenIG<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;response&nbsp;=&nbsp;createResponse(clientResponse);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Promises.newResultPromise(response);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;IOException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Promises.newResultPromise(new&nbsp;Response().setStatus(Status.INTERNAL_SERVER_ERROR));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImplProviderjavafromrev3378forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientApacheHttpClientImplProviderjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,108&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2009&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
+&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2010–2011&nbsp;ApexIdentity&nbsp;Inc.<br>
+&nbsp;*&nbsp;Portions&nbsp;Copyright&nbsp;2011-2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.apache.httpclient;<br>
+<br>
+import&nbsp;static&nbsp;java.util.concurrent.TimeUnit.MILLISECONDS;<br>
+<br>
+import&nbsp;java.security.GeneralSecurityException;<br>
+<br>
+import&nbsp;javax.net.ssl.SSLContext;<br>
+<br>
+import&nbsp;org.apache.http.client.config.RequestConfig;<br>
+import&nbsp;org.apache.http.conn.ssl.SSLConnectionSocketFactory;<br>
+import&nbsp;org.apache.http.impl.NoConnectionReuseStrategy;<br>
+import&nbsp;org.apache.http.impl.client.HttpClientBuilder;<br>
+import&nbsp;org.forgerock.http.Client;<br>
+import&nbsp;org.forgerock.http.HttpApplicationException;<br>
+import&nbsp;org.forgerock.http.client.ahc.NoAuthenticationStrategy;<br>
+import&nbsp;org.forgerock.http.io.Buffer;<br>
+import&nbsp;org.forgerock.http.spi.ClientImpl;<br>
+import&nbsp;org.forgerock.http.spi.ClientImplProvider;<br>
+import&nbsp;org.forgerock.util.Factory;<br>
+import&nbsp;org.forgerock.util.Options;<br>
+import&nbsp;org.forgerock.util.time.Duration;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;An&nbsp;HTTP&nbsp;client&nbsp;implementation&nbsp;provider&nbsp;for&nbsp;Apache&nbsp;HttpClient.<br>
+&nbsp;*/<br>
+public&nbsp;final&nbsp;class&nbsp;ApacheHttpClientImplProvider&nbsp;implements&nbsp;ClientImplProvider&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ClientImpl&nbsp;newClientImpl(final&nbsp;Options&nbsp;options)&nbsp;throws&nbsp;HttpApplicationException&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Factory&amp;lt;Buffer&amp;gt;&nbsp;storage&nbsp;=&nbsp;options.get(Client.OPTION_TEMPORARY_STORAGE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;HttpClientBuilder&nbsp;builder&nbsp;=&nbsp;HttpClientBuilder.create();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Connection&nbsp;pooling.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;maxConnections&nbsp;=&nbsp;options.get(Client.OPTION_MAX_CONNECTIONS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setMaxConnTotal(maxConnections);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setMaxConnPerRoute(maxConnections);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_REUSE_CONNECTIONS))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setConnectionReuseStrategy(NoConnectionReuseStrategy.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!options.get(Client.OPTION_RETRY_REQUESTS))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableAutomaticRetries();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Timeouts.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestConfig.Builder&nbsp;requestConfigBuilder&nbsp;=&nbsp;RequestConfig.custom();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;soTimeout&nbsp;=&nbsp;options.get(Client.OPTION_SO_TIMEOUT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestConfigBuilder.setSocketTimeout(soTimeout.isUnlimited()&nbsp;?&nbsp;0&nbsp;:&nbsp;(int)&nbsp;soTimeout<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.to(MILLISECONDS));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Duration&nbsp;connectTimeout&nbsp;=&nbsp;options.get(Client.OPTION_CONNECT_TIMEOUT);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestConfigBuilder.setConnectTimeout(connectTimeout.isUnlimited()&nbsp;?&nbsp;0<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;(int)&nbsp;connectTimeout.to(MILLISECONDS));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setDefaultRequestConfig(requestConfigBuilder.build());<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;where&nbsp;is&nbsp;this&nbsp;setting&nbsp;in&nbsp;HttpClient&nbsp;4.x?<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;HttpProtocolParams.setVersion(parameters,&nbsp;HttpVersion.HTTP_1_1);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableRedirectHandling();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SSL<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;SSLContext&nbsp;context;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context&nbsp;=&nbsp;SSLContext.getInstance(&amp;quot;TLS&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.init(options.get(Client.OPTION_KEY_MANAGERS),&nbsp;options<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(Client.OPTION_TRUST_MANAGERS),&nbsp;null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(final&nbsp;GeneralSecurityException&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;HttpApplicationException(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setSslcontext(context);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(options.get(Client.OPTION_HOSTNAME_VERIFIER))&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ALLOW_ALL:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;BROWSER_COMPATIBLE:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setHostnameVerifier(SSLConnectionSocketFactory.STRICT_HOSTNAME_VERIFIER);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FIXME:&nbsp;is&nbsp;this&nbsp;equivalent&nbsp;to&nbsp;original&nbsp;OpenIG&nbsp;config?<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.disableCookieManagement();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setProxyAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.setTargetAuthenticationStrategy(NoAuthenticationStrategy.INSTANCE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ApacheHttpClientImpl(builder.build(),&nbsp;storage);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncsrcmainjavaorgforgerockhttpapachehttpclientpackageinfojavafromrev3378forgerockhttpframeworktrunkhttpapachehttpclientsrcmainjavaorgforgerockhttpapachehttpclientpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/java/org/forgerock/http/apache/httpclient/package-info.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/java/org/forgerock/http/apache/httpclient/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;Copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Provides&nbsp;{@link&nbsp;org.forgerock.http.Client&nbsp;client}&nbsp;client&nbsp;integration&nbsp;with<br>
+&nbsp;*&nbsp;Apache&nbsp;HttpComponents&nbsp;HttpClient.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.http.apache.httpclient;<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProviderfromrev3378forgerockhttpframeworktrunkhttpapachehttpclientsrcmainresourcesMETAINFservicesorgforgerockhttpspiClientImplProvider&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/main/resources/META-INF/services/org.forgerock.http.spi.ClientImplProvider&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,17&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+#<br>
+#&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+#&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+#&nbsp;License.<br>
+#<br>
+#&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+#&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+#<br>
+#&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+#&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+#&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+#&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+#<br>
+#&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+#<br>
+<br>
+org.forgerock.http.apache.httpclient.ApacheHttpClientImplProvider<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkhttpclientapachesyncsrctestjavaorgforgerockhttpapachehttpclientApacheHttpClientImplTestjavafromrev3378forgerockhttpframeworktrunkhttpapachehttpclientsrctestjavaorgforgerockhttpapachehttpclientApacheHttpClientImplTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp;(from&nbsp;rev&nbsp;3378,&nbsp;forgerock-http-framework/trunk/http-apache-httpclient/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java)&nbsp;(0&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-http-framework/trunk/http-client-apache-sync/src/test/java/org/forgerock/http/apache/httpclient/ApacheHttpClientImplTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,112&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.http.apache.httpclient;<br>
+<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.builder.stub.StubHttp.whenHttp;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Action.status;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.post;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.withPostBody;<br>
+import&nbsp;static&nbsp;com.xebialabs.restito.semantics.Condition.withPostBodyContaining;<br>
+import&nbsp;static&nbsp;java.lang.String.format;<br>
+import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
+<br>
+import&nbsp;org.forgerock.http.Client;<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Status;<br>
+import&nbsp;org.glassfish.grizzly.http.util.HttpStatus;<br>
+import&nbsp;org.testng.annotations.AfterTest;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.BeforeTest;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+import&nbsp;com.google.common.base.Predicate;<br>
+import&nbsp;com.google.common.base.Predicates;<br>
+import&nbsp;com.xebialabs.restito.semantics.Call;<br>
+import&nbsp;com.xebialabs.restito.semantics.Condition;<br>
+import&nbsp;com.xebialabs.restito.server.StubServer;<br>
+<br>
+@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
+public&nbsp;class&nbsp;ApacheHttpClientImplTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;can&nbsp;we&nbsp;test&nbsp;connection&nbsp;pooling,&nbsp;reuse,&nbsp;SSL,&nbsp;HTTP&nbsp;version,&nbsp;etc?<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;StubServer&nbsp;server;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;mock&nbsp;HTTP&nbsp;server.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;=&nbsp;new&nbsp;StubServer().run();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@AfterTest<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;tearDown()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.stop();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;cleanup()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Clear&nbsp;mocked&nbsp;invocations&nbsp;between&nbsp;tests<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;So&nbsp;we&nbsp;can&nbsp;reuse&nbsp;the&nbsp;server&nbsp;instance&nbsp;(less&nbsp;traces)&nbsp;still&nbsp;having&nbsp;isolation<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(server&nbsp;!=&nbsp;null)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getCalls().clear();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.getStubs().clear();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSendPostHttpMessageWithEntityContent()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/test&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withPostBodyContaining(&amp;quot;Hello&amp;quot;))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(status(HttpStatus.OK_200));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/test&amp;quot;,&nbsp;server.getPort()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.getEntity().setString(&amp;quot;Hello&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(client.send(request).getStatus()).isEqualTo(Status.OK);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldSendPostHttpMessageWithEmptyEntity()&nbsp;throws&nbsp;Exception&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whenHttp(server).match(post(&amp;quot;/test&amp;quot;),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not(withPostBody()))<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(status(HttpStatus.OK_200));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;client&nbsp;=&nbsp;new&nbsp;Client();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;request&nbsp;=&nbsp;new&nbsp;Request();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(&amp;quot;POST&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setUri(format(&amp;quot;http://localhost:%d/test&amp;quot;,&nbsp;server.getPort()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(client.send(request).getStatus()).isEqualTo(Status.OK);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Restito&nbsp;doesn't&nbsp;provide&nbsp;any&nbsp;way&nbsp;to&nbsp;express&nbsp;a&nbsp;negative&nbsp;condition&nbsp;yet.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Condition&nbsp;not(final&nbsp;Condition&nbsp;condition)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;MyCondition(Predicates.not(condition.getPredicate()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;And&nbsp;Condition&nbsp;has&nbsp;a&nbsp;unique&nbsp;protected&nbsp;constructor.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;MyCondition&nbsp;extends&nbsp;Condition&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;MyCondition(final&nbsp;Predicate&amp;lt;Call&amp;gt;&nbsp;predicate)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(predicate);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockhttpframeworktrunkpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-http-framework/trunk/pom.xml&nbsp;(3378&nbsp;=&gt;&nbsp;3379)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-http-framework/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:04:32&nbsp;UTC&nbsp;(rev&nbsp;3378)<br>
+++&nbsp;forgerock-http-framework/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-06-01&nbsp;12:05:55&nbsp;UTC&nbsp;(rev&nbsp;3379)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-37,10&nbsp;+37,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&amp;lt;modules&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-core&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-servlet&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-apache-httpclient&amp;lt;/module&amp;gt;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-test&amp;lt;/module&amp;gt;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-apache-client&amp;lt;/module&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-apache-asynchttpclient&amp;lt;/module&amp;gt;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-client-apache-common&amp;lt;/module&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-client-apache-sync&amp;lt;/module&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;module&amp;gt;http-client-apache-async&amp;lt;/module&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&amp;lt;/modules&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&amp;lt;properties&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;maven.compiler.target&amp;gt;1.6&amp;lt;/maven.compiler.target&amp;gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
