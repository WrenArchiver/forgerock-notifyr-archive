<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[2970]&nbsp;forgerock-bloomfilter/trunk:&nbsp;Improve&nbsp;javadoc,&nbsp;tests&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=2970&quot;&gt;2970&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;neil.madden&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2015-02-25&nbsp;17:21:30&nbsp;+0000&nbsp;(Wed,&nbsp;25&nbsp;Feb&nbsp;2015)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;Improve&nbsp;javadoc,&nbsp;tests&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBatchingBloomFilterjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BatchingBloomFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterChainjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterChain.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterFactoryjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterFactory.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFiltersjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilters.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterConcurrencyStrategyjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrencyStrategy.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterConcurrentRollingBloomFilterjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterCopyOnWriteBloomFilterjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/CopyOnWriteBloomFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterSynchronizedBloomFilterjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/SynchronizedBloomFilter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterpackageinfojava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterBatchingBloomFilterTestjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BatchingBloomFilterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterBloomFilterChainTestjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BloomFilterChainTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterConcurrentRollingBloomFilterTestjava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkpomxml&quot;&gt;forgerock-bloomfilter/trunk/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterPooljava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterGeometricSeriesBloomFilterPooljava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/GeometricSeriesBloomFilterPool.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterPooljava&quot;&gt;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBatchingBloomFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BatchingBloomFilter.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BatchingBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BatchingBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-29,6&nbsp;+29,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;usage&nbsp;and&nbsp;a&nbsp;small&nbsp;additional&nbsp;overhead&nbsp;for&nbsp;reads,&nbsp;is&nbsp;that&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;{@link&nbsp;#add(Object)}&nbsp;method&nbsp;is&nbsp;no<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;longer&nbsp;accurate&nbsp;for&nbsp;any&nbsp;write&nbsp;that&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a&nbsp;buffer&nbsp;flush,&nbsp;and&nbsp;only&nbsp;returns&nbsp;an&nbsp;aggregate&nbsp;result&nbsp;for&nbsp;those<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;that&nbsp;do.<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;*<br>
+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;stored&nbsp;in&nbsp;this&nbsp;bloom&nbsp;filter.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;final&nbsp;class&nbsp;BatchingBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;delegate;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-66,7&nbsp;+68,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(buffer)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;changed&nbsp;=&nbsp;buffer.add(element);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer.size()&nbsp;&amp;gt;=&nbsp;batchSize)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;changed&nbsp;|=&nbsp;delegate.addAll(buffer);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;changed&nbsp;=&nbsp;delegate.addAll(buffer);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer.clear();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;changed;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilter.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,17&nbsp;+16,36&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;javax.annotation.concurrent.ThreadSafe;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;A&nbsp;type&nbsp;of&nbsp;set&nbsp;data&nbsp;structure&nbsp;for&nbsp;which&nbsp;the&nbsp;contains&nbsp;method&nbsp;may&nbsp;return&nbsp;false&nbsp;positives.&nbsp;Implementations&nbsp;typically<br>
-&nbsp;*&nbsp;can&nbsp;store&nbsp;very&nbsp;large&nbsp;numbers&nbsp;of&nbsp;elements&nbsp;in&nbsp;memory&nbsp;at&nbsp;the&nbsp;cost&nbsp;of&nbsp;some&nbsp;loss&nbsp;of&nbsp;accuracy&nbsp;in&nbsp;determining&nbsp;set<br>
-&nbsp;*&nbsp;membership.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;General&nbsp;interface&nbsp;contract&nbsp;for&nbsp;implementations&nbsp;of&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://en.wikipedia.org/wiki/Bloom_filter&amp;quot;&amp;gt;Bloom<br>
+&nbsp;*&nbsp;Filters&amp;lt;/a&amp;gt;.&nbsp;A&nbsp;Bloom&nbsp;Filter&nbsp;is&nbsp;a&nbsp;Set-like&nbsp;data&nbsp;structure&nbsp;that&nbsp;uses&nbsp;only&nbsp;a&nbsp;few&nbsp;bits&nbsp;of&nbsp;memory&nbsp;per&nbsp;element&nbsp;stored.<br>
+&nbsp;*&nbsp;This&nbsp;allows&nbsp;very&nbsp;large&nbsp;numbers&nbsp;(billions)&nbsp;of&nbsp;elements&nbsp;to&nbsp;be&nbsp;stored&nbsp;in-memory,&nbsp;with&nbsp;the&nbsp;trade-off&nbsp;being&nbsp;that&nbsp;set<br>
+&nbsp;*&nbsp;containment&nbsp;can&nbsp;now&nbsp;return&nbsp;false&nbsp;positives.&nbsp;That&nbsp;is,&nbsp;the&nbsp;Bloom&nbsp;Filter&nbsp;can&nbsp;say&nbsp;for&nbsp;certain&nbsp;if&nbsp;a&nbsp;given&nbsp;element&nbsp;is<br>
+&nbsp;*&nbsp;definitely&nbsp;&amp;lt;em&amp;gt;not&amp;lt;/em&amp;gt;&nbsp;in&nbsp;the&nbsp;set,&nbsp;but&nbsp;it&nbsp;cannot&nbsp;say&nbsp;for&nbsp;certain&nbsp;whether&nbsp;it&nbsp;is.&nbsp;Bloom&nbsp;Filters&nbsp;are&nbsp;therefore<br>
+&nbsp;*&nbsp;appropriate&nbsp;as&nbsp;a&nbsp;quick&nbsp;initial&nbsp;check&nbsp;to&nbsp;reduce&nbsp;load&nbsp;on&nbsp;a&nbsp;more&nbsp;expensive&nbsp;but&nbsp;more&nbsp;accurate&nbsp;storage&nbsp;mechanism&nbsp;(e.g.,<br>
+&nbsp;*&nbsp;a&nbsp;database)&nbsp;or&nbsp;where&nbsp;some&nbsp;level&nbsp;of&nbsp;false&nbsp;positives&nbsp;is&nbsp;tolerable.&nbsp;The&nbsp;expected&nbsp;usage&nbsp;pattern&nbsp;for&nbsp;the&nbsp;former&nbsp;case<br>
+&nbsp;*&nbsp;would&nbsp;be&nbsp;something&nbsp;like&nbsp;the&nbsp;following&nbsp;psuedo-code:<br>
+&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;amp;lt;T&amp;amp;gt&nbsp;filter&nbsp;=&nbsp;...;<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&amp;amp;lt;T&amp;amp;gt;&nbsp;expensiveSet&nbsp;=&nbsp;...;&nbsp;//&nbsp;e.g.&nbsp;database,&nbsp;web-service<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(filter.mightContain(element))&nbsp;{<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;the&nbsp;more&nbsp;expensive&nbsp;check&nbsp;to&nbsp;be&nbsp;sure<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;expensive.contains(element);<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
+&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
+&nbsp;*&nbsp;Note:&nbsp;this&nbsp;assumes&nbsp;that&nbsp;the&nbsp;Bloom&nbsp;Filter&nbsp;is&nbsp;kept&nbsp;in-sync&nbsp;with&nbsp;the&nbsp;definitive&nbsp;set!&nbsp;How&nbsp;this&nbsp;is&nbsp;accomplished&nbsp;is<br>
+&nbsp;*&nbsp;outside&nbsp;of&nbsp;the&nbsp;scope&nbsp;of&nbsp;this&nbsp;package.<br>
+&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
+&nbsp;*&nbsp;All&nbsp;Bloom&nbsp;Filter&nbsp;implementations&nbsp;in&nbsp;this&nbsp;package&nbsp;allow&nbsp;the&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives&nbsp;(FPP)&nbsp;to&nbsp;be&nbsp;specified,<br>
+&nbsp;*&nbsp;and&nbsp;the&nbsp;implementation&nbsp;will&nbsp;adjust&nbsp;the&nbsp;amount&nbsp;of&nbsp;memory&nbsp;used&nbsp;to&nbsp;ensure&nbsp;the&nbsp;given&nbsp;level&nbsp;of&nbsp;accuracy&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;expected&nbsp;number&nbsp;of&nbsp;elements.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;@param&nbsp;&amp;lt;E&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;contained&nbsp;in&nbsp;the&nbsp;set.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;@param&nbsp;&amp;lt;E&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;contained&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://en.wikipedia.org/wiki/Bloom_filter&amp;quot;&amp;gt;Bloom&nbsp;Filter&nbsp;Wikipedia&nbsp;entry&amp;lt;/a&amp;gt;.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-@ThreadSafe<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;interface&nbsp;BloomFilter&amp;lt;E&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterChainjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterChain.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterChain.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterChain.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-22,21&nbsp;+22,22&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.time.TimeService;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.annotation.concurrent.ThreadSafe;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;java.util.ArrayDeque;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.ArrayList;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collection;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;java.util.HashSet;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.ListIterator;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;java.util.Queue;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;java.util.Set;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.concurrent.CopyOnWriteArrayList;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;A&nbsp;chain&nbsp;of&nbsp;bloom&nbsp;filters&nbsp;that&nbsp;together&nbsp;acts&nbsp;as&nbsp;a&nbsp;bloom&nbsp;filter.&nbsp;The&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;of&nbsp;the&nbsp;chain<br>
-&nbsp;*&nbsp;is&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;false&nbsp;positive&nbsp;probabilities&nbsp;of&nbsp;the&nbsp;elements&nbsp;in&nbsp;the&nbsp;chain.&nbsp;Subsequent&nbsp;filters&nbsp;(&amp;quot;buckets&amp;quot;)&nbsp;in&nbsp;the<br>
-&nbsp;*&nbsp;chain&nbsp;are&nbsp;acquired&nbsp;from&nbsp;a&nbsp;{@link&nbsp;BloomFilterPool}&nbsp;according&nbsp;to&nbsp;a&nbsp;geometric&nbsp;series,&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;overall&nbsp;false<br>
-&nbsp;*&nbsp;positive&nbsp;probability&nbsp;is&nbsp;maintained,&nbsp;while&nbsp;also&nbsp;accommodating&nbsp;massive&nbsp;underestimation&nbsp;of&nbsp;required&nbsp;capacity.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;A&nbsp;chain&nbsp;of&nbsp;bloom&nbsp;filters&nbsp;that&nbsp;together&nbsp;acts&nbsp;as&nbsp;a&nbsp;single&nbsp;bloom&nbsp;filter.&nbsp;The&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;of&nbsp;the<br>
+&nbsp;*&nbsp;chain&nbsp;is&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;false&nbsp;positive&nbsp;probabilities&nbsp;of&nbsp;the&nbsp;elements&nbsp;in&nbsp;the&nbsp;chain.&nbsp;Subsequent&nbsp;filters&nbsp;(&amp;quot;buckets&amp;quot;)<br>
+&nbsp;*&nbsp;in&nbsp;the&nbsp;chain&nbsp;are&nbsp;acquired&nbsp;from&nbsp;a&nbsp;{@link&nbsp;GeometricSeriesBloomFilterPool}&nbsp;according&nbsp;to&nbsp;a&nbsp;geometric&nbsp;series,&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;overall<br>
+&nbsp;*&nbsp;false&nbsp;positive&nbsp;probability&nbsp;is&nbsp;maintained,&nbsp;while&nbsp;also&nbsp;accommodating&nbsp;massive&nbsp;underestimation&nbsp;of&nbsp;required&nbsp;capacity.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;@see&nbsp;BloomFilterPool<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;stored&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;*&nbsp;@see&nbsp;GeometricSeriesBloomFilterPool<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;@ThreadSafe<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;final&nbsp;class&nbsp;BloomFilterChain&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-80,8&nbsp;+81,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;addAll(final&nbsp;Collection&amp;lt;?&nbsp;extends&nbsp;T&amp;gt;&nbsp;elements)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;changed&nbsp;=&nbsp;false;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;List&amp;lt;T&amp;gt;&nbsp;queue&nbsp;=&nbsp;new&nbsp;ArrayList&amp;lt;T&amp;gt;(elements);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i&nbsp;=&nbsp;0,&nbsp;size&nbsp;=&nbsp;queue.size();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;List&amp;lt;T&amp;gt;&nbsp;queue&nbsp;=&nbsp;(elements&nbsp;instanceof&nbsp;List)&nbsp;?&nbsp;(List&amp;lt;T&amp;gt;)&nbsp;elements&nbsp;:&nbsp;new&nbsp;ArrayList&amp;lt;T&amp;gt;(elements);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;size&nbsp;=&nbsp;queue.size();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i&nbsp;=&nbsp;0;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;We&nbsp;cannot&nbsp;simply&nbsp;call&nbsp;lastBucket().addAll(...)&nbsp;because&nbsp;this&nbsp;might&nbsp;over-saturate&nbsp;that&nbsp;bucket.&nbsp;Instead&nbsp;we<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;estimate&nbsp;how&nbsp;many&nbsp;more&nbsp;elements&nbsp;can&nbsp;be&nbsp;inserted&nbsp;into&nbsp;that&nbsp;bucket&nbsp;before&nbsp;it&nbsp;becomes&nbsp;saturated&nbsp;and&nbsp;only<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;insert&nbsp;(some&nbsp;percentage&nbsp;of)&nbsp;that&nbsp;number&nbsp;at&nbsp;a&nbsp;time,&nbsp;creating&nbsp;a&nbsp;new&nbsp;bucket&nbsp;if&nbsp;it&nbsp;does&nbsp;actually&nbsp;overflow.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(i&nbsp;&amp;lt;&nbsp;size)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;bucket&nbsp;=&nbsp;lastBucket();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;remainingCapacity&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-94,6&nbsp;+101,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;changed;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;each&nbsp;bloom&nbsp;filter&nbsp;in&nbsp;the&nbsp;chain&nbsp;to&nbsp;see&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;might&nbsp;contain&nbsp;the&nbsp;given&nbsp;element.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;element&nbsp;the&nbsp;element&nbsp;to&nbsp;check&nbsp;for&nbsp;membership&nbsp;in&nbsp;this&nbsp;set.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@code&nbsp;true}&nbsp;if&nbsp;any&nbsp;of&nbsp;the&nbsp;filters&nbsp;in&nbsp;the&nbsp;chain&nbsp;might&nbsp;contain&nbsp;the&nbsp;given&nbsp;element.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;mightContain(final&nbsp;T&nbsp;element)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(BloomFilter&amp;lt;T&amp;gt;&nbsp;bucket&nbsp;:&nbsp;chain)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-104,6&nbsp;+117,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;aggregate&nbsp;statistics&nbsp;for&nbsp;all&nbsp;buckets&nbsp;in&nbsp;the&nbsp;chain&nbsp;as&nbsp;it&nbsp;currently&nbsp;stands.&nbsp;Note&nbsp;that&nbsp;this&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;underestimate&nbsp;the&nbsp;remaining&nbsp;capacity,&nbsp;as&nbsp;it&nbsp;does&nbsp;not&nbsp;take&nbsp;into&nbsp;account&nbsp;the&nbsp;capacity&nbsp;that&nbsp;is&nbsp;still&nbsp;available&nbsp;in<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;pool.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterStatistics&nbsp;statistics()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;configuredFpp&nbsp;=&nbsp;0.0d;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-126,6&nbsp;+144,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;BloomFilterStatistics(configuredFpp,&nbsp;expectedFpp,&nbsp;capacity,&nbsp;bitSize,&nbsp;lastExpiryTime,&nbsp;remainingCapacity);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;last&nbsp;bucket&nbsp;in&nbsp;the&nbsp;chain,&nbsp;creating&nbsp;a&nbsp;new&nbsp;bucket&nbsp;if&nbsp;the&nbsp;chain&nbsp;is&nbsp;empty&nbsp;or&nbsp;if&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;last&nbsp;bucket&nbsp;is&nbsp;saturated.&nbsp;Additionally,&nbsp;this&nbsp;method&nbsp;will&nbsp;release&nbsp;any&nbsp;buckets&nbsp;that&nbsp;have&nbsp;expired.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;lastBucket()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;lastBucket&nbsp;=&nbsp;null;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListIterator&amp;lt;BloomFilter&amp;lt;T&amp;gt;&amp;gt;&nbsp;it&nbsp;=&nbsp;chain.listIterator(chain.size());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-136,21&nbsp;+158,25&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Synchronize&nbsp;to&nbsp;ensure&nbsp;atomicity&nbsp;(double-checked&nbsp;locking).&nbsp;Chain.listIterator().previous()&nbsp;is&nbsp;volatile<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;read.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(chain)&nbsp;{<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;some&nbsp;initial&nbsp;cleanup&nbsp;to&nbsp;remove&nbsp;any&nbsp;expired&nbsp;buckets<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&amp;lt;BloomFilter&amp;lt;T&amp;gt;&amp;gt;&nbsp;toRemove&nbsp;=&nbsp;new&nbsp;HashSet&amp;lt;BloomFilter&amp;lt;T&amp;gt;&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(BloomFilter&amp;lt;T&amp;gt;&nbsp;bucket&nbsp;:&nbsp;chain)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;now&nbsp;=&nbsp;clock.now();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilterStatistics&nbsp;stats&nbsp;=&nbsp;bucket.statistics();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(stats.isSaturated()&nbsp;&amp;amp;&amp;amp;&nbsp;stats.getExpiryTime()&nbsp;&amp;lt;&nbsp;now)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toRemove.add(bucket);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool.release(bucket);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CoWAL&nbsp;performance&nbsp;is&nbsp;better&nbsp;if&nbsp;we&nbsp;remove&nbsp;all&nbsp;at&nbsp;once.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!toRemove.isEmpty())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.removeAll(toRemove);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastBucket&nbsp;=&nbsp;null;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;=&nbsp;chain.listIterator(chain.size());<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(it.hasPrevious())&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(it.hasPrevious())&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastBucket&nbsp;=&nbsp;it.previous();<br>
&lt;/span&gt;&lt;del&gt;-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilterStatistics&nbsp;statistics&nbsp;=&nbsp;lastBucket.statistics();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(statistics.isSaturated()&nbsp;&amp;amp;&amp;amp;&nbsp;statistics.getExpiryTime()&nbsp;&amp;lt;&nbsp;clock.now())&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;it.remove()&nbsp;is&nbsp;unsupported&nbsp;operation&nbsp;for&nbsp;CoWAL:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(chain.remove(lastBucket))&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool.release(lastBucket);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastBucket&nbsp;=&nbsp;null;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(lastBucket&nbsp;==&nbsp;null&nbsp;||&nbsp;lastBucket.statistics().isSaturated())&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastBucket&nbsp;=&nbsp;pool.nextAvailable();<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterFactoryjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterFactory.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterFactory.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-17,8&nbsp;+17,18&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Created&nbsp;by&nbsp;neilmadden&nbsp;on&nbsp;22/02/15.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Abstract&nbsp;factory&nbsp;pattern&nbsp;for&nbsp;creating&nbsp;individual&nbsp;bloom&nbsp;filters&nbsp;with&nbsp;the&nbsp;given&nbsp;capacity&nbsp;and&nbsp;false&nbsp;positive<br>
+&nbsp;*&nbsp;probability.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;to&nbsp;be&nbsp;contained&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;interface&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+interface&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;Bloom&nbsp;Filter&nbsp;with&nbsp;the&nbsp;given&nbsp;capacity&nbsp;and&nbsp;false&nbsp;positive&nbsp;probability.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;expectedInsertions&nbsp;the&nbsp;expected&nbsp;number&nbsp;of&nbsp;elements&nbsp;to&nbsp;be&nbsp;inserted&nbsp;into&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;falsePositiveProbability&nbsp;the&nbsp;desired&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;a&nbsp;new&nbsp;bloom&nbsp;filter&nbsp;satisfying&nbsp;the&nbsp;requirements.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;create(long&nbsp;expectedInsertions,&nbsp;double&nbsp;falsePositiveProbability);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterPooljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,158&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.bloomfilter;<br>
-<br>
-import&nbsp;static&nbsp;java.lang.Math.pow;<br>
-import&nbsp;static&nbsp;java.util.Collections.synchronizedMap;<br>
-<br>
-import&nbsp;org.forgerock.util.Reject;<br>
-<br>
-import&nbsp;javax.annotation.concurrent.ThreadSafe;<br>
-import&nbsp;java.util.BitSet;<br>
-import&nbsp;java.util.IdentityHashMap;<br>
-import&nbsp;java.util.Map;<br>
-import&nbsp;java.util.TreeSet;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Maintains&nbsp;a&nbsp;pool&nbsp;of&nbsp;available&nbsp;bloom&nbsp;filters&nbsp;whose&nbsp;capacities&nbsp;and&nbsp;false&nbsp;positive&nbsp;probabilities&nbsp;are&nbsp;adjusted<br>
-&nbsp;*&nbsp;according&nbsp;to&nbsp;some&nbsp;geometric&nbsp;series.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;a&nbsp;{@link&nbsp;BloomFilterChain}&nbsp;built&nbsp;from&nbsp;elements&nbsp;from&nbsp;this<br>
-&nbsp;*&nbsp;pool&nbsp;will&nbsp;never&nbsp;exceed&nbsp;the&nbsp;desired&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability,&nbsp;while&nbsp;also&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;capacity&nbsp;of<br>
-&nbsp;*&nbsp;each&nbsp;subsequent&nbsp;bloom&nbsp;filter&nbsp;is&nbsp;increased&nbsp;to&nbsp;avoid&nbsp;creating&nbsp;long&nbsp;chains&nbsp;in&nbsp;cases&nbsp;where&nbsp;the&nbsp;required&nbsp;capacity&nbsp;has<br>
-&nbsp;*&nbsp;been&nbsp;underestimated&nbsp;by&nbsp;orders&nbsp;of&nbsp;magnitude.<br>
-&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
-&nbsp;*&nbsp;A&nbsp;pool&nbsp;of&nbsp;entries&nbsp;is&nbsp;maintained&nbsp;rather&nbsp;than&nbsp;a&nbsp;simple&nbsp;counter&nbsp;to&nbsp;allow&nbsp;for&nbsp;rolling&nbsp;bloom&nbsp;filter&nbsp;chains,&nbsp;in&nbsp;which<br>
-&nbsp;*&nbsp;older&nbsp;filters&nbsp;in&nbsp;the&nbsp;chain&nbsp;may&nbsp;expire.&nbsp;By&nbsp;re-using&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;series&nbsp;at&nbsp;that&nbsp;point,&nbsp;we&nbsp;avoid&nbsp;creating<br>
-&nbsp;*&nbsp;excessively&nbsp;large&nbsp;filters&nbsp;unnecessarily.<br>
-&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
-&nbsp;*&nbsp;As&nbsp;an&nbsp;implementation&nbsp;detail,&nbsp;the&nbsp;current&nbsp;implementation&nbsp;only&nbsp;pools&nbsp;the&nbsp;natural&nbsp;numbers&nbsp;representing&nbsp;elements&nbsp;in<br>
-&nbsp;*&nbsp;the&nbsp;geometric&nbsp;series.&nbsp;The&nbsp;Bloom&nbsp;Filters&nbsp;themselves&nbsp;are&nbsp;created&nbsp;on-demand,&nbsp;with&nbsp;parameters&nbsp;according&nbsp;to&nbsp;the&nbsp;following<br>
-&nbsp;*&nbsp;formulae.&nbsp;To&nbsp;create&nbsp;the&nbsp;&amp;lt;em&amp;gt;i&amp;lt;/em&amp;gt;th&nbsp;element&nbsp;in&nbsp;the&nbsp;series&nbsp;we&nbsp;use:<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;capacity(i)&nbsp;=&nbsp;initialCapacity&nbsp;*&nbsp;capacityGrowthFactor^i<br>
-&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fpp(i)&nbsp;=&nbsp;initialFalsePositiveProbability&nbsp;*&nbsp;fppScaleFactor^i<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*&nbsp;Where&nbsp;the&nbsp;initialFalsePositiveProbability&nbsp;is&nbsp;given&nbsp;by&nbsp;&amp;lt;code&amp;gt;overallFalsePositiveProbability&nbsp;*<br>
-&nbsp;*&nbsp;(1-fppScaleFactor)&amp;lt;/code&amp;gt;<br>
-&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
-&nbsp;*&nbsp;The&nbsp;strategy&nbsp;used&nbsp;here&nbsp;is&nbsp;described&nbsp;in&nbsp;detail&nbsp;in&nbsp;the&nbsp;paper&nbsp;&amp;lt;a<br>
-&nbsp;*&nbsp;href=&amp;quot;http://www.sciencedirect.com/science/article/pii/S0020019006003127&amp;quot;&amp;gt;Scalable&nbsp;Bloom&nbsp;Filters&amp;lt;/a&amp;gt;&nbsp;by&nbsp;Almeida&nbsp;et<br>
-&nbsp;*&nbsp;al.,&nbsp;&amp;lt;em&amp;gt;Information&nbsp;Processing&nbsp;Letters&amp;lt;/em&amp;gt;,&nbsp;101(6),&nbsp;p.255&amp;amp;ndash;261,&nbsp;2007.&nbsp;We&nbsp;add&nbsp;the&nbsp;ability&nbsp;to&nbsp;remove&nbsp;buckets<br>
-&nbsp;*&nbsp;from&nbsp;the&nbsp;chain&nbsp;and&nbsp;later&nbsp;reuse&nbsp;them,&nbsp;resulting&nbsp;in&nbsp;what&nbsp;we&nbsp;call&nbsp;&amp;lt;em&amp;gt;Rolling&nbsp;Bloom&nbsp;Filters&amp;lt;/em&amp;gt;.<br>
-&nbsp;*/<br>
-@ThreadSafe<br>
-final&nbsp;class&nbsp;BloomFilterPool&amp;lt;T&amp;gt;&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BitSet&nbsp;bucketNumbers;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;int&nbsp;maxBuckets;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;long&nbsp;initialCapacity;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;capacityGrowthFactor;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;initialFalsePositiveProbability;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;falsePositiveProbabilityScaleFactor;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Map&amp;lt;BloomFilter&amp;lt;T&amp;gt;,&nbsp;Integer&amp;gt;&nbsp;takenBucketNumbers;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;pool&nbsp;with&nbsp;the&nbsp;given&nbsp;parameters.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;factory&nbsp;the&nbsp;factory&nbsp;to&nbsp;use&nbsp;to&nbsp;create&nbsp;new&nbsp;buckets.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;maxBuckets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;in&nbsp;the&nbsp;chain.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;initialCapacity&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;the&nbsp;first&nbsp;bucket&nbsp;in&nbsp;the&nbsp;chain.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;capacityGrowthFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;increase&nbsp;the&nbsp;capacity&nbsp;of&nbsp;subsequent&nbsp;buckets&nbsp;in&nbsp;the&nbsp;chain.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;overallFalsePositiveProbability&nbsp;the&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;to&nbsp;maintain&nbsp;for&nbsp;the&nbsp;entire&nbsp;chain.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;falsePositiveProbabilityScaleFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;scale&nbsp;false&nbsp;positive&nbsp;probability&nbsp;on&nbsp;each<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subsequent&nbsp;bucket&nbsp;in&nbsp;the&nbsp;chain&nbsp;(must&nbsp;be&nbsp;&amp;amp;gt;0&nbsp;and&nbsp;&amp;amp;lt;1).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;BloomFilterPool(final&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory,&nbsp;final&nbsp;int&nbsp;maxBuckets,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;initialCapacity,&nbsp;final&nbsp;double&nbsp;capacityGrowthFactor,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;overallFalsePositiveProbability,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;falsePositiveProbabilityScaleFactor)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(maxBuckets&nbsp;&amp;gt;&nbsp;0,&nbsp;&amp;quot;Max&nbsp;#&nbsp;buckets&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(factory);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(initialCapacity&nbsp;&amp;gt;&nbsp;0L,&nbsp;&amp;quot;Capacity&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(capacityGrowthFactor&nbsp;&amp;gt;&nbsp;0.0d,&nbsp;&amp;quot;Capacity&nbsp;growth&nbsp;factor&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(overallFalsePositiveProbability&nbsp;&amp;gt;&nbsp;0.0d&nbsp;&amp;amp;&amp;amp;&nbsp;overallFalsePositiveProbability&nbsp;&amp;lt;&nbsp;1.0d,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&nbsp;and&nbsp;&amp;lt;&nbsp;1&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(falsePositiveProbabilityScaleFactor&nbsp;&amp;gt;&nbsp;0.0d&nbsp;&amp;amp;&amp;amp;&nbsp;falsePositiveProbabilityScaleFactor&nbsp;&amp;lt;&nbsp;1.0d,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;False&nbsp;positive&nbsp;probability&nbsp;scale&nbsp;factor&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&nbsp;and&nbsp;&amp;lt;&nbsp;1&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.factory&nbsp;=&nbsp;factory;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.maxBuckets&nbsp;=&nbsp;maxBuckets;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bucketNumbers&nbsp;=&nbsp;new&nbsp;BitSet(maxBuckets);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialCapacity&nbsp;=&nbsp;initialCapacity;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.capacityGrowthFactor&nbsp;=&nbsp;capacityGrowthFactor;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialFalsePositiveProbability&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overallFalsePositiveProbability&nbsp;*&nbsp;(1.0d&nbsp;-&nbsp;falsePositiveProbabilityScaleFactor);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.falsePositiveProbabilityScaleFactor&nbsp;=&nbsp;falsePositiveProbabilityScaleFactor;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.takenBucketNumbers&nbsp;=&nbsp;synchronizedMap(new&nbsp;IdentityHashMap&amp;lt;BloomFilter&amp;lt;T&amp;gt;,&nbsp;Integer&amp;gt;(maxBuckets));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;next&nbsp;available&nbsp;BloomFilter&nbsp;from&nbsp;the&nbsp;pool.&nbsp;Subsequent&nbsp;calls&nbsp;will&nbsp;yield&nbsp;progressively&nbsp;larger&nbsp;and<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;more&nbsp;accurate&nbsp;bloom&nbsp;filters&nbsp;according&nbsp;to&nbsp;the&nbsp;geometric&nbsp;series&nbsp;defined&nbsp;by&nbsp;the&nbsp;pool&nbsp;parameters,&nbsp;until&nbsp;bloom<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filters&nbsp;are&nbsp;released.&nbsp;Once&nbsp;filters&nbsp;have&nbsp;been&nbsp;released&nbsp;back&nbsp;to&nbsp;the&nbsp;pool,&nbsp;then&nbsp;the&nbsp;pool&nbsp;will&nbsp;reuse&nbsp;the&nbsp;capacity<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;false&nbsp;positive&nbsp;probability&nbsp;of&nbsp;the&nbsp;released&nbsp;pool&nbsp;in&nbsp;preference&nbsp;to&nbsp;any&nbsp;higher&nbsp;values.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;next&nbsp;available&nbsp;bloom&nbsp;filter&nbsp;according&nbsp;to&nbsp;the&nbsp;geometric&nbsp;series.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IllegalStateException&nbsp;if&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;has&nbsp;been&nbsp;exceeded.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;nextAvailable()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;bucketNumber;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(bucketNumbers)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumber&nbsp;=&nbsp;bucketNumbers.nextClearBit(0);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bucketNumber&nbsp;&amp;gt;=&nbsp;maxBuckets)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalStateException(&amp;quot;Maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;exceeded:&nbsp;&amp;quot;&nbsp;+&nbsp;maxBuckets);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumbers.set(bucketNumber);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;capacity&nbsp;=&nbsp;(long)&nbsp;(initialCapacity&nbsp;*&nbsp;pow(capacityGrowthFactor,&nbsp;bucketNumber));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;fpp&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialFalsePositiveProbability&nbsp;*&nbsp;pow(falsePositiveProbabilityScaleFactor,&nbsp;bucketNumber);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;bucket&nbsp;=&nbsp;factory.create(capacity,&nbsp;fpp);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;takenBucketNumbers.put(bucket,&nbsp;bucketNumber);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bucket;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Releases&nbsp;a&nbsp;Bloom&nbsp;Filter&nbsp;back&nbsp;into&nbsp;the&nbsp;pool.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;released&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;to&nbsp;release&nbsp;back&nbsp;to&nbsp;the&nbsp;pool.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;release(BloomFilter&amp;lt;T&amp;gt;&nbsp;released)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;bucketNumber&nbsp;=&nbsp;takenBucketNumbers.get(released);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(bucketNumbers)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumbers.clear(bucketNumber);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;toString()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;BloomFilterPool{&amp;quot;&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;maxBuckets=&amp;quot;&nbsp;+&nbsp;maxBuckets&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;initialCapacity=&amp;quot;&nbsp;+&nbsp;initialCapacity&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;capacityGrowthFactor=&amp;quot;&nbsp;+&nbsp;capacityGrowthFactor&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;initialFalsePositiveProbability=&amp;quot;&nbsp;+&nbsp;initialFalsePositiveProbability&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;falsePositiveProbabilityScaleFactor=&amp;quot;&nbsp;+&nbsp;falsePositiveProbabilityScaleFactor&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;takenBucketNumbers=&amp;quot;&nbsp;+&nbsp;new&nbsp;TreeSet&amp;lt;Integer&amp;gt;(takenBucketNumbers.values())&nbsp;+<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}';<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterPooljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp;(0&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,38&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.bloomfilter;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;pool&nbsp;of&nbsp;available&nbsp;bloom&nbsp;filters&nbsp;for&nbsp;use&nbsp;in&nbsp;a&nbsp;{@link&nbsp;BloomFilterChain}.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;stored&nbsp;in&nbsp;bloom&nbsp;filters&nbsp;contained&nbsp;in&nbsp;this&nbsp;pool.<br>
+&nbsp;*&nbsp;@see&nbsp;GeometricSeriesBloomFilterPool<br>
+&nbsp;*/<br>
+interface&nbsp;BloomFilterPool&amp;lt;T&amp;gt;&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;next&nbsp;available&nbsp;bloom&nbsp;filter&nbsp;from&nbsp;the&nbsp;pool.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IllegalStateException&nbsp;if&nbsp;the&nbsp;pool&nbsp;has&nbsp;been&nbsp;exhausted.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;nextAvailable();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Releases&nbsp;a&nbsp;bloom&nbsp;filter&nbsp;back&nbsp;to&nbsp;the&nbsp;pool&nbsp;to&nbsp;be&nbsp;reused.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;released&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;to&nbsp;release.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;release(BloomFilter&amp;lt;T&amp;gt;&nbsp;released);<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFiltersjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilters.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilters.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilters.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-17,25&nbsp;+17,34&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.guava.common.hash.Funnel;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.guava.common.hash.Funnels;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.Reject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.annotations.VisibleForTesting;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.time.TimeService;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Methods&nbsp;for&nbsp;creating&nbsp;bloom&nbsp;filters&nbsp;of&nbsp;various&nbsp;kinds.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Factory&nbsp;methods&nbsp;for&nbsp;creating&nbsp;bloom&nbsp;filters&nbsp;with&nbsp;various&nbsp;requirements.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;final&nbsp;class&nbsp;BloomFilters&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;BloomFilters()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UnsupportedOperationException(&amp;quot;Utility&nbsp;class&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;{@link&nbsp;BloomFilterBuilder}&nbsp;to&nbsp;begin&nbsp;configuration&nbsp;of&nbsp;a&nbsp;particular&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;funnel&nbsp;the&nbsp;funnel&nbsp;to&nbsp;use&nbsp;to&nbsp;hash&nbsp;elements&nbsp;of&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;to&nbsp;be&nbsp;contained&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;a&nbsp;builder&nbsp;object&nbsp;to&nbsp;continue&nbsp;configuration&nbsp;of&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;Funnels<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;&amp;lt;T&amp;gt;&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;create(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;(funnel);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Expiry&nbsp;strategy&nbsp;for&nbsp;objects&nbsp;that&nbsp;never&nbsp;expire.&nbsp;With&nbsp;this&nbsp;strategy&nbsp;a&nbsp;rolling&nbsp;Bloom&nbsp;Filter&nbsp;becomes&nbsp;a&nbsp;normal&nbsp;scalable<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Bloom&nbsp;Filter.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Expiry&nbsp;strategy&nbsp;for&nbsp;objects&nbsp;that&nbsp;never&nbsp;expire.&nbsp;With&nbsp;this&nbsp;strategy&nbsp;a&nbsp;rolling&nbsp;Bloom&nbsp;Filter&nbsp;becomes&nbsp;a&nbsp;normal<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;scalable&nbsp;Bloom&nbsp;Filter.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;enum&nbsp;NeverExpires&nbsp;implements&nbsp;ExpiryStrategy&amp;lt;Object&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-52,7&nbsp;+61,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Builder&nbsp;pattern&nbsp;for&nbsp;constructing&nbsp;and&nbsp;configuring&nbsp;Bloom&nbsp;Filter&nbsp;implementations.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Builder&nbsp;for&nbsp;constructing&nbsp;and&nbsp;configuring&nbsp;Bloom&nbsp;Filter&nbsp;implementations.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;class&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;initialCapacity&nbsp;=&nbsp;1000;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-67,6&nbsp;+76,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.funnel&nbsp;=&nbsp;funnel;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Copy&nbsp;constructor.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilterBuilder(final&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;toCopy)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(toCopy.funnel);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialCapacity&nbsp;=&nbsp;toCopy.initialCapacity;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-75,12&nbsp;+87,25&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writeBatchSize&nbsp;=&nbsp;toCopy.writeBatchSize;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Specifies&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;the&nbsp;bloom&nbsp;filter.&nbsp;This&nbsp;is&nbsp;the&nbsp;expected&nbsp;number&nbsp;of&nbsp;elements&nbsp;that&nbsp;can&nbsp;be<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;inserted&nbsp;into&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;before&nbsp;it&nbsp;becomes&nbsp;saturated&nbsp;(exceeds&nbsp;the&nbsp;configured&nbsp;false&nbsp;positive<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;probability).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;capacity&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withInitialCapacity(final&nbsp;int&nbsp;capacity)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(capacity&nbsp;&amp;gt;&nbsp;0,&nbsp;&amp;quot;Initial&nbsp;capacity&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialCapacity&nbsp;=&nbsp;capacity;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Specifies&nbsp;the&nbsp;overall&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives&nbsp;that&nbsp;this&nbsp;bloom&nbsp;filter&nbsp;should&nbsp;achieve.&nbsp;The&nbsp;bloom<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filter&nbsp;will&nbsp;be&nbsp;sized&nbsp;to&nbsp;achieve&nbsp;this&nbsp;probability&nbsp;for&nbsp;the&nbsp;specified&nbsp;capacity.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;fpp&nbsp;the&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives&nbsp;to&nbsp;achieve.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withFalsePositiveProbability(final&nbsp;double&nbsp;fpp)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(fpp&nbsp;&amp;gt;&nbsp;0.0d,&nbsp;&amp;quot;False&nbsp;positive&nbsp;probability&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(fpp&nbsp;&amp;lt;&nbsp;1.0d,&nbsp;&amp;quot;False&nbsp;positive&nbsp;probability&nbsp;must&nbsp;be&nbsp;&amp;lt;&nbsp;1&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-88,18&nbsp;+113,52&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;increase&nbsp;the&nbsp;capacity&nbsp;of&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;when&nbsp;it&nbsp;exceeds&nbsp;the&nbsp;initial&nbsp;capacity.&nbsp;A<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;factor&nbsp;of&nbsp;1&nbsp;will&nbsp;increase&nbsp;the&nbsp;capacity&nbsp;linearly,&nbsp;which&nbsp;may&nbsp;result&nbsp;in&nbsp;an&nbsp;explosion&nbsp;in&nbsp;the&nbsp;number&nbsp;of&nbsp;buckets<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;if&nbsp;the&nbsp;expected&nbsp;capacity&nbsp;of&nbsp;the&nbsp;filter&nbsp;has&nbsp;been&nbsp;underestimated.&nbsp;The&nbsp;default&nbsp;factor&nbsp;is&nbsp;2,&nbsp;which&nbsp;ensures<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;that&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;quickly&nbsp;grows&nbsp;to&nbsp;be&nbsp;&amp;quot;large&nbsp;enough&amp;quot;&nbsp;without&nbsp;creating&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;buckets&nbsp;(i.e.,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;number&nbsp;of&nbsp;buckets&nbsp;created&nbsp;will&nbsp;be&nbsp;logarithmic&nbsp;in&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;insertions).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;growthFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;increase&nbsp;bloom&nbsp;filter&nbsp;capacity&nbsp;when&nbsp;expanding.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withCapacityGrowthFactor(final&nbsp;double&nbsp;growthFactor)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;(this).withCapacityGrowthFactor(growthFactor);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;reduce&nbsp;the&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives&nbsp;when&nbsp;expanding&nbsp;a&nbsp;scalable/rolling&nbsp;bloom<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filter.&nbsp;As&nbsp;the&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;(FPP)&nbsp;is&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;probabilities&nbsp;of&nbsp;each&nbsp;component<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;bloom&nbsp;filter&nbsp;in&nbsp;the&nbsp;chain,&nbsp;the&nbsp;FPP&nbsp;of&nbsp;each&nbsp;subsequent&nbsp;bucket&nbsp;is&nbsp;reduced&nbsp;by&nbsp;this&nbsp;factor&nbsp;so&nbsp;that&nbsp;the&nbsp;sum&nbsp;never<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exceeds&nbsp;the&nbsp;overall&nbsp;FPP.&nbsp;A&nbsp;factor&nbsp;close&nbsp;to&nbsp;1&nbsp;will&nbsp;reduce&nbsp;the&nbsp;FPP&nbsp;slowly,&nbsp;limiting&nbsp;the&nbsp;additional&nbsp;memory<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;used&nbsp;on&nbsp;each&nbsp;expansion,&nbsp;but&nbsp;with&nbsp;the&nbsp;trade-off&nbsp;of&nbsp;using&nbsp;more&nbsp;memory&nbsp;initially.&nbsp;A&nbsp;lower&nbsp;number&nbsp;will&nbsp;use<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;less&nbsp;memory&nbsp;initially&nbsp;but&nbsp;then&nbsp;decrease&nbsp;the&nbsp;FPP&nbsp;more&nbsp;rapidly,&nbsp;resulting&nbsp;in&nbsp;increased&nbsp;memory&nbsp;usage.&nbsp;The<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;default&nbsp;setting&nbsp;(0.8)&nbsp;is&nbsp;tuned&nbsp;for&nbsp;scalable&nbsp;bloom&nbsp;filters&nbsp;that&nbsp;grow&nbsp;unbounded&nbsp;over&nbsp;time.&nbsp;It&nbsp;is&nbsp;recommended<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;reduce&nbsp;the&nbsp;factor&nbsp;in&nbsp;rolling&nbsp;bloom&nbsp;filters&nbsp;where&nbsp;the&nbsp;chain&nbsp;is&nbsp;expected&nbsp;not&nbsp;to&nbsp;grow&nbsp;beyond&nbsp;a&nbsp;few&nbsp;buckets<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;size.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;scaleFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;decrease&nbsp;the&nbsp;false&nbsp;positive&nbsp;probability&nbsp;when&nbsp;expanding.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withFalsePositiveProbabilityScaleFactor(final&nbsp;double&nbsp;scaleFactor)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;(this).withFalsePositiveProbabilityScaleFactor(scaleFactor);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;to&nbsp;create&nbsp;before&nbsp;throwing&nbsp;an&nbsp;exception&nbsp;indicating&nbsp;the&nbsp;maximum&nbsp;capacity<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;has&nbsp;been&nbsp;reached.&nbsp;Defaults&nbsp;to&nbsp;unlimited.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;maximumNumberOfBuckets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;to&nbsp;create.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withMaximumNumberOfBuckets(final&nbsp;int&nbsp;maximumNumberOfBuckets)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;(this).withMaximumNumberOfBuckets(maximumNumberOfBuckets);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Strategy&nbsp;for&nbsp;determining&nbsp;when&nbsp;elements&nbsp;of&nbsp;a&nbsp;rolling&nbsp;bloom&nbsp;filter&nbsp;have&nbsp;expired.&nbsp;Used&nbsp;to&nbsp;determine&nbsp;when&nbsp;all<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;elements&nbsp;in&nbsp;a&nbsp;bucket&nbsp;have&nbsp;expired&nbsp;and&nbsp;so&nbsp;can&nbsp;be&nbsp;released.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;expiryStrategy&nbsp;strategy&nbsp;for&nbsp;determining&nbsp;element&nbsp;expiry&nbsp;time.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withExpiryStrategy(final&nbsp;ExpiryStrategy&amp;lt;T&amp;gt;&nbsp;expiryStrategy)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;(this).withExpiryStrategy(expiryStrategy);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-109,6&nbsp;+168,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;(this).withClock(clock);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;strategy&nbsp;to&nbsp;use&nbsp;for&nbsp;managing&nbsp;thread-safety&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;strategy&nbsp;the&nbsp;concurrency&nbsp;strategy&nbsp;to&nbsp;use.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withConcurrencyStrategy(<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ConcurrencyStrategy&nbsp;strategy)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(strategy);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-116,20&nbsp;+180,43&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Enables&nbsp;batching&nbsp;of&nbsp;writes&nbsp;to&nbsp;the&nbsp;bloom&nbsp;filter.&nbsp;This&nbsp;can&nbsp;significantly&nbsp;increase&nbsp;the&nbsp;performance&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;write-heavy&nbsp;workloads&nbsp;at&nbsp;the&nbsp;expense&nbsp;of&nbsp;using&nbsp;additional&nbsp;memory&nbsp;and&nbsp;reducing&nbsp;the&nbsp;accuracy&nbsp;of&nbsp;the&nbsp;result&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;add/addAll&nbsp;methods.&nbsp;It&nbsp;is&nbsp;recommended&nbsp;to&nbsp;enable&nbsp;this&nbsp;setting&nbsp;when&nbsp;using&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;ConcurrencyStrategy#COPY_ON_WRITE}&nbsp;strategy.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;batchSize&nbsp;the&nbsp;number&nbsp;of&nbsp;elements&nbsp;to&nbsp;buffer&nbsp;before&nbsp;writing&nbsp;to&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;withWriteBatchSize(final&nbsp;int&nbsp;batchSize)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(batchSize&nbsp;&amp;gt;=&nbsp;0,&nbsp;&amp;quot;Write&nbsp;batch&nbsp;size&nbsp;must&nbsp;be&nbsp;&amp;gt;=&nbsp;0&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writeBatchSize&nbsp;=&nbsp;batchSize;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Forces&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;to&nbsp;be&nbsp;a&nbsp;Scalable&nbsp;Bloom&nbsp;Filter&nbsp;which&nbsp;can&nbsp;expand&nbsp;to&nbsp;arbitrary&nbsp;capacity.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://www.sciencedirect.com/science/article/pii/S0020019006003127&amp;quot;&amp;gt;Scalable&nbsp;Bloom&nbsp;Filters&amp;lt;/a&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;by&nbsp;Almeida&nbsp;et&nbsp;al.,&nbsp;&amp;lt;em&amp;gt;Information&nbsp;Processing&nbsp;Letters&amp;lt;/em&amp;gt;,&nbsp;101(6),&nbsp;p.255&amp;amp;ndash;261,&nbsp;2007.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;scalable()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;(this);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Forces&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;to&nbsp;be&nbsp;a&nbsp;Rolling&nbsp;Bloom&nbsp;Filter,&nbsp;which&nbsp;is&nbsp;a&nbsp;variant&nbsp;on&nbsp;Scalable&nbsp;Bloom&nbsp;Filters&nbsp;where<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;elements&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;can&nbsp;expire&nbsp;allowing&nbsp;space&nbsp;to&nbsp;be&nbsp;reclaimed.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;rolling()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;(this);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Builds&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;with&nbsp;the&nbsp;configured&nbsp;options.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;a&nbsp;new&nbsp;bloom&nbsp;filter&nbsp;configured&nbsp;appropriately.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;build()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;bf&nbsp;=&nbsp;buildBloomFilter();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(writeBatchSize&nbsp;&amp;gt;&nbsp;0)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-144,10&nbsp;+231,17&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Builder&nbsp;pattern&nbsp;for&nbsp;Scalable&nbsp;Bloom&nbsp;Filters.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;contained&nbsp;in&nbsp;this&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://www.sciencedirect.com/science/article/pii/S0020019006003127&amp;quot;&amp;gt;Scalable&nbsp;Bloom&nbsp;Filters&amp;lt;/a&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;by&nbsp;Almeida&nbsp;et&nbsp;al.,&nbsp;&amp;lt;em&amp;gt;Information&nbsp;Processing&nbsp;Letters&amp;lt;/em&amp;gt;,&nbsp;101(6),&nbsp;p.255&amp;amp;ndash;261,&nbsp;2007.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;class&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;extends&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;capacityGrowthFactor&nbsp;=&nbsp;2.0d;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;falsePositiveProbabilityScaleFactor&nbsp;=&nbsp;0.8d;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;maxNumberOfBuckets&nbsp;=&nbsp;64;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;maxNumberOfBuckets&nbsp;=&nbsp;Integer.MAX_VALUE;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScalableBloomFilterBuilder(final&nbsp;BloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;toCopy)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(toCopy);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-188,6&nbsp;+282,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Builder&nbsp;pattern&nbsp;for&nbsp;Rolling&nbsp;Bloom&nbsp;Filters,&nbsp;which&nbsp;are&nbsp;Scalable&nbsp;Bloom&nbsp;Filters&nbsp;whose&nbsp;elements&nbsp;can&nbsp;expire&nbsp;allowing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;space&nbsp;to&nbsp;be&nbsp;reclaimed&nbsp;over&nbsp;time.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;to&nbsp;contain&nbsp;in&nbsp;the&nbsp;bloom&nbsp;filter.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;class&nbsp;RollingBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;extends&nbsp;ScalableBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeService&nbsp;clock&nbsp;=&nbsp;TimeService.SYSTEM;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExpiryStrategy&amp;lt;T&amp;gt;&nbsp;expiryStrategy&nbsp;=&nbsp;null;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterConcurrencyStrategyjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrencyStrategy.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrencyStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrencyStrategy.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,15&nbsp;+19,31&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.guava.common.hash.Funnel;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Strategy&nbsp;that&nbsp;determines&nbsp;how&nbsp;thread-safety&nbsp;of&nbsp;bloom&nbsp;filters&nbsp;should&nbsp;be&nbsp;managed.&nbsp;Different&nbsp;strategies&nbsp;have&nbsp;different<br>
+&nbsp;*&nbsp;trade-offs&nbsp;in&nbsp;terms&nbsp;of&nbsp;memory&nbsp;usage&nbsp;and&nbsp;read&nbsp;or&nbsp;write&nbsp;performance.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;enum&nbsp;ConcurrencyStrategy&nbsp;{<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Treats&nbsp;Bloom&nbsp;Filters&nbsp;as&nbsp;effectively&nbsp;immutable&nbsp;objects&nbsp;and&nbsp;creates&nbsp;a&nbsp;copy&nbsp;when&nbsp;applying&nbsp;updates&nbsp;before<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;atomically&nbsp;swapping&nbsp;with&nbsp;the&nbsp;original.&nbsp;This&nbsp;strategy&nbsp;optimises&nbsp;read&nbsp;(mightContain)&nbsp;performance&nbsp;at&nbsp;the&nbsp;cost&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;significantly&nbsp;more&nbsp;expensive&nbsp;write&nbsp;(add/addAll)&nbsp;times&nbsp;and&nbsp;increased&nbsp;garbage&nbsp;collection&nbsp;pressure&nbsp;due&nbsp;to&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;temporary&nbsp;copies&nbsp;that&nbsp;are&nbsp;created.&nbsp;This&nbsp;is&nbsp;the&nbsp;recommended&nbsp;strategy&nbsp;if&nbsp;read&nbsp;performance&nbsp;is&nbsp;critical.&nbsp;Writing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;batching&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;mitigate&nbsp;the&nbsp;poor&nbsp;write&nbsp;performance&nbsp;(even&nbsp;exceeding&nbsp;the&nbsp;synchronized&nbsp;strategy)&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;somewhat&nbsp;mitigate&nbsp;the&nbsp;additional&nbsp;garbage&nbsp;creation.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COPY_ON_WRITE&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;T&amp;gt;&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;getFactory(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;CopyOnWriteBloomFilterFactory&amp;lt;T&amp;gt;(funnel);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fully&nbsp;synchronizes&nbsp;all&nbsp;accesses&nbsp;to&nbsp;the&nbsp;bloom&nbsp;filter.&nbsp;For&nbsp;scalable&nbsp;and&nbsp;rolling&nbsp;bloom&nbsp;filters,&nbsp;each&nbsp;bucket&nbsp;in<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;chain&nbsp;is&nbsp;synchronized&nbsp;individually,&nbsp;allowing&nbsp;a&nbsp;finer&nbsp;level&nbsp;of&nbsp;locking.&nbsp;This&nbsp;strategy&nbsp;provides&nbsp;a&nbsp;reasonable<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;compromise&nbsp;between&nbsp;read&nbsp;and&nbsp;write&nbsp;performance&nbsp;when&nbsp;read&nbsp;performance&nbsp;is&nbsp;not&nbsp;critical.&nbsp;Additionally,&nbsp;this<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;strategy&nbsp;creates&nbsp;significantly&nbsp;less&nbsp;garbage&nbsp;collection&nbsp;pressure&nbsp;than&nbsp;the&nbsp;copy-on-write&nbsp;strategy&nbsp;as&nbsp;it&nbsp;modifies<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;bloom&nbsp;filters&nbsp;in-place.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SYNCHRONIZED&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;T&amp;gt;&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;getFactory(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-36,6&nbsp;+52,13&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;factory&nbsp;object&nbsp;for&nbsp;creating&nbsp;fixed-capacity&nbsp;bloom&nbsp;filters&nbsp;using&nbsp;the&nbsp;given&nbsp;concurrency&nbsp;strategy.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;funnel&nbsp;the&nbsp;funnel&nbsp;to&nbsp;use&nbsp;for&nbsp;hashing&nbsp;elements.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&amp;lt;T&amp;gt;&nbsp;the&nbsp;type&nbsp;of&nbsp;elements&nbsp;to&nbsp;contain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;an&nbsp;appropriate&nbsp;factory&nbsp;object&nbsp;for&nbsp;this&nbsp;concurrency&nbsp;strategy.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract&nbsp;&amp;lt;T&amp;gt;&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;getFactory(Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;class&nbsp;CopyOnWriteBloomFilterFactory&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterConcurrentRollingBloomFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilter.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,7&nbsp;+16,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.guava.common.hash.Funnel;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.Reject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.slf4j.Logger;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.slf4j.LoggerFactory;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-40,15&nbsp;+39,17&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Logger&nbsp;LOGGER&nbsp;=&nbsp;LoggerFactory.getLogger(ConcurrentRollingBloomFilter.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilterChain&amp;lt;T&amp;gt;&nbsp;bucketChain;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilterPool&amp;lt;T&amp;gt;&nbsp;bucketPool;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;GeometricSeriesBloomFilterPool&amp;lt;T&amp;gt;&nbsp;bucketPool;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;ConcurrencyStrategy&nbsp;concurrencyStrategy;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConcurrentRollingBloomFilter(final&nbsp;BloomFilters.RollingBloomFilterBuilder&amp;lt;T&amp;gt;&nbsp;builder)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.concurrencyStrategy&nbsp;=&nbsp;builder.concurrencyStrategy;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory&nbsp;=&nbsp;new&nbsp;ExpiringBloomFilterFactory&amp;lt;T&amp;gt;(<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concurrencyStrategy.&amp;lt;T&amp;gt;getFactory(builder.funnel),&nbsp;builder.expiryStrategy);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bucketPool&nbsp;=&nbsp;new&nbsp;BloomFilterPool&amp;lt;T&amp;gt;(factory,&nbsp;builder.maxNumberOfBuckets,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory&nbsp;=&nbsp;concurrencyStrategy.&amp;lt;T&amp;gt;getFactory(builder.funnel);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(builder.expiryStrategy&nbsp;!=&nbsp;BloomFilters.NeverExpires.strategy())&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;new&nbsp;ExpiringBloomFilterFactory&amp;lt;T&amp;gt;(factory,&nbsp;builder.expiryStrategy);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bucketPool&nbsp;=&nbsp;new&nbsp;GeometricSeriesBloomFilterPool&amp;lt;T&amp;gt;(factory,&nbsp;builder.maxNumberOfBuckets,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.initialCapacity,&nbsp;builder.capacityGrowthFactor,<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.falsePositiveProbability,&nbsp;builder.falsePositiveProbabilityScaleFactor);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bucketChain&nbsp;=&nbsp;new&nbsp;BloomFilterChain&amp;lt;T&amp;gt;(bucketPool,&nbsp;builder.clock);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterCopyOnWriteBloomFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/CopyOnWriteBloomFilter.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/CopyOnWriteBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/CopyOnWriteBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,15&nbsp;+28,15&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;additions&nbsp;to&nbsp;the&nbsp;set.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;@ThreadSafe<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;final&nbsp;class&nbsp;CopyOnWriteBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+final&nbsp;class&nbsp;CopyOnWriteBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;long&nbsp;capacity;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;falsePositiveProbability;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;AtomicReference&amp;lt;org.forgerock.guava.common.hash.BloomFilter&amp;lt;T&amp;gt;&amp;gt;&nbsp;bloomFilterAtomicReference;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;CopyOnWriteBloomFilter(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;capacity,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;falsePositiveProbability)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;CopyOnWriteBloomFilter(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;capacity,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;falsePositiveProbability)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.capacity&nbsp;=&nbsp;capacity;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.falsePositiveProbability&nbsp;=&nbsp;falsePositiveProbability;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterGeometricSeriesBloomFilterPooljavafromrev2968forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterBloomFilterPooljava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/GeometricSeriesBloomFilterPool.java&nbsp;(from&nbsp;rev&nbsp;2968,&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/BloomFilterPool.java)&nbsp;(0&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/GeometricSeriesBloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/GeometricSeriesBloomFilterPool.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,162&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.bloomfilter;<br>
+<br>
+import&nbsp;static&nbsp;java.lang.Math.pow;<br>
+import&nbsp;static&nbsp;java.util.Collections.synchronizedMap;<br>
+<br>
+import&nbsp;org.forgerock.util.Reject;<br>
+<br>
+import&nbsp;javax.annotation.concurrent.ThreadSafe;<br>
+import&nbsp;java.util.BitSet;<br>
+import&nbsp;java.util.IdentityHashMap;<br>
+import&nbsp;java.util.Map;<br>
+import&nbsp;java.util.TreeSet;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;Maintains&nbsp;a&nbsp;pool&nbsp;of&nbsp;available&nbsp;bloom&nbsp;filters&nbsp;whose&nbsp;capacities&nbsp;and&nbsp;false&nbsp;positive&nbsp;probabilities&nbsp;are&nbsp;adjusted<br>
+&nbsp;*&nbsp;according&nbsp;to&nbsp;some&nbsp;geometric&nbsp;series.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;a&nbsp;{@link&nbsp;BloomFilterChain}&nbsp;built&nbsp;from&nbsp;elements&nbsp;from&nbsp;this<br>
+&nbsp;*&nbsp;pool&nbsp;will&nbsp;never&nbsp;exceed&nbsp;the&nbsp;desired&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability,&nbsp;while&nbsp;also&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;capacity&nbsp;of<br>
+&nbsp;*&nbsp;each&nbsp;subsequent&nbsp;bloom&nbsp;filter&nbsp;is&nbsp;increased&nbsp;to&nbsp;avoid&nbsp;creating&nbsp;long&nbsp;chains&nbsp;in&nbsp;cases&nbsp;where&nbsp;the&nbsp;required&nbsp;capacity&nbsp;has<br>
+&nbsp;*&nbsp;been&nbsp;underestimated&nbsp;by&nbsp;orders&nbsp;of&nbsp;magnitude.<br>
+&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
+&nbsp;*&nbsp;A&nbsp;pool&nbsp;of&nbsp;entries&nbsp;is&nbsp;maintained&nbsp;rather&nbsp;than&nbsp;a&nbsp;simple&nbsp;counter&nbsp;to&nbsp;allow&nbsp;for&nbsp;rolling&nbsp;bloom&nbsp;filter&nbsp;chains,&nbsp;in&nbsp;which<br>
+&nbsp;*&nbsp;older&nbsp;filters&nbsp;in&nbsp;the&nbsp;chain&nbsp;may&nbsp;expire.&nbsp;By&nbsp;re-using&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;series&nbsp;at&nbsp;that&nbsp;point,&nbsp;we&nbsp;avoid&nbsp;creating<br>
+&nbsp;*&nbsp;excessively&nbsp;large&nbsp;filters&nbsp;unnecessarily.<br>
+&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
+&nbsp;*&nbsp;As&nbsp;an&nbsp;implementation&nbsp;detail,&nbsp;the&nbsp;current&nbsp;implementation&nbsp;only&nbsp;pools&nbsp;the&nbsp;natural&nbsp;numbers&nbsp;representing&nbsp;elements&nbsp;in<br>
+&nbsp;*&nbsp;the&nbsp;geometric&nbsp;series.&nbsp;The&nbsp;Bloom&nbsp;Filters&nbsp;themselves&nbsp;are&nbsp;created&nbsp;on-demand,&nbsp;with&nbsp;parameters&nbsp;according&nbsp;to&nbsp;the&nbsp;following<br>
+&nbsp;*&nbsp;formulae.&nbsp;To&nbsp;create&nbsp;the&nbsp;&amp;lt;em&amp;gt;i&amp;lt;/em&amp;gt;th&nbsp;element&nbsp;in&nbsp;the&nbsp;series&nbsp;we&nbsp;use:<br>
+&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;capacity(i)&nbsp;=&nbsp;initialCapacity&nbsp;*&nbsp;capacityGrowthFactor^i<br>
+&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fpp(i)&nbsp;=&nbsp;initialFalsePositiveProbability&nbsp;*&nbsp;fppScaleFactor^i<br>
+&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
+&nbsp;*&nbsp;Where&nbsp;the&nbsp;initialFalsePositiveProbability&nbsp;is&nbsp;given&nbsp;by&nbsp;&amp;lt;code&amp;gt;overallFalsePositiveProbability&nbsp;*<br>
+&nbsp;*&nbsp;(1-fppScaleFactor)&amp;lt;/code&amp;gt;<br>
+&nbsp;*&nbsp;&amp;lt;p/&amp;gt;<br>
+&nbsp;*&nbsp;The&nbsp;strategy&nbsp;used&nbsp;here&nbsp;is&nbsp;described&nbsp;in&nbsp;detail&nbsp;in&nbsp;the&nbsp;paper&nbsp;&amp;lt;a<br>
+&nbsp;*&nbsp;href=&amp;quot;http://www.sciencedirect.com/science/article/pii/S0020019006003127&amp;quot;&amp;gt;Scalable&nbsp;Bloom&nbsp;Filters&amp;lt;/a&amp;gt;&nbsp;by&nbsp;Almeida&nbsp;et<br>
+&nbsp;*&nbsp;al.,&nbsp;&amp;lt;em&amp;gt;Information&nbsp;Processing&nbsp;Letters&amp;lt;/em&amp;gt;,&nbsp;101(6),&nbsp;p.255&amp;amp;ndash;261,&nbsp;2007.&nbsp;We&nbsp;add&nbsp;the&nbsp;ability&nbsp;to&nbsp;remove&nbsp;buckets<br>
+&nbsp;*&nbsp;from&nbsp;the&nbsp;chain&nbsp;and&nbsp;later&nbsp;reuse&nbsp;them,&nbsp;resulting&nbsp;in&nbsp;what&nbsp;we&nbsp;call&nbsp;&amp;lt;em&amp;gt;Rolling&nbsp;Bloom&nbsp;Filters&amp;lt;/em&amp;gt;.<br>
+&nbsp;*/<br>
+@ThreadSafe<br>
+final&nbsp;class&nbsp;GeometricSeriesBloomFilterPool&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilterPool&amp;lt;T&amp;gt;&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BitSet&nbsp;bucketNumbers;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;int&nbsp;maxBuckets;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;long&nbsp;initialCapacity;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;capacityGrowthFactor;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;initialFalsePositiveProbability;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;falsePositiveProbabilityScaleFactor;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Map&amp;lt;BloomFilter&amp;lt;T&amp;gt;,&nbsp;Integer&amp;gt;&nbsp;takenBucketNumbers;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;pool&nbsp;with&nbsp;the&nbsp;given&nbsp;parameters.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;factory&nbsp;the&nbsp;factory&nbsp;to&nbsp;use&nbsp;to&nbsp;create&nbsp;new&nbsp;buckets.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;maxBuckets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;in&nbsp;the&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;initialCapacity&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;the&nbsp;first&nbsp;bucket&nbsp;in&nbsp;the&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;capacityGrowthFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;increase&nbsp;the&nbsp;capacity&nbsp;of&nbsp;subsequent&nbsp;buckets&nbsp;in&nbsp;the&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;overallFalsePositiveProbability&nbsp;the&nbsp;overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;to&nbsp;maintain&nbsp;for&nbsp;the&nbsp;entire&nbsp;chain.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;falsePositiveProbabilityScaleFactor&nbsp;the&nbsp;factor&nbsp;by&nbsp;which&nbsp;to&nbsp;scale&nbsp;false&nbsp;positive&nbsp;probability&nbsp;on&nbsp;each<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subsequent&nbsp;bucket&nbsp;in&nbsp;the&nbsp;chain&nbsp;(must&nbsp;be&nbsp;&amp;amp;gt;0&nbsp;and&nbsp;&amp;amp;lt;1).<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;GeometricSeriesBloomFilterPool(final&nbsp;BloomFilterFactory&amp;lt;T&amp;gt;&nbsp;factory,&nbsp;final&nbsp;int&nbsp;maxBuckets,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;initialCapacity,&nbsp;final&nbsp;double&nbsp;capacityGrowthFactor,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;overallFalsePositiveProbability,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;falsePositiveProbabilityScaleFactor)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(maxBuckets&nbsp;&amp;gt;&nbsp;0,&nbsp;&amp;quot;Max&nbsp;#&nbsp;buckets&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(factory);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(initialCapacity&nbsp;&amp;gt;&nbsp;0L,&nbsp;&amp;quot;Capacity&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(capacityGrowthFactor&nbsp;&amp;gt;&nbsp;0.0d,&nbsp;&amp;quot;Capacity&nbsp;growth&nbsp;factor&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(overallFalsePositiveProbability&nbsp;&amp;gt;&nbsp;0.0d&nbsp;&amp;amp;&amp;amp;&nbsp;overallFalsePositiveProbability&nbsp;&amp;lt;&nbsp;1.0d,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;Overall&nbsp;false&nbsp;positive&nbsp;probability&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&nbsp;and&nbsp;&amp;lt;&nbsp;1&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(falsePositiveProbabilityScaleFactor&nbsp;&amp;gt;&nbsp;0.0d&nbsp;&amp;amp;&amp;amp;&nbsp;falsePositiveProbabilityScaleFactor&nbsp;&amp;lt;&nbsp;1.0d,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;False&nbsp;positive&nbsp;probability&nbsp;scale&nbsp;factor&nbsp;must&nbsp;be&nbsp;&amp;gt;&nbsp;0&nbsp;and&nbsp;&amp;lt;&nbsp;1&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;initialNumberOfBuckets&nbsp;=&nbsp;Math.min(maxBuckets,&nbsp;256);&nbsp;//&nbsp;Limit&nbsp;size&nbsp;initially<br>
+<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.factory&nbsp;=&nbsp;factory;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.maxBuckets&nbsp;=&nbsp;maxBuckets;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bucketNumbers&nbsp;=&nbsp;new&nbsp;BitSet(initialNumberOfBuckets);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialCapacity&nbsp;=&nbsp;initialCapacity;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.capacityGrowthFactor&nbsp;=&nbsp;capacityGrowthFactor;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.initialFalsePositiveProbability&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overallFalsePositiveProbability&nbsp;*&nbsp;(1.0d&nbsp;-&nbsp;falsePositiveProbabilityScaleFactor);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.falsePositiveProbabilityScaleFactor&nbsp;=&nbsp;falsePositiveProbabilityScaleFactor;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.takenBucketNumbers&nbsp;=&nbsp;synchronizedMap(new&nbsp;IdentityHashMap&amp;lt;BloomFilter&amp;lt;T&amp;gt;,&nbsp;Integer&amp;gt;(initialNumberOfBuckets));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;next&nbsp;available&nbsp;BloomFilter&nbsp;from&nbsp;the&nbsp;pool.&nbsp;Subsequent&nbsp;calls&nbsp;will&nbsp;yield&nbsp;progressively&nbsp;larger&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;more&nbsp;accurate&nbsp;bloom&nbsp;filters&nbsp;according&nbsp;to&nbsp;the&nbsp;geometric&nbsp;series&nbsp;defined&nbsp;by&nbsp;the&nbsp;pool&nbsp;parameters,&nbsp;until&nbsp;bloom<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;filters&nbsp;are&nbsp;released.&nbsp;Once&nbsp;filters&nbsp;have&nbsp;been&nbsp;released&nbsp;back&nbsp;to&nbsp;the&nbsp;pool,&nbsp;then&nbsp;the&nbsp;pool&nbsp;will&nbsp;reuse&nbsp;the&nbsp;capacity<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;false&nbsp;positive&nbsp;probability&nbsp;of&nbsp;the&nbsp;released&nbsp;pool&nbsp;in&nbsp;preference&nbsp;to&nbsp;any&nbsp;higher&nbsp;values.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;next&nbsp;available&nbsp;bloom&nbsp;filter&nbsp;according&nbsp;to&nbsp;the&nbsp;geometric&nbsp;series.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IllegalStateException&nbsp;if&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;has&nbsp;been&nbsp;exceeded.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;nextAvailable()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;bucketNumber;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(bucketNumbers)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumber&nbsp;=&nbsp;bucketNumbers.nextClearBit(0);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bucketNumber&nbsp;&amp;gt;=&nbsp;maxBuckets)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalStateException(&amp;quot;Maximum&nbsp;number&nbsp;of&nbsp;buckets&nbsp;exceeded:&nbsp;&amp;quot;&nbsp;+&nbsp;maxBuckets);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumbers.set(bucketNumber);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;capacity&nbsp;=&nbsp;(long)&nbsp;(initialCapacity&nbsp;*&nbsp;pow(capacityGrowthFactor,&nbsp;bucketNumber));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;fpp&nbsp;=<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialFalsePositiveProbability&nbsp;*&nbsp;pow(falsePositiveProbabilityScaleFactor,&nbsp;bucketNumber);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;bucket&nbsp;=&nbsp;factory.create(capacity,&nbsp;fpp);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;takenBucketNumbers.put(bucket,&nbsp;bucketNumber);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bucket;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Releases&nbsp;a&nbsp;Bloom&nbsp;Filter&nbsp;back&nbsp;into&nbsp;the&nbsp;pool.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;released&nbsp;the&nbsp;bloom&nbsp;filter&nbsp;to&nbsp;release&nbsp;back&nbsp;to&nbsp;the&nbsp;pool.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;release(BloomFilter&amp;lt;T&amp;gt;&nbsp;released)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;bucketNumber&nbsp;=&nbsp;takenBucketNumbers.get(released);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(bucketNumbers)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bucketNumbers.clear(bucketNumber);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;toString()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;BloomFilterPool{&amp;quot;&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;maxBuckets=&amp;quot;&nbsp;+&nbsp;maxBuckets&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;initialCapacity=&amp;quot;&nbsp;+&nbsp;initialCapacity&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;capacityGrowthFactor=&amp;quot;&nbsp;+&nbsp;capacityGrowthFactor&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;initialFalsePositiveProbability=&amp;quot;&nbsp;+&nbsp;initialFalsePositiveProbability&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;falsePositiveProbabilityScaleFactor=&amp;quot;&nbsp;+&nbsp;falsePositiveProbabilityScaleFactor&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;,&nbsp;takenBucketNumbers=&amp;quot;&nbsp;+&nbsp;new&nbsp;TreeSet&amp;lt;Integer&amp;gt;(takenBucketNumbers.values())&nbsp;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}';<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterSynchronizedBloomFilterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/SynchronizedBloomFilter.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/SynchronizedBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/SynchronizedBloomFilter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-25,12&nbsp;+25,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;A&nbsp;fully&nbsp;synchronized&nbsp;bloom&nbsp;filter&nbsp;implementation.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;@ThreadSafe<br>
&lt;/span&gt;&lt;del&gt;-public&nbsp;final&nbsp;class&nbsp;SynchronizedBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+final&nbsp;class&nbsp;SynchronizedBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;long&nbsp;capacity;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;double&nbsp;falsePositiveProbability;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;org.forgerock.guava.common.hash.BloomFilter&amp;lt;T&amp;gt;&nbsp;bloomFilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;SynchronizedBloomFilter(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;SynchronizedBloomFilter(final&nbsp;Funnel&amp;lt;?&nbsp;super&nbsp;T&amp;gt;&nbsp;funnel,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;capacity,<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;double&nbsp;falsePositiveProbability)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.falsePositiveProbability&nbsp;=&nbsp;falsePositiveProbability;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrcmainjavaorgforgerockbloomfilterpackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/package-info.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/main/java/org/forgerock/bloomfilter/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-20,5&nbsp;+20,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;trade-off&nbsp;is&nbsp;that&nbsp;the&nbsp;set&nbsp;membership&nbsp;operation&nbsp;may&nbsp;report&nbsp;false&nbsp;positives&nbsp;(i.e.,&nbsp;it&nbsp;may&nbsp;claim&nbsp;that&nbsp;an&nbsp;item&nbsp;is&nbsp;a<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;member&nbsp;of&nbsp;the&nbsp;set&nbsp;when&nbsp;it&nbsp;isn't).&nbsp;The&nbsp;probability&nbsp;of&nbsp;false&nbsp;positives&nbsp;can&nbsp;be&nbsp;tuned&nbsp;by&nbsp;increasing&nbsp;the&nbsp;amount&nbsp;of<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;memory&nbsp;used.<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://en.wikipedia.org/wiki/Bloom_filter&amp;quot;&amp;gt;Bloom&nbsp;Filter&nbsp;Wikipedia&nbsp;entry&amp;lt;/a&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterBatchingBloomFilterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BatchingBloomFilterTest.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BatchingBloomFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BatchingBloomFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-27,6&nbsp;+27,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.testng.annotations.BeforeMethod;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.testng.annotations.Test;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;java.util.ArrayList;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Arrays;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-43,7&nbsp;+44,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setup()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MockitoAnnotations.initMocks(this);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testFilter&nbsp;=&nbsp;new&nbsp;BatchingBloomFilter&amp;lt;Integer&amp;gt;(mockDelegate,&nbsp;BATCH_SIZE);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testFilter&nbsp;=&nbsp;new&nbsp;BatchingBloomFilter&amp;lt;Integer&amp;gt;(new&nbsp;ArgumentCloningBloomFilter&amp;lt;Integer&amp;gt;(mockDelegate),&nbsp;BATCH_SIZE);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-57,6&nbsp;+58,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Then<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;Collection&amp;gt;&nbsp;batch&nbsp;=&nbsp;ArgumentCaptor.forClass(Collection.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(mockDelegate).addAll(batch.capture());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(batch.getValue()).containsAll(expected);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-92,4&nbsp;+94,38&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(result).isTrue();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(mockDelegate).mightContain(1);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;ins&gt;+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Wrapper&nbsp;to&nbsp;ensure&nbsp;that&nbsp;arguments&nbsp;to&nbsp;the&nbsp;addAll&nbsp;method&nbsp;are&nbsp;copied&nbsp;before&nbsp;passing&nbsp;to&nbsp;the&nbsp;delegate.&nbsp;This&nbsp;is<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;because&nbsp;Mockito&nbsp;only&nbsp;captures&nbsp;arguments&nbsp;by&nbsp;reference,&nbsp;so&nbsp;we&nbsp;can&nbsp;otherwise&nbsp;only&nbsp;verify&nbsp;the&nbsp;final&nbsp;state&nbsp;of&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;argument&nbsp;and&nbsp;not&nbsp;how&nbsp;it&nbsp;was&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;class&nbsp;ArgumentCloningBloomFilter&amp;lt;T&amp;gt;&nbsp;implements&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;delegate;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCloningBloomFilter(final&nbsp;BloomFilter&amp;lt;T&amp;gt;&nbsp;delegate)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.delegate&nbsp;=&nbsp;delegate;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;add(final&nbsp;T&nbsp;element)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.add(element);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;addAll(final&nbsp;Collection&amp;lt;?&nbsp;extends&nbsp;T&amp;gt;&nbsp;elements)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;copy&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;capture&nbsp;in&nbsp;mockito<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.addAll(new&nbsp;ArrayList&amp;lt;T&amp;gt;(elements));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;mightContain(final&nbsp;T&nbsp;element)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.mightContain(element);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;BloomFilterStatistics&nbsp;statistics()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;delegate.statistics();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterBloomFilterChainTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BloomFilterChainTest.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BloomFilterChainTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/BloomFilterChainTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,8&nbsp;+16,80&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.bloomfilter;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.testng.Assert.*;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.util.time.TimeService;<br>
+import&nbsp;org.mockito.Mock;<br>
+import&nbsp;org.mockito.MockitoAnnotations;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;BloomFilterChainTest&nbsp;{<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;BloomFilterStatistics&nbsp;SATURATED&nbsp;=&nbsp;new&nbsp;BloomFilterStatistics(0.01d,&nbsp;0.02d,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;0);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Mock<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;BloomFilterPool&amp;lt;Integer&amp;gt;&nbsp;mockPool;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Mock<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;TimeService&nbsp;mockClock;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Mock<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;BloomFilter&amp;lt;Integer&amp;gt;&nbsp;mockBloomFilter;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;BloomFilterChain&amp;lt;Integer&amp;gt;&nbsp;testChain;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setup()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MockitoAnnotations.initMocks(this);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testChain&nbsp;=&nbsp;new&nbsp;BloomFilterChain&amp;lt;Integer&amp;gt;(mockPool,&nbsp;mockClock);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAcquireBucketFromPoolIfEmpty()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value&nbsp;=&nbsp;42;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockPool.nextAvailable()).willReturn(mockBloomFilter);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testChain.add(value);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(mockPool).nextAvailable();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(mockBloomFilter).add(value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldAcquireBucketIfLastBucketIsSaturated()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BloomFilter&amp;lt;Integer&amp;gt;&nbsp;newBucket&nbsp;=&nbsp;mock(BloomFilter.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value&nbsp;=&nbsp;42;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockPool.nextAvailable()).willReturn(mockBloomFilter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockBloomFilter.statistics()).willReturn(SATURATED);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockPool.nextAvailable()).willReturn(newBucket);&nbsp;//&nbsp;2nd&nbsp;call<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testChain.add(value);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(newBucket).add(value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldReleaseExpiredAndSaturatedBuckets()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value&nbsp;=&nbsp;42;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockPool.nextAvailable()).willReturn(mockBloomFilter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testChain.add(value);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockBloomFilter.statistics()).willReturn(SATURATED);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(mockClock.now()).willReturn(Long.MAX_VALUE);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testChain.add(value+1);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(mockPool).release(mockBloomFilter);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkbloomfiltercoresrctestjavaorgforgerockbloomfilterConcurrentRollingBloomFilterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilterTest.java&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/bloomfilter-core/src/test/java/org/forgerock/bloomfilter/ConcurrentRollingBloomFilterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-58,8&nbsp;+58,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.unencodedCharsFunnel())<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withConcurrencyStrategy(strategy)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withWriteBatchSize(25000)<br>
&lt;/span&gt;&lt;del&gt;-//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withInitialCapacity(10)<br>
-//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withCapacityGrowthFactor(1.2d)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withInitialCapacity(10)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withCapacityGrowthFactor(1.2d)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.scalable()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-110,8&nbsp;+110,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.unencodedCharsFunnel())<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withConcurrencyStrategy(strategy)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withWriteBatchSize(25000)<br>
&lt;/span&gt;&lt;del&gt;-//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withInitialCapacity(10)<br>
-//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withCapacityGrowthFactor(1.2d)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withInitialCapacity(10)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withCapacityGrowthFactor(1.2d)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.scalable()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockbloomfiltertrunkpomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-bloomfilter/trunk/pom.xml&nbsp;(2969&nbsp;=&gt;&nbsp;2970)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-bloomfilter/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;15:44:29&nbsp;UTC&nbsp;(rev&nbsp;2969)<br>
+++&nbsp;forgerock-bloomfilter/trunk/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-02-25&nbsp;17:21:30&nbsp;UTC&nbsp;(rev&nbsp;2970)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-114,6&nbsp;+114,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${testng.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-jcl&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${slf4j.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencyManagement&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-137,6&nbsp;+143,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${testng.version}&amp;lt;/version&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;slf4j-jcl&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;version&amp;gt;${slf4j.version}&amp;lt;/version&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependencies&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;repositories&amp;gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
