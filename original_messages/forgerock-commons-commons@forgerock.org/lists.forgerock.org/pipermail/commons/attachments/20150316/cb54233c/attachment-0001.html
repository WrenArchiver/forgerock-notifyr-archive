<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[3034]&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter:&nbsp;CAF-86&nbsp;CMN-83&nbsp;Create&nbsp;Authentication&nbsp;Framework&nbsp;Asynchronous&nbsp;API&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=3034&quot;&gt;3034&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;phillcunnington&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2015-03-16&nbsp;08:55:25&nbsp;+0000&nbsp;(Mon,&nbsp;16&nbsp;Mar&nbsp;2015)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;CAF-86&nbsp;CMN-83&nbsp;Create&nbsp;Authentication&nbsp;Framework&nbsp;Asynchronous&nbsp;API&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspimodulesforgerockjaspiopenamsessionmodulesrcmainjavaorgforgerockjaspimodulessessionopenamOpenAMSessionModulejava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/main/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModule.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspimodulesforgerockjaspiopenamsessionmodulesrctestjavaorgforgerockjaspimodulessessionopenamOpenAMSessionModuleTestjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/test/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModuleTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimepomxml&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextFallbackServerAuthContextjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextContextHandlerjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextContextHandlerTestjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextTestjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterREADMEmd&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/README.md&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAsyncServerAuthContextjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAsyncServerAuthModulejava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthModule.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAuthenticationExceptionjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AuthenticationException.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiMessageContextjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContext.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiMessageContextInfojava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContextInfo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapipackageinfojava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/package-info.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/&lt;/li&gt;<br>
&lt;li&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/api/&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockcafauthenticationapiAuthenticationExceptionTestjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/api/AuthenticationExceptionTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionsJaspiAuthExceptionjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiexceptionsJaspiAuthExceptionTestjava&quot;&gt;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterREADMEmd&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/README.md&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/README.md&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/README.md&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,142&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+#&nbsp;Overview&nbsp;of&nbsp;Authentication&nbsp;Framework<br>
+<br>
+##&nbsp;Async&nbsp;API&nbsp;Usage:<br>
+<br>
+A&nbsp;**AsyncServerAuthContext**&nbsp;uses&nbsp;a&nbsp;**MessageContext**&nbsp;instance&nbsp;to&nbsp;store&nbsp;state&nbsp;for&nbsp;its&nbsp;own&nbsp;later&nbsp;use&nbsp;and<br>
+to&nbsp;pass&nbsp;additional&nbsp;information&nbsp;to&nbsp;other&nbsp;**AsyncServerAuthContext**&nbsp;and&nbsp;**AsyncServerAuthModule**&nbsp;instances<br>
+that&nbsp;are&nbsp;configured.<br>
+<br>
+On&nbsp;the&nbsp;other&nbsp;hand&nbsp;a&nbsp;**AsyncServerAuthModule**&nbsp;uses&nbsp;a&nbsp;**MessageContextInfo**&nbsp;instance&nbsp;to&nbsp;store&nbsp;state&nbsp;for<br>
+its&nbsp;own&nbsp;later&nbsp;use&nbsp;and&nbsp;to&nbsp;pass&nbsp;additional&nbsp;information&nbsp;to&nbsp;other&nbsp;**AsyncServerAuthContext**&nbsp;and<br>
+**AsyncServerAuthModule**&nbsp;instances&nbsp;that&nbsp;are&nbsp;configured.<br>
+<br>
+The&nbsp;reason&nbsp;for&nbsp;these&nbsp;two&nbsp;different&nbsp;objects&nbsp;is&nbsp;to&nbsp;hide&nbsp;information&nbsp;from&nbsp;the&nbsp;**AsyncServerAuthModule**<br>
+instances&nbsp;that&nbsp;is&nbsp;only&nbsp;application&nbsp;at&nbsp;the&nbsp;**AsyncServerAuthContext**&nbsp;level.&nbsp;A&nbsp;**MessageContext**&nbsp;is&nbsp;a<br>
+**MessageContextInfo**&nbsp;so&nbsp;no&nbsp;conversion&nbsp;needs&nbsp;to&nbsp;take&nbsp;place&nbsp;when&nbsp;passing&nbsp;a&nbsp;**MessageContext**&nbsp;into&nbsp;a&nbsp;call<br>
+to&nbsp;a&nbsp;**AsyncServerAuthModule**.<br>
+<br>
+The&nbsp;authentication&nbsp;framework&nbsp;will&nbsp;create&nbsp;a&nbsp;new&nbsp;**MessageContext**&nbsp;instance&nbsp;for&nbsp;each&nbsp;incoming&nbsp;request&nbsp;to<br>
+process,&nbsp;which&nbsp;will&nbsp;be&nbsp;passed&nbsp;to&nbsp;the&nbsp;configured&nbsp;**AsyncServerAuthContext**.<br>
+<br>
+---<br>
+<br>
+###&nbsp;Example&nbsp;implementation&nbsp;of&nbsp;a&nbsp;AsyncServerAuthContext<br>
+```java<br>
+new&nbsp;AsyncServerAuthContext()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;AsyncServerAuthModule&nbsp;module&nbsp;=&nbsp;...;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;validateRequest(MessageContext&nbsp;context,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject,&nbsp;Subject&nbsp;serviceSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;module.validateRequest(context,&nbsp;clientSubject,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;secureResponse(MessageContext&nbsp;context,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;module.secureResponse(context,&nbsp;serviceSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;cleanSubject(MessageContext&nbsp;context,&nbsp;Subject&nbsp;clientSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;module.cleanSubject(context,&nbsp;clientSubject);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+};<br>
+```<br>
+<br>
+###&nbsp;Example&nbsp;implementation&nbsp;of&nbsp;a&nbsp;AsyncServerAuthModule<br>
+```java<br>
+new&nbsp;AsyncServerAuthModule()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getModuleId()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&amp;quot;MyFirstModule&amp;quot;;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;initialize(MessagePolicy&nbsp;requestPolicy,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessagePolicy&nbsp;responsePolicy,&nbsp;CallbackHandler&nbsp;handler,&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;options)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPoolExecutor&nbsp;executor&nbsp;=&nbsp;...;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.execute(new&nbsp;Runnable()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;some&nbsp;asynchronous&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleError(new&nbsp;AuthenticationException(&amp;quot;Failed&nbsp;to&nbsp;initialize&nbsp;module&amp;quot;,&nbsp;e));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Collection&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&nbsp;getSupportedMessageTypes()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&nbsp;supportedMessageTypes&nbsp;=&nbsp;new&nbsp;HashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;supportedMessageTypes.add(Request.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;supportedMessageTypes.add(Response.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;supportedMessageTypes;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;validateRequest(MessageContextInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject,&nbsp;Subject&nbsp;serviceSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPoolExecutor&nbsp;executor&nbsp;=&nbsp;...;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.execute(new&nbsp;Runnable()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;some&nbsp;asynchronous&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(AuthStatus.SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleError(new&nbsp;AuthenticationException(&amp;quot;Failed&nbsp;to&nbsp;validate&nbsp;request&amp;quot;,&nbsp;e));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;secureResponse(MessageContextInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPoolExecutor&nbsp;executor&nbsp;=&nbsp;...;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.execute(new&nbsp;Runnable()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;some&nbsp;asynchronous&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(AuthStatus.SEND_SUCCESS);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleError(new&nbsp;AuthenticationException(&amp;quot;Failed&nbsp;to&nbsp;secure&nbsp;response&amp;quot;,&nbsp;e));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;cleanSubject(MessageContextInfo&nbsp;messageInfo,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;clientSubject)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;PromiseImpl&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;promise&nbsp;=&nbsp;PromiseImpl.create();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPoolExecutor&nbsp;executor&nbsp;=&nbsp;...;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.execute(new&nbsp;Runnable()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;some&nbsp;asynchronous&nbsp;processing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleResult(null);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise.handleError(new&nbsp;AuthenticationException(&amp;quot;Failed&nbsp;to&nbsp;clean&nbsp;subject&amp;quot;,&nbsp;e));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;promise;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+};<br>
+```<br>
+```<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspimodulesforgerockjaspiopenamsessionmodulesrcmainjavaorgforgerockjaspimodulessessionopenamOpenAMSessionModulejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/main/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModule.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/main/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/main/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,15&nbsp;+11,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.modules.session.openam;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.json.resource.ResourceException;<br>
-import&nbsp;org.forgerock.util.Reject;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.callback.Callback;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-39,7&nbsp;+36,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collections;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.forgerock.util.Reject;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;A&nbsp;JASPI&nbsp;Session&nbsp;Module&nbsp;which&nbsp;uses&nbsp;OpenAM&nbsp;to&nbsp;validate&nbsp;SSO&nbsp;Tokens&nbsp;issued&nbsp;by&nbsp;an&nbsp;OpenAM&nbsp;instance.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-211,11&nbsp;+211,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;{@inheritDoc}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;{@inheritDoc}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@inheritDoc}<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;JaspiAuthException&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;when&nbsp;setting&nbsp;the&nbsp;authenticated&nbsp;principal&nbsp;on&nbsp;the&nbsp;client&nbsp;subject.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AuthenticationException&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;when&nbsp;setting&nbsp;the&nbsp;authenticated&nbsp;principal&nbsp;on&nbsp;the&nbsp;client&nbsp;subject.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthStatus&nbsp;validateRequest(final&nbsp;MessageInfo&nbsp;messageInfo,&nbsp;final&nbsp;Subject&nbsp;clientSubject,<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Subject&nbsp;serviceSubject)&nbsp;throws&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;tokenId&nbsp;=&nbsp;getSsoTokenId((HttpServletRequest)&nbsp;messageInfo.getRequestMessage());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.debug(&amp;quot;SSO&nbsp;Token&nbsp;found.&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-256,9&nbsp;+256,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(&amp;quot;REST&nbsp;validation&nbsp;call&nbsp;returned&nbsp;non&nbsp;HTTP&nbsp;200&nbsp;response&amp;quot;,&nbsp;e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;AuthStatus.SEND_FAILURE;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(UnsupportedCallbackException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(e.getMessage(),&nbsp;e);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(e.getMessage(),&nbsp;e);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(e.getMessage(),&nbsp;e);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(e.getMessage(),&nbsp;e);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspimodulesforgerockjaspiopenamsessionmodulesrctestjavaorgforgerockjaspimodulessessionopenamOpenAMSessionModuleTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/test/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModuleTest.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/test/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModuleTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-openam-session-module/src/test/java/org/forgerock/jaspi/modules/session/openam/OpenAMSessionModuleTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,17&nbsp;+11,19&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2014-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.modules.session.openam;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.json.resource.ResourceException;<br>
-import&nbsp;org.mockito.ArgumentCaptor;<br>
-import&nbsp;org.testng.annotations.BeforeMethod;<br>
-import&nbsp;org.testng.annotations.Test;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.*;<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.anyMapOf;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.anyString;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-35,20&nbsp;+37,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.HashMap;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.array;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.field;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
-import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
-import&nbsp;static&nbsp;org.mockito.Matchers.anyMapOf;<br>
-import&nbsp;static&nbsp;org.mockito.Matchers.anyString;<br>
-import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.doThrow;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.verify;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.verifyZeroInteractions;<br>
-import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
-import&nbsp;static&nbsp;org.testng.Assert.assertTrue;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;OpenAMSessionModuleTest&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-452,7&nbsp;+446,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenSsoTokenNotOnRequest()&nbsp;throws&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenSsoTokenNotOnRequest()&nbsp;throws&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-473,7&nbsp;+467,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenSsoTokenNotInCookies()&nbsp;throws&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenSsoTokenNotInCookies()&nbsp;throws&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-499,7&nbsp;+493,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenRestResponseIsEmpty()&nbsp;throws&nbsp;ResourceException,<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-527,7&nbsp;+521,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenRestResponseIsInvalidSession()&nbsp;throws&nbsp;ResourceException,<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-554,7&nbsp;+548,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenSsoTokenIsValid()&nbsp;throws&nbsp;ResourceException,&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenSsoTokenIsValid()&nbsp;throws&nbsp;ResourceException,&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-591,7&nbsp;+585,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialiseShouldAddTrailingSlashToOpenAMDeploymentURL()&nbsp;throws&nbsp;ResourceException,&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initialiseShouldAddTrailingSlashToOpenAMDeploymentURL()&nbsp;throws&nbsp;ResourceException,&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise(&amp;quot;https://OPENAM_DEPLOYMENT_URI&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-627,7&nbsp;+621,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenRestCallFails()&nbsp;throws&nbsp;ResourceException,&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSendFailureWhenRestCallFails()&nbsp;throws&nbsp;ResourceException,&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-650,7&nbsp;+644,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenSsoTokenOnCookie()&nbsp;throws&nbsp;ResourceException,&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenSsoTokenOnCookie()&nbsp;throws&nbsp;ResourceException,&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-694,7&nbsp;+688,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings({&nbsp;&amp;quot;unchecked&amp;quot;,&nbsp;&amp;quot;rawtypes&amp;quot;&nbsp;})<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenAccessingRootRealm()&nbsp;throws&nbsp;ResourceException,&nbsp;JaspiAuthException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldReturnSuccessWhenAccessingRootRealm()&nbsp;throws&nbsp;ResourceException,&nbsp;AuthenticationException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialise();<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimepomxml&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/pom.xml&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-12,7&nbsp;+12,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;--&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&amp;lt;project&nbsp;xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot;&nbsp;xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&nbsp;xsi:schemaLocation=&amp;quot;http://maven.apache.org/POM/4.0.0&nbsp;http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;quot;&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-55,6&nbsp;+55,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.http&amp;lt;/groupId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;chf-http-core&amp;lt;/artifactId&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;dependency&amp;gt;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;groupId&amp;gt;org.forgerock.commons&amp;lt;/groupId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;artifactId&amp;gt;json-resource&amp;lt;/artifactId&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/dependency&amp;gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAsyncServerAuthContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthContext.java&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,114&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;An&nbsp;asynchronous&nbsp;interface&nbsp;counterpart&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.config.ServerAuthContext}.&nbsp;Responsible&nbsp;for&nbsp;passing&nbsp;request<br>
+&nbsp;*&nbsp;and&nbsp;response&nbsp;messages&nbsp;to&nbsp;its&nbsp;configured&nbsp;modules&nbsp;based&nbsp;on&nbsp;the&nbsp;logic&nbsp;this&nbsp;authentication&nbsp;context<br>
+&nbsp;*&nbsp;defines.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;Module&nbsp;instance&nbsp;MUST&nbsp;be&nbsp;constructed&nbsp;and&nbsp;initialized&nbsp;before&nbsp;being&nbsp;passed&nbsp;to&nbsp;the&nbsp;authentication<br>
+&nbsp;*&nbsp;context&nbsp;instance.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;Implementations&nbsp;of&nbsp;this&nbsp;interface&nbsp;must&nbsp;be&nbsp;thread-safe&nbsp;as&nbsp;instances&nbsp;may&nbsp;be&nbsp;used&nbsp;concurrently<br>
+&nbsp;*&nbsp;by&nbsp;multiple&nbsp;requests.&nbsp;If&nbsp;the&nbsp;authentication&nbsp;context&nbsp;needs&nbsp;to&nbsp;store&nbsp;any&nbsp;state&nbsp;for&nbsp;a&nbsp;single<br>
+&nbsp;*&nbsp;request&nbsp;it&nbsp;should&nbsp;store&nbsp;the&nbsp;state&nbsp;in&nbsp;the&nbsp;{@link&nbsp;MessageContext}&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;retrieved<br>
+&nbsp;*&nbsp;later&nbsp;for&nbsp;the&nbsp;in&nbsp;the&nbsp;{@link&nbsp;#secureResponse(MessageContext,&nbsp;javax.security.auth.Subject)}<br>
+&nbsp;*&nbsp;method.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.config.ServerAuthContext<br>
+&nbsp;*&nbsp;@see&nbsp;MessageContext<br>
+&nbsp;*&nbsp;@see&nbsp;Subject<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;2.0.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;AsyncServerAuthContext&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Validates&nbsp;the&nbsp;incoming&nbsp;request&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;The&nbsp;message&nbsp;context&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;of&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;for&nbsp;the&nbsp;server&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@code&nbsp;null}.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;secure&nbsp;the&nbsp;message&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;p&amp;gt;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthStatus}&nbsp;representing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;message&nbsp;processing.&nbsp;See<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.config.ServerAuthContext#validateRequest(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject,&nbsp;Subject)}&nbsp;for&nbsp;the&nbsp;allowed<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthStatus}&nbsp;values.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;when<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;MessageContext}.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;AuthStatus<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.config.ServerAuthContext#validateRequest(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;validateRequest(MessageContext&nbsp;context,&nbsp;Subject&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Secures&nbsp;the&nbsp;outgoing&nbsp;response&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;The&nbsp;message&nbsp;context&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;for&nbsp;the&nbsp;server&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@code&nbsp;null}.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;secure&nbsp;the&nbsp;message&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;p&amp;gt;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthStatus}&nbsp;representing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing.&nbsp;See<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.config.ServerAuthContext#secureResponse(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)}&nbsp;for&nbsp;the&nbsp;allowed<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthStatus}&nbsp;values.&nbsp;Note&nbsp;{@link&nbsp;AuthStatus#SEND_CONTINUE}&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;this<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;interface&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;when<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;MessageContext}.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;AuthStatus<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.config.ServerAuthContext#secureResponse(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;secureResponse(MessageContext&nbsp;context,&nbsp;Subject&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;any&nbsp;method&nbsp;specific&nbsp;principals&nbsp;and&nbsp;credentials&nbsp;from&nbsp;the&nbsp;client&nbsp;subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;The&nbsp;message&nbsp;context&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;of&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&nbsp;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;contain&nbsp;no&nbsp;value&nbsp;and&nbsp;a&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthenticationException}&nbsp;if&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;{@code&nbsp;Subject}&nbsp;processing.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.config.ServerAuthContext#cleanSubject(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;cleanSubject(MessageContext&nbsp;context,&nbsp;Subject&nbsp;clientSubject);<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAsyncServerAuthModulejava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthModule.java&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AsyncServerAuthModule.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,149&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;javax.security.auth.Subject;<br>
+import&nbsp;javax.security.auth.callback.CallbackHandler;<br>
+import&nbsp;javax.security.auth.message.AuthStatus;<br>
+import&nbsp;javax.security.auth.message.MessagePolicy;<br>
+import&nbsp;java.util.Collection;<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;org.forgerock.util.promise.Promise;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;An&nbsp;asynchronous&nbsp;interface&nbsp;counterpart&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.module.ServerAuthModule}.&nbsp;Responsible&nbsp;for&nbsp;validating&nbsp;and<br>
+&nbsp;*&nbsp;securing&nbsp;request&nbsp;and&nbsp;response&nbsp;messages.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;Implementations&nbsp;of&nbsp;this&nbsp;interface&nbsp;must&nbsp;be&nbsp;thread-safe&nbsp;as&nbsp;instances&nbsp;may&nbsp;be&nbsp;used&nbsp;processes<br>
+&nbsp;*&nbsp;concurrent&nbsp;requests.&nbsp;If&nbsp;the&nbsp;module&nbsp;needs&nbsp;to&nbsp;store&nbsp;any&nbsp;state&nbsp;for&nbsp;a&nbsp;single&nbsp;request&nbsp;it&nbsp;should<br>
+&nbsp;*&nbsp;store&nbsp;the&nbsp;state&nbsp;in&nbsp;the&nbsp;{@link&nbsp;MessageContextInfo}&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;retrieved&nbsp;later&nbsp;for&nbsp;the&nbsp;in<br>
+&nbsp;*&nbsp;the&nbsp;{@link&nbsp;#secureResponse(MessageContextInfo,&nbsp;javax.security.auth.Subject)}&nbsp;method.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.module.ServerAuthModule<br>
+&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.MessageInfo<br>
+&nbsp;*&nbsp;@see&nbsp;Subject<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;2.0.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;AsyncServerAuthModule&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;ID&nbsp;of&nbsp;the&nbsp;module&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;creating&nbsp;authentication&nbsp;audit&nbsp;logs&nbsp;to&nbsp;uniquely<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;identify&nbsp;the&nbsp;authentication&nbsp;module&nbsp;and&nbsp;its&nbsp;outcome&nbsp;when&nbsp;processing&nbsp;a&nbsp;request&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;ID&nbsp;of&nbsp;the&nbsp;module.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;getModuleId();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Initialize&nbsp;this&nbsp;module&nbsp;with&nbsp;request&nbsp;and&nbsp;response&nbsp;message&nbsp;policies&nbsp;to&nbsp;enforce,&nbsp;a<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;CallbackHandler},&nbsp;and&nbsp;any&nbsp;module&nbsp;specific&nbsp;configuration&nbsp;properties.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;The&nbsp;request&nbsp;policy&nbsp;and&nbsp;the&nbsp;response&nbsp;policy&nbsp;must&nbsp;not&nbsp;both&nbsp;be&nbsp;null.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;requestPolicy&nbsp;The&nbsp;request&nbsp;policy&nbsp;this&nbsp;module&nbsp;must&nbsp;enforce,&nbsp;or&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;responsePolicy&nbsp;The&nbsp;response&nbsp;policy&nbsp;this&nbsp;module&nbsp;must&nbsp;enforce,&nbsp;or&nbsp;{@code&nbsp;null}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;{@code&nbsp;CallbackHandler}&nbsp;used&nbsp;to&nbsp;request&nbsp;information.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;options&nbsp;A&nbsp;{@code&nbsp;Map}&nbsp;of&nbsp;module-specific&nbsp;configuration&nbsp;properties.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&nbsp;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;contain&nbsp;no&nbsp;value&nbsp;and&nbsp;a&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthenticationException}&nbsp;if&nbsp;module&nbsp;initialization&nbsp;fails,&nbsp;including&nbsp;for&nbsp;the&nbsp;case<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;where&nbsp;the&nbsp;options&nbsp;argument&nbsp;contains&nbsp;elements&nbsp;that&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;the&nbsp;module.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;initialize(MessagePolicy&nbsp;requestPolicy,&nbsp;MessagePolicy&nbsp;responsePolicy,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CallbackHandler&nbsp;handler,&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;options);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;{@code&nbsp;Collection}&nbsp;of&nbsp;{@code&nbsp;Class}&nbsp;objects&nbsp;of&nbsp;the&nbsp;message&nbsp;types&nbsp;supported&nbsp;by&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;module.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;{@code&nbsp;Collection}&nbsp;of&nbsp;{@code&nbsp;Class}&nbsp;objects,&nbsp;with&nbsp;at&nbsp;least&nbsp;on&nbsp;element&nbsp;defining&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;message&nbsp;type(s)&nbsp;supported&nbsp;by&nbsp;the&nbsp;module.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Collection&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&nbsp;getSupportedMessageTypes();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Validates&nbsp;the&nbsp;incoming&nbsp;request&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;message&nbsp;context&nbsp;info&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;of&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;for&nbsp;the&nbsp;server&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@code&nbsp;null}.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;secure&nbsp;the&nbsp;message&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;p&amp;gt;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthStatus}&nbsp;representing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;message&nbsp;processing.&nbsp;See<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.module.ServerAuthModule#validateRequest(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject,&nbsp;Subject)}&nbsp;for&nbsp;the&nbsp;allowed<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthStatus}&nbsp;values.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;when<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;MessageContextInfo}.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;AuthStatus<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.module.ServerAuthModule#validateRequest(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;validateRequest(MessageContextInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Secures&nbsp;the&nbsp;outgoing&nbsp;response&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;message&nbsp;context&nbsp;info&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;serviceSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;for&nbsp;the&nbsp;server&nbsp;or<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@code&nbsp;null}.&nbsp;It&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;secure&nbsp;the&nbsp;message&nbsp;response.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;&amp;lt;p&amp;gt;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthStatus}&nbsp;representing<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;completion&nbsp;status&nbsp;of&nbsp;the&nbsp;processing.&nbsp;See<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;javax.security.auth.message.module.ServerAuthModule#secureResponse(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)}&nbsp;for&nbsp;the&nbsp;allowed<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthStatus}&nbsp;values.&nbsp;Note&nbsp;{@link&nbsp;AuthStatus#SEND_CONTINUE}&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;this<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;interface&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;when<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;message&nbsp;processing&nbsp;failed&nbsp;without&nbsp;establishing&nbsp;a&nbsp;failure&nbsp;response&nbsp;message&nbsp;in&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;MessageContextInfo}.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;AuthStatus<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.module.ServerAuthModule#secureResponse(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;AuthStatus,&nbsp;AuthenticationException&amp;gt;&nbsp;secureResponse(MessageContextInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;serviceSubject);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;any&nbsp;method&nbsp;specific&nbsp;principals&nbsp;and&nbsp;credentials&nbsp;from&nbsp;the&nbsp;client&nbsp;subject.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;messageInfo&nbsp;The&nbsp;message&nbsp;context&nbsp;info&nbsp;for&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;clientSubject&nbsp;A&nbsp;{@code&nbsp;Subject}&nbsp;that&nbsp;represents&nbsp;the&nbsp;subject&nbsp;of&nbsp;this&nbsp;request.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;A&nbsp;{@code&nbsp;Promise}&nbsp;that&nbsp;will&nbsp;be&nbsp;completed,&nbsp;as&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;future,&nbsp;with<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;either&nbsp;a&nbsp;successful&nbsp;value&nbsp;or&nbsp;a&nbsp;failure&nbsp;value.&nbsp;A&nbsp;successfully&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;contain&nbsp;no&nbsp;value&nbsp;and&nbsp;a&nbsp;failed&nbsp;completed&nbsp;{@code&nbsp;Promise}&nbsp;will&nbsp;contain&nbsp;an<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;AuthenticationException}&nbsp;if&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;{@code&nbsp;Subject}&nbsp;processing.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.module.ServerAuthModule#cleanSubject(<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;javax.security.auth.message.MessageInfo,&nbsp;Subject)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Promise&amp;lt;Void,&nbsp;AuthenticationException&amp;gt;&nbsp;cleanSubject(MessageContextInfo&nbsp;messageInfo,&nbsp;Subject&nbsp;clientSubject);<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiAuthenticationExceptionjavafromrev3033forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionsJaspiAuthExceptionjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AuthenticationException.java&nbsp;(from&nbsp;rev&nbsp;3033,&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java)&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AuthenticationException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/AuthenticationException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,60&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;javax.security.auth.message.AuthException;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;A&nbsp;generic&nbsp;authentication&nbsp;exception&nbsp;which&nbsp;accepts&nbsp;a&nbsp;detail&nbsp;message&nbsp;and/or&nbsp;the&nbsp;cause.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
+&nbsp;*/<br>
+public&nbsp;class&nbsp;AuthenticationException&nbsp;extends&nbsp;AuthException&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;8448867142875092521L;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthenticationException(final&nbsp;String&nbsp;message)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;with&nbsp;the&nbsp;specified&nbsp;cause&nbsp;and&nbsp;a&nbsp;detail&nbsp;message&nbsp;of<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;(cause==null&nbsp;?&nbsp;null&nbsp;:&nbsp;cause.getMessage())}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthenticationException(final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(cause.getMessage());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCause(cause);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;an&nbsp;{@code&nbsp;AuthenticationException}&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message&nbsp;and&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AuthenticationException(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCause(cause);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiMessageContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContext.java&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,37&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;org.forgerock.http.Context;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;The&nbsp;authentication&nbsp;framework&nbsp;uses&nbsp;this&nbsp;{@code&nbsp;Context}&nbsp;to&nbsp;pass&nbsp;messages&nbsp;and&nbsp;message<br>
+&nbsp;*&nbsp;processing&nbsp;state&nbsp;to&nbsp;authentication&nbsp;contexts&nbsp;for&nbsp;processing&nbsp;by&nbsp;authentication&nbsp;modules.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;This&nbsp;class&nbsp;encapsulates&nbsp;a&nbsp;request&nbsp;and&nbsp;response&nbsp;message&nbsp;objects&nbsp;for&nbsp;a&nbsp;message&nbsp;exchange.&nbsp;This<br>
+&nbsp;*&nbsp;class&nbsp;may&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;associate&nbsp;additional&nbsp;context&nbsp;in&nbsp;the&nbsp;form&nbsp;of&nbsp;key/value&nbsp;pairs,&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;encapsulated&nbsp;messages.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.MessageInfo<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;2.0.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;MessageContext&nbsp;extends&nbsp;Context,&nbsp;MessageContextInfo&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;//Methods&nbsp;like&nbsp;setAuthContextState(...)&nbsp;and&nbsp;getAuthContextState(...)&nbsp;will&nbsp;end&nbsp;up&nbsp;here<br>
+&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;which&nbsp;do&nbsp;not&nbsp;want&nbsp;to&nbsp;be&nbsp;exposed&nbsp;to&nbsp;auth&nbsp;modules<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapiMessageContextInfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContextInfo.java&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContextInfo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/MessageContextInfo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,77&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;java.util.Map;<br>
+<br>
+import&nbsp;org.forgerock.http.protocol.Request;<br>
+import&nbsp;org.forgerock.http.protocol.Response;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;The&nbsp;authentication&nbsp;framework&nbsp;uses&nbsp;this&nbsp;{@code&nbsp;MessageContextInfo}&nbsp;to&nbsp;pass&nbsp;messages&nbsp;and<br>
+&nbsp;*&nbsp;message&nbsp;processing&nbsp;state&nbsp;to&nbsp;authentication&nbsp;modules&nbsp;for&nbsp;processing&nbsp;of&nbsp;messages.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;&amp;lt;p&amp;gt;This&nbsp;class&nbsp;encapsulates&nbsp;a&nbsp;request&nbsp;and&nbsp;response&nbsp;message&nbsp;objects&nbsp;for&nbsp;a&nbsp;message&nbsp;exchange.&nbsp;This<br>
+&nbsp;*&nbsp;class&nbsp;may&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;associate&nbsp;additional&nbsp;context&nbsp;in&nbsp;the&nbsp;form&nbsp;of&nbsp;key/value&nbsp;pairs,&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;encapsulated&nbsp;messages.&amp;lt;/p&amp;gt;<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@see&nbsp;javax.security.auth.message.MessageInfo<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;@since&nbsp;2.0.0<br>
+&nbsp;*/<br>
+public&nbsp;interface&nbsp;MessageContextInfo&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;request&nbsp;object&nbsp;from&nbsp;this&nbsp;{@code&nbsp;MessageContextInfo}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;{@code&nbsp;Request}&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Request&nbsp;getRequest();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;response&nbsp;object&nbsp;from&nbsp;this&nbsp;{@code&nbsp;MessageContextInfo}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;{@code&nbsp;Response}&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Response&nbsp;getResponse();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;request&nbsp;object&nbsp;for&nbsp;this&nbsp;{@code&nbsp;MessageContextInfo}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;{@code&nbsp;Request}&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;setRequest(Request&nbsp;request);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;response&nbsp;object&nbsp;for&nbsp;this&nbsp;{@code&nbsp;MessageContextInfo}.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;response&nbsp;The&nbsp;{@code&nbsp;Response}&nbsp;object.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;setResponse(Response&nbsp;response);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Gets&nbsp;the&nbsp;context&nbsp;map&nbsp;for&nbsp;this&nbsp;message&nbsp;exchange.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;This&nbsp;{@code&nbsp;Map}&nbsp;can&nbsp;contain&nbsp;shared&nbsp;information&nbsp;between<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;org.forgerock.caf.authentication.api.AsyncServerAuthContext}s&nbsp;and<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;org.forgerock.caf.authentication.api.AsyncServerAuthModule}s&nbsp;which&nbsp;will&nbsp;be&nbsp;maintained<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;for&nbsp;a&nbsp;single&nbsp;request.&amp;lt;/p&amp;gt;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;request&nbsp;context&nbsp;map.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;Map&amp;lt;String,&nbsp;Object&amp;gt;&nbsp;getRequestContextMap();<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockcafauthenticationapipackageinfojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;addfile&quot;&gt;&lt;h4&gt;Added:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/package-info.java&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/caf/authentication/api/package-info.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,21&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;This&nbsp;package&nbsp;defines&nbsp;the&nbsp;core&nbsp;interfaces&nbsp;and&nbsp;classes&nbsp;to&nbsp;provide&nbsp;an&nbsp;asynchronous&nbsp;and&nbsp;improved<br>
+&nbsp;*&nbsp;JASPI-like&nbsp;message&nbsp;authentication&nbsp;API.<br>
+&nbsp;*/<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;\&nbsp;No&nbsp;newline&nbsp;at&nbsp;end&nbsp;of&nbsp;file<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspicontextFallbackServerAuthContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/context/FallbackServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,16&nbsp;+11,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
-import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
-import&nbsp;org.forgerock.jaspi.runtime.context.JaspiServerAuthContext;<br>
-import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuditTrail.*;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuthStatusUtils.asString;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,13&nbsp;+26,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.MessageInfo;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collections;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;java.util.HashMap;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuditTrail.*;<br>
-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuthStatusUtils.asString;<br>
-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.ContextHandler;<br>
+import&nbsp;org.forgerock.jaspi.runtime.context.JaspiServerAuthContext;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Encapsulates&nbsp;ServerAuthModules&nbsp;that&nbsp;are&nbsp;used&nbsp;to&nbsp;validate&nbsp;service&nbsp;requests&nbsp;received&nbsp;from&nbsp;clients,&nbsp;and&nbsp;to&nbsp;secure&nbsp;any<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-153,7&nbsp;+152,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auditTrail.auditFailure(moduleId,&nbsp;Collections.&amp;lt;String,&nbsp;Object&amp;gt;singletonMap(&amp;quot;message&amp;quot;,&nbsp;message),<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleAuditInfo);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(message);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(message);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(message);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;In&nbsp;this&nbsp;implementation&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;we&nbsp;are&nbsp;allowing&nbsp;a&nbsp;single&nbsp;&amp;quot;session&amp;quot;&nbsp;auth&nbsp;module&nbsp;to<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiexceptionsJaspiAuthExceptionjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/exceptions/JaspiAuthException.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,60&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.jaspi.exceptions;<br>
-<br>
-import&nbsp;javax.security.auth.message.AuthException;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;A&nbsp;sub-type&nbsp;of&nbsp;an&nbsp;AuthException&nbsp;which&nbsp;can&nbsp;accept&nbsp;a&nbsp;cause&nbsp;for&nbsp;this&nbsp;exception.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;@since&nbsp;1.3.0<br>
-&nbsp;*/<br>
-public&nbsp;class&nbsp;JaspiAuthException&nbsp;extends&nbsp;AuthException&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;-1L;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;String&nbsp;message)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;cause&nbsp;and&nbsp;a&nbsp;detail&nbsp;message&nbsp;of<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;(cause==null&nbsp;?&nbsp;null&nbsp;:&nbsp;cause.getMessage()).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(cause.getMessage());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCause(cause);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;a&nbsp;new&nbsp;JaspiAuthException&nbsp;with&nbsp;the&nbsp;specified&nbsp;detail&nbsp;message&nbsp;and&nbsp;cause.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;message&nbsp;The&nbsp;detail&nbsp;message.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cause&nbsp;The&nbsp;cause.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;JaspiAuthException(final&nbsp;String&nbsp;message,&nbsp;final&nbsp;Throwable&nbsp;cause)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCause(cause);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextContextHandlerjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/ContextHandler.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,18&nbsp;+11,13&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.runtime.context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
-import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
-import&nbsp;org.forgerock.json.resource.ResourceException;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthStatus;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-35,6&nbsp;+30,11&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;A&nbsp;handler&nbsp;for&nbsp;ServerAuthContext,&nbsp;which&nbsp;exposes&nbsp;helper&nbsp;methods&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;at&nbsp;the&nbsp;varying&nbsp;end&nbsp;states<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;ServerAuthContext&nbsp;processing.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-98,7&nbsp;+98,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;amp;&amp;amp;&nbsp;supportedTypes.contains(HttpServletResponse.class)))&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(&amp;quot;ServerAuthModule&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;HttpServlet&nbsp;profile,&nbsp;&amp;quot;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authModule.getClass().getName());<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;ServerAuthModule&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;HttpServlet&nbsp;profile,&nbsp;&amp;quot;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(&amp;quot;ServerAuthModule&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;HttpServlet&nbsp;profile,&nbsp;&amp;quot;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;authModule.getClass().getName());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-123,7&nbsp;+123,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.debug(&amp;quot;Authentication&nbsp;has&nbsp;failed.&amp;quot;);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResourceException&nbsp;jre&nbsp;=&nbsp;ResourceException.getException(UNAUTHORIZED_HTTP_ERROR_CODE,<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNAUTHORIZED_ERROR_MESSAGE);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(jre);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(jre);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setAuthenticationRequestAttributes(messageInfo,&nbsp;clientSubject);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrcmainjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/main/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContext.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,14&nbsp;+11,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.runtime.context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
-import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuditTrail.*;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuthStatusUtils.asString;<br>
+import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,13&nbsp;+28,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.module.ServerAuthModule;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.ArrayList;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Collections;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;java.util.HashMap;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuditTrail.*;<br>
-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.AuthStatusUtils.asString;<br>
-import&nbsp;static&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime.LOG;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Encapsulates&nbsp;ServerAuthModules&nbsp;that&nbsp;are&nbsp;used&nbsp;to&nbsp;validate&nbsp;service&nbsp;requests&nbsp;received&nbsp;from&nbsp;clients,&nbsp;and&nbsp;to&nbsp;secure&nbsp;any<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-201,7&nbsp;+200,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auditTrail.auditFailure(moduleId,&nbsp;Collections.&amp;lt;String,&nbsp;Object&amp;gt;singletonMap(&amp;quot;message&amp;quot;,&nbsp;message),<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleAuditInfo);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(message);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(message);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(message);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageInfo.getMap().remove(AUDIT_INFO_KEY);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-216,7&nbsp;+215,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;AuthStatus&nbsp;exceptionAuthStatus&nbsp;=&nbsp;authStatus;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Setting&nbsp;authStatus&nbsp;to&nbsp;null&nbsp;so&nbsp;auditing&nbsp;does&nbsp;not&nbsp;happen.&nbsp;As&nbsp;this&nbsp;exception&nbsp;is&nbsp;a&nbsp;configuration&nbsp;issue.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;{}&amp;quot;,&nbsp;asString(exceptionAuthStatus));<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;asString(exceptionAuthStatus));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-362,7&nbsp;+361,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthStatus&nbsp;authStatus&nbsp;=&nbsp;secureResponse(authModules,&nbsp;messageInfo,&nbsp;serviceSubject);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(AuthStatus.SUCCESS.equals(authStatus)&nbsp;||&nbsp;AuthStatus.FAILURE.equals(authStatus))&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.error(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;{}&amp;quot;,&nbsp;asString(authStatus));<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JaspiAuthException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AuthenticationException(&amp;quot;Invalid&nbsp;AuthStatus&nbsp;returned&nbsp;from&nbsp;validateRequest,&nbsp;&amp;quot;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;asString(authStatus));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockcafauthenticationapiAuthenticationExceptionTestjavafromrev3033forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiexceptionsJaspiAuthExceptionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/api/AuthenticationExceptionTest.java&nbsp;(from&nbsp;rev&nbsp;3033,&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java)&nbsp;(0&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/api/AuthenticationExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/caf/authentication/api/AuthenticationExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,113&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.caf.authentication.api;<br>
+<br>
+import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
+import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
+<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+public&nbsp;class&nbsp;AuthenticationExceptionTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithThrowable()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessageAndCause()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;CAUSE_MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessage()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(&amp;quot;MESSAGE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetCauseMessageWhenOnlyCauseSet()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;CAUSE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessageWhenDetailMessageAndCauseSet()&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationException&nbsp;e&nbsp;=&nbsp;new&nbsp;AuthenticationException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiexceptionsJaspiAuthExceptionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/exceptions/JaspiAuthExceptionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,113&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.jaspi.exceptions;<br>
-<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-import&nbsp;static&nbsp;org.mockito.BDDMockito.given;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.mock;<br>
-import&nbsp;static&nbsp;org.testng.Assert.assertEquals;<br>
-import&nbsp;static&nbsp;org.testng.Assert.assertNotNull;<br>
-<br>
-public&nbsp;class&nbsp;JaspiAuthExceptionTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessage()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithThrowable()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;MESSAGE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(cause);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldCreateJaspiAuthExceptionWithMessageAndCause()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;cause&nbsp;=&nbsp;new&nbsp;Exception(&amp;quot;CAUSE_MESSAGE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertNotNull(e);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(e.getMessage(),&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessage()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetCauseMessageWhenOnlyCauseSet()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(cause);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;CAUSE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldGetDetailMessageWhenDetailMessageAndCauseSet()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;mock(Throwable.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JaspiAuthException&nbsp;e&nbsp;=&nbsp;new&nbsp;JaspiAuthException(&amp;quot;MESSAGE&amp;quot;,&nbsp;cause);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given(cause.getMessage()).willReturn(&amp;quot;CAUSE&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=&nbsp;e.getMessage();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(message,&nbsp;&amp;quot;MESSAGE&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextContextHandlerTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/ContextHandlerTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,7&nbsp;+11,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.runtime.context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-20,13&nbsp;+20,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.testng.Assert.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
-import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
-import&nbsp;org.forgerock.json.resource.ResourceException;<br>
-import&nbsp;org.testng.annotations.BeforeMethod;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthStatus;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-41,6&nbsp;+34,13&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.JaspiRuntime;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.forgerock.json.resource.ResourceException;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;ContextHandlerTest&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ContextHandler&nbsp;contextHandler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-68,7&nbsp;+68,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenDoesNotSupportEither()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-86,7&nbsp;+86,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenOnlySupportsHttpServletRequest()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-105,7&nbsp;+105,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;rawtypes&amp;quot;)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateServerAuthModulesShouldThrowJaspiAuthExceptionWhenOnlySupportsHttpServletResponse()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockauthfilterstrunkforgerockauthnfilterforgerockjaspiruntimesrctestjavaorgforgerockjaspiruntimecontextJaspiServerAuthContextTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp;(3033&nbsp;=&gt;&nbsp;3034)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:48:40&nbsp;UTC&nbsp;(rev&nbsp;3033)<br>
+++&nbsp;forgerock-auth-filters/trunk/forgerock-authn-filter/forgerock-jaspi-runtime/src/test/java/org/forgerock/jaspi/runtime/context/JaspiServerAuthContextTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-03-16&nbsp;08:55:25&nbsp;UTC&nbsp;(rev&nbsp;3034)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-11,7&nbsp;+11,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;Copyright&nbsp;2013-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;*&nbsp;Copyright&nbsp;2013-2015&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.jaspi.runtime.context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-22,12&nbsp;+22,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.testng.Assert.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.jaspi.exceptions.JaspiAuthException;<br>
-import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
-import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
-import&nbsp;org.testng.annotations.BeforeMethod;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.Subject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;javax.security.auth.message.AuthStatus;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-38,6&nbsp;+32,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.List;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.caf.authentication.api.AuthenticationException;<br>
+import&nbsp;org.forgerock.jaspi.runtime.AuditTrail;<br>
+import&nbsp;org.forgerock.jaspi.utils.MessageInfoUtils;<br>
+import&nbsp;org.testng.annotations.BeforeMethod;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;public&nbsp;class&nbsp;JaspiServerAuthContextTest&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;MessageInfoUtils&nbsp;messageInfoUtils;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-284,7&nbsp;+284,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_CONTINUE);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenSessionModuleReturnsInvalidAuthStatus()<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-352,7&nbsp;+352,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SEND_FAILURE);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenAuthModulesReturnNull()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-382,7&nbsp;+382,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;JaspiAuthException<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;validateRequestShouldThrowJaspiAuthExceptionWhenAuthModulesReturnFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-575,7&nbsp;+575,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals(authStatus,&nbsp;AuthStatus.SUCCESS);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldThrowJaspiAuthExceptionWhenAuthModulesReturnSuccess()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-596,7&nbsp;+596,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;JaspiAuthException.class)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;AuthenticationException.class)<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;secureResponseShouldThrowJaspiAuthExceptionWhenAuthModulesReturnFailure()&nbsp;throws&nbsp;AuthException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
