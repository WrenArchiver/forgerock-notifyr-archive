<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.1//EN&quot;<br>
&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;<br>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;<br>
&lt;title&gt;[2876]&nbsp;forgerock-rest/branches/http-framework:&nbsp;Removes&nbsp;Router&nbsp;and&nbsp;exposes&nbsp;UriRouter&nbsp;and&nbsp;VersionRouter&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--<br>
#msg&nbsp;dl.meta&nbsp;{&nbsp;border:&nbsp;1px&nbsp;#006&nbsp;solid;&nbsp;background:&nbsp;#369;&nbsp;padding:&nbsp;6px;&nbsp;color:&nbsp;#fff;&nbsp;}<br>
#msg&nbsp;dl.meta&nbsp;dt&nbsp;{&nbsp;float:&nbsp;left;&nbsp;width:&nbsp;6em;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;dt:after&nbsp;{&nbsp;content:':';}<br>
#msg&nbsp;dl,&nbsp;#msg&nbsp;dt,&nbsp;#msg&nbsp;ul,&nbsp;#msg&nbsp;li,&nbsp;#header,&nbsp;#footer,&nbsp;#logmsg&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a&nbsp;{&nbsp;font-weight:&nbsp;bold}<br>
#msg&nbsp;dl&nbsp;a:link&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;color:#fc3;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:active&nbsp;&nbsp;{&nbsp;color:#ff0;&nbsp;}<br>
#msg&nbsp;dl&nbsp;a:visited&nbsp;{&nbsp;color:#cc6;&nbsp;}<br>
h3&nbsp;{&nbsp;font-family:&nbsp;verdana,arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#msg&nbsp;pre&nbsp;{&nbsp;overflow:&nbsp;auto;&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#logmsg&nbsp;{&nbsp;background:&nbsp;#ffc;&nbsp;border:&nbsp;1px&nbsp;#fa0&nbsp;solid;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;pre,&nbsp;#logmsg&nbsp;blockquote&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;p,&nbsp;#logmsg&nbsp;li,&nbsp;#logmsg&nbsp;dt,&nbsp;#logmsg&nbsp;dd&nbsp;{&nbsp;line-height:&nbsp;14pt;&nbsp;}<br>
#logmsg&nbsp;h1,&nbsp;#logmsg&nbsp;h2,&nbsp;#logmsg&nbsp;h3,&nbsp;#logmsg&nbsp;h4,&nbsp;#logmsg&nbsp;h5,&nbsp;#logmsg&nbsp;h6&nbsp;{&nbsp;margin:&nbsp;.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;h1:first-child,&nbsp;#logmsg&nbsp;h2:first-child,&nbsp;#logmsg&nbsp;h3:first-child,&nbsp;#logmsg&nbsp;h4:first-child,&nbsp;#logmsg&nbsp;h5:first-child,&nbsp;#logmsg&nbsp;h6:first-child&nbsp;{&nbsp;margin-top:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;ul,&nbsp;#logmsg&nbsp;ol&nbsp;{&nbsp;padding:&nbsp;0;&nbsp;list-style-position:&nbsp;inside;&nbsp;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;ul&nbsp;{&nbsp;text-indent:&nbsp;-1em;&nbsp;padding-left:&nbsp;1em;&nbsp;}#logmsg&nbsp;ol&nbsp;{&nbsp;text-indent:&nbsp;-1.5em;&nbsp;padding-left:&nbsp;1.5em;&nbsp;}<br>
#logmsg&nbsp;&gt;&nbsp;ul,&nbsp;#logmsg&nbsp;&gt;&nbsp;ol&nbsp;{&nbsp;margin:&nbsp;0&nbsp;0&nbsp;1em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;pre&nbsp;{&nbsp;background:&nbsp;#eee;&nbsp;padding:&nbsp;1em;&nbsp;}<br>
#logmsg&nbsp;blockquote&nbsp;{&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;border-left-width:&nbsp;10px;&nbsp;padding:&nbsp;1em&nbsp;1em&nbsp;0&nbsp;1em;&nbsp;background:&nbsp;white;}<br>
#logmsg&nbsp;dl&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dt&nbsp;{&nbsp;font-weight:&nbsp;bold;&nbsp;}<br>
#logmsg&nbsp;dd&nbsp;{&nbsp;margin:&nbsp;0;&nbsp;padding:&nbsp;0&nbsp;0&nbsp;0.5em&nbsp;0;&nbsp;}<br>
#logmsg&nbsp;dd:before&nbsp;{&nbsp;content:'\00bb';}<br>
#logmsg&nbsp;table&nbsp;{&nbsp;border-spacing:&nbsp;0px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;border-top:&nbsp;4px&nbsp;solid&nbsp;#fa0;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;background:&nbsp;#fff;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;font-weight:&nbsp;normal;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;td&nbsp;{&nbsp;text-align:&nbsp;right;&nbsp;border-top:&nbsp;1px&nbsp;dotted&nbsp;#fa0;&nbsp;padding:&nbsp;0.2em&nbsp;0.5em;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;thead&nbsp;th&nbsp;{&nbsp;text-align:&nbsp;center;&nbsp;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#fa0;&nbsp;}<br>
#logmsg&nbsp;table&nbsp;th.Corner&nbsp;{&nbsp;text-align:&nbsp;left;&nbsp;}<br>
#logmsg&nbsp;hr&nbsp;{&nbsp;border:&nbsp;none&nbsp;0;&nbsp;border-top:&nbsp;2px&nbsp;dashed&nbsp;#fa0;&nbsp;height:&nbsp;1px;&nbsp;}<br>
#header,&nbsp;#footer&nbsp;{&nbsp;color:&nbsp;#fff;&nbsp;background:&nbsp;#636;&nbsp;border:&nbsp;1px&nbsp;#300&nbsp;solid;&nbsp;padding:&nbsp;6px;&nbsp;}<br>
#patch&nbsp;{&nbsp;width:&nbsp;100%;&nbsp;}<br>
#patch&nbsp;h4&nbsp;{font-family:&nbsp;verdana,arial,helvetica,sans-serif;font-size:10pt;padding:8px;background:#369;color:#fff;margin:0;}<br>
#patch&nbsp;.propset&nbsp;h4,&nbsp;#patch&nbsp;.binary&nbsp;h4&nbsp;{margin:0;}<br>
#patch&nbsp;pre&nbsp;{padding:0;line-height:1.2em;margin:0;}<br>
#patch&nbsp;.diff&nbsp;{width:100%;background:#eee;padding:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;overflow:auto;}<br>
#patch&nbsp;.propset&nbsp;.diff,&nbsp;#patch&nbsp;.binary&nbsp;.diff&nbsp;&nbsp;{padding:10px&nbsp;0;}<br>
#patch&nbsp;span&nbsp;{display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.modfile,&nbsp;#patch&nbsp;.addfile,&nbsp;#patch&nbsp;.delfile,&nbsp;#patch&nbsp;.propset,&nbsp;#patch&nbsp;.binary,&nbsp;#patch&nbsp;.copfile&nbsp;{border:1px&nbsp;solid&nbsp;#ccc;margin:10px&nbsp;0;}<br>
#patch&nbsp;ins&nbsp;{background:#dfd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;del&nbsp;{background:#fdd;text-decoration:none;display:block;padding:0&nbsp;10px;}<br>
#patch&nbsp;.lines,&nbsp;.info&nbsp;{color:#888;background:#fff;}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;id=&quot;msg&quot;&gt;<br>
&lt;dl&nbsp;class=&quot;meta&quot;&gt;<br>
&lt;dt&gt;Revision&lt;/dt&gt;&nbsp;&lt;dd&gt;&lt;a&nbsp;href=&quot;http://sources.forgerock.org/changelog/commons/?cs=2876&quot;&gt;2876&lt;/a&gt;&lt;/dd&gt;<br>
&lt;dt&gt;Author&lt;/dt&gt;&nbsp;&lt;dd&gt;phillcunnington&lt;/dd&gt;<br>
&lt;dt&gt;Date&lt;/dt&gt;&nbsp;&lt;dd&gt;2015-01-28&nbsp;14:58:54&nbsp;+0000&nbsp;(Wed,&nbsp;28&nbsp;Jan&nbsp;2015)&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;h3&gt;Log&nbsp;Message&lt;/h3&gt;<br>
&lt;pre&gt;Removes&nbsp;Router&nbsp;and&nbsp;exposes&nbsp;UriRouter&nbsp;and&nbsp;VersionRouter<br>
<br>
Single&nbsp;Router&nbsp;class&nbsp;was&nbsp;meant&nbsp;to&nbsp;offer&nbsp;both&nbsp;uri&nbsp;routing&nbsp;and&nbsp;version&nbsp;routing.&nbsp;This&nbsp;doesn't&nbsp;work&nbsp;well&nbsp;in&nbsp;practice<br>
so&nbsp;falling&nbsp;back&nbsp;to&nbsp;use&nbsp;composition&nbsp;instead.&lt;/pre&gt;<br>
<br>
&lt;h3&gt;Modified&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceUriRouterjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceVersionRouterjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/VersionRouter.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionRouterTestjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDemoUtilsjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDynamicRealmDemojava&quot;&gt;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesVersionedResourcesDemojava&quot;&gt;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpMemoryBackendConnectionFactoryProviderjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource-http/src/main/java/org/forgerock/json/resource/http/MemoryBackendConnectionFactoryProvider.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Added&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionedRouterTestjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;h3&gt;Removed&nbsp;Paths&lt;/h3&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceRouterjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/Router.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceRouterTestjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceRouterVersionTestjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterVersionTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;#forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionRouterVersionTestjava&quot;&gt;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterVersionTest.java&lt;/a&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;patch&quot;&gt;<br>
&lt;h3&gt;Diff&lt;/h3&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceRouterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/Router.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,360&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-<br>
-import&nbsp;java.util.Set;<br>
-import&nbsp;java.util.concurrent.CopyOnWriteArraySet;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;request&nbsp;handler&nbsp;which&nbsp;routes&nbsp;requests&nbsp;using&nbsp;URI&nbsp;template&nbsp;matching&nbsp;against&nbsp;the&nbsp;request's&nbsp;resource&nbsp;name&nbsp;and&nbsp;based<br>
-&nbsp;*&nbsp;on&nbsp;a&nbsp;version&nbsp;of&nbsp;a&nbsp;resource.&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;Examples&nbsp;of&nbsp;valid&nbsp;URI&nbsp;templates&nbsp;include:&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;users<br>
-&nbsp;*&nbsp;users/{userId}<br>
-&nbsp;*&nbsp;users/{userId}/devices<br>
-&nbsp;*&nbsp;users/{userId}/devices/{deviceId}<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;Routes&nbsp;may&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;router&nbsp;as&nbsp;follows:&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;RequestHandler&nbsp;usersV1Dot0&nbsp;=&nbsp;...;<br>
-&nbsp;*&nbsp;RequestHandler&nbsp;usersV1Dot5&nbsp;=&nbsp;...;<br>
-&nbsp;*&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;router.addRoute(&amp;amp;quot;users&amp;amp;quot;)<br>
-&nbsp;*&nbsp;.addVersion(EQUALS,&nbsp;&amp;amp;quot;1.0&amp;amp;quot;,&nbsp;usersV1Dot0)<br>
-&nbsp;*&nbsp;.addVersion(EQUALS,&nbsp;&amp;amp;quot;1.5&amp;amp;quot;,&nbsp;usersV1Dot5);<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;request&nbsp;handler&nbsp;receiving&nbsp;a&nbsp;routed&nbsp;request&nbsp;may&nbsp;access&nbsp;the&nbsp;associated&nbsp;route's&nbsp;URI&nbsp;template&nbsp;variables&nbsp;via<br>
-&nbsp;*&nbsp;{@link&nbsp;RouterContext#getUriTemplateVariables()}.&nbsp;For&nbsp;example,&nbsp;a&nbsp;request&nbsp;handler&nbsp;processing&nbsp;requests&nbsp;for&nbsp;the&nbsp;route<br>
-&nbsp;*&nbsp;users/{userId}&nbsp;may&nbsp;obtain&nbsp;the&nbsp;value&nbsp;of&nbsp;{@code&nbsp;userId}&nbsp;as&nbsp;follows:&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;String&nbsp;userId&nbsp;=&nbsp;context.asContext(RouterContext.class).getUriTemplateVariables().get(&amp;amp;quot;userId&amp;amp;quot;);<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;The&nbsp;request&nbsp;handler&nbsp;receiving&nbsp;the&nbsp;routed&nbsp;request&nbsp;may&nbsp;access&nbsp;the&nbsp;associated&nbsp;resource's&nbsp;version&nbsp;via<br>
-&nbsp;*&nbsp;{@link&nbsp;AcceptAPIVersionContext#getResourceVersion()}.&nbsp;For&nbsp;example,&nbsp;a&nbsp;request&nbsp;handler&nbsp;processing&nbsp;requests&nbsp;for&nbsp;a&nbsp;version&nbsp;of<br>
-&nbsp;*&nbsp;a&nbsp;resource&nbsp;may&nbsp;obtain&nbsp;the&nbsp;resource's&nbsp;version&nbsp;as&nbsp;follows:&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;*&nbsp;Version&nbsp;resourceVersion&nbsp;=&nbsp;context.asContext(AcceptAPIVersionContext.class).getResourceVersion();<br>
-&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;During&nbsp;routing&nbsp;resource&nbsp;names&nbsp;are&nbsp;&amp;quot;relativized&amp;quot;&nbsp;by&nbsp;removing&nbsp;the&nbsp;leading&nbsp;path&nbsp;components&nbsp;which&nbsp;matched&nbsp;the<br>
-&nbsp;*&nbsp;template.&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;{@link&nbsp;RouterContext}&nbsp;for&nbsp;more&nbsp;information.&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;NOTE:&amp;lt;/b&amp;gt;&nbsp;for&nbsp;simplicity&nbsp;this&nbsp;implementation&nbsp;only&nbsp;supports&nbsp;a&nbsp;small&nbsp;sub-set&nbsp;of&nbsp;the&nbsp;functionality&nbsp;described&nbsp;in<br>
-&nbsp;*&nbsp;RFC&nbsp;6570.&amp;lt;/p&amp;gt;<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;@see&nbsp;RouterContext<br>
-&nbsp;*&nbsp;@see&nbsp;AcceptAPIVersionContext<br>
-&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://tools.ietf.org/html/rfc6570&amp;quot;&amp;gt;RFC&nbsp;6570&nbsp;-&nbsp;URI&nbsp;Template&amp;lt;/a&amp;gt;<br>
-&nbsp;*&nbsp;@since&nbsp;2.4.0<br>
-&nbsp;*/<br>
-public&nbsp;final&nbsp;class&nbsp;Router&nbsp;implements&nbsp;RequestHandler&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;UriRouter&nbsp;uriRouter&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionSelector.DefaultVersionBehaviour&nbsp;defaultVersioningBehaviour&nbsp;=<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VersionSelector.DefaultVersionBehaviour.LATEST;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;boolean&nbsp;warningEnabled&nbsp;=&nbsp;true;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Set&amp;lt;VersionRouter&amp;gt;&nbsp;versionRouters&nbsp;=&nbsp;new&nbsp;CopyOnWriteArraySet&amp;lt;VersionRouter&amp;gt;();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;with&nbsp;no&nbsp;routes&nbsp;defined.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;containing&nbsp;the&nbsp;same&nbsp;routes&nbsp;and&nbsp;default&nbsp;route&nbsp;as&nbsp;the&nbsp;provided&nbsp;router.&nbsp;Changes&nbsp;to&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;returned&nbsp;router's&nbsp;routing&nbsp;table&nbsp;will&nbsp;not&nbsp;impact&nbsp;the&nbsp;provided&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router&nbsp;The&nbsp;router&nbsp;to&nbsp;be&nbsp;copied.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router(Router&nbsp;router)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.addAllRoutes(router.uriRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;all&nbsp;of&nbsp;the&nbsp;routes&nbsp;defined&nbsp;in&nbsp;the&nbsp;provided&nbsp;router&nbsp;to&nbsp;this&nbsp;router.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;is&nbsp;processing&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router&nbsp;The&nbsp;router&nbsp;whose&nbsp;routes&nbsp;are&nbsp;to&nbsp;be&nbsp;copied&nbsp;into&nbsp;this&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;addAllRoutes(Router&nbsp;router)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.addAllRoutes(router.uriRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;collection&nbsp;resource&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;this&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;The&nbsp;provided&nbsp;URI&nbsp;template&nbsp;must&nbsp;match&nbsp;the&nbsp;resource&nbsp;collection&nbsp;itself,&nbsp;not&nbsp;resource&nbsp;instances.&nbsp;For&nbsp;example:&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;pre&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;CollectionResourceProvider&nbsp;users&nbsp;=&nbsp;...;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;valid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;the&nbsp;resource&nbsp;collection.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;//&nbsp;This&nbsp;is&nbsp;invalid&nbsp;usage:&nbsp;the&nbsp;template&nbsp;matches&nbsp;resource&nbsp;instances.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router.addRoute(&amp;quot;users/{userId}&amp;quot;,&nbsp;users);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;/pre&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider&nbsp;The&nbsp;collection&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests&nbsp;will&nbsp;be&nbsp;routed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(String&nbsp;uriTemplate,&nbsp;CollectionResourceProvider&nbsp;provider)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uriRouter.addRoute(uriTemplate,&nbsp;provider);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;singleton&nbsp;resource&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;provider&nbsp;The&nbsp;singleton&nbsp;resource&nbsp;provider&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests&nbsp;will&nbsp;be&nbsp;routed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(String&nbsp;uriTemplate,&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uriRouter.addRoute(uriTemplate,&nbsp;provider);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;request&nbsp;handler.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;processing&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mode&nbsp;Indicates&nbsp;how&nbsp;the&nbsp;URI&nbsp;template&nbsp;should&nbsp;be&nbsp;matched&nbsp;against&nbsp;resource&nbsp;names.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;The&nbsp;request&nbsp;handler&nbsp;to&nbsp;which&nbsp;matching&nbsp;requests&nbsp;will&nbsp;be&nbsp;routed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(RoutingMode&nbsp;mode,&nbsp;String&nbsp;uriTemplate,&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uriRouter.addRoute(mode,&nbsp;uriTemplate,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route&nbsp;for&nbsp;requests&nbsp;which&nbsp;do&nbsp;not&nbsp;match&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;defined<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;routes.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;handler&nbsp;The&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;setDefaultRoute(final&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.setDefaultRoute(handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route&nbsp;for&nbsp;requests&nbsp;which&nbsp;do&nbsp;not&nbsp;match&nbsp;any&nbsp;of&nbsp;the&nbsp;other<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;defined&nbsp;routes.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;RequestHandler&nbsp;getDefaultRoute()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uriRouter.getDefaultRoute();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Initiates&nbsp;the&nbsp;creation&nbsp;of&nbsp;a&nbsp;new&nbsp;route,&nbsp;to&nbsp;a&nbsp;versioned&nbsp;resource,&nbsp;on&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;URI&nbsp;template.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;route&nbsp;is&nbsp;not&nbsp;actually&nbsp;added&nbsp;to&nbsp;the&nbsp;router&nbsp;until&nbsp;a&nbsp;specific&nbsp;version&nbsp;and&nbsp;request&nbsp;handler&nbsp;has&nbsp;been&nbsp;specified&nbsp;by<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;calling&nbsp;#addVersion&nbsp;on&nbsp;the&nbsp;return&nbsp;{@code&nbsp;VersionHandler}.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Use&nbsp;this&nbsp;method&nbsp;when&nbsp;adding&nbsp;routes&nbsp;to&nbsp;{@link&nbsp;CollectionResourceProvider}s&nbsp;and<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;SingletonResourceProvider}s.&nbsp;To&nbsp;add&nbsp;routes&nbsp;to&nbsp;{@link&nbsp;RequestHandler}s&nbsp;use&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;#addRoute(RoutingMode,&nbsp;String)}&nbsp;method.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;{@code&nbsp;VersionHandler}&nbsp;instance&nbsp;to&nbsp;add&nbsp;resource&nbsp;version&nbsp;routes&nbsp;on.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addRoute(String&nbsp;uriTemplate)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(null,&nbsp;uriTemplate);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Initiates&nbsp;the&nbsp;creation&nbsp;of&nbsp;a&nbsp;new&nbsp;route,&nbsp;to&nbsp;a&nbsp;versioned&nbsp;resource,&nbsp;on&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;URI&nbsp;template.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;route&nbsp;is&nbsp;not&nbsp;actually&nbsp;added&nbsp;to&nbsp;the&nbsp;router&nbsp;until&nbsp;a&nbsp;specific&nbsp;version&nbsp;and&nbsp;request&nbsp;handler&nbsp;has&nbsp;been&nbsp;specified&nbsp;by<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;calling&nbsp;#addVersion&nbsp;on&nbsp;the&nbsp;return&nbsp;{@code&nbsp;VersionHandler}.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Use&nbsp;this&nbsp;method&nbsp;when&nbsp;adding&nbsp;routes&nbsp;to&nbsp;{@link&nbsp;RequestHandler}s.&nbsp;To&nbsp;add&nbsp;routes&nbsp;to<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;CollectionResourceProvider}s&nbsp;and&nbsp;{@link&nbsp;SingletonResourceProvider}s&nbsp;use&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;#addRoute(String)}&nbsp;method.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mode&nbsp;Indicates&nbsp;how&nbsp;the&nbsp;URI&nbsp;template&nbsp;should&nbsp;be&nbsp;matched&nbsp;against&nbsp;resource&nbsp;names.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;uriTemplate&nbsp;The&nbsp;URI&nbsp;template&nbsp;which&nbsp;request&nbsp;resource&nbsp;names&nbsp;must&nbsp;match.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;{@code&nbsp;VersionHandler}&nbsp;instance&nbsp;to&nbsp;add&nbsp;resource&nbsp;version&nbsp;routes&nbsp;on.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addRoute(RoutingMode&nbsp;mode,&nbsp;String&nbsp;uriTemplate)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter&nbsp;versionRouter&nbsp;=&nbsp;new&nbsp;VersionRouter(this,&nbsp;mode,&nbsp;uriTemplate);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setVersionRouterDefaultBehaviour(versionRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setWarningEnabledBehaviour(versionRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouters.add(versionRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;versionRouter;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;setVersionRouterDefaultBehaviour(VersionRouter&nbsp;versionRouter)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(defaultVersioningBehaviour)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;LATEST:&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.defaultToLatest();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OLDEST:&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.defaultToOldest();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.noDefault();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;updateVersionRoutersDefaultBehaviour()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(VersionRouter&nbsp;versionRouter&nbsp;:&nbsp;versionRouters)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setVersionRouterDefaultBehaviour(versionRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;to&nbsp;always&nbsp;use&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;latest&nbsp;resource&nbsp;version&nbsp;when&nbsp;the&nbsp;requested&nbsp;version&nbsp;is&nbsp;{@code&nbsp;null}.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;setVersioningToDefaultToLatest()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultVersioningBehaviour&nbsp;=&nbsp;VersionSelector.DefaultVersionBehaviour.LATEST;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateVersionRoutersDefaultBehaviour();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;to&nbsp;always&nbsp;use&nbsp;the<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;oldest&nbsp;resource&nbsp;version&nbsp;when&nbsp;the&nbsp;requested&nbsp;version&nbsp;is&nbsp;{@code&nbsp;null}.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;setVersioningToDefaultToOldest()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultVersioningBehaviour&nbsp;=&nbsp;VersionSelector.DefaultVersionBehaviour.OLDEST;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateVersionRoutersDefaultBehaviour();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;default&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;which&nbsp;will<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;result&nbsp;in&nbsp;{@code&nbsp;NotFoundException}s&nbsp;when&nbsp;the&nbsp;requested&nbsp;version&nbsp;is<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@code&nbsp;null}.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;setVersioningToDefaultToNone()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultVersioningBehaviour&nbsp;=&nbsp;VersionSelector.DefaultVersionBehaviour.NONE;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateVersionRoutersDefaultBehaviour();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;setWarningEnabledBehaviour(VersionRouter&nbsp;versionRouter)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.setWarningEnabledBehaviour(warningEnabled);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;updateVersionRoutersWarningBehaviour()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(VersionRouter&nbsp;versionRouter&nbsp;:&nbsp;versionRouters)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setWarningEnabledBehaviour(versionRouter);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Determines&nbsp;whether&nbsp;or&nbsp;not&nbsp;the&nbsp;responses&nbsp;returned&nbsp;by&nbsp;the&nbsp;resources&nbsp;under<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;this&nbsp;router&nbsp;will&nbsp;add&nbsp;a&nbsp;warning&nbsp;to&nbsp;the&nbsp;response&nbsp;if&nbsp;there&nbsp;is&nbsp;no<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Accept-API-Version&nbsp;header&nbsp;in&nbsp;them.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;warningEnabled<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{@code&nbsp;true}&nbsp;to&nbsp;enable&nbsp;warning,&nbsp;false&nbsp;otherwise.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;setWarningEnabled(boolean&nbsp;warningEnabled)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.warningEnabled&nbsp;=&nbsp;warningEnabled;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateVersionRoutersWarningBehaviour();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleAction(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleAction(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCreate(ServerContext&nbsp;context,&nbsp;CreateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleDelete(ServerContext&nbsp;context,&nbsp;DeleteRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handlePatch(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleQuery(ServerContext&nbsp;context,&nbsp;QueryRequest&nbsp;request,&nbsp;QueryResultHandler&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleRead(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleRead(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleUpdate(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;all&nbsp;of&nbsp;the&nbsp;routes&nbsp;from&nbsp;this&nbsp;router.&nbsp;Routes&nbsp;may&nbsp;be&nbsp;removed&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Router&nbsp;removeAllRoutes()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRouter.removeAllRoutes();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;one&nbsp;or&nbsp;more&nbsp;routes&nbsp;from&nbsp;this&nbsp;router.&nbsp;Routes&nbsp;may&nbsp;be&nbsp;removed&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;routes&nbsp;The&nbsp;routes&nbsp;to&nbsp;be&nbsp;removed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@code&nbsp;true}&nbsp;if&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;routes&nbsp;was&nbsp;found&nbsp;and&nbsp;removed.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;removeRoute(final&nbsp;Route...&nbsp;routes)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uriRouter.removeRoute(routes);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceUriRouterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/UriRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-13,6&nbsp;+13,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;Copyright&nbsp;2012-2014&nbsp;ForgeRock&nbsp;AS.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.copyOfActionRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-74,11&nbsp;+75,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;of&nbsp;the&nbsp;functionality&nbsp;described&nbsp;in&nbsp;RFC&nbsp;6570.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@see&nbsp;RouterContext<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;*&nbsp;@see&nbsp;UriRouter<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;@see&nbsp;&amp;lt;a&nbsp;href=&amp;quot;http://tools.ietf.org/html/rfc6570&amp;quot;&amp;gt;RFC&nbsp;6570&nbsp;-&nbsp;URI&nbsp;Template<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;/a&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-final&nbsp;class&nbsp;UriRouter&nbsp;implements&nbsp;RequestHandler&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+public&nbsp;final&nbsp;class&nbsp;UriRouter&nbsp;implements&nbsp;RequestHandler&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;RequestHandler&nbsp;defaultRoute&nbsp;=&nbsp;null;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Set&amp;lt;UriRoute&amp;gt;&nbsp;routes&nbsp;=&nbsp;new&nbsp;CopyOnWriteArraySet&amp;lt;UriRoute&amp;gt;();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-91,6&nbsp;+91,19&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;containing&nbsp;the&nbsp;same&nbsp;routes&nbsp;and&nbsp;default&nbsp;route&nbsp;as&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;provided&nbsp;router.&nbsp;Changes&nbsp;to&nbsp;the&nbsp;returned&nbsp;router's&nbsp;routing&nbsp;table&nbsp;will&nbsp;not<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;impact&nbsp;the&nbsp;provided&nbsp;router.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;router&nbsp;to&nbsp;be&nbsp;copied.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter(final&nbsp;UriRouter&nbsp;router)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.defaultRoute&nbsp;=&nbsp;router.defaultRoute;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.routes.addAll(router.routes);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;all&nbsp;of&nbsp;the&nbsp;routes&nbsp;defined&nbsp;in&nbsp;the&nbsp;provided&nbsp;router&nbsp;to&nbsp;this&nbsp;router.&nbsp;New<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-98,7&nbsp;+111,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;router&nbsp;whose&nbsp;routes&nbsp;are&nbsp;to&nbsp;be&nbsp;copied&nbsp;into&nbsp;this&nbsp;router.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;addAllRoutes(final&nbsp;UriRouter&nbsp;router)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter&nbsp;addAllRoutes(final&nbsp;UriRouter&nbsp;router)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this&nbsp;!=&nbsp;router)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routes.addAll(router.routes);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-132,7&nbsp;+145,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRoute&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;CollectionResourceProvider&nbsp;provider)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(STARTS_WITH,&nbsp;uriTemplate,&nbsp;newCollection(provider));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-151,7&nbsp;+164,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRoute&nbsp;addRoute(final&nbsp;RoutingMode&nbsp;mode,&nbsp;final&nbsp;String&nbsp;uriTemplate,<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(final&nbsp;RoutingMode&nbsp;mode,&nbsp;final&nbsp;String&nbsp;uriTemplate,<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(new&nbsp;UriRoute(mode,&nbsp;uriTemplate,&nbsp;handler));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-169,7&nbsp;+182,8&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRoute&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,&nbsp;final&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Route&nbsp;addRoute(final&nbsp;String&nbsp;uriTemplate,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addRoute(EQUALS,&nbsp;uriTemplate,&nbsp;newSingleton(provider));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-179,7&nbsp;+193,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;getDefaultRoute()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;RequestHandler&nbsp;getDefaultRoute()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;defaultRoute;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-287,7&nbsp;+301,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;removeAllRoutes()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter&nbsp;removeAllRoutes()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routes.clear();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-300,7&nbsp;+314,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;routes&nbsp;to&nbsp;be&nbsp;removed.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@code&nbsp;true}&nbsp;if&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;routes&nbsp;was&nbsp;found&nbsp;and&nbsp;removed.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;removeRoute(final&nbsp;Route...&nbsp;routes)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;boolean&nbsp;removeRoute(final&nbsp;Route...&nbsp;routes)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;isModified&nbsp;=&nbsp;false;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(final&nbsp;Route&nbsp;route&nbsp;:&nbsp;routes)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isModified&nbsp;|=&nbsp;this.routes.remove(route);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-316,12&nbsp;+330,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;request&nbsp;handler&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;default&nbsp;route.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;setDefaultRoute(final&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UriRouter&nbsp;setDefaultRoute(final&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.defaultRoute&nbsp;=&nbsp;handler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;UriRoute&nbsp;addRoute(final&nbsp;UriRoute&nbsp;route)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Route&nbsp;addRoute(final&nbsp;UriRoute&nbsp;route)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routes.add(route);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;route;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-341,12&nbsp;+355,13&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;handler&nbsp;=&nbsp;defaultRoute;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Passing&nbsp;the&nbsp;resourceName&nbsp;through&nbsp;explicitly&nbsp;means&nbsp;if&nbsp;an&nbsp;incorrect&nbsp;version&nbsp;was&nbsp;requested&nbsp;the&nbsp;error&nbsp;returned<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;is&nbsp;specific&nbsp;to&nbsp;the&nbsp;endpoint&nbsp;requested.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Passing&nbsp;the&nbsp;resourceName&nbsp;through&nbsp;explicitly&nbsp;means&nbsp;if&nbsp;an&nbsp;incorrect&nbsp;version&nbsp;was&nbsp;requested&nbsp;the&nbsp;error&nbsp;returned<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;is&nbsp;specific&nbsp;to&nbsp;the&nbsp;endpoint&nbsp;requested.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(handler&nbsp;!=&nbsp;null)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;RouteMatcher(context,&nbsp;handler,&nbsp;request.getResourceName());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;ins&gt;+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;i18n<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;NotFoundException(String.format(&amp;quot;Resource&nbsp;'%s'&nbsp;not&nbsp;found&amp;quot;,&nbsp;request<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getResourceName()));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrcmainjavaorgforgerockjsonresourceVersionRouterjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/VersionRouter.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/VersionRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/main/java/org/forgerock/json/resource/VersionRouter.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,16&nbsp;+16,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.util.Reject;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newCollection;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newSingleton;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.VersionConstants.*;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.Map;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;java.util.concurrent.ConcurrentHashMap;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newCollection;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newSingleton;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.RoutingMode.STARTS_WITH;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.VersionConstants.*;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;A&nbsp;request&nbsp;handler&nbsp;which&nbsp;routes&nbsp;requests&nbsp;using&nbsp;a&nbsp;request&nbsp;resource&nbsp;version.&amp;lt;/p&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-61,25&nbsp;+59,40&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;VersionSelector&nbsp;versionSelector&nbsp;=&nbsp;new&nbsp;VersionSelector();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Map&amp;lt;Version,&nbsp;VersionRoute&amp;lt;RequestHandler&amp;gt;&amp;gt;&nbsp;routes&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ConcurrentHashMap&amp;lt;Version,&nbsp;VersionRoute&amp;lt;RequestHandler&amp;gt;&amp;gt;();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;Router&nbsp;router;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;RoutingMode&nbsp;mode;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;uriTemplate;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandlerType&nbsp;requestHandlerType;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;Route&nbsp;uriRoute;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;boolean&nbsp;warningEnabled&nbsp;=&nbsp;true;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;with&nbsp;no&nbsp;routes&nbsp;defined.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter(Router&nbsp;router,&nbsp;RoutingMode&nbsp;mode,&nbsp;String&nbsp;uriTemplate)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(router,&nbsp;&amp;quot;router&nbsp;cannot&nbsp;be&nbsp;null.&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(uriTemplate,&nbsp;&amp;quot;uriTemplate&nbsp;cannot&nbsp;be&nbsp;null.&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.router&nbsp;=&nbsp;router;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.mode&nbsp;=&nbsp;mode;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.uriTemplate&nbsp;=&nbsp;uriTemplate;<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Nothing&nbsp;to&nbsp;do.<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;router&nbsp;containing&nbsp;the&nbsp;same&nbsp;routes&nbsp;and&nbsp;default&nbsp;route&nbsp;as&nbsp;the&nbsp;provided&nbsp;router.&nbsp;Changes&nbsp;to&nbsp;the<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;returned&nbsp;router's&nbsp;routing&nbsp;table&nbsp;will&nbsp;not&nbsp;impact&nbsp;the&nbsp;provided&nbsp;router.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router&nbsp;The&nbsp;router&nbsp;to&nbsp;be&nbsp;copied.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter(VersionRouter&nbsp;router)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.routes.putAll(router.routes);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;all&nbsp;of&nbsp;the&nbsp;routes&nbsp;defined&nbsp;in&nbsp;the&nbsp;provided&nbsp;router&nbsp;to&nbsp;this&nbsp;router.&nbsp;New<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;router<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;router&nbsp;whose&nbsp;routes&nbsp;are&nbsp;to&nbsp;be&nbsp;copied&nbsp;into&nbsp;this&nbsp;router.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;This&nbsp;router.<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addAllRoutes(VersionRouter&nbsp;router)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this&nbsp;!=&nbsp;router)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routes.putAll(router.routes);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;a&nbsp;new&nbsp;route&nbsp;to&nbsp;this&nbsp;router&nbsp;for&nbsp;the&nbsp;provided&nbsp;collection&nbsp;resource&nbsp;provider.&nbsp;New&nbsp;routes&nbsp;may&nbsp;be&nbsp;added&nbsp;while&nbsp;this<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;router&nbsp;is&nbsp;processing&nbsp;requests.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-88,7&nbsp;+101,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addVersion(String&nbsp;version,&nbsp;CollectionResourceProvider&nbsp;provider)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addVersion(RequestHandlerType.COLLECTION,&nbsp;STARTS_WITH,&nbsp;version,&nbsp;newCollection(provider));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addVersion(version,&nbsp;newCollection(provider));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-101,7&nbsp;+114,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addVersion(String&nbsp;version,&nbsp;SingletonResourceProvider&nbsp;provider)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addVersion(RequestHandlerType.SINGLETON,&nbsp;RoutingMode.EQUALS,&nbsp;version,&nbsp;newSingleton(provider));<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addVersion(version,&nbsp;newSingleton(provider));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-114,16&nbsp;+127,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;An&nbsp;opaque&nbsp;handle&nbsp;for&nbsp;the&nbsp;route&nbsp;which&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;removing&nbsp;the&nbsp;route&nbsp;later.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;addVersion(String&nbsp;version,&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(mode,&nbsp;&amp;quot;Routing&nbsp;mode&nbsp;is&nbsp;not&nbsp;set.&nbsp;Incorrect&nbsp;use&nbsp;of&nbsp;Router#addRoute(String),&nbsp;&amp;quot;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;use&nbsp;Router#addRoute(RoutingMode,&nbsp;String)&nbsp;instead&nbsp;and&nbsp;specify&nbsp;the&nbsp;RoutingMode&nbsp;to&nbsp;use&nbsp;with&nbsp;the&nbsp;&amp;quot;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;RequestHandler.&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addVersion(RequestHandlerType.GENERIC,&nbsp;mode,&nbsp;version,&nbsp;handler);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionRouter&nbsp;addVersion(RequestHandlerType&nbsp;type,&nbsp;RoutingMode&nbsp;mode,&nbsp;String&nbsp;version,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addVersion(new&nbsp;VersionRoute&amp;lt;RequestHandler&amp;gt;(Version.valueOf(version),&nbsp;handler));<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addRoute(type,&nbsp;mode);<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-132,36&nbsp;+136,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;P&amp;gt;If&nbsp;the&nbsp;route&nbsp;to&nbsp;the&nbsp;resource&nbsp;URI&nbsp;has&nbsp;not&nbsp;been&nbsp;added,&nbsp;this&nbsp;method&nbsp;will&nbsp;add&nbsp;it.&nbsp;This&nbsp;is&nbsp;only&nbsp;ever&nbsp;done&nbsp;once&nbsp;for<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;very&nbsp;first&nbsp;call.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&amp;lt;p&amp;gt;Subsequent&nbsp;calls&nbsp;will&nbsp;be&nbsp;validated&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;resource&nbsp;handler&nbsp;has&nbsp;not&nbsp;changed&nbsp;type,&nbsp;i.e.&nbsp;from&nbsp;a<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;CollectionResourceProvider&nbsp;to&nbsp;a&nbsp;SingletonResourceProvider.&amp;lt;/p&amp;gt;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;type&nbsp;The&nbsp;resource&nbsp;handler&nbsp;type.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;mode&nbsp;Indicates&nbsp;how&nbsp;the&nbsp;URI&nbsp;template&nbsp;should&nbsp;be&nbsp;matched&nbsp;against&nbsp;resource&nbsp;names.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;addRoute(RequestHandlerType&nbsp;type,&nbsp;RoutingMode&nbsp;mode)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validateRequestHandlerType(type);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(uriRoute&nbsp;==&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uriRoute&nbsp;=&nbsp;router.addRoute(mode,&nbsp;uriTemplate,&nbsp;this);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;validateRequestHandlerType(RequestHandlerType&nbsp;type)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(requestHandlerType&nbsp;!=&nbsp;null)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifFalse(type.equals(requestHandlerType),&nbsp;&amp;quot;Incompatible&nbsp;request&nbsp;handler&nbsp;types,&nbsp;&amp;quot;&nbsp;+&nbsp;requestHandlerType<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&amp;quot;&nbsp;and&nbsp;&amp;quot;&nbsp;+&nbsp;type);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestHandlerType&nbsp;=&nbsp;type;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;to&nbsp;always&nbsp;use&nbsp;the&nbsp;latest&nbsp;resource&nbsp;version&nbsp;when&nbsp;the&nbsp;requested<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;version&nbsp;is&nbsp;{@code&nbsp;null}.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter&nbsp;defaultToLatest()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;defaultToLatest()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionSelector.defaultToLatest();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-170,7&nbsp;+148,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;to&nbsp;always&nbsp;use&nbsp;the&nbsp;oldest&nbsp;resource&nbsp;version&nbsp;when&nbsp;the&nbsp;requested<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;version&nbsp;is&nbsp;{@code&nbsp;null}.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter&nbsp;defaultToOldest()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;defaultToOldest()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionSelector.defaultToOldest();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-179,12&nbsp;+157,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;default&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;version&nbsp;routing&nbsp;process&nbsp;which&nbsp;will&nbsp;result&nbsp;in&nbsp;{@code&nbsp;NotFoundException}s&nbsp;when<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;requested&nbsp;version&nbsp;is&nbsp;{@code&nbsp;null}.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter&nbsp;noDefault()&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;noDefault()&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionSelector.noDefault();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;VersionRouter&nbsp;setWarningEnabledBehaviour(boolean&nbsp;warningEnabled)&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;VersionRouter&nbsp;setWarningEnabledBehaviour(boolean&nbsp;warningEnabled)&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.warningEnabled&nbsp;=&nbsp;warningEnabled;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-195,7&nbsp;+173,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleAction(ServerContext&nbsp;context,&nbsp;ActionRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleAction(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleAction(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-207,7&nbsp;+185,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleCreate(ServerContext&nbsp;context,&nbsp;CreateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleCreate(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleCreate(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-219,7&nbsp;+197,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleDelete(ServerContext&nbsp;context,&nbsp;DeleteRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleDelete(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleDelete(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-231,7&nbsp;+209,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handlePatch(ServerContext&nbsp;context,&nbsp;PatchRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handlePatch(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handlePatch(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-243,7&nbsp;+221,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleQuery(ServerContext&nbsp;context,&nbsp;QueryRequest&nbsp;request,&nbsp;QueryResultHandler&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleQuery(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleQuery(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-255,7&nbsp;+233,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleRead(ServerContext&nbsp;context,&nbsp;ReadRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleRead(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleRead(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-267,7&nbsp;+245,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleUpdate(ServerContext&nbsp;context,&nbsp;UpdateRequest&nbsp;request,&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context,&nbsp;request).handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getBestRoute(context).handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ResourceException&nbsp;e)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.handleError(e);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-282,11&nbsp;+260,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;changed&nbsp;by&nbsp;calling&nbsp;either&nbsp;{@link&nbsp;#defaultToLatest()}&nbsp;or&nbsp;{@link&nbsp;#defaultToOldest()}.&amp;lt;/p&amp;gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;The&nbsp;context.<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;request&nbsp;The&nbsp;request&nbsp;being&nbsp;processed.<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;The&nbsp;best&nbsp;matching&nbsp;{@code&nbsp;RequestHandler}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;NotFoundException&nbsp;If&nbsp;no&nbsp;match&nbsp;is&nbsp;found.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;getBestRoute(ServerContext&nbsp;context,&nbsp;Request&nbsp;request)&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;getBestRoute(ServerContext&nbsp;context)&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;context.asContext(AcceptAPIVersionContext.class);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addWarningAdvice(context,&nbsp;apiVersionContext.getResourceVersion());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;VersionRoute&amp;lt;RequestHandler&amp;gt;&nbsp;selectedRoute&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-320,13&nbsp;+297,4&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.toString());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;del&gt;-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;/**<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;An&nbsp;enum&nbsp;for&nbsp;the&nbsp;type&nbsp;of&nbsp;request&nbsp;handler&nbsp;for&nbsp;the&nbsp;resource.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;enum&nbsp;RequestHandlerType&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECTION,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SINGLETON,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GENERIC<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceRouterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,248&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2012-2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newReadRequest;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
-<br>
-import&nbsp;org.forgerock.resource.core.Context;<br>
-import&nbsp;org.forgerock.resource.core.RootContext;<br>
-import&nbsp;org.mockito.ArgumentCaptor;<br>
-import&nbsp;org.mockito.Matchers;<br>
-import&nbsp;org.testng.annotations.DataProvider;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-import&nbsp;java.util.Collections;<br>
-import&nbsp;java.util.LinkedHashMap;<br>
-import&nbsp;java.util.Map;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;Tests&nbsp;{@code&nbsp;VersionRouter}.<br>
-&nbsp;*/<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;final&nbsp;class&nbsp;RouterTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;starts&nbsp;with&nbsp;match<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;more&nbsp;precedence&nbsp;tests<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;test&nbsp;collection/singleton<br>
-&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;route&nbsp;registration/deregistation<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;absoluteRouteHitTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;resource&nbsp;name&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b/c&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/two/three&amp;quot;&nbsp;},&nbsp;//&nbsp;Check&nbsp;multi-char&nbsp;path&nbsp;elements.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;absoluteRouteHitTestData&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testAbsoluteRouteHit(final&nbsp;String&nbsp;resourceName)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;resourceName,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourceName);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h).handleRead(rc.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;resourceName);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri,&nbsp;final&nbsp;String&nbsp;key,&nbsp;final&nbsp;String&nbsp;value)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;expectedMatchedUri,&nbsp;Collections.singletonMap(key,&nbsp;value));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;expectedMatchedUri,&nbsp;Collections.&amp;lt;String,&nbsp;String&amp;gt;emptyMap());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;checkRouterContext(ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc,&nbsp;final&nbsp;ServerContext&nbsp;c,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;expectedMatchedUri,&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;String&amp;gt;&nbsp;expectedUriTemplateVariables)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getParent()).isSameAs(c);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getMatchedUri()).isEqualTo(expectedMatchedUri);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getBaseUri()).isEqualTo(expectedMatchedUri);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(rc.getValue().getUriTemplateVariables()).isEqualTo(expectedUriTemplateVariables);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;invalidTemplatesTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;invalid&nbsp;template&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{}&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a/{b}&amp;quot;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;invalidTemplatesTestData&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testInvalidTemplates(final&nbsp;String&nbsp;template)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMultipleRoutePrecedence()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h1&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;object&amp;quot;,&nbsp;h1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h2&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;{objectId}&amp;quot;,&nbsp;h2);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r1&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r1,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc1&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h1).handleRead(rc1.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc1,&nbsp;c,&nbsp;&amp;quot;object&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r2&nbsp;=&nbsp;newReadRequest(&amp;quot;thing&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r2,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc2&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h2).handleRead(rc2.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc2,&nbsp;c,&nbsp;&amp;quot;thing&amp;quot;,&nbsp;&amp;quot;objectId&amp;quot;,&nbsp;&amp;quot;thing&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testMultipleRoutes()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h1&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;users&amp;quot;,&nbsp;h1);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h2&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;groups&amp;quot;,&nbsp;h2);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r1&nbsp;=&nbsp;newReadRequest(&amp;quot;users&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r1,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc1&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h1).handleRead(rc1.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc1,&nbsp;c,&nbsp;&amp;quot;users&amp;quot;);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r2&nbsp;=&nbsp;newReadRequest(&amp;quot;groups&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r2,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc2&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h2).handleRead(rc2.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc2,&nbsp;c,&nbsp;&amp;quot;groups&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;routeMissTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;template&nbsp;-&nbsp;resource&nbsp;name&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a&amp;quot;,&nbsp;&amp;quot;a/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;a/b&amp;quot;,&nbsp;&amp;quot;b/b&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/two&amp;quot;,&nbsp;&amp;quot;one/twox&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/twox&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/{b}&amp;quot;,&nbsp;&amp;quot;one/two/three&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;one/{a}/{b}&amp;quot;,&nbsp;&amp;quot;one/two&amp;quot;&nbsp;},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;routeMissTestData&amp;quot;,&nbsp;expectedExceptions&nbsp;=&nbsp;NotFoundException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testRouteMiss(final&nbsp;String&nbsp;template,&nbsp;final&nbsp;String&nbsp;resourceName)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourceName);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newInternalConnection(router).read(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;that&nbsp;routing&nbsp;failure&nbsp;does&nbsp;not&nbsp;pollute&nbsp;the&nbsp;context.<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object[][]&nbsp;variableRouteHitTestData()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:off<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;template&nbsp;-&nbsp;resource&nbsp;name&nbsp;-&nbsp;variables&nbsp;*/<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}&amp;quot;,&nbsp;&amp;quot;a&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;a&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}&amp;quot;,&nbsp;&amp;quot;test&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;x{userId}&amp;quot;,&nbsp;&amp;quot;xtest&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{userId}/devices&amp;quot;,&nbsp;&amp;quot;test/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;userId&amp;quot;,&nbsp;&amp;quot;test&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/{b}&amp;quot;,&nbsp;&amp;quot;aaa/bbb&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;a&amp;quot;,&nbsp;&amp;quot;aaa&amp;quot;,&nbsp;&amp;quot;b&amp;quot;,&nbsp;&amp;quot;bbb&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;{a}/b/{c}&amp;quot;,&nbsp;&amp;quot;aaa/b/ccc&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;a&amp;quot;,&nbsp;&amp;quot;aaa&amp;quot;,&nbsp;&amp;quot;c&amp;quot;,&nbsp;&amp;quot;ccc&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;users/{id}/devices&amp;quot;,&nbsp;&amp;quot;users/test%20user/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;id&amp;quot;,&nbsp;&amp;quot;test&nbsp;user&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;users/{id}/devices&amp;quot;,&nbsp;&amp;quot;users/test+%2buser/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;id&amp;quot;,&nbsp;&amp;quot;test++user&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&amp;quot;users/{id}/devices&amp;quot;,&nbsp;&amp;quot;users/test%2fdevices/devices&amp;quot;,&nbsp;new&nbsp;String[]&nbsp;{&amp;quot;id&amp;quot;,&nbsp;&amp;quot;test/devices&amp;quot;&nbsp;}},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;@formatter:on<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(dataProvider&nbsp;=&nbsp;&amp;quot;variableRouteHitTestData&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testVariableRouteHit(final&nbsp;String&nbsp;template,&nbsp;final&nbsp;String&nbsp;resourceName,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String[]&nbsp;expectedVars)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;RequestHandler&nbsp;h&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;template,&nbsp;h);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ServerContext&nbsp;c&nbsp;=&nbsp;newServerContext(router);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(resourceName);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(c,&nbsp;r,&nbsp;null);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Map&amp;lt;String,&nbsp;String&amp;gt;&nbsp;expectedMap&nbsp;=&nbsp;new&nbsp;LinkedHashMap&amp;lt;String,&nbsp;String&amp;gt;();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;expectedVars.length;&nbsp;i&nbsp;+=&nbsp;2)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMap.put(expectedVars[i],&nbsp;expectedVars[i&nbsp;+&nbsp;1]);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ArgumentCaptor&amp;lt;RouterContext&amp;gt;&nbsp;rc&nbsp;=&nbsp;ArgumentCaptor.forClass(RouterContext.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(h).handleRead(rc.capture(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;&nbsp;any(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matchers.&amp;lt;ResultHandler&amp;lt;Resource&amp;gt;&amp;gt;&nbsp;any());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkRouterContext(rc,&nbsp;c,&nbsp;resourceName,&nbsp;expectedMap);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test(expectedExceptions&nbsp;=&nbsp;NotFoundException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testZeroRoutes()&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Context&nbsp;c&nbsp;=&nbsp;new&nbsp;RootContext();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ReadRequest&nbsp;r&nbsp;=&nbsp;newReadRequest(&amp;quot;object&amp;quot;);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newInternalConnection(router).read(c,&nbsp;r);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;ServerContext&nbsp;newServerContext(final&nbsp;RequestHandler&nbsp;handler)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;ServerContext(new&nbsp;RootContext());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceRouterVersionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterVersionTest.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterVersionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/RouterVersionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,284&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
-import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
-<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.resource.core.RootContext;<br>
-import&nbsp;org.mockito.ArgumentCaptor;<br>
-import&nbsp;org.mockito.Matchers;<br>
-import&nbsp;org.testng.annotations.BeforeClass;<br>
-import&nbsp;org.testng.annotations.DataProvider;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;@since&nbsp;2.4.0<br>
-&nbsp;*/<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;class&nbsp;RouterVersionTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Router&nbsp;router;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerOne;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerTwo;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerThree;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerOne;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerTwo;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerThree;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeClass<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;usersHandlerOne)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersHandlerTwo)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;usersHandlerThree);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/groups&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;groupsHandlerOne)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;groupsHandlerTwo)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataProvider()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;3.0&amp;quot;,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.0&amp;quot;,&nbsp;false,&nbsp;groupsHandlerTwo},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;1.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerTwo},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.9&amp;quot;,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;groupsHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteCreateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;Requests.newCreateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleCreate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;CreateRequest&amp;gt;anyObject(),&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteReadVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;Requests.newReadRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleRead(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteUpdateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;Requests.newUpdateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleUpdate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;UpdateRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteDeleteVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;Requests.newDeleteRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleDelete(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;DeleteRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRoutePatchVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;Requests.newPatchRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handlePatch(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;PatchRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteActionVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(resource,&nbsp;&amp;quot;ACTION_ID&amp;quot;).setContent(json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleAction(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ActionRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteQueryVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;Requests.newQueryRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResultHandler&nbsp;handler&nbsp;=&nbsp;mock(QueryResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleQuery(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;QueryRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionRouterTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterTest.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,7&nbsp;+19,6&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.json.resource.RoutingMode.EQUALS;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-50,109&nbsp;+49,9&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@BeforeMethod<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;uriTemplate&nbsp;=&nbsp;&amp;quot;URI_TEMPLATE&amp;quot;;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter&nbsp;=&nbsp;new&nbsp;VersionRouter(router,&nbsp;EQUALS,&nbsp;uriTemplate);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter&nbsp;=&nbsp;new&nbsp;VersionRouter();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithRequestHandlerThenCollectionHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;handler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollectionResourceProvider&nbsp;otherHandler&nbsp;=&nbsp;mock(CollectionResourceProvider.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithRequestHandlerThenSingletonHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;handler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SingletonResourceProvider&nbsp;otherHandler&nbsp;=&nbsp;mock(SingletonResourceProvider.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithCollectionHandlerThenRequestHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollectionResourceProvider&nbsp;handler&nbsp;=&nbsp;mock(CollectionResourceProvider.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;otherHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithCollectionHandlerThenSingletonHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollectionResourceProvider&nbsp;handler&nbsp;=&nbsp;mock(CollectionResourceProvider.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SingletonResourceProvider&nbsp;otherHandler&nbsp;=&nbsp;mock(SingletonResourceProvider.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithSingletonHandlerThenRequestHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SingletonResourceProvider&nbsp;handler&nbsp;=&nbsp;mock(SingletonResourceProvider.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;otherHandler&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(expectedExceptions&nbsp;=&nbsp;IllegalArgumentException.class)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;addVersionWithSingletonHandlerThenCollectionHandlerShouldThrowIllegalArgumentException()&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SingletonResourceProvider&nbsp;handler&nbsp;=&nbsp;mock(SingletonResourceProvider.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollectionResourceProvider&nbsp;otherHandler&nbsp;=&nbsp;mock(CollectionResourceProvider.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;otherHandler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Expected&nbsp;IllegalArgumentException<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;data&amp;quot;)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataProvider()&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionRouterVersionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;delfile&quot;&gt;&lt;h4&gt;Deleted:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterVersionTest.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterVersionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterVersionTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-1,512&nbsp;+0,0&nbsp;@@<br>
&lt;/span&gt;&lt;del&gt;-/*<br>
-&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
-&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
-&nbsp;*&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
-&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
-&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
-&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
-&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
-&nbsp;*<br>
-&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
-&nbsp;*/<br>
-<br>
-package&nbsp;org.forgerock.json.resource;<br>
-<br>
-import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
-import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
-import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
-<br>
-import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
-import&nbsp;org.forgerock.json.resource.VersionSelector.DefaultVersionBehaviour;<br>
-import&nbsp;org.forgerock.resource.core.RootContext;<br>
-import&nbsp;org.mockito.ArgumentCaptor;<br>
-import&nbsp;org.mockito.Matchers;<br>
-import&nbsp;org.testng.annotations.BeforeClass;<br>
-import&nbsp;org.testng.annotations.DataProvider;<br>
-import&nbsp;org.testng.annotations.Test;<br>
-<br>
-/**<br>
-&nbsp;*&nbsp;@since&nbsp;2.4.0<br>
-&nbsp;*/<br>
-@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
-public&nbsp;class&nbsp;VersionRouterVersionTest&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Router&nbsp;router;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerOne;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerTwo;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerThree;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerOne;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerTwo;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerThree;<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@BeforeClass<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/users&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;usersHandlerOne)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersHandlerTwo)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;usersHandlerThree);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/groups&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;groupsHandlerOne)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&nbsp;&amp;quot;1.5&amp;quot;,&nbsp;groupsHandlerTwo)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataWithVersionHeader()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;3.0&amp;quot;,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.0&amp;quot;,&nbsp;false,&nbsp;groupsHandlerTwo},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;1.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerTwo},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.9&amp;quot;,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;groupsHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteCreateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;Requests.newCreateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleCreate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;CreateRequest&amp;gt;anyObject(),&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteReadVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;Requests.newReadRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleRead(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteUpdateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;Requests.newUpdateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleUpdate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;UpdateRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteDeleteVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;Requests.newDeleteRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleDelete(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;DeleteRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRoutePatchVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;Requests.newPatchRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handlePatch(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;PatchRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteActionVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(resource,&nbsp;&amp;quot;ACTION_ID&amp;quot;).setContent(json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleAction(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ActionRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteQueryVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;Requests.newQueryRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResultHandler&nbsp;handler&nbsp;=&nbsp;mock(QueryResultHandler.class);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleQuery(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;QueryRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataWithoutVersionHeader()&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.LATEST,&nbsp;false,&nbsp;usersHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.LATEST,&nbsp;false,&nbsp;groupsHandlerThree},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.OLDEST,&nbsp;false,&nbsp;usersHandlerOne},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.OLDEST,&nbsp;false,&nbsp;groupsHandlerOne},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.NONE,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.NONE,&nbsp;true,&nbsp;null},<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteCreateRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;Requests.newCreateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleCreate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;CreateRequest&amp;gt;anyObject(),&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteReadRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;Requests.newReadRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleRead(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteUpdateRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;Requests.newUpdateRequest(resource,&nbsp;json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleUpdate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;UpdateRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteDeleteRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;Requests.newDeleteRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleDelete(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;DeleteRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRoutePatchRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;Requests.newPatchRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handlePatch(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;PatchRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteActionRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(resource,&nbsp;&amp;quot;ACTION_ID&amp;quot;).setContent(json(object()));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleAction(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ActionRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
-&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteQueryRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;Requests.newQueryRequest(resource);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResultHandler&nbsp;handler&nbsp;=&nbsp;mock(QueryResultHandler.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(router,&nbsp;versionBehaviour);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleQuery(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;QueryRequest&amp;gt;anyObject(),<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-<br>
-&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;void&nbsp;setDefaultVersionBehaviour(Router&nbsp;router,&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(versionBehaviour)&nbsp;{<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;LATEST:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setVersioningToDefaultToLatest();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OLDEST:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setVersioningToDefaultToOldest();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;NONE:<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.setVersioningToDefaultToNone();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-&nbsp;&nbsp;&nbsp;&nbsp;}<br>
-}<br>
&lt;/del&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionedRouterTestjavafromrev2875forgerockrestbrancheshttpframeworkjsonresourcesrctestjavaorgforgerockjsonresourceVersionRouterVersionTestjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;copfile&quot;&gt;&lt;h4&gt;Copied:&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp;(from&nbsp;rev&nbsp;2875,&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionRouterVersionTest.java)&nbsp;(0&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rev&nbsp;0)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource/src/test/java/org/forgerock/json/resource/VersionedRouterTest.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-0,0&nbsp;+1,523&nbsp;@@<br>
&lt;/span&gt;&lt;ins&gt;+/*<br>
+&nbsp;*&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;are&nbsp;subject&nbsp;to&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;Common&nbsp;Development&nbsp;and<br>
+&nbsp;*&nbsp;Distribution&nbsp;License&nbsp;(the&nbsp;License).&nbsp;You&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the<br>
+&nbsp;*&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;You&nbsp;can&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the<br>
+&nbsp;*&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permission&nbsp;and&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;When&nbsp;distributing&nbsp;Covered&nbsp;Software,&nbsp;include&nbsp;this&nbsp;CDDL&nbsp;Header&nbsp;Notice&nbsp;in&nbsp;each&nbsp;file&nbsp;and&nbsp;include<br>
+&nbsp;*&nbsp;the&nbsp;License&nbsp;file&nbsp;at&nbsp;legal/CDDLv1.0.txt.&nbsp;If&nbsp;applicable,&nbsp;add&nbsp;the&nbsp;following&nbsp;below&nbsp;the&nbsp;CDDL<br>
+&nbsp;*&nbsp;Header,&nbsp;with&nbsp;the&nbsp;fields&nbsp;enclosed&nbsp;by&nbsp;brackets&nbsp;[]&nbsp;replaced&nbsp;by&nbsp;your&nbsp;own&nbsp;identifying<br>
+&nbsp;*&nbsp;information:&nbsp;&amp;quot;Portions&nbsp;copyright&nbsp;[year]&nbsp;[name&nbsp;of&nbsp;copyright&nbsp;owner]&amp;quot;.<br>
+&nbsp;*<br>
+&nbsp;*&nbsp;Copyright&nbsp;2014&nbsp;ForgeRock&nbsp;AS.<br>
+&nbsp;*/<br>
+<br>
+package&nbsp;org.forgerock.json.resource;<br>
+<br>
+import&nbsp;static&nbsp;org.assertj.core.api.Assertions.assertThat;<br>
+import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
+import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
+import&nbsp;static&nbsp;org.mockito.Matchers.eq;<br>
+import&nbsp;static&nbsp;org.mockito.Mockito.*;<br>
+<br>
+import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
+import&nbsp;org.forgerock.json.resource.VersionSelector.DefaultVersionBehaviour;<br>
+import&nbsp;org.forgerock.resource.core.RootContext;<br>
+import&nbsp;org.mockito.ArgumentCaptor;<br>
+import&nbsp;org.mockito.Matchers;<br>
+import&nbsp;org.testng.annotations.BeforeClass;<br>
+import&nbsp;org.testng.annotations.DataProvider;<br>
+import&nbsp;org.testng.annotations.Test;<br>
+<br>
+/**<br>
+&nbsp;*&nbsp;@since&nbsp;2.4.0<br>
+&nbsp;*/<br>
+@SuppressWarnings(&amp;quot;javadoc&amp;quot;)<br>
+public&nbsp;class&nbsp;VersionedRouterTest&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;UriRouter&nbsp;router;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionRouter&nbsp;versionRouter1;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;VersionRouter&nbsp;versionRouter2;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerOne;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerTwo;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;usersHandlerThree;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerOne;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerTwo;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;RequestHandler&nbsp;groupsHandlerThree;<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@BeforeClass<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usersHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerOne&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerThree&nbsp;=&nbsp;mock(RequestHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter1&nbsp;=&nbsp;new&nbsp;VersionRouter();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionRouter2&nbsp;=&nbsp;new&nbsp;VersionRouter();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/users&amp;quot;,&nbsp;versionRouter1<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;usersHandlerOne)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersHandlerTwo)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;usersHandlerThree));<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/groups&amp;quot;,&nbsp;versionRouter2<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;groupsHandlerOne)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;groupsHandlerTwo)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.1&amp;quot;,&nbsp;groupsHandlerThree));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataWithVersionHeader()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;3.0&amp;quot;,&nbsp;true,&nbsp;null},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.0&amp;quot;,&nbsp;false,&nbsp;groupsHandlerTwo},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;1.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerTwo},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;1.9&amp;quot;,&nbsp;true,&nbsp;null},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;usersHandlerThree},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;&amp;quot;2.1&amp;quot;,&nbsp;false,&nbsp;groupsHandlerThree},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteCreateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;Requests.newCreateRequest(resource,&nbsp;json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleCreate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;CreateRequest&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteReadVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;Requests.newReadRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleRead(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteUpdateVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;Requests.newUpdateRequest(resource,&nbsp;json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleUpdate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;UpdateRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteDeleteVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;Requests.newDeleteRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleDelete(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;DeleteRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRoutePatchVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;Requests.newPatchRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handlePatch(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;PatchRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteActionVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(resource,&nbsp;&amp;quot;ACTION_ID&amp;quot;).setContent(json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleAction(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ActionRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteQueryVersionRequests(String&nbsp;resource,&nbsp;String&nbsp;requestedVersion,&nbsp;boolean&nbsp;expectException,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withDefaultResourceVersion(requestedVersion).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;Requests.newQueryRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResultHandler&nbsp;handler&nbsp;=&nbsp;mock(QueryResultHandler.class);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(NotFoundException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleQuery(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;QueryRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@DataProvider(name&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object[][]&nbsp;dataWithoutVersionHeader()&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;Object[][]{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.LATEST,&nbsp;false,&nbsp;usersHandlerThree},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.LATEST,&nbsp;false,&nbsp;groupsHandlerThree},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.OLDEST,&nbsp;false,&nbsp;usersHandlerOne},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.OLDEST,&nbsp;false,&nbsp;groupsHandlerOne},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;users&amp;quot;,&nbsp;DefaultVersionBehaviour.NONE,&nbsp;true,&nbsp;null},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&amp;quot;groups&amp;quot;,&nbsp;DefaultVersionBehaviour.NONE,&nbsp;true,&nbsp;null},<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteCreateRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateRequest&nbsp;request&nbsp;=&nbsp;Requests.newCreateRequest(resource,&nbsp;json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleCreate(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleCreate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;CreateRequest&amp;gt;anyObject(),&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteReadRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadRequest&nbsp;request&nbsp;=&nbsp;Requests.newReadRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleRead(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleRead(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ReadRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteUpdateRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateRequest&nbsp;request&nbsp;=&nbsp;Requests.newUpdateRequest(resource,&nbsp;json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleUpdate(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleUpdate(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;UpdateRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteDeleteRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteRequest&nbsp;request&nbsp;=&nbsp;Requests.newDeleteRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleDelete(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleDelete(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;DeleteRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRoutePatchRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatchRequest&nbsp;request&nbsp;=&nbsp;Requests.newPatchRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;Resource&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handlePatch(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handlePatch(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;PatchRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteActionRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionRequest&nbsp;request&nbsp;=&nbsp;Requests.newActionRequest(resource,&nbsp;&amp;quot;ACTION_ID&amp;quot;).setContent(json(object()));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultHandler&amp;lt;JsonValue&amp;gt;&nbsp;handler&nbsp;=&nbsp;mock(ResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleAction(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleAction(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;ActionRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;@Test&nbsp;(dataProvider&nbsp;=&nbsp;&amp;quot;dataWithoutVersionHeader&amp;quot;)<br>
+&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;shouldRouteQueryRequestsUsingDefaultVersionBehaviour(String&nbsp;resource,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour,&nbsp;boolean&nbsp;expectException,&nbsp;RequestHandler&nbsp;provider)&nbsp;{<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Given<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersionContext&nbsp;apiVersionContext&nbsp;=&nbsp;new&nbsp;AcceptAPIVersionContext(new&nbsp;RootContext(),&nbsp;&amp;quot;PROTOCOL_NAME&amp;quot;,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AcceptAPIVersion.newBuilder().withDefaultProtocolVersion(&amp;quot;1.0&amp;quot;).build());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerContext&nbsp;context&nbsp;=&nbsp;new&nbsp;ServerContext(apiVersionContext);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryRequest&nbsp;request&nbsp;=&nbsp;Requests.newQueryRequest(resource);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryResultHandler&nbsp;handler&nbsp;=&nbsp;mock(QueryResultHandler.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter1,&nbsp;versionBehaviour);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setDefaultVersionBehaviour(versionRouter2,&nbsp;versionBehaviour);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//When<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.handleQuery(context,&nbsp;request,&nbsp;handler);<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Then<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(expectException)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgumentCaptor&amp;lt;ResourceException&amp;gt;&nbsp;exceptionCaptor&nbsp;=&nbsp;ArgumentCaptor.forClass(ResourceException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(handler).handleError(exceptionCaptor.capture());<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertThat(exceptionCaptor.getValue()).isInstanceOf(BadRequestException.class);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyZeroInteractions(usersHandlerOne,&nbsp;usersHandlerTwo,&nbsp;usersHandlerThree,&nbsp;groupsHandlerOne,<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groupsHandlerTwo,&nbsp;groupsHandlerThree);<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify(provider).handleQuery(Matchers.&amp;lt;ServerContext&amp;gt;anyObject(),&nbsp;Matchers.&amp;lt;QueryRequest&amp;gt;anyObject(),<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq(handler));<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+<br>
+&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;void&nbsp;setDefaultVersionBehaviour(VersionRouter&nbsp;router,&nbsp;DefaultVersionBehaviour&nbsp;versionBehaviour)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(versionBehaviour)&nbsp;{<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;LATEST:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.defaultToLatest();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;OLDEST:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.defaultToOldest();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;NONE:<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.noDefault();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+&nbsp;&nbsp;&nbsp;&nbsp;}<br>
+}<br>
&lt;/ins&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDemoUtilsjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DemoUtils.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,9&nbsp;+16,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.field;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.json;<br>
-import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.object;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.fluent.JsonValue.*;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newCreateRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-28,7&nbsp;+26,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.MemoryBackend;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.resource.core.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.resource.core.RootContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-59,7&nbsp;+57,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;ConnectionFactory&nbsp;getConnectionFactory()&nbsp;throws&nbsp;ResourceException&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;MemoryBackend&nbsp;users&nbsp;=&nbsp;new&nbsp;MemoryBackend();<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;users&amp;quot;,&nbsp;users);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Connection&nbsp;connection&nbsp;=&nbsp;newInternalConnection(router);<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection.create(ctx(),&nbsp;newCreateRequest(&amp;quot;users&amp;quot;,&nbsp;&amp;quot;1&amp;quot;,&nbsp;userAliceWithIdAndRev(1,&nbsp;0)));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesDynamicRealmDemojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/DynamicRealmDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-15,6&nbsp;+15,13&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.ctx;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.log;<br>
+<br>
+import&nbsp;java.util.Collections;<br>
+import&nbsp;java.util.LinkedList;<br>
+import&nbsp;java.util.List;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.AbstractRequestHandler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ActionRequest;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-33,19&nbsp;+40,12&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResultHandler;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.RouterContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.RoutingMode;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ServerContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;java.util.Collections;<br>
-import&nbsp;java.util.LinkedList;<br>
-import&nbsp;java.util.List;<br>
-<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.ctx;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.log;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;An&nbsp;example&nbsp;illustrating&nbsp;how&nbsp;you&nbsp;can&nbsp;route&nbsp;realms&nbsp;/&nbsp;sub-realm&nbsp;requests&nbsp;using<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;dynamic&nbsp;routing.&nbsp;Resource&nbsp;URLs&nbsp;are&nbsp;of&nbsp;the&nbsp;form<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-158,7&nbsp;+158,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including&nbsp;sub-realms,&nbsp;users,&nbsp;and&nbsp;groups.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;RequestHandler&nbsp;realm(final&nbsp;List&amp;lt;String&amp;gt;&nbsp;path)&nbsp;{<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/users&amp;quot;,&nbsp;collection(path,&nbsp;&amp;quot;user&amp;quot;));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/groups&amp;quot;,&nbsp;collection(path,&nbsp;&amp;quot;group&amp;quot;));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/{realm}&amp;quot;,&nbsp;subrealms(path));<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourceexamplessrcmainjavaorgforgerockjsonresourceexamplesVersionedResourcesDemojava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource-examples/src/main/java/org/forgerock/json/resource/examples/VersionedResourcesDemo.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-16,6&nbsp;+16,10&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;package&nbsp;org.forgerock.json.resource.examples;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newCreateRequest;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
+import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.*;<br>
+<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.fluent.JsonValue;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.AcceptAPIVersion;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.AcceptAPIVersionContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-35,17&nbsp;+39,14&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResourceException;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ResultHandler;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.RoutingMode;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.ServerContext;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.SingletonResourceProvider;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.UpdateRequest;<br>
&lt;/span&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.UriRouter;<br>
+import&nbsp;org.forgerock.json.resource.VersionRouter;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.resource.core.Context;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;static&nbsp;org.forgerock.json.resource.Requests.newCreateRequest;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.Resources.newInternalConnection;<br>
-import&nbsp;static&nbsp;org.forgerock.json.resource.examples.DemoUtils.*;<br>
-<br>
&lt;/del&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*&nbsp;An&nbsp;example&nbsp;client&nbsp;application&nbsp;which&nbsp;performs&nbsp;asynchronous&nbsp;reads&nbsp;against&nbsp;different&nbsp;versions&nbsp;of&nbsp;the&nbsp;same&nbsp;resource.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;*<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-110,21&nbsp;+111,21&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MemoryBackend&nbsp;groups&nbsp;=&nbsp;new&nbsp;MemoryBackend();<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/users&amp;quot;)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/users&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1&amp;quot;,&nbsp;usersV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;usersV1Dot5)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;usersV2Dot0);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;usersV2Dot0));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/roles&amp;quot;)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.EQUALS,&nbsp;&amp;quot;/roles&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;rolesV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;rolesV1Dot5)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;rolesV2Dot0);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;rolesV2Dot0));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;/config&amp;quot;)<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(RoutingMode.STARTS_WITH,&nbsp;&amp;quot;/config&amp;quot;,&nbsp;new&nbsp;VersionRouter()<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.0&amp;quot;,&nbsp;configV1Dot0)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;1.5&amp;quot;,&nbsp;configV1Dot5)<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;configV2Dot0);<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addVersion(&amp;quot;2.0&amp;quot;,&nbsp;configV2Dot0));<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ignores&nbsp;any&nbsp;version&nbsp;information.<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(&amp;quot;groups&amp;quot;,&nbsp;groups);<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;a&nbsp;id=&quot;forgerockrestbrancheshttpframeworkjsonresourcehttpsrcmainjavaorgforgerockjsonresourcehttpMemoryBackendConnectionFactoryProviderjava&quot;&gt;&lt;/a&gt;<br>
&lt;div&nbsp;class=&quot;modfile&quot;&gt;&lt;h4&gt;Modified:&nbsp;forgerock-rest/branches/http-framework/json-resource-http/src/main/java/org/forgerock/json/resource/http/MemoryBackendConnectionFactoryProvider.java&nbsp;(2875&nbsp;=&gt;&nbsp;2876)&lt;/h4&gt;<br>
&lt;pre&nbsp;class=&quot;diff&quot;&gt;&lt;span&gt;<br>
&lt;span&nbsp;class=&quot;info&quot;&gt;---&nbsp;forgerock-rest/branches/http-framework/json-resource-http/src/main/java/org/forgerock/json/resource/http/MemoryBackendConnectionFactoryProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:47&nbsp;UTC&nbsp;(rev&nbsp;2875)<br>
+++&nbsp;forgerock-rest/branches/http-framework/json-resource-http/src/main/java/org/forgerock/json/resource/http/MemoryBackendConnectionFactoryProvider.java&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2015-01-28&nbsp;14:58:54&nbsp;UTC&nbsp;(rev&nbsp;2876)<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-19,7&nbsp;+19,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.http.Handler;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.MemoryBackend;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.json.resource.Resources;<br>
&lt;/span&gt;&lt;del&gt;-import&nbsp;org.forgerock.json.resource.Router;<br>
&lt;/del&gt;&lt;ins&gt;+import&nbsp;org.forgerock.json.resource.UriRouter;<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;import&nbsp;org.forgerock.util.Reject;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;/**<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;lines&quot;&gt;@@&nbsp;-34,7&nbsp;+34,7&nbsp;@@<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;Handler&nbsp;getConnectionFactory(String&nbsp;uriTemplate)&nbsp;{<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reject.ifNull(uriTemplate,&nbsp;&amp;quot;uriTemplate&nbsp;cannot&nbsp;be&nbsp;null&amp;quot;);<br>
&lt;/span&gt;&lt;del&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Router&nbsp;router&nbsp;=&nbsp;new&nbsp;Router();<br>
&lt;/del&gt;&lt;ins&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;UriRouter&nbsp;router&nbsp;=&nbsp;new&nbsp;UriRouter();<br>
&lt;/ins&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;router.addRoute(uriTemplate,&nbsp;new&nbsp;MemoryBackend());<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CrestHandler.newHandler(Resources.newInternalConnectionFactory(router));<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;cx&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;footer&quot;&gt;Copyright&nbsp;(c)&nbsp;by&nbsp;ForgeRock.&nbsp;All&nbsp;rights&nbsp;reserved.&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
